<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.5">
<title>Introduction</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
<style>
/* Global Navbar */

ul#globalnav {
    background-color: #ededed;

    list-style: none;
    width: 100%;
    margin: 0;
    padding: 0;

    overflow: hidden;
    position: fixed;
    left: 0px;
    top: 0px;
    font-size: 0.6em;
    height: 30px;
}

ul#globalnav::after {
    content: "";
    display: block;
    clear: both;
}

ul#globalnav li {
    float: left;
}

ul#globalnav li a {
    display: inline-block;
    color: #004670;
    text-align: center;
    padding: 0.75em;
    text-decoration: none;
}

ul#globalnav li a:hover {
    color: #428bca;
}

#toc.toc2 {
    top: 30px;
    bottom: 0px;
    height: unset;
}

body.toc2 {
    padding-top: 30px;
}

@media only screen and (min-width:768px) {
    ul#globalnav {
        font-size: 0.75em;
        height: 40px;
    }

    #toc.toc2 {
        top: 40px;
    }

    body.toc2 {
        padding-top: 40px;
    }
}

@media only screen and (min-width:1280px) {
    ul#globalnav {
        font-size: 1em;
        height: 48px;
    }

    #toc.toc2 {
        top: 48px;
    }

    body.toc2 {
        padding-top: 48px;
    }
}

</style>

<style>
/* General Changes */

h1, h2, h3, #toctitle, .sidebarblock>.content>.title, h4, h5, h6 {
    color: #444444;
    font-weight: 500;
}

a {
    color: #004670;
    text-decoration: none;
}

a:hover {
    color: #7da1dc;
}

body {
    font-family: "Open Sans","DejaVu Sans",sans-serif;
    color: #444444;
}

.subheader, .admonitionblock td.content>.title, .audioblock>.title, .exampleblock>.title, .imageblock>.title, .listingblock>.title, .literalblock>.title, .stemblock>.title, .openblock>.title, .paragraph>.title, .quoteblock>.title, table.tableblock>.title, .verseblock>.title, .videoblock>.title, .dlist>.title, .olist>.title, .ulist>.title, .qlist>.title, .hdlist>.title {
    color: #444444;
}

.admonitionblock td.content>.title, .audioblock>.title, .exampleblock>.title, .imageblock>.title, .listingblock>.title, .literalblock>.title, .stemblock>.title, .openblock>.title, .paragraph>.title, .quoteblock>.title, table.tableblock>.title, .verseblock>.title, .videoblock>.title, .dlist>.title, .olist>.title, .ulist>.title, .qlist>.title, .hdlist>.title {
    font-family: "Open Sans","DejaVu Sans",sans-serif;
    font-style: normal;
}

span.image img {
    border:1px solid #ccc;
    -webkit-box-shadow: 3px 3px 15px 0px rgba(0,0,0,0.5);
    -moz-box-shadow: 3px 3px 15px 0px rgba(0,0,0,0.5);
    box-shadow: 3px 3px 15px 0px rgba(0,0,0,0.5);
}

.sect1+.sect1 {
    border-top: none;
}

.page-links {
    border-bottom: 1px solid #efefed;
    border-top: none;
    background: none;
    position: relative;
    left: 0em;
    width: 100%;
    top: -5em;
    height: 0;
    margin: 0;
    padding: 0;
}

.sect2 .page-links {
    top: -3.5em;
}

.page-links .content {
    background: #f8f8f7;
    border: 1px solid #e0e0dc;
    float: right;
    font-size: 0.8em;
    margin: 0;
    padding: 5px;
}

.page-links a {
    display: block;
    padding: 5px;
}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#introduction">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#what-is-red-hat-single-sign-on">1.1. What Is Red Hat Single Sign-On?</a></li>
</ul>
</li>
<li><a href="#before-you-begin">2. Before You Begin</a>
<ul class="sectlevel2">
<li><a href="#comparison-rh-sso-for-openshift-image-and-red-hat-single-sign-on">2.1. Comparison: RH-SSO for OpenShift Image and Red Hat Single Sign-On</a></li>
<li><a href="#version-compatibility-and-support">2.2. Version Compatibility and Support</a></li>
<li><a href="#deprecated-image-streams-and-application-templates-for-rh-sso-for-openshift">2.3. Deprecated Image Streams and Application Templates for RH-SSO for OpenShift</a></li>
<li><a href="#initial-setup">2.4. Initial Setup</a></li>
</ul>
</li>
<li><a href="#get-started">3. Get Started</a>
<ul class="sectlevel2">
<li><a href="#using-the-rh-sso-for-openshift-image-streams-and-application-templates">3.1. Using the RH-SSO for OpenShift Image Streams and Application Templates</a></li>
<li><a href="#preparing-and-deploying-the-rh-sso-for-openshift-application-templates">3.2. Preparing and Deploying the RH-SSO for OpenShift Application Templates</a>
<ul class="sectlevel3">
<li><a href="#Configuring-Keystores">3.2.1. Configuring Keystores</a></li>
<li><a href="#generating-secrets">3.2.2. Generating Secrets</a></li>
<li><a href="#sso-administrator-setup">3.2.3. Creating Administrator Account for Red Hat Single Sign-On Server</a></li>
<li><a href="#using-the-openshift-web-console">3.2.4. Using the OpenShift Web Console</a></li>
<li><a href="#routes">3.2.5. Routes</a></li>
<li><a href="#deployment-process">3.2.6. Deployment Process</a></li>
<li><a href="#SSO-Clients">3.2.7. RH-SSO Clients</a></li>
<li><a href="#Auto-Man-Client-Reg">3.2.8. Automatic and Manual RH-SSO Client Registration Methods</a></li>
<li><a href="#automatic-rh-sso-client-registration">3.2.9. Automatic RH-SSO Client Registration</a></li>
<li><a href="#manual-rh-sso-client-registration">3.2.10. Manual RH-SSO Client Registration</a></li>
<li><a href="#limitations">3.2.11. Limitations</a></li>
</ul>
</li>
<li><a href="#binary-builds">3.3. Binary Builds</a>
<ul class="sectlevel3">
<li><a href="#deploy-binary-build-of-eap-6-4-7-0-jsp-service-invocation-application-that-authenticates-using-red-hat-single-sign-on">3.3.1. Deploy Binary Build of EAP 6.4 / 7.0 JSP Service Invocation Application that Authenticates Using Red Hat Single Sign-On</a></li>
</ul>
</li>
<li><a href="#RH-SSO-Binary-Builds-Tutorial">3.4. Example Workflow: Creating OpenShift Application from Existing Maven Binaries and Securing it Using Red Hat Single Sing-On</a></li>
</ul>
</li>
<li><a href="#tutorials">4. Tutorials</a>
<ul class="sectlevel2">
<li><a href="#Example-Deploying-SSO">4.1. Example Workflow: Preparing and Deploying the RH-SSO for OpenShift image</a>
<ul class="sectlevel3">
<li><a href="#Preparing-SSO-Authentication-for-OpenShift-Deployment">4.1.1. Preparing RH-SSO Authentication for OpenShift Deployment</a></li>
<li><a href="#deploy-binary-build-of-eap-6-4-7-0-jsp-service-invocation-application-and-secure-it-using-red-hat-single-sign-on">4.1.2. Deploy Binary Build of EAP 6.4 / 7.0 JSP Service Invocation Application and Secure it Using Red Hat Single Sign-On</a></li>
</ul>
</li>
<li><a href="#upgrading-sso-db-from-70-to-71">4.2. Example Workflow: Updating Existing Database when Migrating RH-SSO for OpenShift Image to a new version</a>
<ul class="sectlevel3">
<li><a href="#automatic-db-migration">4.2.1. Automatic Database Migration</a></li>
<li><a href="#manual-db-migration">4.2.2. Manual Database Migration</a></li>
</ul>
</li>
<li><a href="#example-workflow-migrating-entire-rh-sso-server-database-across-the-environments">4.3. Example Workflow: Migrating Entire RH-SSO Server Database Across The Environments</a>
<ul class="sectlevel3">
<li><a href="#deploying-the-rh-sso-mysql-application-template">4.3.1. Deploying the RH-SSO MySQL Application Template</a></li>
<li><a href="#optional-creating-additional-rh-sso-a-href-https-access-redhat-com-documentation-en-us-red_hat_single_sign-on-7-2-html-single-server_administration_guide-core_concepts_and_terms-realm-and-users-a-to-be-also-exported">4.3.2. (Optional) Creating additional RH-SSO <a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.2/html-single/server_administration_guide/#core_concepts_and_terms">realm and users</a> to be also exported</a></li>
<li><a href="#sso-export-the-database">4.3.3. Export the RH-SSO database as a JSON file on the OpenShift pod</a></li>
<li><a href="#retrieve-and-import-the-exported-json-file">4.3.4. Retrieve and import the exported JSON file</a></li>
</ul>
</li>
<li><a href="#OSE-SSO-AUTH-TUTE">4.4. Example Workflow: Configuring OpenShift to use RH-SSO for Authentication</a>
<ul class="sectlevel3">
<li><a href="#configuring-rh-sso-credentials">4.4.1. Configuring RH-SSO Credentials</a></li>
<li><a href="#configuring-openshift-master-for-red-hat-single-sign-on-authentication">4.4.2. Configuring OpenShift Master for Red Hat Single Sign-On Authentication</a></li>
<li><a href="#logging-in-to-openshift">4.4.3. Logging in to OpenShift</a></li>
</ul>
</li>
<li><a href="#Example-EAP-Auto">4.5. Example Workflow: Automatically Registering EAP Application in RH-SSO with OpenID-Connect Client</a>
<ul class="sectlevel3">
<li><a href="#preparing-rh-sso-authentication-for-openshift-deployment">4.5.1. Preparing RH-SSO Authentication for OpenShift Deployment</a></li>
<li><a href="#preparing-the-rh-sso-credentials">4.5.2. Preparing the RH-SSO Credentials</a></li>
<li><a href="#deploy-the-rh-sso-enabled-jboss-eap-image">4.5.3. Deploy the RH-SSO-enabled JBoss EAP Image</a></li>
<li><a href="#log-in-to-the-jboss-eap-server-using-rh-sso">4.5.4. Log in to the JBoss EAP Server Using RH-SSO</a></li>
</ul>
</li>
<li><a href="#Example-EAP-Manual">4.6. Example Workflow: Manually Registering EAP Application in RH-SSO with SAML Client</a>
<ul class="sectlevel3">
<li><a href="#preparing-the-rh-sso-credentials-2">4.6.1. Preparing the RH-SSO Credentials</a></li>
<li><a href="#preparing-rh-sso-authentication-for-openshift-deployment-2">4.6.2. Preparing RH-SSO Authentication for OpenShift Deployment</a></li>
<li><a href="#modified-saml-xml">4.6.3. Modifying the <strong>secure-saml-deployments</strong> File</a></li>
<li><a href="#configuring-saml-client-registration-in-the-application-strong-web-xml-strong">4.6.4. Configuring SAML Client Registration in the Application <strong>web.xml</strong></a></li>
<li><a href="#deploying-the-application">4.6.5. Deploying the Application</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#reference">5. Reference</a>
<ul class="sectlevel2">
<li><a href="#sso-artifact-repository-mirrors-section">5.1. Artifact Repository Mirrors</a></li>
<li><a href="#env_vars">5.2. Environment Variables</a>
<ul class="sectlevel3">
<li><a href="#information-environment-variables">5.2.1. Information Environment Variables</a></li>
<li><a href="#configuration-environment-variables">5.2.2. Configuration Environment Variables</a></li>
<li><a href="#template-variables-for-all-rh-sso-images">5.2.3. Template variables for all RH-SSO images</a></li>
<li><a href="#template-variables-specific-to-strong-em-sso72-mysql-em-strong-strong-em-sso72-mysql-persistent-em-strong-and-strong-em-sso72-x509-mysql-persistent-em-strong">5.2.4. Template variables specific to <strong><em>sso72-mysql</em></strong>, <strong><em>sso72-mysql-persistent</em></strong>, and <strong><em>sso72-x509-mysql-persistent</em></strong></a></li>
<li><a href="#template-variables-specific-to-strong-em-sso72-postgresql-em-strong-strong-em-sso72-postgresql-persistent-em-strong-and-strong-em-sso72-x509-postgresql-persistent-em-strong">5.2.5. Template variables specific to <strong><em>sso72-postgresql</em></strong>, <strong><em>sso72-postgresql-persistent</em></strong>, and <strong><em>sso72-x509-postgresql-persistent</em></strong></a></li>
<li><a href="#template-variables-specific-to-strong-em-sso72-mysql-persistent-em-strong-strong-em-sso72-x509-mysql-persistent-em-strong-strong-em-sso72-postgresql-persistent-em-strong-and-strong-em-sso72-x509-postgresql-persistent-em-strong">5.2.6. Template variables specific to <strong><em>sso72-mysql-persistent</em></strong>, <strong><em>sso72-x509-mysql-persistent</em></strong>, <strong><em>sso72-postgresql-persistent</em></strong>, and <strong><em>sso72-x509-postgresql-persistent</em></strong></a></li>
<li><a href="#template-variables-for-general-strong-eap64-strong-strong-eap70-strong-and-strong-eap71-strong-s2i-images">5.2.7. Template variables for general <strong>eap64</strong>, <strong>eap70</strong>, and <strong>eap71</strong> S2I images</a></li>
<li><a href="#template-variables-specific-to-strong-em-eap64-sso-s2i-em-strong-strong-em-eap70-sso-s2i-em-strong-and-strong-em-eap71-sso-s2i-em-strong-for-automatic-client-registration">5.2.8. Template variables specific to <strong><em>eap64-sso-s2i</em></strong>, <strong><em>eap70-sso-s2i</em></strong>, and <strong><em>eap71-sso-s2i</em></strong> for automatic client registration</a></li>
<li><a href="#template-variables-specific-to-strong-em-eap64-sso-s2i-em-strong-strong-em-eap70-sso-s2i-em-strong-and-strong-em-eap71-sso-s2i-em-strong-for-automatic-client-registration-with-saml-clients">5.2.9. Template variables specific to <strong><em>eap64-sso-s2i</em></strong>, <strong><em>eap70-sso-s2i</em></strong>, and <strong><em>eap71-sso-s2i</em></strong> for automatic client registration with SAML clients</a></li>
</ul>
</li>
<li><a href="#exposed-ports">5.3. Exposed Ports</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="introduction"><a class="anchor" href="#introduction"></a>1. Introduction</h2>
<div class="sectionbody">
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak-documentation/blob/master/openshift/topics/introduction.adoc" target="_blank">Edit this section</a>
<a href="https://issues.jboss.org/secure/CreateIssueDetails!init.jspa?pid=12313920&amp;components=12323375&amp;issuetype=1&amp;priority=3&amp;description=File:%20openshift/topics/introduction.adoc" target="_blank">Report an issue</a>
</div>
</div>
<div class="sect2">
<h3 id="what-is-red-hat-single-sign-on"><a class="anchor" href="#what-is-red-hat-single-sign-on"></a>1.1. What Is Red Hat Single Sign-On?</h3>
<div class="paragraph">
<p>Red Hat Single Sign-On (RH-SSO) is an integrated sign-on solution available as a Red Hat JBoss Middleware for OpenShift containerized image. The Red Hat Single Sign-On for OpenShift image provides an authentication server for users to centrally log in, log out, register, and manage user accounts for web applications, mobile applications, and RESTful web services.</p>
</div>
<div id="sso-templates" class="paragraph">
<p>Red Hat offers multiple OpenShift application templates utilizing the RH-SSO for OpenShift image version number 7.2. These define the resources needed to develop Red Hat Single Sign-On 7.2 server based deployment and can be split into the following two categories:</p>
</div>
<div id="passthrough-templates" class="ulist">
<ul>
<li>
<p>Templates using HTTPS and JGroups keystores and a truststore for the RH-SSO server, all prepared beforehand. These secure the TLS communication using <a href="https://docs.openshift.com/container-platform/latest/architecture/networking/routes.html#passthrough-termination">passthrough TLS termination</a>:</p>
<div class="ulist">
<ul>
<li>
<p><strong><em>sso72-https</em></strong>: RH-SSO 7.2 backed by internal H2 database on the same pod.</p>
</li>
<li>
<p><strong><em>sso72-mysql</em></strong>: RH-SSO 7.2 backed by ephemeral MySQL database on a separate pod.</p>
</li>
<li>
<p><strong><em>sso72-mysql-persistent</em></strong>: RH-SSO 7.2 backed by persistent MySQL database on a separate pod.</p>
</li>
<li>
<p><strong><em>sso72-postgresql</em></strong>: RH-SSO 7.2 backed by ephemeral PostgreSQL database on a separate pod.</p>
</li>
<li>
<p><strong><em>sso72-postgresql-persistent</em></strong>: RH-SSO 7.2 backed by persistent PostgreSQL database on a separate pod.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div id="reencrypt-templates" class="ulist">
<ul>
<li>
<p>Templates using OpenShift&#8217;s internal <a href="https://docs.openshift.com/container-platform/latest/dev_guide/secrets.html#service-serving-certificate-secrets">service serving x509 certificate secrets</a> to automatically create the HTTPS keystore used for serving secure content. The JGroups cluster traffic is authenticated using the <code>AUTH</code> protocol and encrypted using the <code>ASYM_ENCRYPT</code> protocol. The RH-SSO server truststore is also created automatically, containing the <strong>/var/run/secrets/kubernetes.io/serviceaccount/service-ca.crt</strong> CA certificate file, which is used to sign the certificate for HTTPS keystore. Moreover, the truststore for the RH-SSO server is pre-populated with the all known, trusted CA certificate files found in the Java system path. These templates secure the TLS communication using <a href="https://docs.openshift.com/container-platform/latest/architecture/networking/routes.html#re-encryption-termination">re-encryption TLS termination</a>:</p>
<div class="ulist">
<ul>
<li>
<p><strong><em>sso72-x509-https</em></strong>: RH-SSO 7.2 with auto-generated HTTPS keystore and RH-SSO truststore, backed by internal H2 database. The <code>ASYM_ENCRYPT</code> JGroups protocol is used for encryption of cluster traffic.</p>
</li>
<li>
<p><strong><em>sso72-x509-mysql-persistent</em></strong>: RH-SSO 7.2 with auto-generated HTTPS keystore and RH-SSO truststore, backed by persistent MySQL database. The <code>ASYM_ENCRYPT</code> JGroups protocol is used for encryption of cluster traffic.</p>
</li>
<li>
<p><strong><em>sso72-x509-postgresql-persistent</em></strong>: RH-SSO 7.2 with auto-generated HTTPS keystore and RH-SSO truststore, backed by persistent PostgreSQL database. The <code>ASYM_ENCRYPT</code> JGroups protocol is used for encryption of cluster traffic.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Other templates that integrate with RH-SSO are also available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><em>eap64-sso-s2i</em></strong>: RH-SSO-enabled Red Hat JBoss Enterprise Application Platform 6.4.</p>
</li>
<li>
<p><strong><em>eap70-sso-s2i</em></strong>: RH-SSO-enabled Red Hat JBoss Enterprise Application Platform 7.0.</p>
</li>
<li>
<p><strong><em>eap71-sso-s2i</em></strong>: RH-SSO enabled Red Hat JBoss Enterprise Application Platform 7.1.</p>
</li>
<li>
<p><strong><em>datavirt63-secure-s2i</em></strong>: RH-SSO-enabled Red Hat JBoss Data Virtualization 6.3.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These templates contain environment variables specific to RH-SSO that enable automatic RH-SSO client registration when deployed.</p>
</div>
<div class="paragraph">
<p>See <a href="#Auto-Man-Client-Reg">Automatic and Manual RH-SSO Client Registration Methods</a> for more information.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="before-you-begin"><a class="anchor" href="#before-you-begin"></a>2. Before You Begin</h2>
<div class="sectionbody">
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak-documentation/blob/master/openshift/topics/before_you_begin.adoc" target="_blank">Edit this section</a>
<a href="https://issues.jboss.org/secure/CreateIssueDetails!init.jspa?pid=12313920&amp;components=12323375&amp;issuetype=1&amp;priority=3&amp;description=File:%20openshift/topics/before_you_begin.adoc" target="_blank">Report an issue</a>
</div>
</div>
<div class="sect2">
<h3 id="comparison-rh-sso-for-openshift-image-and-red-hat-single-sign-on"><a class="anchor" href="#comparison-rh-sso-for-openshift-image-and-red-hat-single-sign-on"></a>2.1. Comparison: RH-SSO for OpenShift Image and Red Hat Single Sign-On</h3>
<div class="paragraph">
<p>The RH-SSO for OpenShift image version number 7.2 is based on Red Hat Single Sign-On 7.2. There are some differences in functionality between the RH-SSO for OpenShift image and Red Hat Single Sign-On:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The RH-SSO for OpenShift image includes all of the functionality of Red Hat Single Sign-On. In addition, the RH-SSO-enabled JBoss EAP image automatically handles OpenID Connect or SAML client registration and configuration for <strong><em>.war</em></strong> deployments that contain <strong>&lt;auth-method&gt;KEYCLOAK&lt;/auth-method&gt;</strong> or <strong>&lt;auth-method&gt;KEYCLOAK-SAML&lt;/auth-method&gt;</strong> in their respective <strong>web.xml</strong> files.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="version-compatibility-and-support"><a class="anchor" href="#version-compatibility-and-support"></a>2.2. Version Compatibility and Support</h3>
<div class="paragraph">
<p>See the xPaaS part of the <a href="https://access.redhat.com/articles/2176281">OpenShift and Atomic Platform Tested Integrations page</a> for details about OpenShift image version compatibility.</p>
</div>
</div>
<div class="sect2">
<h3 id="deprecated-image-streams-and-application-templates-for-rh-sso-for-openshift"><a class="anchor" href="#deprecated-image-streams-and-application-templates-for-rh-sso-for-openshift"></a>2.3. Deprecated Image Streams and Application Templates for RH-SSO for OpenShift</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The RH-SSO for OpenShift image version number 7.0 and 7.1 are deprecated and they will no longer receive updates of image and application templates.</p>
</div>
<div class="paragraph">
<p><strong>To deploy new applications, it is recommended to use the version 7.2 of the RH-SSO for OpenShift image along with the application templates specific to that version.</strong></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="initial-setup"><a class="anchor" href="#initial-setup"></a>2.4. Initial Setup</h3>
<div class="paragraph">
<p>The Tutorials in this guide follow on from and assume an OpenShift instance similar to that created in the <a href="https://access.redhat.com/documentation/en/red-hat-xpaas/0/single/openshift-primer">OpenShift Primer</a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For information related to updating the existing database when migrating RH-SSO for OpenShift image from RH-SSO 7.0 to RH-SSO 7.1, or from RH-SSO 7.1 to RH-SSO 7.2, see the <a href="../tutorials/tutorials.html#upgrading-sso-db-from-70-to-71">Updating Existing Database when Migrating RH-SSO for OpenShift Image to a new version</a> section.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="get-started"><a class="anchor" href="#get-started"></a>3. Get Started</h2>
<div class="sectionbody">
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak-documentation/blob/master/openshift/topics/get_started.adoc" target="_blank">Edit this section</a>
<a href="https://issues.jboss.org/secure/CreateIssueDetails!init.jspa?pid=12313920&amp;components=12323375&amp;issuetype=1&amp;priority=3&amp;description=File:%20openshift/topics/get_started.adoc" target="_blank">Report an issue</a>
</div>
</div>
<div class="sect2">
<h3 id="using-the-rh-sso-for-openshift-image-streams-and-application-templates"><a class="anchor" href="#using-the-rh-sso-for-openshift-image-streams-and-application-templates"></a>3.1. Using the RH-SSO for OpenShift Image Streams and Application Templates</h3>
<div class="paragraph">
<p>Red Hat JBoss Middleware for OpenShift images are pulled on demand from the Red Hat Registry: <a href="https://access.redhat.com/containers/">registry.access.redhat.com</a>. To update to the latest RH-SSO for OpenShift images, run the following commands:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On your master host(s), ensure that you are logged in as a cluster administrator or a user with project administrator access to the global <code>openshift</code> project.</p>
<div class="listingblock">
<div class="content">
<pre>$ oc login -u system:admin</pre>
</div>
</div>
</li>
<li>
<p>Run the following commands to update the core set of RH-SSO 7.2 resources for OpenShift in the <code>openshift</code> project:</p>
<div class="listingblock">
<div class="content">
<pre>$ for resource in sso72-image-stream.json \
  sso72-https.json \
  sso72-mysql-persistent.json \
  sso72-mysql.json \
  sso72-postgresql-persistent.json \
  sso72-postgresql.json
do
  oc replace -n openshift --force -f \
  https://raw.githubusercontent.com/jboss-openshift/application-templates/ose-v1.4.9/sso/${resource}
done</pre>
</div>
</div>
</li>
<li>
<p>Run the following command to install the RH-SSO 7.2 OpenShift image streams in the <code>openshift</code> project:</p>
<div class="listingblock">
<div class="content">
<pre>$ oc -n openshift import-image redhat-sso72-openshift:1.0</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="preparing-and-deploying-the-rh-sso-for-openshift-application-templates"><a class="anchor" href="#preparing-and-deploying-the-rh-sso-for-openshift-application-templates"></a>3.2. Preparing and Deploying the RH-SSO for OpenShift Application Templates</h3>
<div class="sect3">
<h4 id="Configuring-Keystores"><a class="anchor" href="#Configuring-Keystores"></a>3.2.1. Configuring Keystores</h4>
<div class="paragraph">
<p>The RH-SSO for OpenShift image requires two keystores:<br>
- An SSL keystore to provide private and public keys for https traffic encryption.<br>
- A JGroups keystore to provide private and public keys for network traffic encryption between nodes in the cluster.</p>
</div>
<div class="paragraph">
<p>These keystores are expected by the RH-SSO for OpenShift image, even if the application uses only http on a single-node OpenShift instance. Self-signed certificates do not provide secure communication and are intended for internal testing purposes.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
For production environments Red Hat recommends that you use your own SSL certificate purchased from a verified Certificate Authority (CA) for SSL-encrypted connections (HTTPS).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See the <a href="https://access.redhat.com/documentation/en-us/jboss_enterprise_application_platform/6.1/html-single/security_guide/index#Generate_a_SSL_Encryption_Key_and_Certificate">JBoss Enterprise Application Platform Security Guide</a> for more information on how to create a keystore with self-signed or purchased SSL certificates.</p>
</div>
</div>
<div class="sect3">
<h4 id="generating-secrets"><a class="anchor" href="#generating-secrets"></a>3.2.2. Generating Secrets</h4>
<div class="paragraph">
<p>OpenShift uses objects called <code>Secrets</code> to hold sensitive information, such as passwords or keystores. See the <a href="https://access.redhat.com/documentation/en-us/openshift_enterprise/3.2/html-single/developer_guide/index#dev-guide-secrets">Secrets chapter</a> in the OpenShift documentation for more information.</p>
</div>
<div class="paragraph">
<p>The RH-SSO for OpenShift image requires one or more secrets that hold the two keystores described earlier. This provides the necessary authorization to applications in the project.</p>
</div>
<div class="paragraph">
<p>Use the SSL and JGroups keystore files to create secrets for the project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ oc secret new &lt;<em>sso-ssl-secret</em>&gt; &lt;<em>ssl.jks</em>&gt;
$ oc secret new &lt;<em>sso-jgroups-secret</em>&gt; &lt;<em>jgroups.jceks</em>&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sso-administrator-setup"><a class="anchor" href="#sso-administrator-setup"></a>3.2.3. Creating Administrator Account for Red Hat Single Sign-On Server</h4>
<div class="paragraph">
<p>Red Hat Single Sign-On does not provide any pre-configured management account out of the box. This administrator account is necessary for logging into the <code>master</code> realm&#8217;s management console and perform server maintenance operations such as, creating realms or users, or registering applications intended to be secured by Red Hat Single Sign-On.</p>
</div>
<div class="paragraph">
<p>The administrator account can be created:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>By providing values for the <a href="#sso-admin-template-parameters"><strong><em>SSO_ADMIN_USERNAME</em></strong> and <strong><em>SSO_ADMIN_PASSWORD</em></strong> parameters</a>, when deploying the RH-SSO application template, or</p>
</li>
<li>
<p>By <a href="#sso-admin-remote-shell">a remote shell session to particular RH-SSO pod</a>, if the RH-SSO for OpenShift image is deployed without an application template.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Red Hat Single Sign-On allows an initial administrator account creation via the <a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.2/html-single/getting_started_guide/#creating_the_admin_account">Welcome Page</a> web form. But only if the <code>Welcome Page</code> is accessed from a localhost, this method of administrator account creation is not applicable for RH-SSO for OpenShift image.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="sso-admin-template-parameters"><a class="anchor" href="#sso-admin-template-parameters"></a>Creating RH-SSO Administrator Account via Template Parameters</h5>
<div class="paragraph">
<p>When deploying RH-SSO application template, <strong><em>SSO_ADMIN_USERNAME</em></strong> and <strong><em>SSO_ADMIN_PASSWORD</em></strong> parameters denote the username and password of the RH-SSO server&#8217;s administrator account to be created for the <code>master</code> realm.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>Both of these parameters are required.</strong> If not specified, they are auto generated and displayed as an OpenShift instructional message when the template is instantiated.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The lifespan of the RH-SSO server&#8217;s administrator account depends upon the the storage type used to store the RH-SSO server&#8217;s database:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For an in-memory database mode (<strong><em>sso71-https</em></strong> and <strong><em>sso72-https</em></strong> templates) the account exist throughout the lifecycle of the particular RH-SSO pod (stored account data is lost upon pod destruction),</p>
</li>
<li>
<p>For an ephemeral database mode (<strong><em>sso71-mysql</em></strong>, <strong><em>sso71-postgresql</em></strong>, <strong><em>sso72-mysql</em></strong>, and <strong><em>sso72-postgresql</em></strong> templates) the account exist throughout the lifecycle of the database pod (even if RH-SSO pod is destructed, the stored account data is preserved under the assumption that the database pod is still running),</p>
</li>
<li>
<p>For persistent database mode (<strong><em>sso71-mysql-persistent</em></strong>, <strong><em>sso71-postgresql-persistent</em></strong>, <strong><em>sso72-mysql-persistent</em></strong>, and <strong><em>sso72-postgresql-persistent</em></strong> templates) the account exists throughout the lifecycle of the persistent medium used to hold the database data. This means that the stored account data is preserved even when both, the RH-SSO and the database pods are destructed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is a common practice to deploy an RH-SSO application template to get the corresponding OpenShift deployment config for the application, and then reuse that deployment config multiple times (every time a new RH-SSO application needs to be instantiated).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In the case of <strong>ephemeral or persistent database mode</strong>, after creating the RH_SSO server&#8217;s administrator account, remove the <strong><em>SSO_ADMIN_USERNAME</em></strong> and <strong><em>SSO_ADMIN_PASSWORD</em></strong> variables from the deployment config before deploying new RH-SSO applications.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Run the following commands to prepare the previously created deployment config of the RH-SSO application for reuse after the administrator account has been created:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Identify the deployment config of the RH-SSO application.</p>
<div class="listingblock">
<div class="content">
<pre>$ oc get dc -o name
deploymentconfig/sso
deploymentconfig/sso-mysql</pre>
</div>
</div>
</li>
<li>
<p>Clear the <strong><em>SSO_ADMIN_USERNAME</em></strong> and <strong><em>SSO_ADMIN_PASSWORD</em></strong> variables setting.</p>
<div class="listingblock">
<div class="content">
<pre>$ oc env dc/sso -e SSO_ADMIN_USERNAME="" SSO_ADMIN_PASSWORD=""</pre>
</div>
</div>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="sso-admin-remote-shell"><a class="anchor" href="#sso-admin-remote-shell"></a>Creating RH-SSO Administrator Account via Remote Shell Session to RH-SSO Pod</h5>
<div class="paragraph">
<p>Run following commands to create administrator account for the <code>master</code> realm of the RH-SSO server, when deploying the RH-SSO for OpenShift image directly from the image stream (without the <a href="../introduction/introduction.html#sso-templates">template</a>), after the RH-SSO application pod has been started:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Identify the RH-SSO application pod.</p>
<div class="listingblock">
<div class="content">
<pre>$ oc get pods
NAME                READY     STATUS    RESTARTS   AGE
sso-12-pt93n        1/1       Running   0          1m
sso-mysql-6-d97pf   1/1       Running   0          2m</pre>
</div>
</div>
</li>
<li>
<p>Open a remote shell session to RH-SSO for OpenShift container.</p>
<div class="listingblock">
<div class="content">
<pre>$ oc rsh sso-12-pt93n
sh-4.2$</pre>
</div>
</div>
</li>
<li>
<p>Create the RH-SSO server administrator account for the <code>master</code> realm at the command line with the <code>add-user-keycloak.sh</code> script.</p>
<div class="listingblock">
<div class="content">
<pre>sh-4.2$ cd /opt/eap/bin/
sh-4.2$ ./add-user-keycloak.sh -r master -u sso_admin -p sso_password
Added 'sso_admin' to '/opt/eap/standalone/configuration/keycloak-add-user.json', restart server to load user</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>sso_admin</code>/<code>sso_password</code> credentials in the example above are for demonstration purposes only. Refer to the password policy applicable within your organization for guidance on how to create a secure user name and password.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Restart the underlying JBoss EAP server instance to load the newly added user account. Wait for the server to restart properly.</p>
<div class="listingblock">
<div class="content">
<pre>sh-4.2$ ./jboss-cli.sh --connect ':reload'
{
    "outcome" =&gt; "success",
    "result" =&gt; undefined
}</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When restarting the server it is important to restart just the JBoss EAP process within the running RH-SSO container, and not the whole container. Because restarting the whole container recreates it from scratch, without the RH-SSO server administration account for the <code>master</code> realm to be created.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Log into the <code>master</code> realm&#8217;s administration console of the RH-SSO server using the the credentials created in the steps above. In the browser, navigate to <strong>http://sso-&lt;project-name&gt;.&lt;hostname&gt;/auth/admin</strong>  for the RH-SSO web server, or to <strong>https://secure-sso-&lt;project-name&gt;.&lt;hostname&gt;/auth/admin</strong> for the encrypted RH-SSO web server, and specify user name and password used to create the administrator user.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="using-the-openshift-web-console"><a class="anchor" href="#using-the-openshift-web-console"></a>3.2.4. Using the OpenShift Web Console</h4>
<div class="paragraph">
<p>Log in to the OpenShift web console:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <strong>Add to project</strong> to list the default image streams and templates.</p>
</li>
<li>
<p>Use the <strong>Filter by keyword</strong> search bar to limit the list to those that match <em>sso</em>. You may need to click <strong>See all</strong> to show the desired application template.</p>
</li>
<li>
<p>Select an application template and configure the deployment parameters as required.</p>
</li>
<li>
<p>Click <strong>Create</strong> to deploy the application template.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>These are some of the more common variables to configure an RH-SSO deployment:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Variable</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>APPLICATION_NAME</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name for the RH-SSO application.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HOSTNAME_HTTPS</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom hostname for https service route. Leave blank for default hostname of <em>&lt;application-name&gt;.&lt;project&gt;.&lt;default-domain-suffix&gt;</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HOSTNAME_HTTP</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom hostname for http service route. Leave blank for default hostname of <em>&lt;application-name&gt;.&lt;project&gt;.&lt;default-domain-suffix&gt;</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HTTPS_KEYSTORE</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the keystore file within the secret.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HTTPS_PASSWORD</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password for the keystore and certificate.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HTTPS_SECRET</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the secret containing the keystore file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>JGROUPS_ENCRYPT_KEYSTORE</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the JGroups keystore file within the secret.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>JGROUPS_ENCRYPT_PASSWORD</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password for the JGroups keystore and certificate.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>JGROUPS_ENCRYPT_SECRET</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the secret containing the JGroups keystore file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_ADMIN_USERNAME</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Username of the administrator account for the <code>master</code> realm of the RH-SSO server. <strong>Required.</strong> If no value is specified, it is auto generated and displayed as an OpenShift instructional message when the template is instantiated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_ADMIN_PASSWORD</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password of the administrator account for the <code>master</code> realm of the RH-SSO server. <strong>Required.</strong> If no value is specified, it is auto generated and displayed as an OpenShift instructional message when the template is instantiated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_REALM</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of an additional RH-SSO realm to create during deployment.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_SERVICE_USERNAME</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RH-SSO service user name to manage the realm.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_SERVICE_PASSWORD</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RH-SSO service user password.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>See the <a href="#env_vars">Reference chapter</a> for a more comprehensive list of the RH-SSO environment variables.
See the <a href="#Example-Deploying-SSO">Example Workflow: Preparing and Deploying the RH-SSO for OpenShift Image</a> for an end-to-end example of RH-SSO deployment.</p>
</div>
</div>
<div class="sect3">
<h4 id="routes"><a class="anchor" href="#routes"></a>3.2.5. Routes</h4>
<div class="paragraph">
<p>The RH-SSO for OpenShift templates use TLS passthrough termination for routes by default. This means that the destination route receives encrypted traffic without the OpenShift router providing TLS termination. Users do not need the relevant SSL certificate to connect to the RH-SSO login page.</p>
</div>
<div class="paragraph">
<p>For more information on OpenShift route types, see the <a href="https://docs.openshift.com/container-platform/3.7/architecture/networking/routes.html#route-types">Networking chapter</a> of the OpenShift Architecture Guide.</p>
</div>
</div>
<div class="sect3">
<h4 id="deployment-process"><a class="anchor" href="#deployment-process"></a>3.2.6. Deployment Process</h4>
<div class="paragraph">
<p>Once deployed, the <strong><em>sso71-https</em></strong> and <strong><em>sso72-https</em></strong> templates create a single pod that contains both the database and the RH-SSO servers. The <strong><em>sso71-mysql</em></strong>, <strong><em>sso72-mysql</em></strong>, <strong><em>sso71-mysql-persistent</em></strong>, <strong><em>sso72-mysql-persistent</em></strong>, <strong><em>sso71-postgresql</em></strong>, <strong><em>sso72-postgresql</em></strong>, <strong><em>sso71-postgresql-persistent</em></strong>, and <strong><em>sso72-postgresql-persistent</em></strong> templates create two pods, one for the database server and one for the RH-SSO web server.</p>
</div>
<div class="paragraph">
<p>After the RH-SSO web server pod has started, it can be accessed at its custom configured hostnames, or at the default hostnames:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>http://sso-<em>&lt;project-name&gt;</em>.<em>&lt;hostname&gt;</em>/auth/admin</strong>: for the RH-SSO web server, and</p>
</li>
<li>
<p><strong>https://secure-sso-<em>&lt;project-name&gt;</em>.<em>&lt;hostname&gt;</em>/auth/admin</strong>: for the encrypted RH-SSO web server.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Use the <a href="../get_started/get_started.html#sso-administrator-setup">administrator user credentials</a> to log in into the <code>master</code> realm’s administration console.</p>
</div>
</div>
<div class="sect3">
<h4 id="SSO-Clients"><a class="anchor" href="#SSO-Clients"></a>3.2.7. RH-SSO Clients</h4>
<div class="paragraph">
<p>Clients are RH-SSO entities that request user authentication. A client can be an application requesting RH-SSO to provide user authentication, or it can be making requests for access tokens to start services on behalf of an authenticated user. See the <a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.2/html/server_administration_guide/clients">Managing Clients chapter of the Red Hat Single Sign-On documentation</a> for more information.</p>
</div>
<div class="paragraph">
<p>RH-SSO provides <a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.2/html/server_administration_guide/clients#oidc_clients">OpenID-Connect</a> and <a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.2/html/server_administration_guide/clients#saml_clients">SAML</a> client protocols.<br>
OpenID-Connect is the preferred protocol and utilizes three different access types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>public</strong>: Useful for JavaScript applications that run directly in the browser and require no server configuration.</p>
</li>
<li>
<p><strong>confidential</strong>: Useful for server-side clients, such as EAP web applications, that need to perform a browser login.</p>
</li>
<li>
<p><strong>bearer-only</strong>: Useful for back-end services that allow bearer token requests.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is required to specify the client type in the <strong>&lt;auth-method&gt;</strong> key of the application <strong>web.xml</strong> file. This file is read by the image at deployment. Set the value of <strong>&lt;auth-method&gt;</strong> element to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>KEYCLOAK</strong> for the OpenID Connect client.</p>
</li>
<li>
<p><strong>KEYCLOAK-SAML</strong> for the SAML client.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following is an example snippet for the application <strong>web.xml</strong> to configure an OIDC client:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>...
&lt;login-config&gt;
        &lt;auth-method&gt;KEYCLOAK&lt;/auth-method&gt;
&lt;/login-config&gt;
...</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Auto-Man-Client-Reg"><a class="anchor" href="#Auto-Man-Client-Reg"></a>3.2.8. Automatic and Manual RH-SSO Client Registration Methods</h4>
<div class="paragraph">
<p>A client application can be automatically registered to an RH-SSO realm by using credentials passed in variables specific to the <strong><em>eap64-sso-s2i</em></strong>,  <strong><em>eap70-sso-s2i</em></strong>, <strong><em>eap71-sso-s2i</em></strong>, and <strong><em>datavirt63-secure-s2i</em></strong> templates.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can manually register the client application by configuring and exporting the RH-SSO client adapter and including it in the client application configuration.</p>
</div>
</div>
<div class="sect3">
<h4 id="automatic-rh-sso-client-registration"><a class="anchor" href="#automatic-rh-sso-client-registration"></a>3.2.9. Automatic RH-SSO Client Registration</h4>
<div class="paragraph">
<p>Automatic RH-SSO client registration is determined by RH-SSO environment variables specific to the <strong><em>eap64-sso-s2i</em></strong>,  <strong><em>eap70-sso-s2i</em></strong>, <strong><em>eap71-sso-s2i</em></strong>, and <strong><em>datavirt63-secure-s2i</em></strong> templates. The RH-SSO credentials supplied in the template are then used to register the client to the RH-SSO realm during deployment of the client application.</p>
</div>
<div class="paragraph">
<p>The RH-SSO environment variables included in the <strong><em>eap64-sso-s2i</em></strong>,  <strong><em>eap70-sso-s2i</em></strong>, <strong><em>eap71-sso-s2i</em></strong>, and <strong><em>datavirt63-secure-s2i</em></strong> templates are:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Variable</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HOSTNAME_HTTP</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom hostname for http service route. Leave blank for default hostname of &lt;application-name&gt;.&lt;project&gt;.&lt;default-domain-suffix&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HOSTNAME_HTTPS</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom hostname for https service route. Leave blank for default hostname of &lt;application-name&gt;.&lt;project&gt;.&lt;default-domain-suffix&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_URL</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The RH-SSO web server authentication address: https://secure-sso-<em>&lt;project-name&gt;</em>.<em>&lt;hostname&gt;</em>/auth</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_REALM</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The RH-SSO realm created for this procedure.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_USERNAME</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the <em>realm management user</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_PASSWORD</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password of the user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_PUBLIC_KEY</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The public key generated by the realm. It is located in the <strong>Keys</strong> tab of the <strong>Realm Settings</strong> in the RH-SSO console.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_BEARER_ONLY</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to <strong>true</strong>, the OpenID Connect client is registered as bearer-only.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_ENABLE_CORS</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to <strong>true</strong>, the RH-SSO adapter enables Cross-Origin Resource Sharing (CORS).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If the RH-SSO client uses the SAML protocol, the following additional variables need to be configured:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Variable</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_SAML_KEYSTORE_SECRET</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Secret to use for access to SAML keystore. The default is <em>sso-app-secret</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_SAML_KEYSTORE</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keystore filename in the SAML keystore secret. The default is <em>keystore.jks</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_SAML_KEYSTORE_PASSWORD</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keystore password for SAML. The default is <em>mykeystorepass</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_SAML_CERTIFICATE_NAME</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alias for keys/certificate to use for SAML. The default is <em>jboss</em>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>See <a href="#Example-EAP-Auto">Example Workflow: Automatically Registering EAP Application in RH-SSO with OpenID-Connect Client</a> for an end-to-end example of the automatic client registration method using an OpenID-Connect client.</p>
</div>
</div>
<div class="sect3">
<h4 id="manual-rh-sso-client-registration"><a class="anchor" href="#manual-rh-sso-client-registration"></a>3.2.10. Manual RH-SSO Client Registration</h4>
<div class="paragraph">
<p>Manual RH-SSO client registration is determined by the presence of a deployment file in the client application&#8217;s <em>../configuration/</em> directory. These files are exported from the client adapter in the RH-SSO web console. The name of this file is different for OpenID-Connect and SAML clients:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<strong>OpenID-Connect</strong>
</td>
<td class="hdlist2">
<p><em>../configuration/secure-deployments</em></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<strong>SAML</strong>
</td>
<td class="hdlist2">
<p><em>../configuration/secure-saml-deployments</em></p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>These files are copied to the RH-SSO adapter configuration section in the <em>standalone-openshift.xml</em> at when the application is deployed.</p>
</div>
<div class="paragraph">
<p>There are two methods for passing the RH-SSO adapter configuration to the client application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Modify the deployment file to contain the RH-SSO adapter configuration so that it is included in the <em>standalone-openshift.xml</em> file at deployment, or</p>
</li>
<li>
<p>Manually include the OpenID-Connect <em>keycloak.json</em> file, or the SAML <em>keycloak-saml.xml</em> file in the client application&#8217;s <strong>../WEB-INF</strong> directory.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See <a href="#Example-EAP-Manual">Example Workflow: Manually Configure an Application to Use RH-SSO Authentication, Using SAML Client</a> for an end-to-end example of the manual RH-SSO client registration method using a SAML client.</p>
</div>
</div>
<div class="sect3">
<h4 id="limitations"><a class="anchor" href="#limitations"></a>3.2.11. Limitations</h4>
<div class="paragraph">
<p>OpenShift does not currently accept OpenShift role mapping from external providers. If RH-SSO is used as an authentication gateway for OpenShift, users created in RH-SSO must have the roles added using the OpenShift Administrator <code>oadm policy</code> command.</p>
</div>
<div class="paragraph">
<p>For example, to allow an RH-SSO-created user to view a project namespace in OpenShift:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oadm policy add-role-to-user view &lt;<em>user-name</em>&gt; -n &lt;<em>project-name</em>&gt;</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="binary-builds"><a class="anchor" href="#binary-builds"></a>3.3. Binary Builds</h3>
<div class="paragraph">
<p>To deploy existing applications on OpenShift, you can use the <a href="https://docs.openshift.com/container-platform/latest/dev_guide/builds/build_inputs.html#binary-source">binary source</a> capability.</p>
</div>
<div class="sect3">
<h4 id="deploy-binary-build-of-eap-6-4-7-0-jsp-service-invocation-application-that-authenticates-using-red-hat-single-sign-on"><a class="anchor" href="#deploy-binary-build-of-eap-6-4-7-0-jsp-service-invocation-application-that-authenticates-using-red-hat-single-sign-on"></a>3.3.1. Deploy Binary Build of EAP 6.4 / 7.0 JSP Service Invocation Application that Authenticates Using Red Hat Single Sign-On</h4>
<div class="paragraph">
<p>The following example uses both <a href="https://github.com/keycloak/keycloak-quickstarts/tree/latest/app-jee-jsp">app-jee-jsp</a> and <a href="https://github.com/keycloak/keycloak-quickstarts/tree/latest/service-jee-jaxrs">service-jee-jaxrs</a> quickstarts to deploy EAP 6.4 / 7.0 JSP service application that authenticates using the Red Hat Single Sign-On.</p>
</div>
<div class="paragraph">
<p><strong>Prerequisite:</strong></p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This guide assumes the RH-SSO for OpenShift image has been previously <a href="https://access.redhat.com/documentation/en-us/red_hat_jboss_middleware_for_openshift/3/html-single/red_hat_single_sign-on_for_openshift/index#Example-Deploying-SSO">deployed using one of the following templates:</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><em>sso71-mysql</em></strong></p>
</li>
<li>
<p><strong><em>sso72-mysql</em></strong></p>
</li>
<li>
<p><strong><em>sso71-postgresql</em></strong></p>
</li>
<li>
<p><strong><em>sso72-postgresql</em></strong></p>
</li>
<li>
<p><strong><em>sso71-mysql-persistent</em></strong></p>
</li>
<li>
<p><strong><em>sso72-mysql-persistent</em></strong></p>
</li>
<li>
<p><strong><em>sso71-postgresql-persistent</em></strong></p>
</li>
<li>
<p><strong><em>sso72-postgresql-persistent</em></strong></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="create-rh-sso-realm-roles-and-user-for-the-eap-6-4-7-0-jsp-application"><a class="anchor" href="#create-rh-sso-realm-roles-and-user-for-the-eap-6-4-7-0-jsp-application"></a>Create RH-SSO Realm, Roles, and User for the EAP 6.4 / 7.0 JSP Application</h5>
<div class="paragraph">
<p>The EAP 6.4 / 7.0 JSP service application requires dedicated RH-SSO realm, username, and password to be able to authenticate using Red Hat Single Sign-On. Perform the following steps after the RH-SSO for OpenShift image has been deployed:</p>
</div>
<div class="paragraph">
<p><strong>Create the RH-SSO Realm</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Login to the administration console of the RH-SSO server.</p>
<div class="paragraph">
<p><strong>https://secure-sso-sso-app-demo.openshift.example.com/auth/admin</strong></p>
</div>
<div class="paragraph">
<p>Use the <a href="sso_server.html#sso-administrator-setup">credentials of the RH-SSO administrator user</a>.</p>
</div>
</li>
<li>
<p>Hover your cursor over the realm namespace (default is <strong>Master</strong>) at the top of the sidebar and click <strong>Add Realm</strong>.</p>
</li>
<li>
<p>Enter a realm name (this example uses <code>demo</code>) and click <strong>Create</strong>.</p>
</li>
</ol>
</div>
<div id="copy-rsa-public-key" class="paragraph">
<p><strong>Copy the Public Key</strong></p>
</div>
<div class="paragraph">
<p>In the newly created <code>demo</code> realm, click the <strong>Keys</strong> tab and copy the public key that has been generated.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>RH-SSO 7.1 and RH-SSO 7.2 images generate two keys by default:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RSA key, and</p>
</li>
<li>
<p>HMAC key</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To copy the public key information for the RH-SSO 7.1 or RH-SSO 7.2 image, click the <strong>Public key</strong> button of the <strong>RSA</strong> row of the keys table. Then select and copy the content of the pop-up window that appears.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The information about the public key is necessary <a href="#sso-public-key-details">later to deploy</a> the RH-SSO-enabled EAP 6.4 / 7.0 JSP application.</p>
</div>
<div class="paragraph">
<p><strong>Create RH-SSO Roles</strong></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <a href="https://github.com/keycloak/keycloak-quickstarts/tree/latest/service-jee-jaxrs">service-jee-jaxrs</a> quickstart exposes three endpoints by the service:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>public</code> - Requires no authentication.</p>
</li>
<li>
<p><code>secured</code> - Can be invoked by users with the <code>user</code> role.</p>
</li>
<li>
<p><code>admin</code> - Can be invoked by users with the <code>admin</code> role.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Create <code>user</code> and <code>admin</code> roles in RH-SSO. These roles will be assigned to an RH-SSO application user to authenticate access to user applications.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <strong>Roles</strong> in the <strong>Configure</strong> sidebar to list the roles for this realm.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This is a new realm, so there should only be the default roles:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>offline_access</code> and <code>uma_authorization</code> role for the RH-SSO 7.1 and RH-SSO 7.2 images.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Click <strong>Add Role</strong>.</p>
</li>
<li>
<p>Enter the role name (<code>user</code>) and click <strong>Save</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Repeat these steps for the <code>admin</code> role.</p>
</div>
<div class="paragraph">
<p><strong>Create the RH-SSO Realm Management User</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <strong>Users</strong> in the <strong>Manage</strong> sidebar to view the user information for the realm.</p>
</li>
<li>
<p>Click <strong>Add User.</strong></p>
</li>
<li>
<p>Enter a valid <strong>Username</strong> (this example uses the user <code>appuser</code>) and click <strong>Save</strong>.</p>
</li>
<li>
<p>Edit the user configuration:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click the <strong>Credentials</strong> tab in the user space and enter a password for the user (this example uses the password <code>apppassword</code>).</p>
</li>
<li>
<p>Ensure the <strong>Temporary Password</strong> option is set to <strong>Off</strong> so that it does not prompt for a password change later on, and click <strong>Reset Password</strong> to set the user password. A pop-up window prompts for additional confirmation.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="assign-code-user-code-rh-sso-role-to-the-realm-management-user"><a class="anchor" href="#assign-code-user-code-rh-sso-role-to-the-realm-management-user"></a>Assign <code>user</code> RH-SSO Role to the Realm Management User</h5>
<div class="paragraph">
<p>Perform the following steps to tie the previously created <code>appuser</code> with the <code>user</code> RH-SSO role:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <strong>Role Mappings</strong> to list the realm and client role configuration. In <strong>Available Roles</strong>, select the <code>user</code> role created earlier, and click <strong>Add selected&gt;</strong>.</p>
</li>
<li>
<p>Click <strong>Client Roles</strong>, select <strong>realm-management</strong> entry from the list, select each record in the <strong>Available Roles</strong> list.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can select multiple items at once by holding the <strong>Ctrl</strong> key and simultaneously clicking the first <code>impersonation</code> entry. While keeping the <strong>Ctrl</strong> key and the left mouse button pressed, move to the end of the list to the <code>view-clients</code> entry and ensure each record is selected.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Click <strong>Add selected&gt;</strong> to assign the roles to the client.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="prepare-rh-sso-authentication-for-openshift-deployment-of-the-eap-6-4-7-0-jsp-application"><a class="anchor" href="#prepare-rh-sso-authentication-for-openshift-deployment-of-the-eap-6-4-7-0-jsp-application"></a>Prepare RH-SSO Authentication for OpenShift Deployment of the EAP 6.4 / 7.0 JSP Application</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new project for the EAP 6.4 / 7.0 JSP application.</p>
<div class="listingblock">
<div class="content">
<pre>$ oc new-project eap-app-demo</pre>
</div>
</div>
</li>
<li>
<p>Add the <code>view</code> role to the <a href="https://docs.openshift.com/container-platform/latest/dev_guide/service_accounts.html#default-service-accounts-and-roles"><code>default</code></a> service account. This enables the service account to view all the resources in the <code>eap-app-demo</code> namespace, which is necessary for managing the cluster.</p>
<div class="listingblock">
<div class="content">
<pre>$ oc policy add-role-to-user view system:serviceaccount:$(oc project -q):default</pre>
</div>
</div>
</li>
<li>
<p>The EAP template requires an <a href="https://access.redhat.com/documentation/en-us/red_hat_jboss_middleware_for_openshift/3/html-single/red_hat_single_sign-on_for_openshift/index#Configuring-Keystores">SSL keystore and a JGroups keystore</a>. This example uses <code>keytool</code>, a package included with the Java Development Kit, to generate self-signed certificates for these keystores.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Generate a secure key for the SSL keystore (this example uses <code>password</code> as password for the keystore).</p>
<div class="listingblock">
<div class="content">
<pre>$ keytool -genkeypair \
-dname "CN=secure-eap-app-eap-app-demo.openshift.example.com" \
-alias https \
-storetype JKS \
-keystore eapkeystore.jks</pre>
</div>
</div>
</li>
<li>
<p>Generate a secure key for the JGroups keystore (this example uses <code>password</code> as password for the keystore).</p>
<div class="listingblock">
<div class="content">
<pre>$ keytool -genseckey \
-alias jgroups \
-storetype JCEKS \
-keystore eapjgroups.jceks</pre>
</div>
</div>
</li>
<li>
<p>Generate the EAP 6.4 / 7.0 for OpenShift secrets with the SSL and JGroup keystore files.</p>
<div class="listingblock">
<div class="content">
<pre>$ oc secret new eap-ssl-secret eapkeystore.jks</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ oc secret new eap-jgroup-secret eapjgroups.jceks</pre>
</div>
</div>
</li>
<li>
<p>Add the EAP application secret to the <a href="https://docs.openshift.com/container-platform/latest/dev_guide/service_accounts.html#default-service-accounts-and-roles"><code>default</code></a> service account.</p>
<div class="listingblock">
<div class="content">
<pre>$ oc secrets link default eap-ssl-secret eap-jgroup-secret</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="deploy-binary-build-of-the-eap-6-4-7-0-jsp-application"><a class="anchor" href="#deploy-binary-build-of-the-eap-6-4-7-0-jsp-application"></a>Deploy Binary Build of the EAP 6.4 / 7.0 JSP Application</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Clone the source code.</p>
<div class="listingblock">
<div class="content">
<pre>$ git clone <a href="https://github.com/keycloak/keycloak-quickstarts.git" class="bare">https://github.com/keycloak/keycloak-quickstarts.git</a></pre>
</div>
</div>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.1/html-single/development_guide/#use_the_maven_repository">Configure</a> the <a href="https://access.redhat.com/maven-repository">Red Hat JBoss Middleware Maven repository</a>.</p>
</li>
<li>
<p>Build both the <a href="https://github.com/keycloak/keycloak-quickstarts/tree/latest/service-jee-jaxrs">service-jee-jaxrs</a> and <a href="https://github.com/keycloak/keycloak-quickstarts/tree/latest/app-jee-jsp">app-jee-jsp</a> applications.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Build the <code>service-jee-jaxrs</code> application.</p>
<div class="listingblock">
<div class="content">
<pre>$ cd keycloak-quickstarts/service-jee-jaxrs/</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mvn clean package -DskipTests
[INFO] Scanning for projects...
[INFO]
[INFO] ------------------------------------------------------------------------
[INFO] Building Keycloak Quickstart: service-jee-jaxrs 3.1.0.Final
[INFO] ------------------------------------------------------------------------
...
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 2.153 s
[INFO] Finished at: 2017-06-26T12:06:12+02:00
[INFO] Final Memory: 25M/241M
[INFO] ------------------------------------------------------------------------</pre>
</div>
</div>
</li>
<li>
<p><strong>Comment out</strong> the <code>app-jee-jsp/config/keycloak.json</code> requirement of the <code>maven-enforcer-plugin</code> plugin and build the <code>app-jee-jsp</code> application.</p>
<div class="listingblock">
<div class="content">
<pre>service-jee-jaxrs]$ cd ../app-jee-jsp/</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>app-jee-jsp]$ sed -i /\&lt;executions\&gt;/s/^/\&lt;\!--/ pom.xml</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>app-jee-jsp]$ sed -i '/\(&lt;\/executions&gt;\)/a\--&gt;' pom.xml</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>app-jee-jsp]$ mvn clean package -DskipTests
[INFO] Scanning for projects...
[INFO]
[INFO] ------------------------------------------------------------------------
[INFO] Building Keycloak Quickstart: app-jee-jsp 3.1.0.Final
[INFO] ------------------------------------------------------------------------
...
[INFO] Building war: /tmp/github/keycloak-quickstarts/app-jee-jsp/target/app-jsp.war
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 3.018 s
[INFO] Finished at: 2017-06-26T12:22:25+02:00
[INFO] Final Memory: 35M/310M
[INFO] ------------------------------------------------------------------------</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <a href="https://github.com/keycloak/keycloak-quickstarts/tree/latest/app-jee-jsp">app-jee-jsp</a> quickstart requires to configure the adapter, and adapter configuration file (<code>keycloak.json</code>) to be present at the <code>config/</code> directory in the root of the quickstart to successfully build the quickstart. But since this example configures the adapter later via selected environment variables available for the EAP 6.4 / 7.0 for OpenShift image, it is not necessary to specify the form of <code>keycloak.json</code> adapter configuration file at this moment.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div id="directory-structure-binary-builds" class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Prepare the directory structure on the local file system.</p>
<div class="paragraph">
<p>Application archives in the <strong>deployments/</strong> subdirectory of the main binary build directory are copied directly to the <a href="#standard-deployments-directory">standard deployments directory</a> of the image being built on OpenShift. For the application to deploy, the directory hierarchy containing the web application data must be correctly structured.</p>
</div>
<div class="paragraph">
<p>Create main directory for the binary build on the local file system and <strong>deployments/</strong> subdirectory within it. Copy the previously built WAR archives of both the <strong>service-jee-jaxrs</strong> and <strong>app-jee-jsp</strong> quickstarts to the <strong>deployments/</strong> subdirectory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>app-jee-jsp]$ ls
config  pom.xml  README.md  src  target</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>app-jee-jsp]$ mkdir -p sso-eap7-bin-demo/deployments</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>app-jee-jsp]$ cp target/app-jsp.war sso-eap7-bin-demo/deployments/</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>app-jee-jsp]$ cp ../service-jee-jaxrs/target/service.war sso-eap7-bin-demo/deployments/</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>app-jee-jsp]$ tree sso-eap7-bin-demo/
sso-eap7-bin-demo/
|__ deployments
    |__ app-jsp.war
    |__ service.war

1 directory, 2 files</pre>
</div>
</div>
<div id="standard-deployments-directory" class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Location of the standard deployments directory depends on the underlying base image, that was used to deploy the application. See the following table:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Standard Location of the Deployments Directory</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name of the Underlying Base Image(s)</th>
<th class="tableblock halign-left valign-top">Standard Location of the Deployments Directory</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EAP for OpenShift 6.4 and 7.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>$JBOSS_HOME/standalone/deployments</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Java S2I for OpenShift</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>/deployments</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JWS for OpenShift</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>$JWS_HOME/webapps</em></strong></p></td>
</tr>
</tbody>
</table>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Identify the image stream for EAP 6.4 / 7.0 image.</p>
<div class="listingblock">
<div class="content">
<pre>$ oc get is -n openshift | grep eap | cut -d ' ' -f 1
jboss-eap64-openshift
jboss-eap70-openshift
jboss-eap71-openshift</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="eap-new-binary-build" class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Create new binary build, specifying image stream and application name.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Replace <code>--image-stream=jboss-eap70-openshift</code> parameter with the <code>--image-stream=jboss-eap64-openshift</code> one in the following oc command to deploy the JSP application on top of JBoss EAP 6.4 for OpenShift image.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre>$ oc new-build --binary=true \
--image-stream=jboss-eap70-openshift \
--name=eap-app
--&gt; Found image 31895a4 (3 months old) in image stream "openshift/jboss-eap70-openshift" under tag "latest" for "jboss-eap70-openshift"

    JBoss EAP 7.0
    -------------
    Platform for building and running JavaEE applications on JBoss EAP 7.0

    Tags: builder, javaee, eap, eap7

    * A source build using binary input will be created
      * The resulting image will be pushed to image stream "eap-app:latest"
      * A binary build was created, use 'start-build --from-dir' to trigger a new build

--&gt; Creating resources with label build=eap-app ...
    imagestream "eap-app" created
    buildconfig "eap-app" created
--&gt; Success</pre>
</div>
</div>
</li>
<li>
<p>Start the binary build. Instruct <code>oc</code> executable to use main directory of the binary build we created <a href="#directory-structure-binary-builds">in previous step</a> as the directory containing binary input for the OpenShift build. In the working directory of <strong>app-jee-jsp</strong> issue the following command.</p>
<div class="listingblock">
<div class="content">
<pre>app-jee-jsp]$ oc start-build eap-app \
--from-dir=./sso-eap7-bin-demo/ \
--follow
Uploading directory "sso-eap7-bin-demo" as binary input for the build ...
build "eap-app-1" started
Receiving source from STDIN as archive ...
Copying all war artifacts from /home/jboss/source/. directory into /opt/eap/standalone/deployments for later deployment...
Copying all ear artifacts from /home/jboss/source/. directory into /opt/eap/standalone/deployments for later deployment...
Copying all rar artifacts from /home/jboss/source/. directory into /opt/eap/standalone/deployments for later deployment...
Copying all jar artifacts from /home/jboss/source/. directory into /opt/eap/standalone/deployments for later deployment...
Copying all war artifacts from /home/jboss/source/deployments directory into /opt/eap/standalone/deployments for later deployment...
'/home/jboss/source/deployments/app-jsp.war' -&gt; '/opt/eap/standalone/deployments/app-jsp.war'
'/home/jboss/source/deployments/service.war' -&gt; '/opt/eap/standalone/deployments/service.war'
Copying all ear artifacts from /home/jboss/source/deployments directory into /opt/eap/standalone/deployments for later deployment...
Copying all rar artifacts from /home/jboss/source/deployments directory into /opt/eap/standalone/deployments for later deployment...
Copying all jar artifacts from /home/jboss/source/deployments directory into /opt/eap/standalone/deployments for later deployment...
Pushing image 172.30.82.129:5000/eap-app-demo/eap-app:latest ...
Pushed 6/7 layers, 86% complete
Pushed 7/7 layers, 100% complete
Push successful</pre>
</div>
</div>
</li>
<li>
<p>Create a new OpenShift application based on the build.</p>
<div class="listingblock">
<div class="content">
<pre>$ oc new-app eap-app
--&gt; Found image 6b13d36 (2 minutes old) in image stream "eap-app-demo/eap-app" under tag "latest" for "eap-app"

    eap-app-demo/eap-app-1:aa2574d9
    -------------------------------
    Platform for building and running JavaEE applications on JBoss EAP 7.0

    Tags: builder, javaee, eap, eap7

    * This image will be deployed in deployment config "eap-app"
    * Ports 8080/tcp, 8443/tcp, 8778/tcp will be load balanced by service "eap-app"
      * Other containers can access this service through the hostname "eap-app"

--&gt; Creating resources ...
    deploymentconfig "eap-app" created
    service "eap-app" created
--&gt; Success
    Run 'oc status' to view your app.</pre>
</div>
</div>
</li>
<li>
<p>Stop all running containers of the EAP 6.4 / 7.0 JSP application in the current namespace.</p>
<div class="listingblock">
<div class="content">
<pre>$ oc get dc -o name
deploymentconfig/eap-app</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ oc scale dc/eap-app --replicas=0
deploymentconfig "eap-app" scaled</pre>
</div>
</div>
</li>
<li>
<p>Further configure the EAP 6.4 / 7.0 JSP application prior the deployment.</p>
<div id="sso-public-key-details" class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Configure the application with proper details about the RH-SSO server instance.</p>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Ensure to replace the value of <strong><em>SSO_PUBLIC_KEY</em></strong> variable below with the actual content of the RSA public key for the <code>demo</code> realm, that has been <a href="#copy-rsa-public-key">copied</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre>$ oc set env dc/eap-app \
-e HOSTNAME_HTTP="eap-app-eap-app-demo.openshift.example.com" \
-e HOSTNAME_HTTPS="secure-eap-app-eap-app-demo.openshift.example.com" \
-e SSO_DISABLE_SSL_CERTIFICATE_VALIDATION="true" \
-e SSO_USERNAME="appuser" \
-e SSO_PASSWORD="apppassword" \
-e SSO_REALM="demo" \
-e SSO_URL="https://secure-sso-sso-app-demo.openshift.example.com/auth" \
-e SSO_PUBLIC_KEY="MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAkdhXyKx97oIoO6HwnV/MiX2EHO55Sn+ydsPzbjJevI5F31UvUco9uA8dGl6oM8HrnaWWv+i8PvmlaRMhhl6Xs68vJTEc6d0soP+6A+aExw0coNRp2PDwvzsXVWPvPQg3+iytStxu3Icndx+gC0ZYnxoRqL7rY7zKcQBScGEr78Nw6vZDwfe6d/PQ6W4xVErNytX9KyLFVAE1VvhXALyqEM/EqYGLmpjw5bMGVKRXnhmVo9E88CkFDH8E+aPiApb/gFul1GJOv+G8ySLoR1c8Y3L29F7C81odkVBp2yMm3RVFIGSPTjHqjO/nOtqYIfY4Wyw9mRIoY5SyW7044dZXRwIDAQAB" \
-e SSO_SECRET="0bb8c399-2501-4fcd-a183-68ac5132868d"
deploymentconfig "eap-app" updated</pre>
</div>
</div>
</li>
<li>
<p>Configure the application with details about both the SSL and JGroups keystore.</p>
<div class="listingblock">
<div class="content">
<pre>$ oc set env dc/eap-app \
-e HTTPS_KEYSTORE_DIR="/etc/eap-secret-volume" \
-e HTTPS_KEYSTORE="eapkeystore.jks" \
-e HTTPS_PASSWORD="password" \
-e JGROUPS_ENCRYPT_SECRET="eap-jgroup-secret" \
-e JGROUPS_ENCRYPT_KEYSTORE_DIR="/etc/jgroups-encrypt-secret-volume" \
-e JGROUPS_ENCRYPT_KEYSTORE="eapjgroups.jceks" \
-e JGROUPS_ENCRYPT_PASSWORD="password"
deploymentconfig "eap-app" updated</pre>
</div>
</div>
</li>
<li>
<p>Define OpenShift volumes for both the SSL and JGroups secrets created earlier.</p>
<div class="listingblock">
<div class="content">
<pre>$ oc volume dc/eap-app --add \
--name="eap-keystore-volume" \
--type=secret \
--secret-name="eap-ssl-secret" \
--mount-path="/etc/eap-secret-volume"
deploymentconfig "eap-app" updated</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ oc volume dc/eap-app --add \
--name="eap-jgroups-keystore-volume" \
--type=secret \
--secret-name="eap-jgroup-secret" \
--mount-path="/etc/jgroups-encrypt-secret-volume"
deploymentconfig "eap-app" updated</pre>
</div>
</div>
</li>
<li>
<p>Configure the deployment config of the application to run application pods under the <code>default</code> OpenShift service account (default setting).</p>
<div class="listingblock">
<div class="content">
<pre>$ oc patch dc/eap-app --type=json \
-p '[{"op": "add", "path": "/spec/template/spec/serviceAccountName", "value": "default"}]'
"eap-app" patched</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Deploy container of the EAP 6.4 / 7.0 JSP application using the modified deployment config.</p>
<div class="listingblock">
<div class="content">
<pre>$ oc scale dc/eap-app --replicas=1
deploymentconfig "eap-app" scaled</pre>
</div>
</div>
</li>
<li>
<p>Expose the service as route.</p>
<div class="listingblock">
<div class="content">
<pre>$ oc get svc -o name
service/eap-app</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ oc get route
No resources found.</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ oc expose svc/eap-app
route "eap-app" exposed</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ oc get route
NAME      HOST/PORT                                    PATH      SERVICES   PORT       TERMINATION   WILDCARD
eap-app   eap-app-eap-app-demo.openshift.example.com             eap-app    8080-tcp                 None</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="access-the-application"><a class="anchor" href="#access-the-application"></a>Access the Application</h5>
<div class="paragraph">
<p>Access the application in your browser using the URL <strong>http://eap-app-eap-app-demo.openshift.example.com/app-jsp</strong>. You should see output like on the following image:</p>
</div>
<div class="paragraph text-center">
<p><span class="image"><img src="./images/sso_app_jee_jsp.png" alt="RH-SSO Example JSP Application"></span></p>
</div>
<div class="paragraph">
<p>Perform the following to test the application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Click the <strong>INVOKE PUBLIC</strong> button to access the <code>public</code> endpoint that doesn&#8217;t require authentication.</p>
<div class="paragraph">
<p>You should see the <strong>Message: public</strong> output.</p>
</div>
</li>
<li>
<p>Click the <strong>LOGIN</strong> button to be redirected for user authentication to the RH-SSO server instance against the <code>demo</code> realm.</p>
<div class="paragraph">
<p>Specify username and password of the RH-SSO user configured earlier (<code>appuser</code> / <code>apppassword</code>). Click <strong>Log in</strong>. The look of the application changes as detailed in the following image:</p>
</div>
<div class="paragraph text-center">
<p><span class="image"><img src="./images/sso_app_jee_jsp_logged_in.png" alt="sso app jee jsp logged in"></span></p>
</div>
</li>
<li>
<p>Click the <strong>INVOKE SECURED</strong> button to access the <code>secured</code> endpoint.</p>
<div class="paragraph">
<p>You should see the <strong>Message: secured</strong> output.</p>
</div>
</li>
<li>
<p>Click the <strong>INVOKE ADMIN</strong> button to access the <code>admin</code> endpoint.</p>
<div class="paragraph">
<p>You should see <strong>403 Forbidden</strong> output.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>admin</code> endpoint requires users with <code>admin</code> RH-SSO role to invoke properly. Access for the <code>appuser</code> is forbidden because they only have <code>user</code> role privilege, which allows them to access the <code>secured</code> endpoint.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Perform the following steps to add the <code>appuser</code> to the <code>admin</code> RH-SSO role:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Access the administration console of the RH-SSO server&#8217;s instance.</p>
<div class="paragraph">
<p><strong>https://secure-sso-sso-app-demo.openshift.example.com/auth/admin</strong>.</p>
</div>
<div class="paragraph">
<p>Use the <a href="sso_server.html#sso-administrator-setup">credentials of the RH-SSO administrator user</a>.</p>
</div>
</li>
<li>
<p>Click <strong>Users</strong> in the <strong>Manage</strong> sidebar to view the user information for the <code>demo</code> realm.</p>
</li>
<li>
<p>Click <strong>View all users</strong> button.</p>
</li>
<li>
<p>Click the ID link for the <strong>appuser</strong> or alternatively click the <strong>Edit</strong> button in the <strong>Actions</strong> column.</p>
</li>
<li>
<p>Click the <strong>Role Mappings</strong> tab.</p>
</li>
<li>
<p>Select <code>admin</code> entry from the <strong>Available Roles</strong> list in the <strong>Realm Roles</strong> row.</p>
</li>
<li>
<p>Click <strong>Add selected&gt;</strong> button to add the <code>admin</code> role to the user.</p>
</li>
<li>
<p>Return to EAP 6.4 / 7.0 JSP service application.</p>
<div class="paragraph">
<p><strong>http://eap-app-eap-app-demo.openshift.example.com/app-jsp</strong>.</p>
</div>
</li>
<li>
<p>Click the <strong>LOGOUT</strong> button to reload role mappings for the <code>appuser</code>.</p>
</li>
<li>
<p>Click the <strong>LOGIN</strong> button again and provider <code>appuser</code> credentials.</p>
</li>
<li>
<p>Click the <strong>INVOKE ADMIN</strong> button again.</p>
<div class="paragraph">
<p>You should see the <strong>Message: admin</strong> output already.</p>
</div>
</li>
</ol>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="RH-SSO-Binary-Builds-Tutorial"><a class="anchor" href="#RH-SSO-Binary-Builds-Tutorial"></a>3.4. Example Workflow: Creating OpenShift Application from Existing Maven Binaries and Securing it Using Red Hat Single Sing-On</h3>
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak-documentation/blob/master/openshift/topics/tutorials.adoc" target="_blank">Edit this section</a>
<a href="https://issues.jboss.org/secure/CreateIssueDetails!init.jspa?pid=12313920&amp;components=12323375&amp;issuetype=1&amp;priority=3&amp;description=File:%20openshift/topics/tutorials.adoc" target="_blank">Report an issue</a>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tutorials"><a class="anchor" href="#tutorials"></a>4. Tutorials</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="Example-Deploying-SSO"><a class="anchor" href="#Example-Deploying-SSO"></a>4.1. Example Workflow: Preparing and Deploying the RH-SSO for OpenShift image</h3>
<div class="sect3">
<h4 id="Preparing-SSO-Authentication-for-OpenShift-Deployment"><a class="anchor" href="#Preparing-SSO-Authentication-for-OpenShift-Deployment"></a>4.1.1. Preparing RH-SSO Authentication for OpenShift Deployment</h4>
<div class="paragraph">
<p>Log in to the OpenShift CLI with a user that holds the <em>cluster:admin</em> role.</p>
</div>
<div class="paragraph">
<p>To deploy existing applications on OpenShift, you can use the <a href="https://docs.openshift.com/container-platform/latest/dev_guide/builds/build_inputs.html#binary-source">binary source</a> capability.</p>
</div>
</div>
<div class="sect3">
<h4 id="deploy-binary-build-of-eap-6-4-7-0-jsp-service-invocation-application-and-secure-it-using-red-hat-single-sign-on"><a class="anchor" href="#deploy-binary-build-of-eap-6-4-7-0-jsp-service-invocation-application-and-secure-it-using-red-hat-single-sign-on"></a>4.1.2. Deploy Binary Build of EAP 6.4 / 7.0 JSP Service Invocation Application and Secure it Using Red Hat Single Sign-On</h4>
<div class="paragraph">
<p>The following example uses both <a href="https://github.com/keycloak/keycloak-quickstarts/tree/latest/app-jee-jsp">app-jee-jsp</a> and <a href="https://github.com/keycloak/keycloak-quickstarts/tree/latest/service-jee-jaxrs">service-jee-jaxrs</a> quickstarts to deploy EAP 6.4 / 7.0 JSP service application that authenticates using the Red Hat Single Sign-On.</p>
</div>
<div class="paragraph">
<p><strong>Prerequisite:</strong></p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This guide assumes the RH-SSO for OpenShift image has been previously <a href="https://access.redhat.com/documentation/en-us/red_hat_jboss_middleware_for_openshift/3/html-single/red_hat_single_sign-on_for_openshift/index#Example-Deploying-SSO">deployed using one of the following templates:</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><em>sso72-mysql</em></strong></p>
</li>
<li>
<p><strong><em>sso72-mysql-persistent</em></strong></p>
</li>
<li>
<p><strong><em>sso72-postgresql</em></strong></p>
</li>
<li>
<p><strong><em>sso72-postgresql-persistent</em></strong></p>
</li>
<li>
<p><strong><em>sso72-x509-mysql-persistent</em></strong></p>
</li>
<li>
<p><strong><em>sso72-x509-postgresql-persistent</em></strong></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="create-rh-sso-realm-roles-and-user-for-the-eap-6-4-7-0-jsp-application-2"><a class="anchor" href="#create-rh-sso-realm-roles-and-user-for-the-eap-6-4-7-0-jsp-application-2"></a>Create RH-SSO Realm, Roles, and User for the EAP 6.4 / 7.0 JSP Application</h5>
<div class="paragraph">
<p>The EAP 6.4 / 7.0 JSP service application requires dedicated RH-SSO realm, username, and password to be able to authenticate using Red Hat Single Sign-On. Perform the following steps after the RH-SSO for OpenShift image has been deployed:</p>
</div>
<div class="paragraph">
<p><strong>Create the RH-SSO Realm</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Login to the administration console of the RH-SSO server.</p>
<div class="paragraph">
<p><strong>https://secure-sso-sso-app-demo.openshift.example.com/auth/admin</strong></p>
</div>
<div class="paragraph">
<p>Use the <a href="sso_server.html#sso-administrator-setup">credentials of the RH-SSO administrator user</a>.</p>
</div>
</li>
<li>
<p>Hover your cursor over the realm namespace (default is <strong>Master</strong>) at the top of the sidebar and click <strong>Add Realm</strong>.</p>
</li>
<li>
<p>Enter a realm name (this example uses <code>demo</code>) and click <strong>Create</strong>.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="upgrading-sso-db-from-70-to-71"><a class="anchor" href="#upgrading-sso-db-from-70-to-71"></a>4.2. Example Workflow: Updating Existing Database when Migrating RH-SSO for OpenShift Image to a new version</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Rolling updates from RH-SSO for OpenShift 7.0 / 7.1 to 7.2 are not supported as databases and caches are not backward compatible.</p>
</li>
<li>
<p>Stop all RH-SSO for OpenShift 7.0 / 7.1 instances before upgrading, they cannot run concurrently against the same database.</p>
</li>
<li>
<p>Pre-generated scripts are not available, they are generated dynamically depending on the database.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Red Hat Single Sign-On 7.2 can <a href="#automatic-db-migration">automatically migrate the database schema</a>, or you can choose to do it <a href="#manual-db-migration">manually</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>By default the database is automatically migrated when you start RH-SSO 7.2 for the first time.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="automatic-db-migration"><a class="anchor" href="#automatic-db-migration"></a>4.2.1. Automatic Database Migration</h4>
<div class="paragraph">
<p>This process assumes that you are running RH-SSO 7.1 image <a href="https://access.redhat.com/documentation/en-us/red_hat_jboss_middleware_for_openshift/3/html-single/red_hat_single_sign-on_for_openshift/index#Example-Deploying-SSO">deployed using one of the following templates</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><em>sso71-mysql</em></strong></p>
</li>
<li>
<p><strong><em>sso71-postgresql</em></strong></p>
</li>
<li>
<p><strong><em>sso71-mysql-persistent</em></strong></p>
</li>
<li>
<p><strong><em>sso71-postgresql-persistent</em></strong></p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Stop all RH-SSO 7.1 pods before upgrading to RH-SSO 7.2, as they cannot run concurrently against the same database.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Use the following steps to automatically migrate the database schema:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Identify existing deployment config for RH-SSO 7.1 containers.</p>
<div class="listingblock">
<div class="content">
<pre>$ oc get dc -o name --selector=application=sso
deploymentconfig/sso
deploymentconfig/sso-postgresql</pre>
</div>
</div>
</li>
<li>
<p>Stop all RH-SSO 7.1 containers in the current namespace.</p>
<div class="listingblock">
<div class="content">
<pre>$ oc scale --replicas=0 dc/sso
deploymentconfig "sso" scaled</pre>
</div>
</div>
</li>
<li>
<p>Update the image change trigger in the existing deployment config to reference the RH-SSO 7.2 image.</p>
<div class="listingblock">
<div class="content">
<pre>$ oc patch dc/sso --type=json -p '[{"op": "replace", "path": "/spec/triggers/0/imageChangeParams/from/name", "value": "redhat-sso72-openshift:1.1"}]'
"sso" patched</pre>
</div>
</div>
</li>
<li>
<p>Start rollout of the new RH-SSO 7.2 images based on the latest image defined in the image change triggers.</p>
<div class="listingblock">
<div class="content">
<pre>$ oc rollout latest dc/sso
deploymentconfig "sso" rolled out</pre>
</div>
</div>
</li>
<li>
<p>Deploy RH-SSO 7.2 containers using the modified deployment config.</p>
<div class="listingblock">
<div class="content">
<pre>$ oc scale --replicas=1 dc/sso
deploymentconfig "sso" scaled</pre>
</div>
</div>
</li>
<li>
<p>(Optional) Verify the database has been successfully updated.</p>
<div class="listingblock">
<div class="content">
<pre>$ oc get pods --selector=application=sso
NAME                     READY     STATUS    RESTARTS   AGE
sso-4-vg21r              1/1       Running   0          1h
sso-postgresql-1-t871r   1/1       Running   0          2h</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ oc logs sso-4-vg21r | grep 'Updating'
11:23:45,160 INFO  [org.keycloak.connections.jpa.updater.liquibase.LiquibaseJpaUpdaterProvider] (ServerService Thread Pool -- 58) Updating database. Using changelog META-INF/jpa-changelog-master.xml</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="manual-db-migration"><a class="anchor" href="#manual-db-migration"></a>4.2.2. Manual Database Migration</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Pre-generated scripts are not available. They are generated dynamically depending on the database. With RH-SSO 7.2 one can generate and export these to an SQL file that can be manually applied to the database afterwards. To dynamically generate the SQL migration file for the database:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Configure RH-SSO 7.2 with the correct datasource,</p>
</li>
<li>
<p>Set following configuration options in the <code>standalone-openshift.xml</code> file:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><code>initializeEmpty=false</code>,</p>
</li>
<li>
<p><code>migrationStrategy=manual</code>, and</p>
</li>
<li>
<p><code>migrationExport</code> to the location on the file system of the pod, where the output SQL migration file should be stored (e.g. <code>migrationExport="${jboss.home.dir}/keycloak-database-update.sql"</code>).</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>See <a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.2/html/server_installation_and_configuration_guide/database-1#database_configuration">database configuration of RH-SSO 7.2</a> for further details.</p>
</div>
<div class="paragraph">
<p>The database migration process handles the data schema update and performs manipulation of the data, therefore, stop all RH-SSO 7.1 instances before dynamic generation of the SQL migration file.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This guide assumes the RH-SSO 7.1 for OpenShift image has been previously <a href="https://access.redhat.com/documentation/en-us/red_hat_jboss_middleware_for_openshift/3/html-single/red_hat_single_sign-on_for_openshift/index#Example-Deploying-SSO">deployed using one of the following templates:</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><em>sso71-mysql</em></strong></p>
</li>
<li>
<p><strong><em>sso71-postgresql</em></strong></p>
</li>
<li>
<p><strong><em>sso71-mysql-persistent</em></strong></p>
</li>
<li>
<p><strong><em>sso71-postgresql-persistent</em></strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Perform the following to generate and get the SQL migration file for the database:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Prepare template of OpenShift <a href="https://docs.openshift.com/container-platform/latest/dev_guide/jobs.html">database migration job</a> to generate the SQL file.</p>
<div class="listingblock">
<div class="content">
<pre>$ cat sso71-to-sso72-db-migrate-job.yaml.orig
apiVersion: batch/v1
kind: Job
metadata:
  name: sso71-to-sso72-db-migrate-job
spec:
  autoSelector: true
  parallelism: 0
  completions: 1
  template:
    metadata:
      name: sso71-to-sso72-db-migrate-job
    spec:
      containers:
      - env:
        - name: DB_SERVICE_PREFIX_MAPPING
          value: &lt;&lt;DB_SERVICE_PREFIX_MAPPING_VALUE&gt;&gt;
        - name: &lt;&lt;PREFIX&gt;&gt;_JNDI
          value: &lt;&lt;PREFIX_JNDI_VALUE&gt;&gt;
        - name: &lt;&lt;PREFIX&gt;&gt;_USERNAME
          value: &lt;&lt;PREFIX_USERNAME_VALUE&gt;&gt;
        - name: &lt;&lt;PREFIX&gt;&gt;_PASSWORD
          value: &lt;&lt;PREFIX_PASSWORD_VALUE&gt;&gt;
        - name: &lt;&lt;PREFIX&gt;&gt;_DATABASE
          value: &lt;&lt;PREFIX_DATABASE_VALUE&gt;&gt;
        - name: TX_DATABASE_PREFIX_MAPPING
          value: &lt;&lt;TX_DATABASE_PREFIX_MAPPING_VALUE&gt;&gt;
        - name: &lt;&lt;SERVICE_HOST&gt;&gt;
          value: &lt;&lt;SERVICE_HOST_VALUE&gt;&gt;
        - name: &lt;&lt;SERVICE_PORT&gt;&gt;
          value: &lt;&lt;SERVICE_PORT_VALUE&gt;&gt;
        image: &lt;&lt;SSO_IMAGE_VALUE&gt;&gt;
        imagePullPolicy: Always
        name: sso71-to-sso72-db-migrate-job
        # Keep the pod running after SQL migration file has been generated,
        # so we can retrieve it
        command: ["/bin/bash", "-c", "/opt/eap/bin/openshift-launch.sh || sleep 600"]
      restartPolicy: Never</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ cp sso71-to-sso72-db-migrate-job.yaml.orig sso71-to-sso72-db-migrate-job.yaml</pre>
</div>
</div>
</li>
<li>
<p>Copy the datasource definition and database access credentials from RH-SSO 7.1 deployment config to appropriate places in database job migration template.</p>
<div class="paragraph">
<p>Use the following script to copy <code>DB_SERVICE_PREFIX_MAPPING</code> and <code>TX_DATABASE_PREFIX_MAPPING</code> variable values, together with values of environment variables specific to particular datasource (<code>&lt;PREFIX&gt;_JNDI</code>, <code>&lt;PREFIX&gt;_USERNAME</code>, <code>&lt;PREFIX&gt;_PASSWORD</code>, and <code>&lt;PREFIX&gt;_DATABASE</code>) from the deployment config named <code>sso</code> to the database job migration template named <code>sso71-to-sso72-db-migrate-job.yaml</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Although the <code>DB_SERVICE_PREFIX_MAPPING</code> environment variable allows a <a href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.0/html-single/red_hat_jboss_enterprise_application_platform_for_openshift/#datasources">comma-separated list of <strong>&lt;name&gt;-&lt;database_type&gt;=&lt;PREFIX&gt;</strong> triplets</a> as its value, this example script accepts only one datasource triplet definition for demonstration purposes. You can modify the script for handling multiple datasource definition triplets.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre>$ cat mirror_sso_dc_db_vars.sh
#!/bin/bash

# IMPORTANT:
#
# If the name of the SSO deployment config differs from 'sso' or if the file name of the
# YAML definition of the migration job is different, update the following two variables
SSO_DC_NAME="sso"
JOB_MIGRATION_YAML="sso71-to-sso72-db-migrate-job.yaml"

# Get existing variables of the $SSO_DC_NAME deployment config in an array
declare -a SSO_DC_VARS=($(oc set env dc/${SSO_DC_NAME} --list | sed '/^#/d'))

# Get the PREFIX used in the names of environment variables
PREFIX=$(grep -oP 'DB_SERVICE_PREFIX_MAPPING=[^ ]+' &lt;&lt;&lt; "${SSO_DC_VARS[@]}")
PREFIX=${PREFIX##*=}

# Substitute (the order in which replacements are made is important):
# * &lt;&lt;PREFIX&gt;&gt; with actual $PREFIX value and
# * &lt;&lt;PREFIX with "&lt;&lt;$PREFIX" value
sed -i "s#&lt;&lt;PREFIX&gt;&gt;#${PREFIX}#g" ${JOB_MIGRATION_YAML}
sed -i "s#&lt;&lt;PREFIX#&lt;&lt;${PREFIX}#g" ${JOB_MIGRATION_YAML}

# Construct the array of environment variables specific to the datasource
declare -a DB_VARS=(JNDI USERNAME PASSWORD DATABASE)

# Prepend $PREFIX to each item of the datasource array
DB_VARS=( "${DB_VARS[@]/#/${PREFIX}_}" )

# Add DB_SERVICE_PREFIX_MAPPING and TX_DATABASE_PREFIX_MAPPING variables
# to datasource array
DB_VARS=( "${DB_VARS[@]}" DB_SERVICE_PREFIX_MAPPING TX_DATABASE_PREFIX_MAPPING )

# Construct the SERVICE from DB_SERVICE_PREFIX_MAPPING
SERVICE=$(grep -oP 'DB_SERVICE_PREFIX_MAPPING=[^ ]+' &lt;&lt;&lt; "${SSO_DC_VARS[@]}")
SERVICE=${SERVICE#*=}
SERVICE=${SERVICE%=*}
SERVICE=${SERVICE^^}
SERVICE=${SERVICE//-/_}

# If the deployment config contains &lt;&lt;SERVICE&gt;&gt;_SERVICE_HOST and
# &lt;&lt;SERVICE&gt;&gt;_SERVICE_PORT variables, add them to the datasource array.
# Their values also need to be propagated into yaml definition of the migration job.
if grep -Pq "${SERVICE}_SERVICE_HOST=[^ ]+" &lt;&lt;&lt; "${SSO_DC_VARS[@]}" &amp;&amp;
   grep -Pq "${SERVICE}_SERVICE_PORT=[^ ]+" &lt;&lt;&lt; "${SSO_DC_VARS[@]}"
then
  DB_VARS=( "${DB_VARS[@]}" ${SERVICE}_SERVICE_HOST ${SERVICE}_SERVICE_PORT )
# If they are not defined, delete their placeholder rows in yaml definition file
# (since if not defined they are not expanded which make the yaml definition invalid).
else
  for KEY in "HOST" "PORT"
  do
    sed -i "/SERVICE_${KEY}/d" ${JOB_MIGRATION_YAML}
  done
fi

# Substitute (the order in which replacements are made is important):
# * &lt;&lt;SERVICE_HOST&gt;&gt; with ${SERVICE}_SERVICE_HOST and
# * &lt;&lt;SERVICE_HOST_VALUE&gt;&gt; with "&lt;&lt;${SERVICE}_SERVICE_HOST_VALUE&gt;&gt;"
# Do this for both "HOST" and "PORT"
for KEY in "HOST" "PORT"
do
  sed -i "s#&lt;&lt;SERVICE_${KEY}&gt;&gt;#${SERVICE}_SERVICE_${KEY}#g" ${JOB_MIGRATION_YAML}
  sed -i "s#&lt;&lt;SERVICE_${KEY}_VALUE&gt;&gt;#&lt;&lt;${SERVICE}_SERVICE_${KEY}_VALUE&gt;&gt;#g" \
    ${JOB_MIGRATION_YAML}
done

# Propagate the values of the datasource array items into yaml definition of the
# migration job
for VAR in "${SSO_DC_VARS[@]}"
do
  IFS=$'=' read KEY VALUE &lt;&lt;&lt; $VAR
  if grep -q $KEY &lt;&lt;&lt; ${DB_VARS[@]}
  then
    KEY+="_VALUE"
    # Enwrap integer port value with double quotes
    if [[ ${KEY} =~ ${SERVICE}_SERVICE_PORT_VALUE ]]
    then
      sed -i "s#&lt;&lt;${KEY}&gt;&gt;#\"${VALUE}\"#g" ${JOB_MIGRATION_YAML}
    # Character values do not need quotes
    else
      sed -i "s#&lt;&lt;${KEY}&gt;&gt;#${VALUE}#g" ${JOB_MIGRATION_YAML}
    fi
    # Verify that the value has been successfully propagated.
    if grep -q '(JNDI|USERNAME|PASSWORD|DATABASE)' &lt;&lt;&lt; "${KEY}" &amp;&amp;
       grep -q "&lt;&lt;PREFIX${KEY#${PREFIX}}" ${JOB_MIGRATION_YAML} ||
       grep -q "&lt;&lt;${KEY}&gt;&gt;" ${JOB_MIGRATION_YAML}
    then
      echo "Failed to update value of ${KEY%_VALUE}! Aborting."
      exit 1
    else
      printf '%-60s%-40s\n' "Successfully updated ${KEY%_VALUE} to:" "$VALUE"
    fi
  fi
done</pre>
</div>
</div>
<div id="get-db-credentials" class="paragraph">
<p>Run the script.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ chmod +x ./mirror_sso_dc_db_vars.sh
$ ./mirror_sso_dc_db_vars.sh
Successfully updated DB_SERVICE_PREFIX_MAPPING to:          sso-postgresql=DB
Successfully updated DB_JNDI to:                            java:jboss/datasources/KeycloakDS
Successfully updated DB_USERNAME to:                        userxOp
Successfully updated DB_PASSWORD to:                        tsWNhQHK
Successfully updated DB_DATABASE to:                        root
Successfully updated TX_DATABASE_PREFIX_MAPPING to:         sso-postgresql=DB</pre>
</div>
</div>
</li>
<li>
<p>Build the RH-SSO 7.2 database migration image using the <a href="https://github.com/iankko/openshift-examples/tree/sso_manual_db_migration">pre-configured source</a> and wait for the build to finish.</p>
<div class="listingblock">
<div class="content">
<pre>$ oc get is -n openshift | grep sso72 | cut -d ' ' -f1
redhat-sso72-openshift</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ oc new-build redhat-sso72-openshift:1.1~https://github.com/jboss-openshift/openshift-examples --context-dir=sso-manual-db-migration --name=sso72-db-migration-image
--&gt; Found image bf45ac2 (7 days old) in image stream "openshift/redhat-sso72-openshift" under tag "1.1" for "redhat-sso72-openshift:1.1"

    Red Hat SSO 7.2
    ---------------
    Platform for running Red Hat SSO

    Tags: sso, sso7, keycloak

    * A source build using source code from https://github.com/jboss-openshift/openshift-examples will be created
      * The resulting image will be pushed to image stream "sso72-db-migration-image:latest"
      * Use 'start-build' to trigger a new build

--&gt; Creating resources with label build=sso72-db-migration-image ...
    imagestream "sso72-db-migration-image" created
    buildconfig "sso72-db-migration-image" created
--&gt; Success
    Build configuration "sso72-db-migration-image" created and build triggered.
    Run 'oc logs -f bc/sso72-db-migration-image' to stream the build progress.</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ oc logs -f bc/sso72-db-migration-image --follow
Cloning "https://github.com/iankko/openshift-examples.git" ...
...
Push successful</pre>
</div>
</div>
</li>
<li>
<p>Update the template of the database migration job (<code>sso71-to-sso72-db-migrate-job.yaml</code>) with reference to the built <code>sso72-db-migration-image</code> image.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Get the docker pull reference for the image.</p>
<div class="listingblock">
<div class="content">
<pre>$ PULL_REF=$(oc get istag -n $(oc project -q) --no-headers | grep sso72-db-migration-image | tr -s ' ' | cut -d ' ' -f 2)</pre>
</div>
</div>
</li>
<li>
<p>Replace the &lt;&lt;SSO_IMAGE_VALUE&gt;&gt; field in the job template with the pull specification.</p>
<div class="listingblock">
<div class="content">
<pre>$ sed -i "s#&lt;&lt;SSO_IMAGE_VALUE&gt;&gt;#$PULL_REF#g" sso71-to-sso72-db-migrate-job.yaml</pre>
</div>
</div>
</li>
<li>
<p>Verify that the field is updated.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Instantiate database migration job from the job template.</p>
<div class="listingblock">
<div class="content">
<pre>$ oc create -f sso71-to-sso72-db-migrate-job.yaml
job "sso71-to-sso72-db-migrate-job" created</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The database migration process handles the data schema update and performs manipulation of the data, therefore, stop all RH-SSO 7.1 instances before dynamic generation of the SQL migration file.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Identify existing deployment config for RH-SSO 7.1 containers.</p>
<div class="listingblock">
<div class="content">
<pre>$ oc get dc -o name --selector=application=sso
deploymentconfig/sso
deploymentconfig/sso-postgresql</pre>
</div>
</div>
</li>
<li>
<p>Stop all RH-SSO 7.1 containers in the current namespace.</p>
<div class="listingblock">
<div class="content">
<pre>$ oc scale --replicas=0 dc/sso
deploymentconfig "sso" scaled</pre>
</div>
</div>
</li>
<li>
<p>Run the database migration job and wait for the pod to be running correctly.</p>
<div class="listingblock">
<div class="content">
<pre>$ oc get jobs
NAME                            DESIRED   SUCCESSFUL   AGE
sso71-to-sso72-db-migrate-job   1         0            3m</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ oc scale --replicas=1 job/sso71-to-sso72-db-migrate-job
job "sso71-to-sso72-db-migrate-job" scaled</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ oc get pods
NAME                                  READY     STATUS      RESTARTS   AGE
sso-postgresql-1-n5p16                1/1       Running     1          19h
sso71-to-sso72-db-migrate-job-b87bb   1/1       Running     0          1m
sso72-db-migration-image-1-build      0/1       Completed   0          27m</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>By default, the database migration job terminates automatically after <code>600 seconds</code> after the migration file is generated. You can adjust this time period.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Get the dynamically generated SQL database migration file from the pod.</p>
<div class="listingblock">
<div class="content">
<pre>$ mkdir -p ./db-update
$ oc rsync sso71-to-sso72-db-migrate-job-b87bb:/opt/eap/keycloak-database-update.sql ./db-update
receiving incremental file list
keycloak-database-update.sql

sent 30 bytes  received 29,726 bytes  59,512.00 bytes/sec
total size is 29,621  speedup is 1.00</pre>
</div>
</div>
</li>
<li>
<p>Inspect the <code>keycloak-database-update.sql</code> file for changes to be performed within manual RH-SSO 7.2 database update.</p>
</li>
<li>
<p>Apply the database update manually.</p>
<div class="ulist">
<ul>
<li>
<p>Run the following commands for <strong><em>sso71-postgresql</em></strong> and <strong><em>sso71-postgresql-persistent</em></strong> templates (PostgreSQL database):</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Copy the generated SQL migration file to the PostgreSQL pod.</p>
<div class="listingblock">
<div class="content">
<pre>$ oc rsync --no-perms=true ./db-update/ sso-postgresql-1-n5p16:/tmp
sending incremental file list

sent 77 bytes  received 11 bytes  176.00 bytes/sec
total size is 26,333  speedup is 299.24</pre>
</div>
</div>
</li>
<li>
<p>Start a shell session to the PostgreSQL pod.</p>
<div class="listingblock">
<div class="content">
<pre>$ oc rsh sso-postgresql-1-n5p16
sh-4.2$</pre>
</div>
</div>
</li>
<li>
<p>Use the <code>psql</code> tool to apply database update manually.</p>
<div class="listingblock">
<div class="content">
<pre>sh-4.2$ alias psql="/opt/rh/rh-postgresql95/root/bin/psql"
sh-4.2$ psql --version
psql (PostgreSQL) 9.5.4
sh-4.2$ psql -U &lt;PREFIX&gt;_USERNAME -d &lt;PREFIX&gt;_DATABASE -W -f /tmp/keycloak-database-update.sql
Password for user &lt;PREFIX&gt;_USERNAME:
INSERT 0 1
INSERT 0 1
...</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Replace <code>&lt;PREFIX&gt;_USERNAME</code> and <code>&lt;PREFIX&gt;_DATABASE</code> with the actual database credentials retrieved <a href="#get-db-credentials">in previous section</a>. Also use value of <code>&lt;PREFIX&gt;_PASSWORD</code> as the password for the database, when prompted.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Close the shell session to the PostgreSQL pod. Continue with <a href="#image-change-trigger-update-step">updating image change trigger step</a>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Run the following commands for <strong><em>sso71-mysql</em></strong> and <strong><em>sso71-mysql-persistent</em></strong> templates (MySQL database):</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Given pod situation similar to the following:</p>
<div class="listingblock">
<div class="content">
<pre>$ oc get pods
NAME                                  READY     STATUS      RESTARTS   AGE
sso-mysql-1-zvhk3                     1/1       Running     0          1h
sso71-to-sso72-db-migrate-job-m202t   1/1       Running     0          11m
sso72-db-migration-image-1-build      0/1       Completed   0          13m</pre>
</div>
</div>
</li>
<li>
<p>Copy the generated SQL migration file to the MySQL pod.</p>
<div class="listingblock">
<div class="content">
<pre>$ oc rsync --no-perms=true ./db-update/ sso-mysql-1-zvhk3:/tmp
sending incremental file list
keycloak-database-update.sql

sent 24,718 bytes  received 34 bytes  49,504.00 bytes/sec
total size is 24,594  speedup is 0.99</pre>
</div>
</div>
</li>
<li>
<p>Start a shell session to the MySQL pod.</p>
<div class="listingblock">
<div class="content">
<pre>$ oc rsh sso-mysql-1-zvhk3
sh-4.2$</pre>
</div>
</div>
</li>
<li>
<p>Use the <code>mysql</code> tool to apply database update manually.</p>
<div class="listingblock">
<div class="content">
<pre>sh-4.2$ alias mysql="/opt/rh/rh-mysql57/root/bin/mysql"
sh-4.2$ mysql --version
/opt/rh/rh-mysql57/root/bin/mysql  Ver 14.14 Distrib 5.7.16, for Linux (x86_64) using  EditLine wrapper
sh-4.2$ mysql -D &lt;PREFIX&gt;_DATABASE -u &lt;PREFIX&gt;_USERNAME -p &lt; /tmp/keycloak-database-update.sql
Enter password:
sh-4.2$ echo $?
0</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Replace <code>&lt;PREFIX&gt;_USERNAME</code> and <code>&lt;PREFIX&gt;_DATABASE</code> with the actual database credentials retrieved <a href="#get-db-credentials">in previous section</a>. Also use value of <code>&lt;PREFIX&gt;_PASSWORD</code> as the password for the database, when prompted.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Close the shell session to the MySQL pod. Continue with <a href="#image-change-trigger-update-step">updating image change trigger step</a>.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div id="image-change-trigger-update-step" class="olist arabic">
<ol class="arabic" start="12">
<li>
<p>Update image change trigger in the existing deployment config of RH-SSO 7.1 to reference the RH-SSO 7.2 image.</p>
<div class="listingblock">
<div class="content">
<pre>$ oc patch dc/sso --type=json -p '[{"op": "replace", "path": "/spec/triggers/0/imageChangeParams/from/name", "value": "redhat-sso72-openshift:1.1"}]'
"sso" patched</pre>
</div>
</div>
</li>
<li>
<p>Start rollout of the new RH-SSO 7.2 images based on the latest image defined in the image change triggers.</p>
<div class="listingblock">
<div class="content">
<pre>$ oc rollout latest dc/sso
deploymentconfig "sso" rolled out</pre>
</div>
</div>
</li>
<li>
<p>Deploy RH-SSO 7.2 containers using the modified deployment config.</p>
<div class="listingblock">
<div class="content">
<pre>$ oc scale --replicas=1 dc/sso
deploymentconfig "sso" scaled</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="example-workflow-migrating-entire-rh-sso-server-database-across-the-environments"><a class="anchor" href="#example-workflow-migrating-entire-rh-sso-server-database-across-the-environments"></a>4.3. Example Workflow: Migrating Entire RH-SSO Server Database Across The Environments</h3>
<div class="paragraph">
<p>This tutorial focuses on migrating the Red Hat Single Sign-On server database from one environment to another or migrating to a different database. It assumes steps described in <a href="#Preparing-SSO-Authentication-for-OpenShift-Deployment">Preparing RH-SSO Authentication for OpenShift Deployment</a> section have been performed already.</p>
</div>
<div class="sect3">
<h4 id="deploying-the-rh-sso-mysql-application-template"><a class="anchor" href="#deploying-the-rh-sso-mysql-application-template"></a>4.3.1. Deploying the RH-SSO MySQL Application Template</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in to the OpenShift web console and select the <em>sso-app-demo</em> project space.</p>
</li>
<li>
<p>Click <strong>Add to project</strong> to list the default image streams and templates.</p>
</li>
<li>
<p>Use the <strong>Filter by keyword</strong> search bar to limit the list to those that match <em>sso</em>. You may need to click <strong>See all</strong> to show the desired application template.</p>
</li>
<li>
<p>Select <strong><em>sso72-mysql</em></strong> RH-SSO application template. When deploying the template ensure to <strong>keep the <em>SSO_REALM</em> variable unset</strong> (default value).</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Export and import of Red Hat Single Sign-On 7.2 database <a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.2/html-single/server_administration_guide/#export_import">is triggered at RH-SSO server boot time and its paramaters are passed in via Java system properties.</a> This means during one RH-SSO server boot only one of the possible migration actions (either <strong><em>export</em></strong>, or <strong><em>import</em></strong>) can be performed.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When the <strong><em>SSO_REALM</em></strong> configuration variable is set on the RH-SSO for OpenShift image, a database import is performed in order to create the RH-SSO server realm requested in the variable. For the database export to be performed correctly, the <strong><em>SSO_REALM</em></strong> configuration variable cannot be simultaneously defined on such image.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Click <strong>Create</strong> to deploy the application template and start pod deployment. This may take a couple of minutes.</p>
<div class="paragraph">
<p>Then access the RH-SSO web console at <strong>https://secure-sso-<em>&lt;sso-app-demo&gt;</em>.<em>&lt;openshift32.example.com&gt;</em>/auth/admin</strong> using the <a href="../advanced_concepts/advanced_concepts.html#sso-administrator-setup">administrator account</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This example workflow uses a self-generated CA to provide an end-to-end workflow for demonstration purposes. Accessing the RH-SSO web console will prompt an insecure connection warning.<br>
For production environments, Red Hat recommends that you use an SSL certificate purchased from a verified Certificate Authority.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="optional-creating-additional-rh-sso-a-href-https-access-redhat-com-documentation-en-us-red_hat_single_sign-on-7-2-html-single-server_administration_guide-core_concepts_and_terms-realm-and-users-a-to-be-also-exported"><a class="anchor" href="#optional-creating-additional-rh-sso-a-href-https-access-redhat-com-documentation-en-us-red_hat_single_sign-on-7-2-html-single-server_administration_guide-core_concepts_and_terms-realm-and-users-a-to-be-also-exported"></a>4.3.2. (Optional) Creating additional RH-SSO <a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.2/html-single/server_administration_guide/#core_concepts_and_terms">realm and users</a> to be also exported</h4>
<div class="paragraph">
<p>When performing <a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.2/html-single/server_administration_guide/#export_import">Red Hat Single Sign-On 7.2 server database export</a> only RH-SSO realms and users currently present in the database will be exported. If the exported JSON file should include also additional RH-SSO realms and users, these need to be created first:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.2/html-single/server_administration_guide/#create-realm">Create a new realm</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.2/html-single/server_administration_guide/#create-new-user">Create new users</a></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Upon their creation <a href="#sso-export-the-database">the database can be exported.</a></p>
</div>
</div>
<div class="sect3">
<h4 id="sso-export-the-database"><a class="anchor" href="#sso-export-the-database"></a>4.3.3. Export the RH-SSO database as a JSON file on the OpenShift pod</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Get the RH-SSO deployment config and scale it down to zero.</p>
<div class="listingblock">
<div class="content">
<pre>$ oc get dc -o name
deploymentconfig/sso
deploymentconfig/sso-mysql

$ oc scale --replicas=0 dc sso
deploymentconfig "sso" scaled</pre>
</div>
</div>
</li>
<li>
<p>Instruct the RH-SSO 7.2 server deployed on RH-SSO for OpenShift image to perform database export at RH-SSO server boot time.</p>
<div class="listingblock">
<div class="content">
<pre>oc env dc/sso -e "JAVA_OPTS_APPEND=-Dkeycloak.migration.action=export -Dkeycloak.migration.provider=singleFile -Dkeycloak.migration.file=/tmp/demorealm-export.json"</pre>
</div>
</div>
</li>
<li>
<p>Scale the RH-SSO deployment config back up. This will start the RH-SSO server and export its database.</p>
<div class="listingblock">
<div class="content">
<pre>$ oc scale --replicas=1 dc sso
deploymentconfig "sso" scaled</pre>
</div>
</div>
</li>
<li>
<p>(Optional) Verify that the export was successful.</p>
<div class="listingblock">
<div class="content">
<pre>$ oc get pods
NAME                READY     STATUS    RESTARTS   AGE
sso-4-ejr0k         1/1       Running   0          27m
sso-mysql-1-ozzl0   1/1       Running   0          4h

$ oc logs sso-4-ejr0k | grep 'Export'
09:24:59,503 INFO  [org.keycloak.exportimport.singlefile.SingleFileExportProvider] (ServerService Thread Pool -- 57) Exporting model into file /tmp/demorealm-export.json
09:24:59,998 INFO  [org.keycloak.services] (ServerService Thread Pool -- 57) KC-SERVICES0035: Export finished successfully</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="retrieve-and-import-the-exported-json-file"><a class="anchor" href="#retrieve-and-import-the-exported-json-file"></a>4.3.4. Retrieve and import the exported JSON file</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Retrieve the JSON file of the RH-SSO database from the pod.</p>
<div class="listingblock">
<div class="content">
<pre>$ oc get pods
NAME                READY     STATUS    RESTARTS   AGE
sso-4-ejr0k         1/1       Running   0          2m
sso-mysql-1-ozzl0   1/1       Running   0          4h

$ oc rsync sso-4-ejr0k:/tmp/demorealm-export.json .</pre>
</div>
</div>
</li>
<li>
<p>(Optional) Import the JSON file of the RH-SSO database into an RH-SSO server running in another environment.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For importing into an RH-SSO server not running on OpenShift, see the <a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.2/html/server_administration_guide/export_import">Export and Import section</a> of the RH SSO Server Administration Guide.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Use the <a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.2/html-single/server_administration_guide/#admin_console_export_import">administration console</a> of the RH-SSO server to import the resources from previously exported JSON file into the RH-SSO server&#8217;s database, when the RH-SSO server is running as a Red Hat Single Sign-On 7.2 container on OpenShift:</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Log into the <code>master</code> realm&#8217;s administration console of the RH-SSO server using the credentials used to create the administrator user. In the browser, navigate to <strong>http://sso-&lt;project-name&gt;.&lt;hostname&gt;/auth/admin</strong>  for the RH-SSO web server, or to <strong>https://secure-sso-&lt;project-name&gt;.&lt;hostname&gt;/auth/admin</strong> for the encrypted RH-SSO web server.</p>
</li>
<li>
<p>At the top of the sidebar choose the name of the RH-SSO realm, the users, clients, realm roles, and client roles should be imported to. This example uses <code>master</code> realm.</p>
</li>
<li>
<p>Click the <strong>Import</strong> link under <strong>Manage</strong> section at the bottom of the sidebar.</p>
</li>
<li>
<p>In the page that opens, click <strong>Select file</strong> and then specify the location of the exported <code>demorealm-export.json</code> JSON file on the local file system.</p>
</li>
<li>
<p>From the <strong>Import from realm</strong> drop-down menu, select the name of the RH-SSO realm from which the data should be imported. This example uses <code>master</code> realm.</p>
</li>
<li>
<p>Choose which of users, clients, realm roles, and client roles should be imported (all of them are imported by default).</p>
</li>
<li>
<p>Choose a strategy to perform, when a resource already exists (one of <strong>Fail</strong>, <strong>Skip</strong>, or <strong>Overwrite</strong>).</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The attempt to import an object (user, client, realm role, or client role) fails if object with the same identifier already exists in the current database. Use <strong>Skip</strong> strategy to import the objects that are present in the <code>demorealm-export.json</code> file, but do not exist in current database.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Click <strong>Import</strong> to perform the import.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When importing objects from a non-master realm to <code>master</code> realm or vice versa, after clicking the <strong>Import</strong> button, it is sometimes possible to encounter an error like the following one:</p>
</div>
<div id="realm-import-error-message" class="paragraph text-center">
<p><span class="image"><img src="./images/import_realm_error.png" alt="Example of Possible Error Message when Performing Partial Import from Previously Exported JSON File"></span></p>
</div>
<div class="paragraph">
<p>In such cases, it is necessary first to create the missing clients, having the <strong>Access Type</strong> set to <strong>bearer-only</strong>. These clients can be created by manual copy of their characteristics from the source RH-SSO server, on which the export JSON file was created, to the target RH-SSO server, where the JSON file is imported. After creation of the necessary clients, click the <strong>Import</strong> button again.</p>
</div>
<div class="paragraph">
<p>To suppress the <a href="#realm-import-error-message">above</a> error message, it is needed to create the missing <code>realm-management</code> client, of the <strong>bearer-only</strong> <strong>Access Type</strong>, and click the <strong>Import</strong> button again.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For <strong>Skip</strong> import strategy, the newly added objects are marked as <strong>ADDED</strong> and the object which were skipped are marked as <strong>SKIPPED</strong>, in the <strong>Action</strong> column on the import result page.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The administration console import allows you to <strong>overwrite</strong> resources if you choose (<strong>Overwrite</strong> strategy). On a production system use this feature with caution.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="OSE-SSO-AUTH-TUTE"><a class="anchor" href="#OSE-SSO-AUTH-TUTE"></a>4.4. Example Workflow: Configuring OpenShift to use RH-SSO for Authentication</h3>
<div class="paragraph">
<p>Configure OpenShift to use the RH-SSO deployment as the authorization gateway for OpenShift. This follows on from <a href="#Example-Deploying-SSO">Example Workflow: Preparing and Deploying the RH-SSO for OpenShift image</a>, in which RH-SSO was deployed on OpenShift.</p>
</div>
<div class="paragraph">
<p>This example adds RH-SSO as an authentication method alongside the HTPasswd method configured in the <a href="https://access.redhat.com/documentation/en/red-hat-xpaas/0/single/openshift-primer/#understand_roles_and_authentication">OpenShift Primer</a>. Once configured, both methods will be available for user login to your OpenShift web console.</p>
</div>
<div class="sect3">
<h4 id="configuring-rh-sso-credentials"><a class="anchor" href="#configuring-rh-sso-credentials"></a>4.4.1. Configuring RH-SSO Credentials</h4>
<div class="paragraph">
<p>Log in to the encrypted RH-SSO web server at <strong>https://secure-sso-<em>sso-app-demo</em>.<em>openshift32.example.com</em>/auth/admin</strong> using the <a href="../advanced_concepts/advanced_concepts.html#sso-administrator-setup">administrator account</a> created during the RH-SSO deployment.</p>
</div>
<div class="paragraph">
<p><strong>Create a Realm</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Hover your cursor over the realm namespace (default is <strong>Master</strong>) at the top of the sidebar and click <strong>Add Realm</strong>.</p>
</li>
<li>
<p>Enter a realm name (this example uses <em>OpenShift</em>) and click <strong>Create</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Create a User</strong></p>
</div>
<div class="paragraph">
<p>Create a test user that can be used to demonstrate the RH-SSO-enabled OpenShift login:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <strong>Users</strong> in the <strong>Manage</strong> sidebar to view the user information for the realm.</p>
</li>
<li>
<p>Click <strong>Add User</strong>.</p>
</li>
<li>
<p>Enter a valid <strong>Username</strong> (this example uses <em>testuser</em>) and any additional optional information and click <strong>Save</strong>.</p>
</li>
<li>
<p>Edit the user configuration:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click the <strong>Credentials</strong> tab in the user space and enter a password for the user.</p>
</li>
<li>
<p>Ensure the <strong>Temporary Password</strong> option is set to <strong>Off</strong> so that it does not prompt for a password change later on, and click <strong>Reset Password</strong> to set the user password. A pop-up window prompts for additional confirmation.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Create and Configure an OpenID-Connect Client</strong></p>
</div>
<div class="paragraph">
<p>See the <a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.2/html-single/server_administration_guide/#clients">Managing Clients</a> chapter of the Red Hat Single Sign-On Server Administration Guide for more information.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <strong>Clients</strong> in the <strong>Manage</strong> sidebar and click <strong>Create</strong>.</p>
</li>
<li>
<p>Enter the <strong>Client ID</strong>. This example uses <em>openshift-demo</em>.</p>
</li>
<li>
<p>Select a <strong>Client Protocol</strong> from the drop-down menu (this example uses <strong>openid-connect</strong>) and click <strong>Save</strong>. You will be taken to the configuration <strong>Settings</strong> page of the <em>openshift-demo</em> client.</p>
</li>
<li>
<p>From the <strong>Access Type</strong> drop-down menu, select <strong>confidential</strong>. This is the access type for server-side applications.</p>
</li>
<li>
<p>In the <strong>Valid Redirect URIs</strong> dialog, enter the URI for the OpenShift web console, which is <em>https://openshift.example.com:8443/*</em> in this example.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The client <strong>Secret</strong> is needed to configure OpenID-Connect on the OpenShift master in the next section. You can copy it now from under the <strong>Credentials</strong> tab. The secret is &lt;<em>7b0384a2-b832-16c5-9d73-2957842e89h7</em>&gt; for this example.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuring-openshift-master-for-red-hat-single-sign-on-authentication"><a class="anchor" href="#configuring-openshift-master-for-red-hat-single-sign-on-authentication"></a>4.4.2. Configuring OpenShift Master for Red Hat Single Sign-On Authentication</h4>
<div class="paragraph">
<p>Log in to the OpenShift master CLI. You must have the required permissions to edit the <strong>/etc/origin/master/master-config.yaml</strong> file.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Edit the <strong>/etc/origin/master/master-config.yaml</strong> file and find the <strong>identityProviders</strong>. The OpenShift master, which was deployed using the OpenShift Primer, is configured with HTPassword and shows the following:</p>
<div class="listingblock">
<div class="content">
<pre>identityProviders:
- challenge: true
  login: true
  name: htpasswd_auth
  provider:
    apiVersion: v1
    file: /etc/origin/openshift-passwd
    kind: HTPasswdPasswordIdentityProvider</pre>
</div>
</div>
<div class="paragraph">
<p>Add RH-SSO as a secondary identity provider with content similar to the following snippet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>- name: rh_sso
  challenge: false
  login: true
  mappingInfo: add
  provider:
    apiVersion: v1
    kind: OpenIDIdentityProvider
    clientID: <em>openshift-demo</em>
    clientSecret: <em>7b0384a2-b832-16c5-9d73-2957842e89h7</em>
    <em>ca: xpaas.crt</em>
    urls:
      authorize: <em>https://secure-sso-sso-app-demo.openshift32.example.com/auth/realms/OpenShift/protocol/openid-connect/auth</em>
      token: <em>https://secure-sso-sso-app-demo.openshift32.example.com/auth/realms/OpenShift/protocol/openid-connect/token</em>
      userInfo: <em>https://secure-sso-sso-app-demo.openshift32.example.com/auth/realms/OpenShift/protocol/openid-connect/userinfo</em>
    claims:
      id:
      - sub
      preferredUsername:
      - preferred_username
      name:
      - name
      email:
      - email</pre>
</div>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>The RH-SSO <strong>Secret</strong> hash for the <strong>clientSecret</strong> can be found in the RH-SSO web console: <strong>Clients</strong> &#8594; <strong><em>openshift-demo</em></strong> &#8594; <strong>Credentials</strong></p>
</li>
<li>
<p>The endpoints for the <strong>urls</strong> can be found by making a request with the RH-SSO application. For example:</p>
<div class="listingblock">
<div class="content">
<pre>&lt;<em>curl -k https://secure-sso-sso-app-demo.openshift32.example.com/auth/realms/OpenShift/.well-known/openid-configuration | python -m json.tool</em>&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The response includes the <strong>authorization_endpoint</strong>, <strong>token_endpoint</strong>, and <strong>userinfo_endpoint</strong>.</p>
</div>
</li>
<li>
<p>This example workflow uses a self-generated CA to provide an end-to-end workflow for demonstration purposes. For this reason, the <strong>ca</strong> is provided as &lt;<em>ca: xpaas.crt</em>&gt;. This CA certificate must also be copied into the <strong>/etc/origin/master</strong> folder. This is not necessary if using a certificate purchased from a verified Certificate Authority.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Save the configuration and restart the OpenShift master:</p>
<div class="listingblock">
<div class="content">
<pre>$ systemctl restart atomic-openshift-master</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="logging-in-to-openshift"><a class="anchor" href="#logging-in-to-openshift"></a>4.4.3. Logging in to OpenShift</h4>
<div class="paragraph">
<p>Navigate to the OpenShift web console, which in this example is <em><a href="https://openshift.example.com:8443/console" class="bare">https://openshift.example.com:8443/console</a></em>. The OpenShift login page now has the option to use either <strong>htpasswd_auth</strong> or <strong>rh-sso</strong>. The former is still available because it is present in the <strong>/etc/origin/master/master-config.yaml</strong>.</p>
</div>
<div class="paragraph">
<p>Select <strong>rh-sso</strong> and log in to OpenShift with the <em>testuser</em> user created earlier in RH-SSO. No projects are visible to <em>testuser</em> until they are added in the OpenShift CLI. This is the only way to provide user privileges in OpenShift because it currently does not accept external role mapping.</p>
</div>
<div class="paragraph">
<p>To provide <em>testuser</em> <code>view</code> privileges for the <em>sso-app-demo</em>, use the OpenShift CLI:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ oadm policy add-role-to-user view testuser -n sso-app-demo</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Example-EAP-Auto"><a class="anchor" href="#Example-EAP-Auto"></a>4.5. Example Workflow: Automatically Registering EAP Application in RH-SSO with OpenID-Connect Client</h3>
<div class="paragraph">
<p>This follows on from <a href="#Example-Deploying-SSO">Example Workflow: Preparing and Deploying the RH-SSO for OpenShift image</a>, in which RH-SSO was deployed on OpenShift. This example prepares RH-SSO realm, role, and user credentials for an EAP project using an OpenID-Connect client adapter. These credentials are then provided in the EAP for OpenShift template for automatic RH-SSO client registration. Once deployed, the RH-SSO user can be used to authenticate and access JBoss EAP.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This example uses a OpenID-Connect client but an SAML client could also be used. See <a href="#SSO-Clients">RH-SSO Clients</a> and <a href="#Auto-Man-Client-Reg">Automatic and Manual RH-SSO Client Registration Methods</a> for more information on the differences between OpenID-Connect and SAML clients.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="preparing-rh-sso-authentication-for-openshift-deployment"><a class="anchor" href="#preparing-rh-sso-authentication-for-openshift-deployment"></a>4.5.1. Preparing RH-SSO Authentication for OpenShift Deployment</h4>
<div class="paragraph">
<p>Log in to the OpenShift CLI with a user that holds the <em>cluster:admin</em> role.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new project:</p>
<div class="listingblock">
<div class="content">
<pre>$ oc new-project eap-app-demo</pre>
</div>
</div>
</li>
<li>
<p>Add the <code>view</code> role to the <a href="https://docs.openshift.com/container-platform/latest/dev_guide/service_accounts.html#default-service-accounts-and-roles"><code>default</code></a> service account. This enables the service account to view all the resources in the <code>eap-app-demo</code> namespace, which is necessary for managing the cluster.</p>
<div class="listingblock">
<div class="content">
<pre>$ oc policy add-role-to-user view system:serviceaccount:$(oc project -q):default</pre>
</div>
</div>
</li>
<li>
<p>The EAP template requires an <a href="#Configuring-Keystores">SSL keystore and a JGroups keystore</a>.<br>
This example uses <code>keytool</code>, a package included with the Java Development Kit, to generate self-signed certificates for these keystores. The following commands will prompt for passwords.<br></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Generate a secure key for the SSL keystore:</p>
<div class="listingblock">
<div class="content">
<pre>$ keytool -genkeypair -alias https -storetype JKS -keystore eapkeystore.jks</pre>
</div>
</div>
</li>
<li>
<p>Generate a secure key for the JGroups keystore:</p>
<div class="listingblock">
<div class="content">
<pre>$ keytool -genseckey -alias jgroups -storetype JCEKS -keystore eapjgroups.jceks</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Generate the EAP for OpenShift secrets with the SSL and JGroup keystore files:</p>
<div class="listingblock">
<div class="content">
<pre>$ oc secret new eap-ssl-secret eapkeystore.jks
$ oc secret new eap-jgroup-secret eapjgroups.jceks</pre>
</div>
</div>
</li>
<li>
<p>Add the EAP secret to the <code>default</code> service account:</p>
<div class="listingblock">
<div class="content">
<pre>$ oc secrets link default eap-ssl-secret eap-jgroup-secret</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="preparing-the-rh-sso-credentials"><a class="anchor" href="#preparing-the-rh-sso-credentials"></a>4.5.2. Preparing the RH-SSO Credentials</h4>
<div class="paragraph">
<p>Log in to the encrypted RH-SSO web server at <strong>https://secure-sso-<em>&lt;project-name&gt;</em>.<em>&lt;hostname&gt;</em>/auth/admin</strong> using the <a href="../advanced_concepts/advanced_concepts.html#sso-administrator-setup">administrator account</a> created during the RH-SSO deployment.</p>
</div>
<div class="paragraph">
<p><strong>Create a Realm</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Hover your cursor over the realm namespace at the top of the sidebar and click*Add Realm*.</p>
</li>
<li>
<p>Enter a realm name (this example uses <em>eap-demo</em>) and click <strong>Create</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Copy the Public Key</strong></p>
</div>
<div class="paragraph">
<p>In the newly created <em>eap-demo</em> realm, click the <strong>Keys</strong> tab and copy the generated public key. This example uses the variable <em>&lt;realm-public-key&gt;</em> for brevity. This is used later to deploy the RH-SSO-enabled JBoss EAP image.</p>
</div>
<div class="paragraph">
<p><strong>Create a Role</strong></p>
</div>
<div class="paragraph">
<p>Create a role in RH-SSO with a name that corresponds to the JEE role defined in the <strong>web.xml</strong> of the example EAP application. This role is assigned to an RH-SSO <em>application user</em> to authenticate access to user applications.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <strong>Roles</strong> in the <strong>Configure</strong> sidebar to list the roles for this realm. This is a new realm, so there should only be the default <em>offline_access</em> role.</p>
</li>
<li>
<p>Click <strong>Add Role</strong>.</p>
</li>
<li>
<p>Enter the role name (this example uses the role <em>eap-user-role</em>) and click <strong>Save</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Create Users and Assign Roles</strong></p>
</div>
<div class="paragraph">
<p>Create two users:
- Assign the <em>realm management user</em> the <strong>realm-management</strong> roles to handle automatic RH-SSO client registration in the RH-SSO server.
- Assign the <em>application user</em> the JEE role, created in the previous step, to authenticate access to user applications.</p>
</div>
<div class="paragraph">
<p>Create the <em>realm management user</em>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <strong>Users</strong> in the <strong>Manage</strong> sidebar to view the user information for the realm.</p>
</li>
<li>
<p>Click <strong>Add User</strong>.</p>
</li>
<li>
<p>Enter a valid <strong>Username</strong> (this example uses the user <em>eap-mgmt-user</em>) and click <strong>Save</strong>.</p>
</li>
<li>
<p>Edit the user configuration. Click the <strong>Credentials</strong> tab in the user space and enter a password for the user. After the password has been confirmed you can click <strong>Reset Password</strong> to set the user password. A pop-up window prompts for additional confirmation.</p>
</li>
<li>
<p>Click <strong>Role Mappings</strong> to list the realm and client role configuration. In the <strong>Client Roles</strong> drop-down menu, select <strong>realm-management</strong> and add all of the available roles to the user. This provides the user RH-SSO server rights that can be used by the JBoss EAP image to create clients.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Create the <em>application user</em>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <strong>Users</strong> in the <strong>Manage</strong> sidebar to view the user information for the realm.</p>
</li>
<li>
<p>Click <strong>Add User</strong>.</p>
</li>
<li>
<p>Enter a valid <strong>Username</strong> and any additional optional information for the <em>application user</em> and click <strong>Save</strong>.</p>
</li>
<li>
<p>Edit the user configuration. Click the <strong>Credentials</strong> tab in the user space and enter a password for the user. After the password has been confirmed you can click <strong>Reset Password</strong> to set the user password. A pop-up window prompts for additional confirmation.</p>
</li>
<li>
<p>Click <strong>Role Mappings</strong> to list the realm and client role configuration. In <strong>Available Roles</strong>, add the role created earlier.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="deploy-the-rh-sso-enabled-jboss-eap-image"><a class="anchor" href="#deploy-the-rh-sso-enabled-jboss-eap-image"></a>4.5.3. Deploy the RH-SSO-enabled JBoss EAP Image</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Return to the OpenShift web console and click <strong>Add to project</strong> to list the default image streams and templates.</p>
</li>
<li>
<p>Use the <strong>Filter by keyword</strong> search bar to limit the list to those that match <em>sso</em>. You may need to click <strong>See all</strong> to show the desired application template.</p>
</li>
<li>
<p>Select the <strong><em>eap71-sso-s2i</em></strong> image to list all of the deployment parameters. Include the following RH-SSO parameters to configure the RH-SSO credentials during the EAP build:</p>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Variable</th>
<th class="tableblock halign-left valign-top">Example Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>APPLICATION_NAME</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>sso</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HOSTNAME_HTTPS</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>secure-sample-jsp.eap-app-demo.openshift32.example.com</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HOSTNAME_HTTP</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>sample-jsp.eap-app-demo.openshift32.example.com</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SOURCE_REPOSITORY_URL</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>https://repository-example.com/developer/application</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_URL</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>https://secure-sso-sso-app-demo.openshift32.example.com/auth</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_REALM</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>eap-demo</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_USERNAME</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>eap-mgmt-user</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_PASSWORD</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>password</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_PUBLIC_KEY</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;realm-public-key&gt;</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HTTPS_KEYSTORE</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>eapkeystore.jks</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HTTPS_PASSWORD</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>password</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HTTPS_SECRET</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>eap-ssl-secret</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>JGROUPS_ENCRYPT_KEYSTORE</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>eapjgroups.jceks</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>JGROUPS_ENCRYPT_PASSWORD</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>password</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>JGROUPS_ENCRYPT_SECRET</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>eap-jgroup-secret</em></p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Click <strong>Create</strong> to deploy the JBoss EAP image.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>It may take several minutes for the JBoss EAP image to deploy.</p>
</div>
</div>
<div class="sect3">
<h4 id="log-in-to-the-jboss-eap-server-using-rh-sso"><a class="anchor" href="#log-in-to-the-jboss-eap-server-using-rh-sso"></a>4.5.4. Log in to the JBoss EAP Server Using RH-SSO</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Access the JBoss EAP application server and click <strong>Login</strong>. You are redirected to the RH-SSO login.</p>
</li>
<li>
<p>Log in using the RH-SSO user created in the example. You are authenticated against the RH-SSO server and returned to the JBoss EAP application server.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Example-EAP-Manual"><a class="anchor" href="#Example-EAP-Manual"></a>4.6. Example Workflow: Manually Registering EAP Application in RH-SSO with SAML Client</h3>
<div class="paragraph">
<p>This follows on from <a href="#Example-Deploying-SSO">Example Workflow: Preparing and Deploying the RH-SSO for OpenShift image</a>, in which RH-SSO was deployed on OpenShift.</p>
</div>
<div class="paragraph">
<p>This example prepares RH-SSO realm, role, and user credentials for an EAP project and configures an EAP for OpenShift deployment. Once deployed, the RH-SSO user can be used to authenticate and access JBoss EAP.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This example uses a SAML client but an OpenID-Connect client could also be used. See <a href="#SSO-Clients">RH-SSO Clients</a> and <a href="#Auto-Man-Client-Reg">Automatic and Manual RH-SSO Client Registration Methods</a> for more information on the differences between SAML and OpenID-Connect clients.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="preparing-the-rh-sso-credentials-2"><a class="anchor" href="#preparing-the-rh-sso-credentials-2"></a>4.6.1. Preparing the RH-SSO Credentials</h4>
<div class="paragraph">
<p>Log in to the encrypted RH-SSO web server at <strong>https://secure-sso-<em>&lt;project-name&gt;</em>.<em>&lt;hostname&gt;</em>/auth/admin</strong> using the <a href="../advanced_concepts/advanced_concepts.html#sso-administrator-setup">administrator account</a> created during the RH-SSO deployment.</p>
</div>
<div class="paragraph">
<p><strong>Create a Realm</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Hover your cursor over the realm namespace (default is <strong>Master</strong>) at the top of the sidebar and click <strong>Add Realm</strong>.</p>
</li>
<li>
<p>Enter a realm name (this example uses <em>saml-demo</em>) and click <strong>Create</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Copy the Public Key</strong></p>
</div>
<div class="paragraph">
<p>In the newly created <em>saml-demo</em> realm, click the <strong>Keys</strong> tab and copy the generated public key. This example uses the variable <em>realm-public-key</em> for brevity. This is needed later to deploy the RH-SSO-enabled JBoss EAP image.</p>
</div>
<div class="paragraph">
<p><strong>Create a Role</strong></p>
</div>
<div class="paragraph">
<p>Create a role in RH-SSO with a name that corresponds to the JEE role defined in the <strong>web.xml</strong> of the example EAP application. This role will be assigned to an RH-SSO <em>application user</em> to authenticate access to user applications.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <strong>Roles</strong> in the <strong>Configure</strong> sidebar to list the roles for this realm. This is a new realm, so there should only be the default <em>offline_access</em> role.</p>
</li>
<li>
<p>Click <strong>Add Role</strong>.</p>
</li>
<li>
<p>Enter the role name (this example uses the role <em>saml-user-role</em>) and click <strong>Save</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Create Users and Assign Roles</strong></p>
</div>
<div class="paragraph">
<p>Create two users:
- Assign the <em>realm management user</em> the <strong>realm-management</strong> roles to handle automatic RH-SSO client registration in the RH-SSO server.
- Assign the <em>application user</em> the JEE role, created in the previous step, to authenticate access to user applications.</p>
</div>
<div class="paragraph">
<p>Create the <em>realm management user</em>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <strong>Users</strong> in the <strong>Manage</strong> sidebar to view the user information for the realm.</p>
</li>
<li>
<p>Click <strong>Add User</strong>.</p>
</li>
<li>
<p>Enter a valid <strong>Username</strong> (this example uses the user <em>app-mgmt-user</em>) and click <strong>Save</strong>.</p>
</li>
<li>
<p>Edit the user configuration. Click the <strong>Credentials</strong> tab in the user space and enter a password for the user. After the password has been confirmed you can click <strong>Reset Password</strong> to set the user password. A pop-up window prompts for additional confirmation.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Create the <em>application user</em>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <strong>Users</strong> in the <strong>Manage</strong> sidebar to view the user information for the realm.</p>
</li>
<li>
<p>Click <strong>Add User</strong>.</p>
</li>
<li>
<p>Enter a valid <strong>Username</strong> and any additional optional information for the <em>application user</em> and click <strong>Save</strong>.</p>
</li>
<li>
<p>Edit the user configuration. Click the <strong>Credentials</strong> tab in the user space and enter a password for the user. After the password has been confirmed you can click <strong>Reset Password</strong> to set the user password. A pop-up window prompts for additional confirmation.</p>
</li>
<li>
<p>Click <strong>Role Mappings</strong> to list the realm and client role configuration. In <strong>Available Roles</strong>, add the role created earlier.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Create and Configure a SAML Client</strong>:</p>
</div>
<div class="paragraph">
<p>Clients are RH-SSO entities that request user authentication. This example configures a SAML client to handle authentication for the EAP application. This section saves two files, <strong>keystore.jks</strong> and <strong>keycloak-saml-subsystem.xml</strong> that are needed later in the procedure.</p>
</div>
<div class="paragraph">
<p>Create the SAML Client:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <strong>Clients</strong> in the <strong>Configure</strong> sidebar to list the clients in the realm. Click <strong>Create</strong>.</p>
</li>
<li>
<p>Enter a valid <strong>Client ID</strong>. This example uses <em>sso-saml-demo</em>.</p>
</li>
<li>
<p>In the <strong>Client Protocol</strong> drop-down menu, select <strong>saml</strong>.</p>
</li>
<li>
<p>Enter the <strong>Root URL</strong> for the application. This example uses <em>https://demoapp-eap-app-demo.openshift32.example.com</em>.</p>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Configure the SAML Client:</p>
</div>
<div class="paragraph">
<p>In the <strong>Settings</strong> tab, set the <strong>Root URL</strong> and the <strong>Valid Redirect URLs</strong> for the new <strong><em>sso-saml-demo</em></strong> client:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>For the <strong>Root URL</strong>, enter the same address used when creating the client. This example uses <em>https://demoapp-eap-app-demo.openshift32.example.com</em>.</p>
</li>
<li>
<p>For the <strong>Valid Redirect URLs</strong>, enter an address for users to be redirected to at when they log in or out. This example uses a redirect address relative to the root <em>https://demoapp-eap-app-demo.openshift32.example.com/*</em>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Export the SAML Keys:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click the <strong>SAML Keys</strong> tab in the <em>sso-saml-demo</em> client space and click <strong>Export</strong>.</p>
</li>
<li>
<p>For this example, leave the <strong>Archive Format</strong> as <strong>JKS</strong>. This example uses the default <strong>Key Alias</strong> of <em>sso-saml-demo</em> and default <strong>Realm Certificate Alias</strong> of <em>saml-demo</em>.</p>
</li>
<li>
<p>Enter the <strong>Key Password</strong> and the <strong>Store Password</strong>. This example uses <em>password</em> for both.</p>
</li>
<li>
<p>Click <strong>Download</strong> and save the <strong>keystore-saml.jks</strong> file for use later.</p>
</li>
<li>
<p>Click the <strong><em>sso-saml-demo</em></strong> client to return to the client space ready for the next step.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Download the Client Adapter:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <strong>Installation</strong>.</p>
</li>
<li>
<p>Use the <strong>Format Option</strong> drop-down menu to select a format. This example uses <strong>Keycloak SAML Wildfly/JBoss Subsystem</strong>.</p>
</li>
<li>
<p>Click <strong>Download</strong> and save the file <strong>keycloak-saml-subsystem.xml</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <strong>keystore-saml.jks</strong> will be used with the other EAP keystores in the next section to create an OpenShift secret for the EAP application project. Copy the <strong>keystore-saml.jks</strong> file to an OpenShift node.<br>
The <strong>keycloak-saml-subsystem.xml</strong> will be modified and used in the application deployment. Copy it into the <strong>/configuration</strong> folder of the application as <strong>secure-saml-deployments</strong>.</p>
</div>
</div>
<div class="sect3">
<h4 id="preparing-rh-sso-authentication-for-openshift-deployment-2"><a class="anchor" href="#preparing-rh-sso-authentication-for-openshift-deployment-2"></a>4.6.2. Preparing RH-SSO Authentication for OpenShift Deployment</h4>
<div class="paragraph">
<p>Log in to the OpenShift CLI with a user that holds the <em>cluster:admin</em> role.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new project:</p>
<div class="listingblock">
<div class="content">
<pre>$ oc new-project eap-app-demo</pre>
</div>
</div>
</li>
<li>
<p>Add the <code>view</code> role to the <a href="https://docs.openshift.com/container-platform/latest/dev_guide/service_accounts.html#default-service-accounts-and-roles"><code>default</code></a> service account. This enables the service account to view all the resources in the <code>eap-app-demo</code> namespace, which is necessary for managing the cluster.</p>
<div class="listingblock">
<div class="content">
<pre>$ oc policy add-role-to-user view system:serviceaccount:$(oc project -q):default</pre>
</div>
</div>
</li>
<li>
<p>The EAP template requires an <a href="#Configuring-Keystores">SSL keystore and a JGroups keystore</a>.<br>
This example uses <code>keytool</code>, a package included with the Java Development Kit, to generate self-signed certificates for these keystores. The following commands will prompt for passwords.<br></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Generate a secure key for the SSL keystore:</p>
<div class="listingblock">
<div class="content">
<pre>$ keytool -genkeypair -alias https -storetype JKS -keystore eapkeystore.jks</pre>
</div>
</div>
</li>
<li>
<p>Generate a secure key for the JGroups keystore:</p>
<div class="listingblock">
<div class="content">
<pre>$ keytool -genseckey -alias jgroups -storetype JCEKS -keystore eapjgroups.jceks</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Generate the EAP for OpenShift secrets with the SSL and JGroup keystore files:</p>
<div class="listingblock">
<div class="content">
<pre>$ oc secret new eap-ssl-secret eapkeystore.jks
$ oc secret new eap-jgroup-secret eapjgroups.jceks</pre>
</div>
</div>
</li>
<li>
<p>Add the EAP application secret to the EAP service account created earlier:</p>
<div class="listingblock">
<div class="content">
<pre>$ oc secrets link default eap-ssl-secret eap-jgroup-secret</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="modified-saml-xml"><a class="anchor" href="#modified-saml-xml"></a>4.6.3. Modifying the <strong>secure-saml-deployments</strong> File</h4>
<div class="paragraph">
<p>The <strong>keycloak-saml-subsystem.xml</strong>, exported from the RH-SSO client in a previous section, should have been copied into the <strong>/configuration</strong> folder of the application and renamed <strong>secure-saml-deployments</strong>. EAP searches for this file when it starts and copies it to the <strong>standalone-openshift.xml</strong> file inside the RH-SSO SAML adapter configuration.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the <strong>/configuration/secure-saml-deployments</strong> file in a text editor.</p>
</li>
<li>
<p>Replace the <strong>YOUR-WAR.war</strong> value of the <strong>secure-deployment name</strong> tag with the application <strong>.war</strong> file. This example uses <em>sso-saml-demo.war</em>.</p>
</li>
<li>
<p>Replace the <strong>SPECIFY YOUR LOGOUT PAGE!</strong> value of the <strong>logout page</strong> tag with the url to redirect users when they log out of the application. This example uses <strong>/index.jsp</strong>.</p>
</li>
<li>
<p>Delete the <strong>&lt;PrivateKeyPem&gt;</strong> and <strong>&lt;CertificatePem&gt;</strong> tags and keys and replace it with keystore information:</p>
<div class="listingblock">
<div class="content">
<pre>...
&lt;Keys&gt;
  &lt;Key signing="true"&gt;
    &lt;KeyStore file= "/etc/eap-secret-volume/keystore-saml.jks" password="password"&gt;
      &lt;PrivateKey alias="sso-saml-demo" password="password"/&gt;
      &lt;Certificate alias="sso-saml-demo"/&gt;
    &lt;/KeyStore&gt;
  &lt;/Key&gt;
&lt;/Keys&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The mount path of the <strong>keystore-saml.jks</strong> (in this example <strong><em>/etc/eap-secret-volume/keystore-saml.jks</em></strong>) can be specified in the application template with the parameter <strong>EAP_HTTPS_KEYSTORE_DIR</strong>.<br>
The aliases and passwords for the <strong>PrivateKey</strong> and the <strong>Certificate</strong> were configured when the SAML Keys were exported from the RH-SSO client.</p>
</div>
</li>
<li>
<p>Delete the second <strong>&lt;CertificatePem&gt;</strong> tag and key and replace it with the the realm certificate information:</p>
<div class="listingblock">
<div class="content">
<pre>...
&lt;Keys&gt;
  &lt;Key signing="true"&gt;
    &lt;KeyStore file="/etc/eap-secret-volume/keystore-saml.jks" password="password"&gt;
      &lt;Certificate alias="saml-demo"/&gt;
    &lt;/KeyStore&gt;
  &lt;/Key&gt;
&lt;/Keys&gt;
...</pre>
</div>
</div>
<div class="paragraph">
<p>The certificate alias and password were configured when the SAML Keys were exported from the RH-SSO client.</p>
</div>
</li>
<li>
<p>Save and close the <strong>/configuration/secure-saml-deployments</strong> file.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="configuring-saml-client-registration-in-the-application-strong-web-xml-strong"><a class="anchor" href="#configuring-saml-client-registration-in-the-application-strong-web-xml-strong"></a>4.6.4. Configuring SAML Client Registration in the Application <strong>web.xml</strong></h4>
<div class="paragraph">
<p>The client type must also be specified by the <strong>&lt;auth-method&gt;</strong> key in the application <strong>web.xml</strong>. This file is read by the image at deployment.</p>
</div>
<div class="paragraph">
<p>Open the application <strong>web.xml</strong> file and ensure it includes the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>...
&lt;login-config&gt;
  &lt;auth-method&gt;KEYCLOAK-SAML&lt;/auth-method&gt;
&lt;/login-config&gt;
...</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="deploying-the-application"><a class="anchor" href="#deploying-the-application"></a>4.6.5. Deploying the Application</h4>
<div class="paragraph">
<p>You do not need to include any RH-SSO configuration for the image because that has been configured in the application itself. Navigating to the application login page redirects you to the RH-SSO login. Log in to the application through RH-SSO using the <em>application user</em> user created earlier.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="reference"><a class="anchor" href="#reference"></a>5. Reference</h2>
<div class="sectionbody">
<div class="sidebarblock page-links">
<div class="content">
<a href="https://github.com/keycloak/keycloak-documentation/blob/master/openshift/topics/reference.adoc" target="_blank">Edit this section</a>
<a href="https://issues.jboss.org/secure/CreateIssueDetails!init.jspa?pid=12313920&amp;components=12323375&amp;issuetype=1&amp;priority=3&amp;description=File:%20openshift/topics/reference.adoc" target="_blank">Report an issue</a>
</div>
</div>
<div class="sect2">
<h3 id="sso-artifact-repository-mirrors-section"><a class="anchor" href="#sso-artifact-repository-mirrors-section"></a>5.1. Artifact Repository Mirrors</h3>
<div class="paragraph">
<p>A repository in Maven holds build artifacts and dependencies of various types
(all the project jars, library jar, plugins or any other project specific
artifacts). It also specifies locations from where to download artifacts from,
while performing the S2I build. Besides using central repositories, it is a
common practice for organizations to deploy a local custom repository (mirror).</p>
</div>
<div class="paragraph">
<p>Benefits of using a mirror are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Availability of a synchronized mirror, which is geographically closer and
faster.</p>
</li>
<li>
<p>Ability to have greater control over the repository content.</p>
</li>
<li>
<p>Possibility to share artifacts across different teams (developers, CI),
without the need to rely on public servers and repositories.</p>
</li>
<li>
<p>Improved build times.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Often, a repository manager can serve as local cache to a mirror. Assuming that
the repository manager is already deployed and reachable externally at
<strong><em>http://10.0.0.1:8080/repository/internal/</em></strong>, the S2I build can then use this
manager by supplying the <code>MAVEN_MIRROR_URL</code> environment variable to the
build configuration of the application as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Identify the name of the build configuration to apply <code>MAVEN_MIRROR_URL</code>
variable against:</p>
<div class="listingblock">
<div class="content">
<pre>oc get bc -o name
buildconfig/sso</pre>
</div>
</div>
</li>
<li>
<p>Update build configuration of <code>sso</code> with a <code>MAVEN_MIRROR_URL</code> environment variable</p>
<div class="listingblock">
<div class="content">
<pre>oc env bc/sso MAVEN_MIRROR_URL="http://10.0.0.1:8080/repository/internal/"
buildconfig "sso" updated</pre>
</div>
</div>
</li>
<li>
<p>Verify the setting</p>
<div class="listingblock">
<div class="content">
<pre>oc env bc/sso --list
# buildconfigs sso
MAVEN_MIRROR_URL=http://10.0.0.1:8080/repository/internal/</pre>
</div>
</div>
</li>
<li>
<p>Schedule new build of the application</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
During application build, you will notice that Maven dependencies are
pulled from the repository manager, instead of the default public repositories.
Also, after the build is finished, you will see that the mirror is filled with
all the dependencies that were retrieved and used during the build.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A repository in Maven holds build artifacts and dependencies of various types
(all the project jars, library jar, plugins or any other project specific
artifacts). It also specifies locations from where to download artifacts from,
while performing the S2I build. Besides using central repositories, it is a
common practice for organizations to deploy a local custom repository (mirror).</p>
</div>
<div class="paragraph">
<p>Benefits of using a mirror are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Availability of a synchronized mirror, which is geographically closer and
faster.</p>
</li>
<li>
<p>Ability to have greater control over the repository content.</p>
</li>
<li>
<p>Possibility to share artifacts across different teams (developers, CI),
without the need to rely on public servers and repositories.</p>
</li>
<li>
<p>Improved build times.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Often, a repository manager can serve as local cache to a mirror. Assuming that
the repository manager is already deployed and reachable externally at
<strong><em>http://10.0.0.1:8080/repository/internal/</em></strong>, the S2I build can then use this
manager by supplying the <code>MAVEN_MIRROR_URL</code> environment variable to the
build configuration of the application as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Identify the name of the build configuration to apply <code>MAVEN_MIRROR_URL</code>
variable against:</p>
<div class="listingblock">
<div class="content">
<pre>oc get bc -o name
buildconfig/sso</pre>
</div>
</div>
</li>
<li>
<p>Update build configuration of <code>sso</code> with a <code>MAVEN_MIRROR_URL</code> environment variable</p>
<div class="listingblock">
<div class="content">
<pre>oc env bc/sso MAVEN_MIRROR_URL="http://10.0.0.1:8080/repository/internal/"
buildconfig "sso" updated</pre>
</div>
</div>
</li>
<li>
<p>Verify the setting</p>
<div class="listingblock">
<div class="content">
<pre>oc env bc/sso --list
# buildconfigs sso
MAVEN_MIRROR_URL=http://10.0.0.1:8080/repository/internal/</pre>
</div>
</div>
</li>
<li>
<p>Schedule new build of the application</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
During application build, you will notice that Maven dependencies are
pulled from the repository manager, instead of the default public repositories.
Also, after the build is finished, you will see that the mirror is filled with
all the dependencies that were retrieved and used during the build.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="env_vars"><a class="anchor" href="#env_vars"></a>5.2. Environment Variables</h3>
<div class="sect3">
<h4 id="information-environment-variables"><a class="anchor" href="#information-environment-variables"></a>5.2.1. Information Environment Variables</h4>
<div class="paragraph">
<p>The following information environment variables are designed to convey
information about the image and should not be modified by the user:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. Information Environment Variables</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Variable Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>AB_JOLOKIA_AUTH_OPENSHIFT</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>true</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>AB_JOLOKIA_HTTPS</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>true</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>AB_JOLOKIA_PASSWORD_RANDOM</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>true</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>JBOSS_IMAGE_NAME</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Image name, same as Name label.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>redhat-sso-7/sso72-openshift</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>JBOSS_IMAGE_RELEASE</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Image release, same as Release label.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>dev</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>JBOSS_IMAGE_VERSION</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Image version, same as Version label.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>1.1</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>JBOSS_MODULES_SYSTEM_PKGS</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>org.jboss.logmanager,jdk.nashorn.api</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>STI_BUILDER</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides OpenShift S2I support for jee project types.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>jee</em></strong></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="configuration-environment-variables"><a class="anchor" href="#configuration-environment-variables"></a>5.2.2. Configuration Environment Variables</h4>
<div class="paragraph">
<p>Configuration environment variables are designed to conveniently adjust the
image without requiring a rebuild, and should be set by the user as desired.</p>
</div>
<table id="conf_env_vars" class="tableblock frame-all grid-all spread">
<caption class="title">Table 3. Configuration Environment Variables</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Variable Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>AB_JOLOKIA_AUTH_OPENSHIFT</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Switch on client authentication for OpenShift TLS communication. The value of
this parameter can be a relative distinguished name which must be contained in
a presented client’s certificate. Enabling this parameter will automatically
switch Jolokia into https communication mode. The default CA cert is set to
<code>/var/run/secrets/kubernetes.io/serviceaccount/ca.crt</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>true</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>AB_JOLOKIA_CONFIG</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set uses this file (including path) as Jolokia JVM agent properties (as
described in Jolokia’s
<a href="https://jolokia.org/reference/html/agents.html#agents-jvm">reference
manual</a>). If not set, the <code>/opt/jolokia/etc/jolokia.properties</code> file will be
created using the settings as defined in this document, otherwise the rest of
the settings in this document are ignored.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>/opt/jolokia/custom.properties</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>AB_JOLOKIA_DISCOVERY_ENABLED</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable Jolokia discovery. Defaults to <strong><em>false</em></strong>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>true</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>AB_JOLOKIA_HOST</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Host address to bind to. Defaults to <strong><em>0.0.0.0</em></strong>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>127.0.0.1</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>AB_JOLOKIA_HTTPS</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Switch on secure communication with https. By default self-signed server
certificates are generated if no serverCert configuration is given in
<strong><em>AB_JOLOKIA_OPTS</em></strong>. <em>NOTE: If the values is set to an empty string, https is
turned <code>off</code>. If the value is set to a non empty string, https is turned <code>on</code>.</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>true</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>AB_JOLOKIA_ID</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Agent ID to use ($HOSTNAME by default, which is the container id).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>openjdk-app-1-xqlsj</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>AB_JOLOKIA_OFF</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set disables activation of Jolokia (i.e. echos an empty value). By default,
Jolokia is enabled. <em>NOTE: If the values is set to an empty string, https is
turned <code>off</code>. If the value is set to a non empty string, https is turned <code>on</code>.</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>true</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>AB_JOLOKIA_OPTS</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Additional options to be appended to the agent configuration. They should be
given in the format <code>"key=value, key=value, …&lt;200b&gt; "</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>backlog=20</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>AB_JOLOKIA_PASSWORD</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password for basic authentication. By default authentication is switched off.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>mypassword</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>AB_JOLOKIA_PASSWORD_RANDOM</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set, a random value is generated for <strong><em>AB_JOLOKIA_PASSWORD</em></strong>, and it is
saved in the <strong><em>/opt/jolokia/etc/jolokia.pw</em></strong> file.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>true</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>AB_JOLOKIA_PORT</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port to use (Default: <strong><em>8778</em></strong>).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>5432</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>AB_JOLOKIA_USER</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User for basic authentication. Defaults to <strong><em>jolokia</em></strong>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>myusername</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>CONTAINER_CORE_LIMIT</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A calculated core limit as described in
<a href="https://www.kernel.org/doc/Documentation/scheduler/sched-bwc.txt">CFS
Bandwidth Control.</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>2</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>GC_ADAPTIVE_SIZE_POLICY_WEIGHT</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The weighting given to the current Garbage Collection (GC) time versus previous
GC times.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>90</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>GC_MAX_HEAP_FREE_RATIO</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum percentage of heap free after GC to avoid shrinking.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>40</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>GC_MAX_METASPACE_SIZE</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum metaspace size.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>100</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>GGC_TIME_RATIOC_MIN_HEAP_FREE_RATIO</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum percentage of heap free after GC to avoid expansion.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>20</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>GC_TIME_RATIO</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the ratio of the time spent outside the garbage collection (for
example, the time spent for application execution) to the time spent in the
garbage collection.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>4</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>JAVA_DIAGNOSTICS</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set this to get some diagnostics information to standard out when things are
happening.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>true</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>JAVA_INITIAL_MEM_RATIO</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is used to calculate a default initial heap memory based the maximal
heap memory. The default is 100 which means 100% of the maximal heap is used
for the initial heap size. You can skip this mechanism by setting this value
to 0 in which case no <code>-Xms</code> option is added.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>100</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>JAVA_MAX_MEM_RATIO</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">It is used to calculate a default maximal heap memory based on a containers
restriction. If used in a Docker container without any memory constraints for
the container then this option has no effect. If there is a memory constraint
then <code>-Xmx</code> is set to a ratio of the container available memory as set here.
The default is 50 which means 50% of the available memory is used as an upper
boundary. You can skip this mechanism by setting this value to 0 in which case
no <code>-Xmx</code> option is added.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>40</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>JAVA_OPTS_APPEND</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server startup options.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>-Dkeycloak.migration.action=export -Dkeycloak.migration.provider=dir -Dkeycloak.migration.dir=/tmp</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>MQ_SIMPLE_DEFAULT_PHYSICAL_DESTINATION</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For backwards compatability, set to true to use <code>MyQueue</code> and <code>MyTopic</code> as
physical destination name defaults instead of <code>queue/MyQueue</code> and <code>topic/MyTopic</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>false</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>OPENSHIFT_KUBE_PING_LABELS</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clustering labels selector.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>app=sso-app</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>OPENSHIFT_KUBE_PING_NAMESPACE</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clustering project namespace.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>myproject</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SCRIPT_DEBUG</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to <code>true</code>, ensurses that the bash scripts are executed with the <code>-x</code>
option, printing the commands and their arguments as they are executed.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>true</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_ADMIN_PASSWORD</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password of the administrator account for the <code>master</code> realm of the RH-SSO
server. <strong>Required.</strong> If no value is specified, it is auto generated and
displayed as an OpenShift Instructional message when the template is
instantiated.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>adm-password</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_ADMIN_USERNAME</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Username of the administrator account for the <code>master</code> realm of the RH-SSO
server. <strong>Required.</strong> If no value is specified, it is auto generated and
displayed as an OpenShift Instructional message when the template is
instantiated.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>admin</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_REALM</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the realm to be created in the RH-SSO server if this environment variable
is provided.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>demo</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_SERVICE_PASSWORD</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password for the RH-SSO service user.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>mgmt-password</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_SERVICE_USERNAME</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The username used to access the RH-SSO service. This is used by clients to create
the application client(s) within the specified RH-SSO realm. This user is created
if this environment variable is provided.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>sso-mgmtuser</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_TRUSTSTORE</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the truststore file within the secret.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>truststore.jks</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_TRUSTSTORE_DIR</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Truststore directory.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>/etc/sso-secret-volume</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_TRUSTSTORE_PASSWORD</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password for the truststore and certificate.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>mykeystorepass</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_TRUSTSTORE_SECRET</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the secret containing the truststore file. Used for
<em>sso-truststore-volume</em> volume.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>truststore-secret</em></strong></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Available <a href="https://docs.openshift.com/container-platform/latest/dev_guide/templates.html#overview">application templates</a>
for RH-SSO for OpenShift can combine the <a href="#conf_env_vars">aforementioned
configuration variables</a> with common OpenShift variables (for example
<strong><em>APPLICATION_NAME</em></strong> or <strong><em>SOURCE_REPOSITORY_URL</em></strong>), product specific variables
(e.g. <strong><em>HORNETQ_CLUSTER_PASSWORD</em></strong>), or configuration variables typical to
database images (e.g. <strong><em>MYSQL_FT_MAX_WORD_LEN</em></strong>) yet. All of these different
types of configuration variables can be adjusted as desired to achieve the
deployed RH-SSO-enabled application will align with the intended use case as much
as possible. The list of configuration variables, available for each category
of application templates for RH-SSO-enabled applications, is described below.</p>
</div>
</div>
<div class="sect3">
<h4 id="template-variables-for-all-rh-sso-images"><a class="anchor" href="#template-variables-for-all-rh-sso-images"></a>5.2.3. Template variables for all RH-SSO images</h4>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 4. Configuration Variables Available For All RH-SSO Images</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Variable</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>APPLICATION_NAME</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name for the application.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>DB_MAX_POOL_SIZE</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets xa-pool/max-pool-size for the configured datasource.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>DB_TX_ISOLATION</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets transaction-isolation for the configured datasource.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>DB_USERNAME</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Database user name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HOSTNAME_HTTP</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom hostname for http service route. Leave blank for default hostname,
e.g.: <em>&lt;application-name&gt;.&lt;project&gt;.&lt;default-domain-suffix&gt;</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HOSTNAME_HTTPS</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom hostname for https service route. Leave blank for default hostname,
e.g.: <em>&lt;application-name&gt;.&lt;project&gt;.&lt;default-domain-suffix&gt;</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HTTPS_KEYSTORE</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the keystore file within the secret. If defined along with
<strong><em>HTTPS_PASSWORD</em></strong> and <strong><em>HTTPS_NAME</em></strong>, enable HTTPS and set the SSL certificate
key file to a relative path under <em>$JBOSS_HOME/standalone/configuration</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HTTPS_KEYSTORE_TYPE</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of the keystore file (JKS or JCEKS).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HTTPS_NAME</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name associated with the server certificate (e.g. <em>jboss</em>). If defined
along with <strong><em>HTTPS_PASSWORD</em></strong> and <strong><em>HTTPS_KEYSTORE</em></strong>, enable HTTPS and set the
SSL name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HTTPS_PASSWORD</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password for the keystore and certificate (e.g. <em>mykeystorepass</em>). If
defined along with <strong><em>HTTPS_NAME</em></strong> and <strong><em>HTTPS_KEYSTORE</em></strong>, enable HTTPS and set
the SSL key password.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HTTPS_SECRET</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the secret containing the keystore file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>IMAGE_STREAM_NAMESPACE</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Namespace in which the ImageStreams for Red Hat Middleware images are
installed. These ImageStreams are normally installed in the <em>openshift</em>
namespace. You should only need to modify this if you&#8217;ve installed the
ImageStreams in a different namespace/project.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>JGROUPS_CLUSTER_PASSWORD</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JGroups cluster password.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>JGROUPS_ENCRYPT_KEYSTORE</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the keystore file within the secret.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>JGROUPS_ENCRYPT_NAME</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name associated with the server certificate (e.g. <em>secret-key</em>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>JGROUPS_ENCRYPT_PASSWORD</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password for the keystore and certificate (e.g. <em>password</em>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>JGROUPS_ENCRYPT_SECRET</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the secret containing the keystore file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_ADMIN_USERNAME</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Username of the administrator account for the <code>master</code> realm of the RH-SSO
server. <strong>Required.</strong> If no value is specified, it is auto generated and
displayed as an OpenShift instructional message when the template is
instantiated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_ADMIN_PASSWORD</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password of the administrator account for the <code>master</code> realm of the RH-SSO
server. <strong>Required.</strong> If no value is specified, it is auto generated and
displayed as an OpenShift instructional message when the template is
instantiated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_REALM</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the realm to be created in the RH-SSO server if this environment variable
is provided.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_SERVICE_USERNAME</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The username used to access the RH-SSO service. This is used by clients to create
the application client(s) within the specified RH-SSO realm. This user is created
if this environment variable is provided.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_SERVICE_PASSWORD</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password for the RH-SSO service user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_TRUSTSTORE</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the truststore file within the secret.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_TRUSTSTORE_SECRET</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the secret containing the truststore file. Used for
<strong><em>sso-truststore-volume</em></strong> volume.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_TRUSTSTORE_PASSWORD</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password for the truststore and certificate.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="template-variables-specific-to-strong-em-sso72-mysql-em-strong-strong-em-sso72-mysql-persistent-em-strong-and-strong-em-sso72-x509-mysql-persistent-em-strong"><a class="anchor" href="#template-variables-specific-to-strong-em-sso72-mysql-em-strong-strong-em-sso72-mysql-persistent-em-strong-and-strong-em-sso72-x509-mysql-persistent-em-strong"></a>5.2.4. Template variables specific to <strong><em>sso72-mysql</em></strong>, <strong><em>sso72-mysql-persistent</em></strong>, and <strong><em>sso72-x509-mysql-persistent</em></strong></h4>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 5. Configuration Variables Specific To RH-SSO-enabled MySQL Applications With Ephemeral Or Persistent Storage</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Variable</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>DB_USERNAME</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Database user name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>DB_PASSWORD</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Database user password.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>DB_JNDI</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Database JNDI name used by application to resolve the datasource,
e.g. <em>java:/jboss/datasources/mysql</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>MYSQL_AIO</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Controls the <em>innodb_use_native_aio</em> setting value if the native AIO is
broken.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>MYSQL_FT_MAX_WORD_LEN</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum length of the word to be included in a FULLTEXT index.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>MYSQL_FT_MIN_WORD_LEN</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The minimum length of the word to be included in a FULLTEXT index.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>MYSQL_LOWER_CASE_TABLE_NAMES</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets how the table names are stored and compared.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>MYSQL_MAX_CONNECTIONS</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum permitted number of simultaneous client connections.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="template-variables-specific-to-strong-em-sso72-postgresql-em-strong-strong-em-sso72-postgresql-persistent-em-strong-and-strong-em-sso72-x509-postgresql-persistent-em-strong"><a class="anchor" href="#template-variables-specific-to-strong-em-sso72-postgresql-em-strong-strong-em-sso72-postgresql-persistent-em-strong-and-strong-em-sso72-x509-postgresql-persistent-em-strong"></a>5.2.5. Template variables specific to <strong><em>sso72-postgresql</em></strong>, <strong><em>sso72-postgresql-persistent</em></strong>, and <strong><em>sso72-x509-postgresql-persistent</em></strong></h4>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 6. Configuration Variables Specific To RH-SSO-enabled PostgreSQL Applications With Ephemeral Or Persistent Storage</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Variable</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>DB_USERNAME</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Database user name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>DB_PASSWORD</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Database user password.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>DB_JNDI</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Database JNDI name used by application to resolve the datasource,
e.g. <em>java:/jboss/datasources/postgresql</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>POSTGRESQL_MAX_CONNECTIONS</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum number of client connections allowed. This also sets the maximum
number of prepared transactions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>POSTGRESQL_SHARED_BUFFERS</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures how much memory is dedicated to PostgreSQL for caching data.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="template-variables-specific-to-strong-em-sso72-mysql-persistent-em-strong-strong-em-sso72-x509-mysql-persistent-em-strong-strong-em-sso72-postgresql-persistent-em-strong-and-strong-em-sso72-x509-postgresql-persistent-em-strong"><a class="anchor" href="#template-variables-specific-to-strong-em-sso72-mysql-persistent-em-strong-strong-em-sso72-x509-mysql-persistent-em-strong-strong-em-sso72-postgresql-persistent-em-strong-and-strong-em-sso72-x509-postgresql-persistent-em-strong"></a>5.2.6. Template variables specific to <strong><em>sso72-mysql-persistent</em></strong>, <strong><em>sso72-x509-mysql-persistent</em></strong>, <strong><em>sso72-postgresql-persistent</em></strong>, and <strong><em>sso72-x509-postgresql-persistent</em></strong></h4>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 7. Configuration Variables Specific To RH-SSO-enabled MySQL / PostgreSQL Applications With Persistent Storage</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Variable</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>VOLUME_CAPACITY</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Size of persistent storage for database volume.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="template-variables-for-general-strong-eap64-strong-strong-eap70-strong-and-strong-eap71-strong-s2i-images"><a class="anchor" href="#template-variables-for-general-strong-eap64-strong-strong-eap70-strong-and-strong-eap71-strong-s2i-images"></a>5.2.7. Template variables for general <strong>eap64</strong>, <strong>eap70</strong>, and <strong>eap71</strong> S2I images</h4>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 8. Configuration Variables For EAP 6.4 and EAP 7 Applications Built Via S2I</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Variable</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>APPLICATION_NAME</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name for the application.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>ARTIFACT_DIR</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Artifacts directory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>AUTO_DEPLOY_EXPLODED</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Controls whether exploded deployment content should be automatically deployed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>CONTEXT_DIR</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path within Git project to build; empty for root project directory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>GENERIC_WEBHOOK_SECRET</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generic build trigger secret.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>GITHUB_WEBHOOK_SECRET</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GitHub trigger secret.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HORNETQ_CLUSTER_PASSWORD</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HornetQ cluster administrator password.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HORNETQ_QUEUES</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Queue names.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HORNETQ_TOPICS</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Topic names.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HOSTNAME_HTTP</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom host name for http service route. Leave blank for default host name,
e.g.: <em>&lt;application-name&gt;.&lt;project&gt;.&lt;default-domain-suffix&gt;</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HOSTNAME_HTTPS</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom host name for https service route. Leave blank for default host name,
e.g.: <em>&lt;application-name&gt;.&lt;project&gt;.&lt;default-domain-suffix&gt;</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HTTPS_KEYSTORE_TYPE</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of the keystore file (JKS or JCEKS).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HTTPS_KEYSTORE</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the keystore file within the secret. If defined along with
<strong><em>HTTPS_PASSWORD</em></strong> and <strong><em>HTTPS_NAME</em></strong>, enable HTTPS and set the SSL certificate
key file to a relative path under <em>$JBOSS_HOME/standalone/configuration</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HTTPS_NAME</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name associated with the server certificate (e.g. <em>jboss</em>). If defined
along with <strong><em>HTTPS_PASSWORD</em></strong> and <strong><em>HTTPS_KEYSTORE</em></strong>, enable HTTPS and set the
SSL name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HTTPS_PASSWORD</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password for the keystore and certificate (e.g. <em>mykeystorepass</em>). If
defined along with <strong><em>HTTPS_NAME</em></strong> and <strong><em>HTTPS_KEYSTORE</em></strong>, enable HTTPS and set
the SSL key password.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HTTPS_SECRET</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the secret containing the keystore file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>IMAGE_STREAM_NAMESPACE</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Namespace in which the ImageStreams for Red Hat Middleware images are
installed. These ImageStreams are normally installed in the <em>openshift</em>
namespace. You should only need to modify this if you&#8217;ve installed the
ImageStreams in a different namespace/project.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>JGROUPS_CLUSTER_PASSWORD</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JGroups cluster password.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>JGROUPS_ENCRYPT_KEYSTORE</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the keystore file within the secret.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>JGROUPS_ENCRYPT_NAME</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name associated with the server certificate (e.g. <em>secret-key</em>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>JGROUPS_ENCRYPT_PASSWORD</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password for the keystore and certificate (e.g. <em>password</em>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>JGROUPS_ENCRYPT_SECRET</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the secret containing the keystore file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SOURCE_REPOSITORY_REF</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Git branch/tag reference.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SOURCE_REPOSITORY_URL</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Git source URI for application.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="template-variables-specific-to-strong-em-eap64-sso-s2i-em-strong-strong-em-eap70-sso-s2i-em-strong-and-strong-em-eap71-sso-s2i-em-strong-for-automatic-client-registration"><a class="anchor" href="#template-variables-specific-to-strong-em-eap64-sso-s2i-em-strong-strong-em-eap70-sso-s2i-em-strong-and-strong-em-eap71-sso-s2i-em-strong-for-automatic-client-registration"></a>5.2.8. Template variables specific to <strong><em>eap64-sso-s2i</em></strong>, <strong><em>eap70-sso-s2i</em></strong>, and <strong><em>eap71-sso-s2i</em></strong> for automatic client registration</h4>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 9. Configuration Variables For EAP 6.4 and EAP 7 RH-SSO-enabled Applications Built Via S2I</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Variable</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_URL</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RH-SSO server location.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_REALM</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the realm to be created in the RH-SSO server if this environment variable
is provided.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_USERNAME</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The username used to access the RH-SSO service. This is used to create the
application client(s) within the specified RH-SSO realm. This should match the
<strong><em>SSO_SERVICE_USERNAME</em></strong> specified through one of the <strong>sso72-</strong> templates.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_PASSWORD</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password for the RH-SSO service user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_PUBLIC_KEY</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RH-SSO public key. Public key is recommended to be passed into the template to
avoid man-in-the-middle security attacks.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_SECRET</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The RH-SSO client secret for confidential access.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_SERVICE_URL</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RH-SSO service location.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_TRUSTSTORE_SECRET</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the secret containing the truststore file. Used for
<strong><em>sso-truststore-volume</em></strong> volume.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_TRUSTSTORE</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the truststore file within the secret.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_TRUSTSTORE_PASSWORD</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password for the truststore and certificate.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_BEARER_ONLY</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RH-SSO client access type.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_DISABLE_SSL_CERTIFICATE_VALIDATION</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true SSL communication between EAP and the RH-SSO Server is insecure
(i.e. certificate validation is disabled with curl)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_ENABLE_CORS</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable CORS for RH-SSO applications.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="template-variables-specific-to-strong-em-eap64-sso-s2i-em-strong-strong-em-eap70-sso-s2i-em-strong-and-strong-em-eap71-sso-s2i-em-strong-for-automatic-client-registration-with-saml-clients"><a class="anchor" href="#template-variables-specific-to-strong-em-eap64-sso-s2i-em-strong-strong-em-eap70-sso-s2i-em-strong-and-strong-em-eap71-sso-s2i-em-strong-for-automatic-client-registration-with-saml-clients"></a>5.2.9. Template variables specific to <strong><em>eap64-sso-s2i</em></strong>, <strong><em>eap70-sso-s2i</em></strong>, and <strong><em>eap71-sso-s2i</em></strong> for automatic client registration with SAML clients</h4>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 10. Configuration Variables For EAP 6.4 and EAP 7 RH-SSO-enabled Applications Built Via S2I Using SAML Protocol</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Variable</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_SAML_CERTIFICATE_NAME</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name associated with the server certificate.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_SAML_KEYSTORE_PASSWORD</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password for the keystore and certificate.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_SAML_KEYSTORE</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the keystore file within the secret.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_SAML_KEYSTORE_SECRET</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the secret containing the keystore file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_SAML_LOGOUT_PAGE</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RH-SSO logout page for SAML applications.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="exposed-ports"><a class="anchor" href="#exposed-ports"></a>5.3. Exposed Ports</h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Port Number</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>8443</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>8778</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jolokia monitoring</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2018-06-07 14:03:26 CEST
</div>
</div>
<ul id="globalnav">
    <li><a href="../getting_started/index.html">Getting Started</a></li>
    <li><a href="../server_installation/index.html">Server Installation</a></li>
    <li><a href="../securing_apps/index.html">Securing Apps</a></li>
    <li><a href="../server_admin/index.html">Server Admin</a></li>
    <li><a href="../server_development/index.html">Server Development</a></li>
    <li><a href="../authorization_services/index.html">Authorization Services</a></li>
    <li><a href="../upgrading/index.html">Upgrading</a></li>
</ul>
</body>
</html>