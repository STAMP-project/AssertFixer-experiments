[INFO] Scanning for projects...
[INFO]                                                                         
[INFO] ------------------------------------------------------------------------
[INFO] Building RabbitMQ Performance Testing Tool 2.3.0-SNAPSHOT
[INFO] ------------------------------------------------------------------------
[INFO] 
[INFO] --- buildnumber-maven-plugin:1.4:create (default) @ perf-test ---
[INFO] Executing: /bin/sh -c cd '/root/workspace/rabbitmq/rabbitmq-perf-test/426645400' && 'git' 'rev-parse' '--verify' 'HEAD'
[INFO] Working directory: /root/workspace/rabbitmq/rabbitmq-perf-test/426645400
[INFO] Storing buildNumber: 946e6f0ffa2225d41f410705aefdb728d1644377 at timestamp: 1536581691766
[WARNING] Cannot get the branch information from the git repository: 
Detecting the current branch failed: fatal: ref HEAD is not a symbolic ref

[INFO] Executing: /bin/sh -c cd '/root/workspace/rabbitmq/rabbitmq-perf-test/426645400' && 'git' 'rev-parse' '--verify' 'HEAD'
[INFO] Working directory: /root/workspace/rabbitmq/rabbitmq-perf-test/426645400
[INFO] Storing buildScmBranch: UNKNOWN
[INFO] 
[INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ perf-test ---
[INFO] Using 'UTF-8' encoding to copy filtered resources.
[INFO] Copying 5 resources
[INFO] Copying 5 resources to static
[INFO] 
[INFO] --- maven-compiler-plugin:3.7.0:compile (default-compile) @ perf-test ---
[INFO] Nothing to compile - all classes are up to date
[INFO] 
[INFO] --- maven-resources-plugin:2.6:testResources (default-testResources) @ perf-test ---
[INFO] Using 'UTF-8' encoding to copy filtered resources.
[INFO] Copying 1 resource
[INFO] 
[INFO] --- maven-compiler-plugin:3.7.0:testCompile (default-testCompile) @ perf-test ---
[INFO] Nothing to compile - all classes are up to date
[INFO] 
[INFO] --- maven-surefire-plugin:2.22.0:test (default-test) @ perf-test ---
[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/surefire-junit-platform/2.22.0/surefire-junit-platform-2.22.0.pom
[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/surefire-junit-platform/2.22.0/surefire-junit-platform-2.22.0.pom (7 KB at 22.3 KB/sec)
[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/surefire-providers/2.22.0/surefire-providers-2.22.0.pom
[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/surefire-providers/2.22.0/surefire-providers-2.22.0.pom (3 KB at 71.5 KB/sec)
[INFO] Downloading: https://repo.maven.apache.org/maven2/org/junit/platform/junit-platform-launcher/1.2.0/junit-platform-launcher-1.2.0.pom
[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/junit/platform/junit-platform-launcher/1.2.0/junit-platform-launcher-1.2.0.pom (3 KB at 65.6 KB/sec)
[INFO] Downloading: https://repo.maven.apache.org/maven2/org/junit/platform/junit-platform-engine/1.2.0/junit-platform-engine-1.2.0.pom
[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/junit/platform/junit-platform-engine/1.2.0/junit-platform-engine-1.2.0.pom (3 KB at 68.7 KB/sec)
[INFO] Downloading: https://repo.maven.apache.org/maven2/org/junit/platform/junit-platform-commons/1.2.0/junit-platform-commons-1.2.0.pom
[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/junit/platform/junit-platform-commons/1.2.0/junit-platform-commons-1.2.0.pom (2 KB at 59.8 KB/sec)
[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/surefire-junit-platform/2.22.0/surefire-junit-platform-2.22.0.jar
[INFO] Downloading: https://repo.maven.apache.org/maven2/org/junit/platform/junit-platform-launcher/1.2.0/junit-platform-launcher-1.2.0.jar
[INFO] Downloading: https://repo.maven.apache.org/maven2/org/junit/platform/junit-platform-commons/1.2.0/junit-platform-commons-1.2.0.jar
[INFO] Downloading: https://repo.maven.apache.org/maven2/org/junit/platform/junit-platform-engine/1.2.0/junit-platform-engine-1.2.0.jar
[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/surefire-junit-platform/2.22.0/surefire-junit-platform-2.22.0.jar (65 KB at 663.5 KB/sec)
[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/junit/platform/junit-platform-commons/1.2.0/junit-platform-commons-1.2.0.jar (77 KB at 749.6 KB/sec)
[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/junit/platform/junit-platform-launcher/1.2.0/junit-platform-launcher-1.2.0.jar (79 KB at 767.5 KB/sec)
[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/junit/platform/junit-platform-engine/1.2.0/junit-platform-engine-1.2.0.jar (88 KB at 844.6 KB/sec)
[INFO] 
[INFO] -------------------------------------------------------
[INFO]  T E S T S
[INFO] -------------------------------------------------------
[INFO] Running com.rabbitmq.perf.ProducerTest
[INFO] Tests run: 11, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.957 s - in com.rabbitmq.perf.ProducerTest
[INFO] Running com.rabbitmq.perf.MulticastSetTest
[INFO] Tests run: 7, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 s - in com.rabbitmq.perf.MulticastSetTest
[INFO] Running com.rabbitmq.perf.SequenceTopologyHandlerTest
[INFO] Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 s - in com.rabbitmq.perf.SequenceTopologyHandlerTest
[INFO] Running com.rabbitmq.perf.TopologyTest
[INFO] Tests run: 29, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 1.335 s - in com.rabbitmq.perf.TopologyTest
[INFO] Running com.rabbitmq.perf.PrometheusMetricsTest
[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.429 s - in com.rabbitmq.perf.PrometheusMetricsTest
[INFO] Running com.rabbitmq.perf.MessageCountTimeLimitAndPublishingIntervalRateTest
14:14:57.432 [main] INFO  c.r.p.MessageCountTimeLimitAndPublishingIntervalRateTest - Starting test publishingInterval (publishingInterval())
14:14:57.438 [main] WARN  c.r.p.MessageCountTimeLimitAndPublishingIntervalRateTest - New threads: [pool-29-thread-1, Reference Handler, process reaper, surefire-forkedjvm-command-thread, Keep-Alive-Timer, main, surefire-forkedjvm-ping-30s, Signal Dispatcher, Finalizer, pool-28-thread-1]
14:14:57.439 [main] INFO  c.r.p.MessageCountTimeLimitAndPublishingIntervalRateTest - Number of threads: 10
14:15:03.787 [main] INFO  c.r.p.MessageCountTimeLimitAndPublishingIntervalRateTest - Starting test consumerCount ([1] 1, 1)
14:15:03.788 [main] INFO  c.r.p.MessageCountTimeLimitAndPublishingIntervalRateTest - Number of threads: 10
14:15:04.304 [main] INFO  c.r.p.MessageCountTimeLimitAndPublishingIntervalRateTest - Starting test consumerCount ([2] 3, 1)
14:15:04.305 [main] INFO  c.r.p.MessageCountTimeLimitAndPublishingIntervalRateTest - Number of threads: 10
14:15:04.717 [main] INFO  c.r.p.MessageCountTimeLimitAndPublishingIntervalRateTest - Starting test consumerCount ([3] 1, 3)
14:15:04.719 [main] INFO  c.r.p.MessageCountTimeLimitAndPublishingIntervalRateTest - Number of threads: 10
14:15:05.191 [main] INFO  c.r.p.MessageCountTimeLimitAndPublishingIntervalRateTest - Starting test consumerCount ([4] 2, 3)
14:15:05.192 [main] INFO  c.r.p.MessageCountTimeLimitAndPublishingIntervalRateTest - Number of threads: 10
14:15:05.627 [main] INFO  c.r.p.MessageCountTimeLimitAndPublishingIntervalRateTest - Starting test timeLimit (timeLimit())
14:15:05.629 [main] INFO  c.r.p.MessageCountTimeLimitAndPublishingIntervalRateTest - Number of threads: 10
14:15:08.639 [main] INFO  c.r.p.MessageCountTimeLimitAndPublishingIntervalRateTest - Starting test publishingRateLimit (publishingRateLimit())
14:15:08.640 [main] INFO  c.r.p.MessageCountTimeLimitAndPublishingIntervalRateTest - Number of threads: 10
14:15:18.538 [main] INFO  c.r.p.MessageCountTimeLimitAndPublishingIntervalRateTest - Starting test consumerOnlyDoesNotStop (consumerOnlyDoesNotStop())
14:15:18.538 [main] INFO  c.r.p.MessageCountTimeLimitAndPublishingIntervalRateTest - Number of threads: 10
14:15:18.743 [main] INFO  c.r.p.MessageCountTimeLimitAndPublishingIntervalRateTest - Starting test timeLimitTakesPrecedenceOverCounts (timeLimitTakesPrecedenceOverCounts())
14:15:18.744 [main] INFO  c.r.p.MessageCountTimeLimitAndPublishingIntervalRateTest - Number of threads: 10
14:15:26.230 [main] INFO  c.r.p.MessageCountTimeLimitAndPublishingIntervalRateTest - Starting test producerOnlyDoesNotStop (producerOnlyDoesNotStop())
14:15:26.232 [main] INFO  c.r.p.MessageCountTimeLimitAndPublishingIntervalRateTest - Number of threads: 10
14:15:36.378 [main] INFO  c.r.p.MessageCountTimeLimitAndPublishingIntervalRateTest - Starting test producerCount ([1] 1, 1)
14:15:36.379 [main] INFO  c.r.p.MessageCountTimeLimitAndPublishingIntervalRateTest - Number of threads: 10
14:15:38.717 [main] INFO  c.r.p.MessageCountTimeLimitAndPublishingIntervalRateTest - Starting test producerCount ([2] 3, 1)
14:15:38.718 [main] INFO  c.r.p.MessageCountTimeLimitAndPublishingIntervalRateTest - Number of threads: 10
14:15:41.218 [main] INFO  c.r.p.MessageCountTimeLimitAndPublishingIntervalRateTest - Starting test producerCount ([3] 1, 3)
14:15:41.219 [main] INFO  c.r.p.MessageCountTimeLimitAndPublishingIntervalRateTest - Number of threads: 10
14:15:44.062 [main] INFO  c.r.p.MessageCountTimeLimitAndPublishingIntervalRateTest - Starting test producerCount ([4] 2, 3)
14:15:44.063 [main] INFO  c.r.p.MessageCountTimeLimitAndPublishingIntervalRateTest - Number of threads: 10
14:15:46.670 [main] INFO  c.r.p.MessageCountTimeLimitAndPublishingIntervalRateTest - Starting test noLimit (noLimit())
14:15:46.671 [main] INFO  c.r.p.MessageCountTimeLimitAndPublishingIntervalRateTest - Number of threads: 10
[INFO] Tests run: 15, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 49.257 s - in com.rabbitmq.perf.MessageCountTimeLimitAndPublishingIntervalRateTest
[INFO] Running com.rabbitmq.perf.ConsumerSharingThreadsTest
[INFO] Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.044 s - in com.rabbitmq.perf.ConsumerSharingThreadsTest
[INFO] Running com.rabbitmq.perf.PublisherOnlyStopsCorrectlyTest
[ERROR] Tests run: 2, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 10.817 s <<< FAILURE! - in com.rabbitmq.perf.PublisherOnlyStopsCorrectlyTest
[ERROR] publisherOnlyStopsWhenBrokerCrashes{int, Consumer, String}[2]  Time elapsed: 10.796 s  <<< FAILURE!
java.lang.AssertionError: 
Sender should have failed and program should stop
Expected: is <true>
     but: was <false>
	at com.rabbitmq.perf.PublisherOnlyStopsCorrectlyTest.publisherOnlyStopsWhenBrokerCrashes(PublisherOnlyStopsCorrectlyTest.java:109)

[INFO] Running com.rabbitmq.perf.LocalFilesMessageBodySourceTest
[INFO] Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.03 s - in com.rabbitmq.perf.LocalFilesMessageBodySourceTest
[INFO] Running com.rabbitmq.perf.MetricsTest
[INFO] Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.011 s - in com.rabbitmq.perf.MetricsTest
[INFO] Running com.rabbitmq.perf.JmxMetricsTest
[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 16.387 s - in com.rabbitmq.perf.JmxMetricsTest
[INFO] Running com.rabbitmq.perf.DatadogMetricsTest
[ERROR] Tests run: 1, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 33.127 s <<< FAILURE! - in com.rabbitmq.perf.DatadogMetricsTest
[ERROR] metricsShouldBeSentToDatadogHttpEndpoint  Time elapsed: 33.127 s  <<< FAILURE!
org.opentest4j.AssertionFailedError: 5 metrics requests should have been sent by now ==> expected: <true> but was: <false>
	at com.rabbitmq.perf.DatadogMetricsTest.metricsShouldBeSentToDatadogHttpEndpoint(DatadogMetricsTest.java:98)

[INFO] Running com.rabbitmq.perf.CachingRoutingKeyGeneratorTest
14:16:47.124 [perf-test-metrics-datadog-0] WARN  i.m.datadog.DatadogMeterRegistry - failed to send metrics
java.net.ConnectException: Connection refused (Connection refused)
	at java.net.PlainSocketImpl.socketConnect(Native Method)
	at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:350)
	at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:206)
	at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:188)
	at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392)
	at java.net.Socket.connect(Socket.java:589)
	at sun.net.NetworkClient.doConnect(NetworkClient.java:175)
	at sun.net.www.http.HttpClient.openServer(HttpClient.java:432)
	at sun.net.www.http.HttpClient.openServer(HttpClient.java:527)
	at sun.net.www.http.HttpClient.parseHTTPHeader(HttpClient.java:781)
	at sun.net.www.http.HttpClient.parseHTTP(HttpClient.java:647)
	at sun.net.www.protocol.http.HttpURLConnection.getInputStream0(HttpURLConnection.java:1569)
	at sun.net.www.protocol.http.HttpURLConnection.getInputStream(HttpURLConnection.java:1474)
	at java.net.HttpURLConnection.getResponseCode(HttpURLConnection.java:480)
	at io.micrometer.datadog.DatadogMeterRegistry.publish(DatadogMeterRegistry.java:126)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:308)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:294)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
	at java.lang.Thread.run(Thread.java:745)
[INFO] Tests run: 6, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.02 s - in com.rabbitmq.perf.CachingRoutingKeyGeneratorTest
[INFO] Running com.rabbitmq.perf.CommandLineProxyTest
[INFO] Tests run: 6, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 16.411 s - in com.rabbitmq.perf.CommandLineProxyTest
[INFO] Running com.rabbitmq.perf.PerfTestTest
[INFO] Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.003 s - in com.rabbitmq.perf.PerfTestTest
[INFO] 
[INFO] Results:
[INFO] 
[ERROR] Failures: 
[ERROR]   DatadogMetricsTest.metricsShouldBeSentToDatadogHttpEndpoint:98 5 metrics requests should have been sent by now ==> expected: <true> but was: <false>
[ERROR]   PublisherOnlyStopsCorrectlyTest.publisherOnlyStopsWhenBrokerCrashes:109 Sender should have failed and program should stop
Expected: is <true>
     but: was <false>
[INFO] 
[ERROR] Tests run: 93, Failures: 2, Errors: 0, Skipped: 0
[INFO] 
[INFO] ------------------------------------------------------------------------
[INFO] BUILD FAILURE
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 02:13 min
[INFO] Finished at: 2018-09-10T14:17:04+02:00
[INFO] Final Memory: 20M/356M
[INFO] ------------------------------------------------------------------------
[ERROR] Failed to execute goal org.apache.maven.plugins:maven-surefire-plugin:2.22.0:test (default-test) on project perf-test: There are test failures.
[ERROR] 
[ERROR] Please refer to /root/workspace/rabbitmq/rabbitmq-perf-test/426645400/target/surefire-reports for the individual test results.
[ERROR] Please refer to dump files (if any exist) [date]-jvmRun[N].dump, [date].dumpstream and [date]-jvmRun[N].dumpstream.
[ERROR] -> [Help 1]
[ERROR] 
[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.
[ERROR] Re-run Maven using the -X switch to enable full debug logging.
[ERROR] 
[ERROR] For more information about the errors and possible solutions, please read the following articles:
[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoFailureException
