[INFO] Scanning for projects...
[WARNING] 
[WARNING] Some problems were encountered while building the effective model for org.axonframework:axon-integrationtests:jar:4.0-SNAPSHOT
[WARNING] 'dependencies.dependency.systemPath' for com.oracle:ojdbc7:jar should not point at files within the project directory, ${project.basedir}/src/test/binary/ojdbc7.jar will be unresolvable by dependent projects @ org.axonframework:axon-integrationtests:[unknown-version], /root/workspace/AxonFramework/AxonFramework/439035107/integrationtests/pom.xml, line 142, column 25
[WARNING] 
[WARNING] It is highly recommended to fix these problems because they threaten the stability of your build.
[WARNING] 
[WARNING] For this reason, future Maven versions might no longer support building such malformed projects.
[WARNING] 
[INFO] ------------------------------------------------------------------------
[INFO] Detecting the operating system and CPU architecture
[INFO] ------------------------------------------------------------------------
[INFO] os.detected.name: linux
[INFO] os.detected.arch: x86_64
[INFO] os.detected.release: debian
[INFO] os.detected.release.version: 8
[INFO] os.detected.release.like.debian: true
[INFO] os.detected.classifier: linux-x86_64
[INFO] ------------------------------------------------------------------------
[INFO] Reactor Build Order:
[INFO] 
[INFO] Axon Framework
[INFO] Axon Framework core
[INFO] Axon Framework Distributed CommandBus JGroups
[INFO] Axon Framework Spring Support
[INFO] Axon AMQP
[INFO] Axon Kafka
[INFO] Axon Framework Distributed CommandBus Spring Cloud
[INFO] Axon Metrics
[INFO] axon-server-connector
[INFO] Axon Framework Spring Boot Support
[INFO] Axon Framework Test Fixtures
[INFO] Axon MongoDB Components
[INFO] Axon Integration tests
[INFO] Spring Boot Starter module for Axon Framework
[INFO] Spring Boot Starter module for Axon with JGroups Distributed Command Bus
[INFO] Axon Legacy Components
[INFO]                                                                         
[INFO] ------------------------------------------------------------------------
[INFO] Building Axon Framework 4.0-SNAPSHOT
[INFO] ------------------------------------------------------------------------
[INFO]                                                                         
[INFO] ------------------------------------------------------------------------
[INFO] Building Axon Framework core 4.0-SNAPSHOT
[INFO] ------------------------------------------------------------------------
[INFO] 
[INFO] --- maven-enforcer-plugin:1.4.1:enforce (enforce-banned-dependencies) @ axon-core ---
[INFO] Skipping Rule Enforcement.
[INFO] 
[INFO] --- maven-resources-plugin:3.0.2:resources (default-resources) @ axon-core ---
[INFO] Using 'UTF-8' encoding to copy filtered resources.
[INFO] Copying 7 resources
[INFO] 
[INFO] --- maven-compiler-plugin:3.5.1:compile (default-compile) @ axon-core ---
[INFO] Changes detected - recompiling the module!
[INFO] Compiling 577 source files to /root/workspace/AxonFramework/AxonFramework/439035107/core/target/classes
[INFO] /root/workspace/AxonFramework/AxonFramework/439035107/core/src/main/java/org/axonframework/eventhandling/saga/repository/LockingSagaRepository.java: Some input files use or override a deprecated API.
[INFO] /root/workspace/AxonFramework/AxonFramework/439035107/core/src/main/java/org/axonframework/eventhandling/saga/repository/LockingSagaRepository.java: Recompile with -Xlint:deprecation for details.
[INFO] /root/workspace/AxonFramework/AxonFramework/439035107/core/src/main/java/org/axonframework/config/DefaultConfigurer.java: Some input files use unchecked or unsafe operations.
[INFO] /root/workspace/AxonFramework/AxonFramework/439035107/core/src/main/java/org/axonframework/config/DefaultConfigurer.java: Recompile with -Xlint:unchecked for details.
[INFO] 
[INFO] --- maven-bundle-plugin:3.3.0:manifest (default) @ axon-core ---
[INFO] 
[INFO] --- maven-resources-plugin:3.0.2:testResources (default-testResources) @ axon-core ---
[INFO] Using 'UTF-8' encoding to copy filtered resources.
[INFO] Copying 10 resources
[INFO] 
[INFO] --- maven-compiler-plugin:3.5.1:testCompile (default-testCompile) @ axon-core ---
[INFO] Nothing to compile - all classes are up to date
[INFO] 
[INFO] --- maven-surefire-plugin:2.19.1:test (default-test) @ axon-core ---
[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/surefire-junit4/2.19.1/surefire-junit4-2.19.1.pom
[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/surefire-junit4/2.19.1/surefire-junit4-2.19.1.pom (4 KB at 9.1 KB/sec)
[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/surefire-providers/2.19.1/surefire-providers-2.19.1.pom
[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/surefire-providers/2.19.1/surefire-providers-2.19.1.pom (3 KB at 71.5 KB/sec)
[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/surefire-junit4/2.19.1/surefire-junit4-2.19.1.jar
[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/surefire-junit4/2.19.1/surefire-junit4-2.19.1.jar (74 KB at 1008.9 KB/sec)

-------------------------------------------------------
 T E S T S
-------------------------------------------------------
Running org.axonframework.eventsourcing.eventstore.jpa.SQLStateResolverTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.136 sec - in org.axonframework.eventsourcing.eventstore.jpa.SQLStateResolverTest
Running org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest
2018-10-09 11:20:06,317 [main] INFO  DefaultTestContextBootstrapper  - Loaded default TestExecutionListener class names from location [META-INF/spring.factories]: [org.springframework.test.context.web.ServletTestExecutionListener, org.springframework.test.context.support.DirtiesContextBeforeModesTestExecutionListener, org.springframework.test.context.support.DependencyInjectionTestExecutionListener, org.springframework.test.context.support.DirtiesContextTestExecutionListener, org.springframework.test.context.transaction.TransactionalTestExecutionListener, org.springframework.test.context.jdbc.SqlScriptsTestExecutionListener]
2018-10-09 11:20:06,430 [main] INFO  DefaultTestContextBootstrapper  - Using TestExecutionListeners: [org.springframework.test.context.support.DirtiesContextBeforeModesTestExecutionListener@333291e3, org.springframework.test.context.support.DependencyInjectionTestExecutionListener@479d31f3, org.springframework.test.context.support.DirtiesContextTestExecutionListener@40ef3420, org.springframework.test.context.transaction.TransactionalTestExecutionListener@498d318c, org.springframework.test.context.jdbc.SqlScriptsTestExecutionListener@6e171cd7]
2018-10-09 11:20:06,501 [main] INFO  XmlBeanDefinitionReader         - Loading XML bean definitions from class path resource [META-INF/spring/db-context.xml]
2018-10-09 11:20:06,854 [main] INFO  GenericApplicationContext       - Refreshing org.springframework.context.support.GenericApplicationContext@222545dc: startup date [Tue Oct 09 11:20:06 CEST 2018]; root of context hierarchy
2018-10-09 11:20:06,989 [main] INFO  redAnnotationBeanPostProcessor  - JSR-330 'javax.inject.Inject' annotation found and supported for autowiring
2018-10-09 11:20:07,197 [main] INFO  DriverManagerDataSource         - Loaded JDBC driver: org.hsqldb.jdbcDriver
2018-10-09 11:20:07,993 [main] INFO  tainerEntityManagerFactoryBean  - Building JPA container EntityManagerFactory for persistence unit 'eventStore'
2018-10-09 11:20:08,048 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-09 11:20:08,168 [main] INFO  Version                         - HHH000412: Hibernate Core {5.1.0.Final}
2018-10-09 11:20:08,171 [main] INFO  Environment                     - HHH000206: hibernate.properties not found
2018-10-09 11:20:08,175 [main] INFO  Environment                     - HHH000021: Bytecode provider name : javassist
2018-10-09 11:20:08,260 [main] INFO  Version                         - HCANN000001: Hibernate Commons Annotations {5.0.1.Final}
2018-10-09 11:20:09,815 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-09 11:20:10,507 [main] INFO  Version                         - HV000001: Hibernate Validator 5.2.4.Final
2018-10-09 11:20:11,252 [main] INFO  ractorJdbcDatabaseMetaDataImpl  - HHH000262: Table not found: AssociationValueEntry
2018-10-09 11:20:11,254 [main] INFO  ractorJdbcDatabaseMetaDataImpl  - HHH000262: Table not found: AssociationValueEntry
2018-10-09 11:20:11,263 [main] INFO  ractorJdbcDatabaseMetaDataImpl  - HHH000262: Table not found: CustomDomainEventEntry
2018-10-09 11:20:11,264 [main] INFO  ractorJdbcDatabaseMetaDataImpl  - HHH000262: Table not found: CustomDomainEventEntry
2018-10-09 11:20:11,273 [main] INFO  ractorJdbcDatabaseMetaDataImpl  - HHH000262: Table not found: CustomSagaEntry
2018-10-09 11:20:11,274 [main] INFO  ractorJdbcDatabaseMetaDataImpl  - HHH000262: Table not found: CustomSagaEntry
2018-10-09 11:20:11,281 [main] INFO  ractorJdbcDatabaseMetaDataImpl  - HHH000262: Table not found: CustomSnapshotEventEntry
2018-10-09 11:20:11,283 [main] INFO  ractorJdbcDatabaseMetaDataImpl  - HHH000262: Table not found: CustomSnapshotEventEntry
2018-10-09 11:20:11,289 [main] INFO  ractorJdbcDatabaseMetaDataImpl  - HHH000262: Table not found: DomainEventEntry
2018-10-09 11:20:11,291 [main] INFO  ractorJdbcDatabaseMetaDataImpl  - HHH000262: Table not found: DomainEventEntry
2018-10-09 11:20:11,297 [main] INFO  ractorJdbcDatabaseMetaDataImpl  - HHH000262: Table not found: JpaAggregate
2018-10-09 11:20:11,298 [main] INFO  ractorJdbcDatabaseMetaDataImpl  - HHH000262: Table not found: JpaAggregate
2018-10-09 11:20:11,302 [main] INFO  ractorJdbcDatabaseMetaDataImpl  - HHH000262: Table not found: SagaEntry
2018-10-09 11:20:11,304 [main] INFO  ractorJdbcDatabaseMetaDataImpl  - HHH000262: Table not found: SagaEntry
2018-10-09 11:20:11,307 [main] INFO  ractorJdbcDatabaseMetaDataImpl  - HHH000262: Table not found: SnapshotEventEntry
2018-10-09 11:20:11,309 [main] INFO  ractorJdbcDatabaseMetaDataImpl  - HHH000262: Table not found: SnapshotEventEntry
2018-10-09 11:20:11,314 [main] INFO  ractorJdbcDatabaseMetaDataImpl  - HHH000262: Table not found: StubAggregate
2018-10-09 11:20:11,316 [main] INFO  ractorJdbcDatabaseMetaDataImpl  - HHH000262: Table not found: StubAggregate
2018-10-09 11:20:11,629 [main] INFO  tainerEntityManagerFactoryBean  - Initialized JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-09 11:20:12,135 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@74b86971, testMethod = testStoreTwoExactSameSnapshots@JpaEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@c889805]; rollback [true]
2018-10-09 11:20:12,436 [main] INFO  ueryTranslatorFactoryInitiator  - HHH000397: Using ASTQueryTranslatorFactory
2018-10-09 11:20:12,701 [main] WARN  SqlExceptionHelper              - SQL Warning Code: -1100, SQLState: 02000
2018-10-09 11:20:12,701 [main] WARN  SqlExceptionHelper              - no data
2018-10-09 11:20:12,701 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@74b86971, testMethod = testStoreTwoExactSameSnapshots@JpaEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-09 11:20:12,710 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@350323a0, testMethod = testStoreEventsWithCustomEntity@JpaEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@c889805]; rollback [true]
2018-10-09 11:20:12,851 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@350323a0, testMethod = testStoreEventsWithCustomEntity@JpaEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-09 11:20:12,853 [main] INFO  GenericApplicationContext       - Closing org.springframework.context.support.GenericApplicationContext@222545dc: startup date [Tue Oct 09 11:20:06 CEST 2018]; root of context hierarchy
2018-10-09 11:20:12,855 [main] INFO  tainerEntityManagerFactoryBean  - Closing JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-09 11:20:12,857 [main] INFO  XmlBeanDefinitionReader         - Loading XML bean definitions from class path resource [META-INF/spring/db-context.xml]
2018-10-09 11:20:12,904 [main] INFO  GenericApplicationContext       - Refreshing org.springframework.context.support.GenericApplicationContext@6650a6c: startup date [Tue Oct 09 11:20:12 CEST 2018]; root of context hierarchy
2018-10-09 11:20:12,921 [main] INFO  redAnnotationBeanPostProcessor  - JSR-330 'javax.inject.Inject' annotation found and supported for autowiring
2018-10-09 11:20:12,970 [main] INFO  DriverManagerDataSource         - Loaded JDBC driver: org.hsqldb.jdbcDriver
2018-10-09 11:20:12,985 [main] INFO  tainerEntityManagerFactoryBean  - Building JPA container EntityManagerFactory for persistence unit 'eventStore'
2018-10-09 11:20:12,986 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-09 11:20:13,090 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-09 11:20:13,387 [main] INFO  tainerEntityManagerFactoryBean  - Initialized JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-09 11:20:13,465 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@6d7b001b, testMethod = testStoreAndLoadEventsFromDatastore@JpaEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@47a3d56a]; rollback [true]
2018-10-09 11:20:13,470 [main] INFO  ueryTranslatorFactoryInitiator  - HHH000397: Using ASTQueryTranslatorFactory
2018-10-09 11:20:13,496 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@6d7b001b, testMethod = testStoreAndLoadEventsFromDatastore@JpaEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-09 11:20:13,502 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@5f3b84bd, testMethod = testLoadLastSequenceNumber@JpaEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@47a3d56a]; rollback [true]
2018-10-09 11:20:13,524 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@5f3b84bd, testMethod = testLoadLastSequenceNumber@JpaEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-09 11:20:13,530 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@79f5a6ed, testMethod = testOldGapsAreRemovedFromProvidedTrackingToken@JpaEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@47a3d56a]; rollback [true]
2018-10-09 11:20:13,625 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@79f5a6ed, testMethod = testOldGapsAreRemovedFromProvidedTrackingToken@JpaEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-09 11:20:13,628 [main] INFO  GenericApplicationContext       - Closing org.springframework.context.support.GenericApplicationContext@6650a6c: startup date [Tue Oct 09 11:20:12 CEST 2018]; root of context hierarchy
2018-10-09 11:20:13,629 [main] INFO  tainerEntityManagerFactoryBean  - Closing JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-09 11:20:13,630 [main] INFO  XmlBeanDefinitionReader         - Loading XML bean definitions from class path resource [META-INF/spring/db-context.xml]
2018-10-09 11:20:13,674 [main] INFO  GenericApplicationContext       - Refreshing org.springframework.context.support.GenericApplicationContext@4e4894d: startup date [Tue Oct 09 11:20:13 CEST 2018]; root of context hierarchy
2018-10-09 11:20:13,692 [main] INFO  redAnnotationBeanPostProcessor  - JSR-330 'javax.inject.Inject' annotation found and supported for autowiring
2018-10-09 11:20:13,741 [main] INFO  DriverManagerDataSource         - Loaded JDBC driver: org.hsqldb.jdbcDriver
2018-10-09 11:20:13,756 [main] INFO  tainerEntityManagerFactoryBean  - Building JPA container EntityManagerFactory for persistence unit 'eventStore'
2018-10-09 11:20:13,757 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-09 11:20:13,848 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-09 11:20:14,163 [main] INFO  tainerEntityManagerFactoryBean  - Initialized JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-09 11:20:14,217 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@12209826, testMethod = testGapsForVeryOldEventsAreNotIncluded@JpaEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@5e3d2765]; rollback [true]
2018-10-09 11:20:14,224 [main] INFO  ueryTranslatorFactoryInitiator  - HHH000397: Using ASTQueryTranslatorFactory
2018-10-09 11:20:14,270 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@12209826, testMethod = testGapsForVeryOldEventsAreNotIncluded@JpaEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-09 11:20:14,276 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@333d44f6, testMethod = testEventsWithUnknownPayloadDoNotResultInError@JpaEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@5e3d2765]; rollback [true]
2018-10-09 11:20:14,362 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@333d44f6, testMethod = testEventsWithUnknownPayloadDoNotResultInError@JpaEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-09 11:20:14,369 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@5fd18419, testMethod = testUnknownSerializedTypeCausesException@JpaEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@5e3d2765]; rollback [true]
2018-10-09 11:20:14,407 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@5fd18419, testMethod = testUnknownSerializedTypeCausesException@JpaEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-09 11:20:14,412 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@138a85d3, testMethod = testLoad_LargeAmountOfEvents@BatchingEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@5e3d2765]; rollback [true]
2018-10-09 11:20:14,743 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@138a85d3, testMethod = testLoad_LargeAmountOfEvents@BatchingEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-09 11:20:14,750 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@7de6549d, testMethod = testStoreDuplicateEventWithoutExceptionResolver@AbstractEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@5e3d2765]; rollback [true]
2018-10-09 11:20:14,762 [main] WARN  SqlExceptionHelper              - SQL Error: -104, SQLState: 23505
2018-10-09 11:20:14,762 [main] ERROR SqlExceptionHelper              - integrity constraint violation: unique constraint or index violation; UKDG43IA27YPO1JOVW2X64VBWV8 table: DOMAINEVENTENTRY
2018-10-09 11:20:14,764 [main] INFO  AbstractBatchImpl               - HHH000010: On release of batch it still contained JDBC statements
2018-10-09 11:20:14,766 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@7de6549d, testMethod = testStoreDuplicateEventWithoutExceptionResolver@AbstractEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-09 11:20:14,766 [main] INFO  GenericApplicationContext       - Closing org.springframework.context.support.GenericApplicationContext@4e4894d: startup date [Tue Oct 09 11:20:13 CEST 2018]; root of context hierarchy
2018-10-09 11:20:14,767 [main] INFO  tainerEntityManagerFactoryBean  - Closing JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-09 11:20:14,768 [main] INFO  XmlBeanDefinitionReader         - Loading XML bean definitions from class path resource [META-INF/spring/db-context.xml]
2018-10-09 11:20:14,795 [main] INFO  GenericApplicationContext       - Refreshing org.springframework.context.support.GenericApplicationContext@3562e7c7: startup date [Tue Oct 09 11:20:14 CEST 2018]; root of context hierarchy
2018-10-09 11:20:14,810 [main] INFO  redAnnotationBeanPostProcessor  - JSR-330 'javax.inject.Inject' annotation found and supported for autowiring
2018-10-09 11:20:14,855 [main] INFO  DriverManagerDataSource         - Loaded JDBC driver: org.hsqldb.jdbcDriver
2018-10-09 11:20:14,870 [main] INFO  tainerEntityManagerFactoryBean  - Building JPA container EntityManagerFactory for persistence unit 'eventStore'
2018-10-09 11:20:14,874 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-09 11:20:14,943 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-09 11:20:15,135 [main] INFO  tainerEntityManagerFactoryBean  - Initialized JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-09 11:20:15,177 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@760a2b6e, testMethod = testStoreDuplicateEventWithExceptionTranslator@AbstractEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@40538370]; rollback [true]
2018-10-09 11:20:15,183 [main] INFO  ueryTranslatorFactoryInitiator  - HHH000397: Using ASTQueryTranslatorFactory
2018-10-09 11:20:15,192 [main] WARN  SqlExceptionHelper              - SQL Error: -104, SQLState: 23505
2018-10-09 11:20:15,192 [main] ERROR SqlExceptionHelper              - integrity constraint violation: unique constraint or index violation; UKDG43IA27YPO1JOVW2X64VBWV8 table: DOMAINEVENTENTRY
2018-10-09 11:20:15,192 [main] INFO  AbstractBatchImpl               - HHH000010: On release of batch it still contained JDBC statements
2018-10-09 11:20:15,195 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@760a2b6e, testMethod = testStoreDuplicateEventWithExceptionTranslator@AbstractEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-09 11:20:15,197 [main] INFO  GenericApplicationContext       - Closing org.springframework.context.support.GenericApplicationContext@3562e7c7: startup date [Tue Oct 09 11:20:14 CEST 2018]; root of context hierarchy
2018-10-09 11:20:15,198 [main] INFO  tainerEntityManagerFactoryBean  - Closing JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-09 11:20:15,199 [main] INFO  XmlBeanDefinitionReader         - Loading XML bean definitions from class path resource [META-INF/spring/db-context.xml]
2018-10-09 11:20:15,237 [main] INFO  GenericApplicationContext       - Refreshing org.springframework.context.support.GenericApplicationContext@66b31d46: startup date [Tue Oct 09 11:20:15 CEST 2018]; root of context hierarchy
2018-10-09 11:20:15,250 [main] INFO  redAnnotationBeanPostProcessor  - JSR-330 'javax.inject.Inject' annotation found and supported for autowiring
2018-10-09 11:20:15,288 [main] INFO  DriverManagerDataSource         - Loaded JDBC driver: org.hsqldb.jdbcDriver
2018-10-09 11:20:15,305 [main] INFO  tainerEntityManagerFactoryBean  - Building JPA container EntityManagerFactory for persistence unit 'eventStore'
2018-10-09 11:20:15,305 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-09 11:20:15,387 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:20:15,394 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-09 11:20:15,725 [main] INFO  tainerEntityManagerFactoryBean  - Initialized JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-09 11:20:15,753 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@16f4a3c0, testMethod = testStoreAndLoadEventsWithUpcaster@AbstractEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@7a3a49e5]; rollback [true]
2018-10-09 11:20:15,757 [main] INFO  ueryTranslatorFactoryInitiator  - HHH000397: Using ASTQueryTranslatorFactory
2018-10-09 11:20:15,814 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@16f4a3c0, testMethod = testStoreAndLoadEventsWithUpcaster@AbstractEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-09 11:20:15,815 [main] INFO  GenericApplicationContext       - Closing org.springframework.context.support.GenericApplicationContext@66b31d46: startup date [Tue Oct 09 11:20:15 CEST 2018]; root of context hierarchy
2018-10-09 11:20:15,815 [main] INFO  tainerEntityManagerFactoryBean  - Closing JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-09 11:20:15,816 [main] INFO  XmlBeanDefinitionReader         - Loading XML bean definitions from class path resource [META-INF/spring/db-context.xml]
2018-10-09 11:20:15,837 [main] INFO  GenericApplicationContext       - Refreshing org.springframework.context.support.GenericApplicationContext@148b6f95: startup date [Tue Oct 09 11:20:15 CEST 2018]; root of context hierarchy
2018-10-09 11:20:15,846 [main] INFO  redAnnotationBeanPostProcessor  - JSR-330 'javax.inject.Inject' annotation found and supported for autowiring
2018-10-09 11:20:15,873 [main] INFO  DriverManagerDataSource         - Loaded JDBC driver: org.hsqldb.jdbcDriver
2018-10-09 11:20:15,879 [main] INFO  tainerEntityManagerFactoryBean  - Building JPA container EntityManagerFactory for persistence unit 'eventStore'
2018-10-09 11:20:15,879 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-09 11:20:15,946 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-09 11:20:16,185 [main] INFO  tainerEntityManagerFactoryBean  - Initialized JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-09 11:20:16,231 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@762cdf46, testMethod = testUniqueKeyConstraintOnEventIdentifier@AbstractEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@4ad3969]; rollback [true]
2018-10-09 11:20:16,237 [main] INFO  ueryTranslatorFactoryInitiator  - HHH000397: Using ASTQueryTranslatorFactory
2018-10-09 11:20:16,245 [main] WARN  SqlExceptionHelper              - SQL Error: -104, SQLState: 23505
2018-10-09 11:20:16,245 [main] ERROR SqlExceptionHelper              - integrity constraint violation: unique constraint or index violation; UK_K5LT6D2792AMNLOO7Q91NJP0V table: DOMAINEVENTENTRY
2018-10-09 11:20:16,245 [main] INFO  AbstractBatchImpl               - HHH000010: On release of batch it still contained JDBC statements
2018-10-09 11:20:16,247 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@762cdf46, testMethod = testUniqueKeyConstraintOnEventIdentifier@AbstractEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-09 11:20:16,248 [main] INFO  GenericApplicationContext       - Closing org.springframework.context.support.GenericApplicationContext@148b6f95: startup date [Tue Oct 09 11:20:15 CEST 2018]; root of context hierarchy
2018-10-09 11:20:16,249 [main] INFO  tainerEntityManagerFactoryBean  - Closing JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-09 11:20:16,250 [main] INFO  XmlBeanDefinitionReader         - Loading XML bean definitions from class path resource [META-INF/spring/db-context.xml]
2018-10-09 11:20:16,282 [main] INFO  GenericApplicationContext       - Refreshing org.springframework.context.support.GenericApplicationContext@24d7657b: startup date [Tue Oct 09 11:20:16 CEST 2018]; root of context hierarchy
2018-10-09 11:20:16,308 [main] INFO  redAnnotationBeanPostProcessor  - JSR-330 'javax.inject.Inject' annotation found and supported for autowiring
2018-10-09 11:20:16,396 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:20:16,424 [main] INFO  DriverManagerDataSource         - Loaded JDBC driver: org.hsqldb.jdbcDriver
2018-10-09 11:20:16,445 [main] INFO  tainerEntityManagerFactoryBean  - Building JPA container EntityManagerFactory for persistence unit 'eventStore'
2018-10-09 11:20:16,445 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-09 11:20:16,588 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-09 11:20:16,928 [main] INFO  tainerEntityManagerFactoryBean  - Initialized JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-09 11:20:16,975 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@57167ccb, testMethod = testCreateTokenAtExactTime@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@248d2cec]; rollback [true]
2018-10-09 11:20:16,983 [main] INFO  ueryTranslatorFactoryInitiator  - HHH000397: Using ASTQueryTranslatorFactory
2018-10-09 11:20:17,019 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@57167ccb, testMethod = testCreateTokenAtExactTime@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-09 11:20:17,024 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@29db008c, testMethod = testCreateHeadToken@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@248d2cec]; rollback [true]
2018-10-09 11:20:17,042 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@29db008c, testMethod = testCreateHeadToken@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-09 11:20:17,051 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@58a7a58d, testMethod = testCreateTailToken@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@248d2cec]; rollback [true]
2018-10-09 11:20:17,081 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@58a7a58d, testMethod = testCreateTailToken@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-09 11:20:17,086 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@45b08b17, testMethod = testLoadNonExistent@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@248d2cec]; rollback [true]
2018-10-09 11:20:17,104 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@45b08b17, testMethod = testLoadNonExistent@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-09 11:20:17,113 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@49665f92, testMethod = testCreateTokenAt@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@248d2cec]; rollback [true]
2018-10-09 11:20:17,130 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@49665f92, testMethod = testCreateTokenAt@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-09 11:20:17,134 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@6109d880, testMethod = testLoadPartialStreamOfTrackedEvents@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@248d2cec]; rollback [true]
2018-10-09 11:20:17,195 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@6109d880, testMethod = testLoadPartialStreamOfTrackedEvents@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-09 11:20:17,200 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@7096d451, testMethod = testStoreAndLoadEvents@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@248d2cec]; rollback [true]
2018-10-09 11:20:17,223 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@7096d451, testMethod = testStoreAndLoadEvents@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-09 11:20:17,228 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@305289b3, testMethod = testCreateTokenWithUnorderedEvents@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@248d2cec]; rollback [true]
2018-10-09 11:20:17,248 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@305289b3, testMethod = testCreateTokenWithUnorderedEvents@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-09 11:20:17,253 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@5e2b512b, testMethod = testReturnedEventMessageBehavior@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@248d2cec]; rollback [true]
2018-10-09 11:20:17,267 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@5e2b512b, testMethod = testReturnedEventMessageBehavior@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-09 11:20:17,272 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@10a064bd, testMethod = testReadPartialStream@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@248d2cec]; rollback [true]
2018-10-09 11:20:17,296 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@10a064bd, testMethod = testReadPartialStream@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-09 11:20:17,300 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@12c78f36, testMethod = testLoadTrackedEvents@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@248d2cec]; rollback [true]
2018-10-09 11:20:17,370 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@12c78f36, testMethod = testLoadTrackedEvents@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-09 11:20:17,374 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@78b8f818, testMethod = testStoreAndLoadEventsArray@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@248d2cec]; rollback [true]
2018-10-09 11:20:17,386 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@78b8f818, testMethod = testStoreAndLoadEventsArray@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-09 11:20:17,391 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@79b4cff, testMethod = testStoreAndLoadApplicationEvent@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@248d2cec]; rollback [true]
2018-10-09 11:20:17,408 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:20:17,432 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@79b4cff, testMethod = testStoreAndLoadApplicationEvent@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-09 11:20:17,445 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@15c4b1a4, testMethod = testStoreAndLoadSnapshot@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@248d2cec]; rollback [true]
2018-10-09 11:20:17,479 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@4c3de38e testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@15c4b1a4, testMethod = testStoreAndLoadSnapshot@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1f9d4b0e testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
Tests run: 27, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 11.409 sec - in org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest
Running org.axonframework.eventsourcing.eventstore.jpa.DomainEventEntryTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.006 sec - in org.axonframework.eventsourcing.eventstore.jpa.DomainEventEntryTest
Running org.axonframework.eventsourcing.eventstore.jpa.SQLErrorCodesResolverTest
Tests run: 12, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.793 sec - in org.axonframework.eventsourcing.eventstore.jpa.SQLErrorCodesResolverTest
Running org.axonframework.eventsourcing.eventstore.EventUtilsTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.055 sec - in org.axonframework.eventsourcing.eventstore.EventUtilsTest
Running org.axonframework.eventsourcing.eventstore.jdbc.JdbcEventStorageEngineTest
2018-10-09 11:20:18,410 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
Tests run: 27, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 1.029 sec - in org.axonframework.eventsourcing.eventstore.jdbc.JdbcEventStorageEngineTest
Running org.axonframework.eventsourcing.eventstore.jdbc.MysqlJdbcEventStorageEngineTest
2018-10-09 11:20:19,413 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
Tests run: 1, Failures: 0, Errors: 0, Skipped: 1, Time elapsed: 0.224 sec - in org.axonframework.eventsourcing.eventstore.jdbc.MysqlJdbcEventStorageEngineTest
Running org.axonframework.eventsourcing.eventstore.FilteringDomainEventStreamTest
Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.eventsourcing.eventstore.FilteringDomainEventStreamTest
Running org.axonframework.eventsourcing.eventstore.ConcatenatingDomainEventStreamTest
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 sec - in org.axonframework.eventsourcing.eventstore.ConcatenatingDomainEventStreamTest
Running org.axonframework.eventsourcing.eventstore.TrackingTokenParameterResolverFactoryTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.eventsourcing.eventstore.TrackingTokenParameterResolverFactoryTest
Running org.axonframework.eventsourcing.eventstore.EqualRevisionPredicateTest
Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.031 sec - in org.axonframework.eventsourcing.eventstore.EqualRevisionPredicateTest
Running org.axonframework.eventsourcing.eventstore.inmemory.InMemoryEventStorageEngineTest
Tests run: 14, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.066 sec - in org.axonframework.eventsourcing.eventstore.inmemory.InMemoryEventStorageEngineTest
Running org.axonframework.eventsourcing.eventstore.EmbeddedEventStoreTest
2018-10-09 11:20:20,105 [main] WARN  AbstractEventStore              - Error reading snapshot for aggregate [aggregate]. Reconstructing from entire event stream.
org.axonframework.common.MockException: Mock
2018-10-09 11:20:20,414 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:20:20,925 [EmbeddedEventStore-1] WARN  EmbeddedEventStore              - An event processor fell behind the tail end of the event store cache. This usually indicates a badly performing event processor.
Tests run: 16, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 1.265 sec - in org.axonframework.eventsourcing.eventstore.EmbeddedEventStoreTest
Running org.axonframework.eventsourcing.eventstore.GlobalSequenceTrackingTokenTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.eventsourcing.eventstore.GlobalSequenceTrackingTokenTest
Running org.axonframework.eventsourcing.eventstore.SequenceEventStorageEngineTest
Tests run: 11, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.053 sec - in org.axonframework.eventsourcing.eventstore.SequenceEventStorageEngineTest
Running org.axonframework.eventsourcing.eventstore.TrackingTokenSerializationTest
2018-10-09 11:20:21,415 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.357 sec - in org.axonframework.eventsourcing.eventstore.TrackingTokenSerializationTest
Running org.axonframework.eventsourcing.eventstore.GapAwareTrackingTokenTest
2018-10-09 11:20:22,416 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
Tests run: 12, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 1.053 sec - in org.axonframework.eventsourcing.eventstore.GapAwareTrackingTokenTest
Running org.axonframework.eventsourcing.CachingRepositoryWithNestedUnitOfWorkTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.613 sec - in org.axonframework.eventsourcing.CachingRepositoryWithNestedUnitOfWorkTest
Running org.axonframework.eventsourcing.NestedUnitOfWorkTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.098 sec - in org.axonframework.eventsourcing.NestedUnitOfWorkTest
Running org.axonframework.eventsourcing.NoSnapshotTriggerDefinitionTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.eventsourcing.NoSnapshotTriggerDefinitionTest
Running org.axonframework.eventsourcing.GenericDomainEventMessageTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 sec - in org.axonframework.eventsourcing.GenericDomainEventMessageTest
Running org.axonframework.eventsourcing.AbstractSnapshotterTest
Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.204 sec - in org.axonframework.eventsourcing.AbstractSnapshotterTest
Running org.axonframework.eventsourcing.EventCountSnapshotTriggerDefinitionTest
2018-10-09 11:20:23,419 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.021 sec - in org.axonframework.eventsourcing.EventCountSnapshotTriggerDefinitionTest
Running org.axonframework.eventsourcing.FilteringEventStorageEngineTest
Tests run: 6, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.003 sec - in org.axonframework.eventsourcing.FilteringEventStorageEngineTest
Running org.axonframework.eventsourcing.AggregateSnapshotterTest
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.029 sec - in org.axonframework.eventsourcing.AggregateSnapshotterTest
Running org.axonframework.eventsourcing.DomainEventStreamTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.003 sec - in org.axonframework.eventsourcing.DomainEventStreamTest
Running org.axonframework.eventsourcing.CachingEventSourcingRepositoryTest
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.134 sec - in org.axonframework.eventsourcing.CachingEventSourcingRepositoryTest
Running org.axonframework.eventsourcing.EventSourcingRepositoryTest
Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.049 sec - in org.axonframework.eventsourcing.EventSourcingRepositoryTest
Running org.axonframework.eventsourcing.GenericAggregateFactoryTest
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 sec - in org.axonframework.eventsourcing.GenericAggregateFactoryTest
Running org.axonframework.eventsourcing.EventSourcingRepositoryIntegrationTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.057 sec - in org.axonframework.eventsourcing.EventSourcingRepositoryIntegrationTest
Running org.axonframework.config.EventProcessingModuleTest
2018-10-09 11:20:23,755 [EventProcessor[tracking]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=tracking, segment=Segment[0/0]}
2018-10-09 11:20:23,756 [EventProcessor[tracking]-0] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=-1} for segment: Segment[0/0]
2018-10-09 11:20:23,765 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'tracking'. Awaiting termination...
2018-10-09 11:20:24,421 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:20:24,792 [EventProcessor[ConcurrentMapProcessor]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=ConcurrentMapProcessor, segment=Segment[0/0]}
2018-10-09 11:20:24,792 [EventProcessor[ConcurrentMapProcessor]-0] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[0/0]
2018-10-09 11:20:24,793 [EventProcessor[java.util]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=java.util, segment=Segment[0/0]}
2018-10-09 11:20:24,793 [EventProcessor[java.util]-0] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[0/0]
2018-10-09 11:20:24,793 [EventProcessor[myGroup]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=myGroup, segment=Segment[0/0]}
2018-10-09 11:20:24,793 [EventProcessor[myGroup]-0] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[0/0]
2018-10-09 11:20:24,797 [EventProcessor[concurrent]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=concurrent, segment=Segment[0/0]}
2018-10-09 11:20:24,797 [EventProcessor[concurrent]-0] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[0/0]
2018-10-09 11:20:24,803 [EventProcessor[special]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=special, segment=Segment[0/0]}
2018-10-09 11:20:24,804 [EventProcessor[special]-0] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[0/0]
2018-10-09 11:20:24,805 [EventProcessor[default]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=default, segment=Segment[0/0]}
2018-10-09 11:20:24,805 [EventProcessor[default]-0] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[0/0]
2018-10-09 11:20:24,808 [EventProcessor[tracking]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=tracking, segment=Segment[0/0]}
2018-10-09 11:20:24,808 [EventProcessor[tracking]-0] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=-1} for segment: Segment[0/0]
2018-10-09 11:20:24,809 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'tracking'. Awaiting termination...
2018-10-09 11:20:25,422 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:20:25,818 [EventProcessor[tracking]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=tracking, segment=Segment[0/0]}
2018-10-09 11:20:25,818 [EventProcessor[tracking]-0] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=-1} for segment: Segment[0/0]
2018-10-09 11:20:25,819 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'tracking'. Awaiting termination...
2018-10-09 11:20:25,824 [EventProcessor[tracking]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=tracking, segment=Segment[0/0]}
2018-10-09 11:20:25,824 [EventProcessor[tracking]-0] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=-1} for segment: Segment[0/0]
2018-10-09 11:20:25,825 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'tracking'. Awaiting termination...
2018-10-09 11:20:26,423 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:20:26,829 [EventProcessor[tracking]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=tracking, segment=Segment[0/0]}
2018-10-09 11:20:26,829 [EventProcessor[tracking]-0] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=-1} for segment: Segment[0/0]
2018-10-09 11:20:26,830 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'tracking'. Awaiting termination...
2018-10-09 11:20:27,423 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
Tests run: 11, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 4.118 sec - in org.axonframework.config.EventProcessingModuleTest
Running org.axonframework.config.DefaultConfigurerTest
2018-10-09 11:20:27,869 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-09 11:20:27,933 [main] WARN  connections                     - HHH10001002: Using Hibernate built-in connection pool (not for production use!)
2018-10-09 11:20:27,933 [main] INFO  connections                     - HHH10001005: using driver [null] at URL [jdbc:hsqldb:mem:axontest]
2018-10-09 11:20:27,934 [main] INFO  connections                     - HHH10001001: Connection properties: {}
2018-10-09 11:20:27,934 [main] INFO  connections                     - HHH10001003: Autocommit mode: false
2018-10-09 11:20:27,937 [main] INFO  rManagerConnectionProviderImpl  - HHH000115: Hibernate connection pool size: 20 (min=1)
2018-10-09 11:20:27,963 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-09 11:20:28,061 [main] WARN  ExceptionHandlerLoggedImpl      - GenerationTarget encountered exception accepting command : Unable to execute command [drop sequence hibernate_sequence]
org.hibernate.tool.schema.spi.CommandAcceptanceException: Unable to execute command [drop sequence hibernate_sequence]
	at org.hibernate.tool.schema.internal.exec.GenerationTargetToDatabase.accept(GenerationTargetToDatabase.java:63)
	at org.hibernate.tool.schema.internal.SchemaDropperImpl.applySqlString(SchemaDropperImpl.java:370)
	at org.hibernate.tool.schema.internal.SchemaDropperImpl.applySqlStrings(SchemaDropperImpl.java:355)
	at org.hibernate.tool.schema.internal.SchemaDropperImpl.dropFromMetadata(SchemaDropperImpl.java:245)
	at org.hibernate.tool.schema.internal.SchemaDropperImpl.performDrop(SchemaDropperImpl.java:153)
	at org.hibernate.tool.schema.internal.SchemaDropperImpl.doDrop(SchemaDropperImpl.java:125)
	at org.hibernate.tool.schema.internal.SchemaDropperImpl.doDrop(SchemaDropperImpl.java:111)
	at org.hibernate.tool.schema.spi.SchemaManagementToolCoordinator.performDatabaseAction(SchemaManagementToolCoordinator.java:137)
	at org.hibernate.tool.schema.spi.SchemaManagementToolCoordinator.process(SchemaManagementToolCoordinator.java:64)
	at org.hibernate.internal.SessionFactoryImpl.<init>(SessionFactoryImpl.java:458)
	at org.hibernate.boot.internal.SessionFactoryBuilderImpl.build(SessionFactoryBuilderImpl.java:465)
	at org.hibernate.jpa.boot.internal.EntityManagerFactoryBuilderImpl.build(EntityManagerFactoryBuilderImpl.java:881)
	at org.hibernate.jpa.HibernatePersistenceProvider.createEntityManagerFactory(HibernatePersistenceProvider.java:58)
	at javax.persistence.Persistence.createEntityManagerFactory(Persistence.java:55)
	at org.axonframework.config.DefaultConfigurerTest.setUp(DefaultConfigurerTest.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:24)
	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:363)
	at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:367)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeWithRerun(JUnit4Provider.java:274)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:238)
	at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:161)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:290)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:242)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:121)
Caused by: java.sql.SQLSyntaxErrorException: user lacks privilege or object not found: HIBERNATE_SEQUENCE in statement [drop sequence hibernate_sequence]
	at org.hsqldb.jdbc.JDBCUtil.sqlException(Unknown Source)
	at org.hsqldb.jdbc.JDBCUtil.sqlException(Unknown Source)
	at org.hsqldb.jdbc.JDBCStatement.fetchResult(Unknown Source)
	at org.hsqldb.jdbc.JDBCStatement.execute(Unknown Source)
	at org.hibernate.tool.schema.internal.exec.GenerationTargetToDatabase.accept(GenerationTargetToDatabase.java:51)
	... 39 more
Caused by: org.hsqldb.HsqlException: user lacks privilege or object not found: HIBERNATE_SEQUENCE
	at org.hsqldb.error.Error.error(Unknown Source)
	at org.hsqldb.error.Error.error(Unknown Source)
	at org.hsqldb.StatementSchema.getResult(Unknown Source)
	at org.hsqldb.StatementSchema.execute(Unknown Source)
	at org.hsqldb.Session.executeCompiledStatement(Unknown Source)
	at org.hsqldb.Session.executeDirectStatement(Unknown Source)
	at org.hsqldb.Session.execute(Unknown Source)
	... 42 more
2018-10-09 11:20:28,077 [main] INFO  SchemaCreatorImpl               - HHH000476: Executing import script 'org.hibernate.tool.schema.internal.exec.ScriptSourceInputNonExistentImpl@6ade4ac6'
2018-10-09 11:20:28,090 [main] WARN  EntityManagerFactoryRegistry    - HHH000436: Entity manager factory name (eventStore) is already registered.  If entity manager will be clustered or passivated, specify a unique value for property 'hibernate.ejb.entitymanager_factory_name'
2018-10-09 11:20:28,115 [EventProcessor[org.axonframework.config]-0] INFO  TrackingEventProcessor          - Dispatching new tracking segment worker: TrackingSegmentWorker{processor=org.axonframework.config, segment=Segment[0/1]}
2018-10-09 11:20:28,115 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'org.axonframework.config'. Awaiting termination...
2018-10-09 11:20:28,117 [EventProcessor[org.axonframework.config]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=org.axonframework.config, segment=Segment[1/1]}
2018-10-09 11:20:28,131 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-09 11:20:28,202 [main] WARN  connections                     - HHH10001002: Using Hibernate built-in connection pool (not for production use!)
2018-10-09 11:20:28,202 [main] INFO  connections                     - HHH10001005: using driver [null] at URL [jdbc:hsqldb:mem:axontest]
2018-10-09 11:20:28,202 [main] INFO  connections                     - HHH10001001: Connection properties: {}
2018-10-09 11:20:28,204 [main] INFO  connections                     - HHH10001003: Autocommit mode: false
2018-10-09 11:20:28,204 [main] INFO  rManagerConnectionProviderImpl  - HHH000115: Hibernate connection pool size: 20 (min=1)
2018-10-09 11:20:28,205 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-09 11:20:28,337 [main] INFO  SchemaCreatorImpl               - HHH000476: Executing import script 'org.hibernate.tool.schema.internal.exec.ScriptSourceInputNonExistentImpl@6ade4ac6'
2018-10-09 11:20:28,351 [main] WARN  EntityManagerFactoryRegistry    - HHH000436: Entity manager factory name (eventStore) is already registered.  If entity manager will be clustered or passivated, specify a unique value for property 'hibernate.ejb.entitymanager_factory_name'
2018-10-09 11:20:28,384 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-09 11:20:28,425 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:20:28,458 [main] WARN  connections                     - HHH10001002: Using Hibernate built-in connection pool (not for production use!)
2018-10-09 11:20:28,458 [main] INFO  connections                     - HHH10001005: using driver [null] at URL [jdbc:hsqldb:mem:axontest]
2018-10-09 11:20:28,459 [main] INFO  connections                     - HHH10001001: Connection properties: {}
2018-10-09 11:20:28,459 [main] INFO  connections                     - HHH10001003: Autocommit mode: false
2018-10-09 11:20:28,459 [main] INFO  rManagerConnectionProviderImpl  - HHH000115: Hibernate connection pool size: 20 (min=1)
2018-10-09 11:20:28,465 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-09 11:20:28,588 [main] INFO  SchemaCreatorImpl               - HHH000476: Executing import script 'org.hibernate.tool.schema.internal.exec.ScriptSourceInputNonExistentImpl@6ade4ac6'
2018-10-09 11:20:28,600 [main] WARN  EntityManagerFactoryRegistry    - HHH000436: Entity manager factory name (eventStore) is already registered.  If entity manager will be clustered or passivated, specify a unique value for property 'hibernate.ejb.entitymanager_factory_name'
2018-10-09 11:20:28,631 [main] INFO  ueryTranslatorFactoryInitiator  - HHH000397: Using ASTQueryTranslatorFactory
2018-10-09 11:20:28,677 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-09 11:20:28,747 [main] WARN  connections                     - HHH10001002: Using Hibernate built-in connection pool (not for production use!)
2018-10-09 11:20:28,748 [main] INFO  connections                     - HHH10001005: using driver [null] at URL [jdbc:hsqldb:mem:axontest]
2018-10-09 11:20:28,748 [main] INFO  connections                     - HHH10001001: Connection properties: {}
2018-10-09 11:20:28,748 [main] INFO  connections                     - HHH10001003: Autocommit mode: false
2018-10-09 11:20:28,748 [main] INFO  rManagerConnectionProviderImpl  - HHH000115: Hibernate connection pool size: 20 (min=1)
2018-10-09 11:20:28,750 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-09 11:20:28,841 [main] INFO  SchemaCreatorImpl               - HHH000476: Executing import script 'org.hibernate.tool.schema.internal.exec.ScriptSourceInputNonExistentImpl@6ade4ac6'
2018-10-09 11:20:28,851 [main] WARN  EntityManagerFactoryRegistry    - HHH000436: Entity manager factory name (eventStore) is already registered.  If entity manager will be clustered or passivated, specify a unique value for property 'hibernate.ejb.entitymanager_factory_name'
2018-10-09 11:20:28,870 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-09 11:20:28,935 [main] WARN  connections                     - HHH10001002: Using Hibernate built-in connection pool (not for production use!)
2018-10-09 11:20:28,936 [main] INFO  connections                     - HHH10001005: using driver [null] at URL [jdbc:hsqldb:mem:axontest]
2018-10-09 11:20:28,937 [main] INFO  connections                     - HHH10001001: Connection properties: {}
2018-10-09 11:20:28,937 [main] INFO  connections                     - HHH10001003: Autocommit mode: false
2018-10-09 11:20:28,937 [main] INFO  rManagerConnectionProviderImpl  - HHH000115: Hibernate connection pool size: 20 (min=1)
2018-10-09 11:20:28,939 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-09 11:20:29,024 [main] INFO  SchemaCreatorImpl               - HHH000476: Executing import script 'org.hibernate.tool.schema.internal.exec.ScriptSourceInputNonExistentImpl@6ade4ac6'
2018-10-09 11:20:29,035 [main] WARN  EntityManagerFactoryRegistry    - HHH000436: Entity manager factory name (eventStore) is already registered.  If entity manager will be clustered or passivated, specify a unique value for property 'hibernate.ejb.entitymanager_factory_name'
2018-10-09 11:20:29,045 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'myProcessor'. Awaiting termination...
2018-10-09 11:20:29,045 [EventProcessor[myProcessor]-0] INFO  TrackingEventProcessor          - Dispatching new tracking segment worker: TrackingSegmentWorker{processor=myProcessor, segment=Segment[0/1]}
2018-10-09 11:20:29,046 [EventProcessor[myProcessor]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=myProcessor, segment=Segment[1/1]}
2018-10-09 11:20:29,054 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-09 11:20:29,119 [main] WARN  connections                     - HHH10001002: Using Hibernate built-in connection pool (not for production use!)
2018-10-09 11:20:29,119 [main] INFO  connections                     - HHH10001005: using driver [null] at URL [jdbc:hsqldb:mem:axontest]
2018-10-09 11:20:29,119 [main] INFO  connections                     - HHH10001001: Connection properties: {}
2018-10-09 11:20:29,119 [main] INFO  connections                     - HHH10001003: Autocommit mode: false
2018-10-09 11:20:29,120 [main] INFO  rManagerConnectionProviderImpl  - HHH000115: Hibernate connection pool size: 20 (min=1)
2018-10-09 11:20:29,120 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-09 11:20:29,201 [main] INFO  SchemaCreatorImpl               - HHH000476: Executing import script 'org.hibernate.tool.schema.internal.exec.ScriptSourceInputNonExistentImpl@6ade4ac6'
2018-10-09 11:20:29,211 [main] WARN  EntityManagerFactoryRegistry    - HHH000436: Entity manager factory name (eventStore) is already registered.  If entity manager will be clustered or passivated, specify a unique value for property 'hibernate.ejb.entitymanager_factory_name'
2018-10-09 11:20:29,220 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-09 11:20:29,287 [main] WARN  connections                     - HHH10001002: Using Hibernate built-in connection pool (not for production use!)
2018-10-09 11:20:29,288 [main] INFO  connections                     - HHH10001005: using driver [null] at URL [jdbc:hsqldb:mem:axontest]
2018-10-09 11:20:29,288 [main] INFO  connections                     - HHH10001001: Connection properties: {}
2018-10-09 11:20:29,288 [main] INFO  connections                     - HHH10001003: Autocommit mode: false
2018-10-09 11:20:29,288 [main] INFO  rManagerConnectionProviderImpl  - HHH000115: Hibernate connection pool size: 20 (min=1)
2018-10-09 11:20:29,289 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-09 11:20:29,373 [main] INFO  SchemaCreatorImpl               - HHH000476: Executing import script 'org.hibernate.tool.schema.internal.exec.ScriptSourceInputNonExistentImpl@6ade4ac6'
2018-10-09 11:20:29,383 [main] WARN  EntityManagerFactoryRegistry    - HHH000436: Entity manager factory name (eventStore) is already registered.  If entity manager will be clustered or passivated, specify a unique value for property 'hibernate.ejb.entitymanager_factory_name'
2018-10-09 11:20:29,416 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-09 11:20:29,426 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:20:29,483 [main] WARN  connections                     - HHH10001002: Using Hibernate built-in connection pool (not for production use!)
2018-10-09 11:20:29,484 [main] INFO  connections                     - HHH10001005: using driver [null] at URL [jdbc:hsqldb:mem:axontest]
2018-10-09 11:20:29,484 [main] INFO  connections                     - HHH10001001: Connection properties: {}
2018-10-09 11:20:29,484 [main] INFO  connections                     - HHH10001003: Autocommit mode: false
2018-10-09 11:20:29,484 [main] INFO  rManagerConnectionProviderImpl  - HHH000115: Hibernate connection pool size: 20 (min=1)
2018-10-09 11:20:29,485 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-09 11:20:29,563 [main] INFO  SchemaCreatorImpl               - HHH000476: Executing import script 'org.hibernate.tool.schema.internal.exec.ScriptSourceInputNonExistentImpl@6ade4ac6'
2018-10-09 11:20:29,574 [main] WARN  EntityManagerFactoryRegistry    - HHH000436: Entity manager factory name (eventStore) is already registered.  If entity manager will be clustered or passivated, specify a unique value for property 'hibernate.ejb.entitymanager_factory_name'
2018-10-09 11:20:29,591 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-09 11:20:29,676 [main] WARN  connections                     - HHH10001002: Using Hibernate built-in connection pool (not for production use!)
2018-10-09 11:20:29,676 [main] INFO  connections                     - HHH10001005: using driver [null] at URL [jdbc:hsqldb:mem:axontest]
2018-10-09 11:20:29,677 [main] INFO  connections                     - HHH10001001: Connection properties: {}
2018-10-09 11:20:29,677 [main] INFO  connections                     - HHH10001003: Autocommit mode: false
2018-10-09 11:20:29,677 [main] INFO  rManagerConnectionProviderImpl  - HHH000115: Hibernate connection pool size: 20 (min=1)
2018-10-09 11:20:29,679 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-09 11:20:29,748 [main] INFO  SchemaCreatorImpl               - HHH000476: Executing import script 'org.hibernate.tool.schema.internal.exec.ScriptSourceInputNonExistentImpl@6ade4ac6'
2018-10-09 11:20:29,759 [main] WARN  EntityManagerFactoryRegistry    - HHH000436: Entity manager factory name (eventStore) is already registered.  If entity manager will be clustered or passivated, specify a unique value for property 'hibernate.ejb.entitymanager_factory_name'
2018-10-09 11:20:29,832 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-09 11:20:29,906 [main] WARN  connections                     - HHH10001002: Using Hibernate built-in connection pool (not for production use!)
2018-10-09 11:20:29,906 [main] INFO  connections                     - HHH10001005: using driver [null] at URL [jdbc:hsqldb:mem:axontest]
2018-10-09 11:20:29,906 [main] INFO  connections                     - HHH10001001: Connection properties: {}
2018-10-09 11:20:29,906 [main] INFO  connections                     - HHH10001003: Autocommit mode: false
2018-10-09 11:20:29,906 [main] INFO  rManagerConnectionProviderImpl  - HHH000115: Hibernate connection pool size: 20 (min=1)
2018-10-09 11:20:29,907 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-09 11:20:29,998 [main] INFO  SchemaCreatorImpl               - HHH000476: Executing import script 'org.hibernate.tool.schema.internal.exec.ScriptSourceInputNonExistentImpl@6ade4ac6'
2018-10-09 11:20:30,010 [main] WARN  EntityManagerFactoryRegistry    - HHH000436: Entity manager factory name (eventStore) is already registered.  If entity manager will be clustered or passivated, specify a unique value for property 'hibernate.ejb.entitymanager_factory_name'
2018-10-09 11:20:30,018 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-09 11:20:30,085 [main] WARN  connections                     - HHH10001002: Using Hibernate built-in connection pool (not for production use!)
2018-10-09 11:20:30,085 [main] INFO  connections                     - HHH10001005: using driver [null] at URL [jdbc:hsqldb:mem:axontest]
2018-10-09 11:20:30,085 [main] INFO  connections                     - HHH10001001: Connection properties: {}
2018-10-09 11:20:30,085 [main] INFO  connections                     - HHH10001003: Autocommit mode: false
2018-10-09 11:20:30,085 [main] INFO  rManagerConnectionProviderImpl  - HHH000115: Hibernate connection pool size: 20 (min=1)
2018-10-09 11:20:30,086 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-09 11:20:30,158 [main] INFO  SchemaCreatorImpl               - HHH000476: Executing import script 'org.hibernate.tool.schema.internal.exec.ScriptSourceInputNonExistentImpl@6ade4ac6'
2018-10-09 11:20:30,170 [main] WARN  EntityManagerFactoryRegistry    - HHH000436: Entity manager factory name (eventStore) is already registered.  If entity manager will be clustered or passivated, specify a unique value for property 'hibernate.ejb.entitymanager_factory_name'
2018-10-09 11:20:30,185 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-09 11:20:30,263 [main] WARN  connections                     - HHH10001002: Using Hibernate built-in connection pool (not for production use!)
2018-10-09 11:20:30,263 [main] INFO  connections                     - HHH10001005: using driver [null] at URL [jdbc:hsqldb:mem:axontest]
2018-10-09 11:20:30,264 [main] INFO  connections                     - HHH10001001: Connection properties: {}
2018-10-09 11:20:30,267 [main] INFO  connections                     - HHH10001003: Autocommit mode: false
2018-10-09 11:20:30,268 [main] INFO  rManagerConnectionProviderImpl  - HHH000115: Hibernate connection pool size: 20 (min=1)
2018-10-09 11:20:30,270 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-09 11:20:30,384 [main] INFO  SchemaCreatorImpl               - HHH000476: Executing import script 'org.hibernate.tool.schema.internal.exec.ScriptSourceInputNonExistentImpl@6ade4ac6'
2018-10-09 11:20:30,398 [main] WARN  EntityManagerFactoryRegistry    - HHH000436: Entity manager factory name (eventStore) is already registered.  If entity manager will be clustered or passivated, specify a unique value for property 'hibernate.ejb.entitymanager_factory_name'
2018-10-09 11:20:30,427 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:20:30,432 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-09 11:20:30,516 [main] WARN  connections                     - HHH10001002: Using Hibernate built-in connection pool (not for production use!)
2018-10-09 11:20:30,516 [main] INFO  connections                     - HHH10001005: using driver [null] at URL [jdbc:hsqldb:mem:axontest]
2018-10-09 11:20:30,516 [main] INFO  connections                     - HHH10001001: Connection properties: {}
2018-10-09 11:20:30,516 [main] INFO  connections                     - HHH10001003: Autocommit mode: false
2018-10-09 11:20:30,516 [main] INFO  rManagerConnectionProviderImpl  - HHH000115: Hibernate connection pool size: 20 (min=1)
2018-10-09 11:20:30,517 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-09 11:20:30,606 [main] INFO  SchemaCreatorImpl               - HHH000476: Executing import script 'org.hibernate.tool.schema.internal.exec.ScriptSourceInputNonExistentImpl@6ade4ac6'
2018-10-09 11:20:30,619 [main] WARN  EntityManagerFactoryRegistry    - HHH000436: Entity manager factory name (eventStore) is already registered.  If entity manager will be clustered or passivated, specify a unique value for property 'hibernate.ejb.entitymanager_factory_name'
Tests run: 13, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 2.815 sec - in org.axonframework.config.DefaultConfigurerTest
Running org.axonframework.config.SagaConfigurationTest
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.115 sec - in org.axonframework.config.SagaConfigurationTest
Running org.axonframework.config.SingleEventProcessorAssigningToMultipleInvokersTest
Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.016 sec - in org.axonframework.config.SingleEventProcessorAssigningToMultipleInvokersTest
Running org.axonframework.config.ConfigurationResourceInjectorTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.005 sec - in org.axonframework.config.ConfigurationResourceInjectorTest
Running org.axonframework.config.ConfigurationScopeAwareProviderTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.335 sec - in org.axonframework.config.ConfigurationScopeAwareProviderTest
Running org.axonframework.config.MessageMonitorFactoryBuilderTest
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.008 sec - in org.axonframework.config.MessageMonitorFactoryBuilderTest
Running org.axonframework.config.ConfigurationParameterResolverFactoryTest
Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.config.ConfigurationParameterResolverFactoryTest
Running org.axonframework.common.ReflectionUtilsTest
Tests run: 11, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.004 sec - in org.axonframework.common.ReflectionUtilsTest
Running org.axonframework.common.AxonThreadFactoryTest
Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.common.AxonThreadFactoryTest
Running org.axonframework.common.AssertTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.common.AssertTest
Running org.axonframework.common.CollectionUtilsTest
Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 sec - in org.axonframework.common.CollectionUtilsTest
Running org.axonframework.common.annotation.AnnotationUtilsTest
Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.006 sec - in org.axonframework.common.annotation.AnnotationUtilsTest
Running org.axonframework.common.annotation.PriorityAnnotationComparatorTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.004 sec - in org.axonframework.common.annotation.PriorityAnnotationComparatorTest
Running org.axonframework.common.lock.LockFactoryTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.039 sec - in org.axonframework.common.lock.LockFactoryTest
Running org.axonframework.common.lock.PessimisticLockFactoryTest
2018-10-09 11:20:31,428 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
Tests run: 10, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.513 sec - in org.axonframework.common.lock.PessimisticLockFactoryTest
Running org.axonframework.common.caching.WeakReferenceCacheTest
Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.518 sec - in org.axonframework.common.caching.WeakReferenceCacheTest
Running org.axonframework.common.caching.NoCacheTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 sec - in org.axonframework.common.caching.NoCacheTest
Running org.axonframework.common.property.DirectPropertyAccessStrategyTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.004 sec - in org.axonframework.common.property.DirectPropertyAccessStrategyTest
Running org.axonframework.common.property.UniformPropertyAccessStrategyTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.002 sec - in org.axonframework.common.property.UniformPropertyAccessStrategyTest
Running org.axonframework.common.property.PropertyAccessStrategyTest
Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.002 sec - in org.axonframework.common.property.PropertyAccessStrategyTest
Running org.axonframework.common.property.BeanPropertyAccessStrategyTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 sec - in org.axonframework.common.property.BeanPropertyAccessStrategyTest
Running org.axonframework.common.jdbc.ConnectionWrapperFactoryTest
Tests run: 8, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.054 sec - in org.axonframework.common.jdbc.ConnectionWrapperFactoryTest
Running org.axonframework.common.jdbc.UnitOfWorkAwareConnectionProviderWrapperTest
Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.023 sec - in org.axonframework.common.jdbc.UnitOfWorkAwareConnectionProviderWrapperTest
Running org.axonframework.common.jdbc.JdbcUtilsTest
2018-10-09 11:20:32,429 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.268 sec - in org.axonframework.common.jdbc.JdbcUtilsTest
Running org.axonframework.common.IdentifierValidatorTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 sec - in org.axonframework.common.IdentifierValidatorTest
Running org.axonframework.common.DateTimeUtilsTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.common.DateTimeUtilsTest
Running org.axonframework.serialization.json.MetaDataDeserializerTest
Tests run: 20, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.138 sec - in org.axonframework.serialization.json.MetaDataDeserializerTest
Running org.axonframework.serialization.json.ByteArrayToJsonNodeConverterTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.004 sec - in org.axonframework.serialization.json.ByteArrayToJsonNodeConverterTest
Running org.axonframework.serialization.json.JacksonSerializerTest
Tests run: 11, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.591 sec - in org.axonframework.serialization.json.JacksonSerializerTest
Running org.axonframework.serialization.json.JsonNodeToByteArrayConverterTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.002 sec - in org.axonframework.serialization.json.JsonNodeToByteArrayConverterTest
Running org.axonframework.serialization.LazyDeserializingObjectTest
Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.014 sec - in org.axonframework.serialization.LazyDeserializingObjectTest
Running org.axonframework.serialization.converters.ByteArrayToStringConverterTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 sec - in org.axonframework.serialization.converters.ByteArrayToStringConverterTest
Running org.axonframework.serialization.converters.StringToByteArrayConverterTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.serialization.converters.StringToByteArrayConverterTest
Running org.axonframework.serialization.converters.InputStreamToByteArrayConverterTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.serialization.converters.InputStreamToByteArrayConverterTest
Running org.axonframework.serialization.xml.Dom4JToByteArrayConverterTest
Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.032 sec - in org.axonframework.serialization.xml.Dom4JToByteArrayConverterTest
Running org.axonframework.serialization.xml.XStreamSerializerTest
2018-10-09 11:20:33,429 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
Tests run: 12, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.117 sec - in org.axonframework.serialization.xml.XStreamSerializerTest
Running org.axonframework.serialization.xml.InputStreamToXomConverterTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.serialization.xml.InputStreamToXomConverterTest
Running org.axonframework.serialization.xml.InputStreamToDom4jConverterTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.serialization.xml.InputStreamToDom4jConverterTest
Running org.axonframework.serialization.xml.XomToStringConverterTest
Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.serialization.xml.XomToStringConverterTest
Running org.axonframework.serialization.SerializedMetaDataValueTest
Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.serialization.SerializedMetaDataValueTest
Running org.axonframework.serialization.MavenArtifactRevisionResolverTest
Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 sec - in org.axonframework.serialization.MavenArtifactRevisionResolverTest
Running org.axonframework.serialization.upcasting.event.AbstractContextAwareSingleEventUpcasterTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.013 sec - in org.axonframework.serialization.upcasting.event.AbstractContextAwareSingleEventUpcasterTest
Running org.axonframework.serialization.upcasting.event.AbstractSingleEventUpcasterTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.069 sec - in org.axonframework.serialization.upcasting.event.AbstractSingleEventUpcasterTest
Running org.axonframework.serialization.upcasting.event.EventUpcasterChainTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.02 sec - in org.axonframework.serialization.upcasting.event.EventUpcasterChainTest
Running org.axonframework.serialization.upcasting.event.AbstractEventMultiUpcasterTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.018 sec - in org.axonframework.serialization.upcasting.event.AbstractEventMultiUpcasterTest
Running org.axonframework.serialization.upcasting.event.AbstractContextAwareEventMultiUpcasterTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.01 sec - in org.axonframework.serialization.upcasting.event.AbstractContextAwareEventMultiUpcasterTest
Running org.axonframework.serialization.upcasting.GenericUpcasterChainTest
Tests run: 6, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.004 sec - in org.axonframework.serialization.upcasting.GenericUpcasterChainTest
Running org.axonframework.serialization.AnnotationRevisionResolverTest
Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 sec - in org.axonframework.serialization.AnnotationRevisionResolverTest
Running org.axonframework.serialization.ChainedConverterTest
Tests run: 6, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.019 sec - in org.axonframework.serialization.ChainedConverterTest
Running org.axonframework.serialization.SerialVersionUIDRevisionResolverTest
Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 sec - in org.axonframework.serialization.SerialVersionUIDRevisionResolverTest
Running org.axonframework.serialization.FixedValueRevisionResolverTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.serialization.FixedValueRevisionResolverTest
Running org.axonframework.serialization.JavaSerializerTest
Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.003 sec - in org.axonframework.serialization.JavaSerializerTest
Running org.axonframework.serialization.SerializedMessageTest
Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.005 sec - in org.axonframework.serialization.SerializedMessageTest
Running org.axonframework.serialization.SerializationAwareTest
Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.011 sec - in org.axonframework.serialization.SerializationAwareTest
Running org.axonframework.commandhandling.disruptor.DisruptorCommandBusBuilderTest
Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.004 sec - in org.axonframework.commandhandling.disruptor.DisruptorCommandBusBuilderTest
Running org.axonframework.commandhandling.disruptor.DisruptorCommandBusTest
2018-10-09 11:20:34,430 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:20:35,431 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:20:35,858 [pool-16-thread-4] INFO  DisruptorCommandBus             - Reset notification for 8b29f3b2-ec83-4ab6-9b95-0d1c303a486a received. The aggregate is removed from the blacklist
2018-10-09 11:20:35,996 [pool-16-thread-4] INFO  DisruptorCommandBus             - Reset notification for 8b29f3b2-ec83-4ab6-9b95-0d1c303a486a received. The aggregate is removed from the blacklist
2018-10-09 11:20:36,082 [pool-16-thread-4] INFO  DisruptorCommandBus             - Reset notification for 8b29f3b2-ec83-4ab6-9b95-0d1c303a486a received. The aggregate is removed from the blacklist
2018-10-09 11:20:36,229 [pool-16-thread-4] INFO  DisruptorCommandBus             - Reset notification for 8b29f3b2-ec83-4ab6-9b95-0d1c303a486a received. The aggregate is removed from the blacklist
2018-10-09 11:20:36,301 [pool-16-thread-4] INFO  DisruptorCommandBus             - Reset notification for 8b29f3b2-ec83-4ab6-9b95-0d1c303a486a received. The aggregate is removed from the blacklist
2018-10-09 11:20:36,374 [pool-16-thread-4] INFO  DisruptorCommandBus             - Reset notification for 8b29f3b2-ec83-4ab6-9b95-0d1c303a486a received. The aggregate is removed from the blacklist
2018-10-09 11:20:36,436 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:20:36,701 [pool-16-thread-4] INFO  DisruptorCommandBus             - Reset notification for 8b29f3b2-ec83-4ab6-9b95-0d1c303a486a received. The aggregate is removed from the blacklist
2018-10-09 11:20:36,790 [pool-16-thread-4] INFO  DisruptorCommandBus             - Reset notification for 8b29f3b2-ec83-4ab6-9b95-0d1c303a486a received. The aggregate is removed from the blacklist
2018-10-09 11:20:36,840 [pool-16-thread-4] INFO  DisruptorCommandBus             - Reset notification for 8b29f3b2-ec83-4ab6-9b95-0d1c303a486a received. The aggregate is removed from the blacklist
2018-10-09 11:20:36,893 [pool-16-thread-4] INFO  DisruptorCommandBus             - Reset notification for 8b29f3b2-ec83-4ab6-9b95-0d1c303a486a received. The aggregate is removed from the blacklist
2018-10-09 11:20:37,437 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:20:38,298 [DisruptorCommandBus-3] INFO  DisruptorCommandBus             - An error occurred while handling a command [org.axonframework.commandhandling.disruptor.DisruptorCommandBusTest$ErrorCommand].
org.axonframework.common.MockException: This is a failing event. EventStore refuses to store that
2018-10-09 11:20:38,299 [DisruptorCommandBus-2] INFO  DisruptorCommandBus             - An error occurred while handling a command [org.axonframework.commandhandling.disruptor.DisruptorCommandBusTest$ErrorCommand].
org.axonframework.common.MockException: This is a failing event. EventStore refuses to store that
2018-10-09 11:20:38,301 [DisruptorCommandBus-1] INFO  DisruptorCommandBus             - Reset notification for 41ffa9b1-2f27-4c26-834c-d18d98276a83 received. The aggregate is removed from the blacklist
2018-10-09 11:20:38,302 [DisruptorCommandBus-1] INFO  DisruptorCommandBus             - Reset notification for 824dbf01-006b-4068-94e0-ff75b21b4fad received. The aggregate is removed from the blacklist
2018-10-09 11:20:38,437 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:20:39,438 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:20:40,445 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:20:41,446 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:20:41,609 [pool-18-thread-5] INFO  DisruptorCommandBus             - Reset notification for 6431aff1-091f-4c82-9c38-51c51ca59bc1 received. The aggregate is removed from the blacklist
2018-10-09 11:20:41,702 [pool-18-thread-5] INFO  DisruptorCommandBus             - Reset notification for 6431aff1-091f-4c82-9c38-51c51ca59bc1 received. The aggregate is removed from the blacklist
2018-10-09 11:20:41,804 [pool-18-thread-5] INFO  DisruptorCommandBus             - Reset notification for 6431aff1-091f-4c82-9c38-51c51ca59bc1 received. The aggregate is removed from the blacklist
2018-10-09 11:20:41,856 [pool-18-thread-5] INFO  DisruptorCommandBus             - Reset notification for 6431aff1-091f-4c82-9c38-51c51ca59bc1 received. The aggregate is removed from the blacklist
2018-10-09 11:20:41,947 [pool-18-thread-5] INFO  DisruptorCommandBus             - Reset notification for 6431aff1-091f-4c82-9c38-51c51ca59bc1 received. The aggregate is removed from the blacklist
2018-10-09 11:20:41,993 [pool-18-thread-5] INFO  DisruptorCommandBus             - Reset notification for 6431aff1-091f-4c82-9c38-51c51ca59bc1 received. The aggregate is removed from the blacklist
2018-10-09 11:20:42,087 [pool-18-thread-5] INFO  DisruptorCommandBus             - Reset notification for 6431aff1-091f-4c82-9c38-51c51ca59bc1 received. The aggregate is removed from the blacklist
2018-10-09 11:20:42,142 [pool-18-thread-5] INFO  DisruptorCommandBus             - Reset notification for 6431aff1-091f-4c82-9c38-51c51ca59bc1 received. The aggregate is removed from the blacklist
2018-10-09 11:20:42,187 [pool-18-thread-5] INFO  DisruptorCommandBus             - Reset notification for 6431aff1-091f-4c82-9c38-51c51ca59bc1 received. The aggregate is removed from the blacklist
2018-10-09 11:20:42,236 [pool-18-thread-5] INFO  DisruptorCommandBus             - Reset notification for 6431aff1-091f-4c82-9c38-51c51ca59bc1 received. The aggregate is removed from the blacklist
2018-10-09 11:20:42,447 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:20:43,447 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:20:44,448 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:20:44,851 [DisruptorCommandBus-1] INFO  DisruptorCommandBus             - Reset notification for 95c3b738-2be6-4206-af99-bf5d31539bce received. The aggregate is removed from the blacklist
2018-10-09 11:20:44,853 [DisruptorCommandBus-2] WARN  DisruptorCommandBus             - Failed sending message [GenericDeadlineMessage{payload={org.axonframework.commandhandling.disruptor.DisruptorCommandBusTest$FailingEvent@5f4a7eee}, metadata={}, messageIdentifier='0290aa85-9f43-4d6e-99e7-ac8ca2095464', timestamp='2018-10-09T09:20:44.853Z}] to aggregate with id [95c3b738-2be6-4206-af99-bf5d31539bce]
2018-10-09 11:20:45,449 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:20:46,450 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:20:47,451 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:20:48,451 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:20:49,452 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:20:50,456 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:20:51,457 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:20:52,457 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:20:52,495 [pool-21-thread-5] INFO  DisruptorCommandBus             - Reset notification for b9b72562-3197-4622-be43-3bf884eff1c4 received. The aggregate is removed from the blacklist
2018-10-09 11:20:52,522 [pool-21-thread-5] INFO  DisruptorCommandBus             - Reset notification for b9b72562-3197-4622-be43-3bf884eff1c4 received. The aggregate is removed from the blacklist
2018-10-09 11:20:52,530 [pool-21-thread-5] INFO  DisruptorCommandBus             - Reset notification for b9b72562-3197-4622-be43-3bf884eff1c4 received. The aggregate is removed from the blacklist
2018-10-09 11:20:52,536 [pool-21-thread-5] INFO  DisruptorCommandBus             - Reset notification for b9b72562-3197-4622-be43-3bf884eff1c4 received. The aggregate is removed from the blacklist
2018-10-09 11:20:52,541 [pool-21-thread-5] INFO  DisruptorCommandBus             - Reset notification for b9b72562-3197-4622-be43-3bf884eff1c4 received. The aggregate is removed from the blacklist
2018-10-09 11:20:52,545 [pool-21-thread-5] INFO  DisruptorCommandBus             - Reset notification for b9b72562-3197-4622-be43-3bf884eff1c4 received. The aggregate is removed from the blacklist
2018-10-09 11:20:52,553 [pool-21-thread-5] INFO  DisruptorCommandBus             - Reset notification for b9b72562-3197-4622-be43-3bf884eff1c4 received. The aggregate is removed from the blacklist
2018-10-09 11:20:52,560 [pool-21-thread-5] INFO  DisruptorCommandBus             - Reset notification for b9b72562-3197-4622-be43-3bf884eff1c4 received. The aggregate is removed from the blacklist
2018-10-09 11:20:52,567 [pool-21-thread-5] INFO  DisruptorCommandBus             - Reset notification for b9b72562-3197-4622-be43-3bf884eff1c4 received. The aggregate is removed from the blacklist
2018-10-09 11:20:52,571 [pool-21-thread-5] INFO  DisruptorCommandBus             - Reset notification for b9b72562-3197-4622-be43-3bf884eff1c4 received. The aggregate is removed from the blacklist
2018-10-09 11:20:53,458 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:20:54,459 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:20:55,461 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
Tests run: 17, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 22.121 sec - in org.axonframework.commandhandling.disruptor.DisruptorCommandBusTest
Running org.axonframework.commandhandling.disruptor.DisruptorCommandBusTest_MultiThreaded
2018-10-09 11:20:55,968 [DisruptorCommandBus-4] INFO  DisruptorCommandBus             - Reset notification for b7ac84fd-35d7-40e9-9e85-3931a9b0fdbd received. The aggregate is removed from the blacklist
2018-10-09 11:20:55,970 [DisruptorCommandBus-2] INFO  DisruptorCommandBus             - Reset notification for f2eb69bf-9d6d-426d-bc58-3b8a7e1d4d80 received. The aggregate is removed from the blacklist
2018-10-09 11:20:55,970 [DisruptorCommandBus-4] INFO  DisruptorCommandBus             - Reset notification for a32bb57d-a7b9-4295-a41a-836c20b13b7b received. The aggregate is removed from the blacklist
2018-10-09 11:20:55,970 [DisruptorCommandBus-4] INFO  DisruptorCommandBus             - Reset notification for 3993fcd0-4db8-4ed0-a885-ad1a9e216331 received. The aggregate is removed from the blacklist
2018-10-09 11:20:55,970 [DisruptorCommandBus-3] INFO  DisruptorCommandBus             - Reset notification for da1acd0f-e537-4bf5-b982-1d0639424ec7 received. The aggregate is removed from the blacklist
2018-10-09 11:20:55,971 [DisruptorCommandBus-4] INFO  DisruptorCommandBus             - Reset notification for 009f7a96-874f-4ef3-b87f-3eb2f9740787 received. The aggregate is removed from the blacklist
2018-10-09 11:20:55,971 [DisruptorCommandBus-2] INFO  DisruptorCommandBus             - Reset notification for 7a518a5c-73a9-4544-a8e0-7a004bf0388a received. The aggregate is removed from the blacklist
2018-10-09 11:20:55,972 [DisruptorCommandBus-4] INFO  DisruptorCommandBus             - Reset notification for 2cd547f5-4537-494f-967a-a8ba0b1ba1c6 received. The aggregate is removed from the blacklist
2018-10-09 11:20:55,973 [DisruptorCommandBus-3] INFO  DisruptorCommandBus             - Reset notification for e0eba88a-4c60-4c45-9cc3-b142ca5150a2 received. The aggregate is removed from the blacklist
2018-10-09 11:20:55,974 [DisruptorCommandBus-4] INFO  DisruptorCommandBus             - Reset notification for ac11069c-fa7f-4fed-a23e-d398e93c90fe received. The aggregate is removed from the blacklist
2018-10-09 11:20:56,461 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 1.279 sec - in org.axonframework.commandhandling.disruptor.DisruptorCommandBusTest_MultiThreaded
Running org.axonframework.commandhandling.disruptor.CommandHandlerInvokerTest
Tests run: 10, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.05 sec - in org.axonframework.commandhandling.disruptor.CommandHandlerInvokerTest
Running org.axonframework.commandhandling.disruptor.DisruptorRepositoryTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.005 sec - in org.axonframework.commandhandling.disruptor.DisruptorRepositoryTest
Running org.axonframework.commandhandling.callbacks.VoidCallbackTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 sec - in org.axonframework.commandhandling.callbacks.VoidCallbackTest
Running org.axonframework.commandhandling.callbacks.FutureCallbackTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.003 sec - in org.axonframework.commandhandling.callbacks.FutureCallbackTest
Running org.axonframework.commandhandling.model.inspection.AnnotatedAggregateMetaModelFactoryTest
Tests run: 15, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.031 sec - in org.axonframework.commandhandling.model.inspection.AnnotatedAggregateMetaModelFactoryTest
Running org.axonframework.commandhandling.model.EntityEventForwardingModelInspectorTest
Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.012 sec - in org.axonframework.commandhandling.model.EntityEventForwardingModelInspectorTest
Running org.axonframework.commandhandling.model.GenericJpaRepositoryIntegrationTest
2018-10-09 11:20:57,233 [main] INFO  DefaultTestContextBootstrapper  - Loaded default TestExecutionListener class names from location [META-INF/spring.factories]: [org.springframework.test.context.web.ServletTestExecutionListener, org.springframework.test.context.support.DirtiesContextBeforeModesTestExecutionListener, org.springframework.test.context.support.DependencyInjectionTestExecutionListener, org.springframework.test.context.support.DirtiesContextTestExecutionListener, org.springframework.test.context.transaction.TransactionalTestExecutionListener, org.springframework.test.context.jdbc.SqlScriptsTestExecutionListener]
2018-10-09 11:20:57,234 [main] INFO  DefaultTestContextBootstrapper  - Using TestExecutionListeners: [org.springframework.test.context.support.DirtiesContextBeforeModesTestExecutionListener@58e22835, org.springframework.test.context.support.DependencyInjectionTestExecutionListener@7647d789, org.springframework.test.context.support.DirtiesContextTestExecutionListener@685d620a, org.springframework.test.context.transaction.TransactionalTestExecutionListener@360fe828, org.springframework.test.context.jdbc.SqlScriptsTestExecutionListener@7fe5dd5c]
2018-10-09 11:20:57,245 [main] INFO  GenericApplicationContext       - Refreshing org.springframework.context.support.GenericApplicationContext@37d6a6b6: startup date [Tue Oct 09 11:20:57 CEST 2018]; root of context hierarchy
2018-10-09 11:20:57,279 [main] INFO  redAnnotationBeanPostProcessor  - JSR-330 'javax.inject.Inject' annotation found and supported for autowiring
2018-10-09 11:20:57,292 [main] INFO  egate$BeanPostProcessorChecker  - Bean 'genericJpaRepositoryIntegrationTest.TestContext' of type [org.axonframework.commandhandling.model.GenericJpaRepositoryIntegrationTest$TestContext$$EnhancerBySpringCGLIB$$a6f14101] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-10-09 11:20:57,315 [main] INFO  DriverManagerDataSource         - Loaded JDBC driver: org.hsqldb.jdbcDriver
2018-10-09 11:20:57,330 [main] INFO  tainerEntityManagerFactoryBean  - Building JPA container EntityManagerFactory for persistence unit 'eventStore'
2018-10-09 11:20:57,330 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-09 11:20:57,396 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-09 11:20:57,462 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:20:57,517 [main] WARN  EntityManagerFactoryRegistry    - HHH000436: Entity manager factory name (eventStore) is already registered.  If entity manager will be clustered or passivated, specify a unique value for property 'hibernate.ejb.entitymanager_factory_name'
2018-10-09 11:20:57,517 [main] INFO  tainerEntityManagerFactoryBean  - Initialized JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-09 11:20:57,567 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@9bd7c1 testClass = GenericJpaRepositoryIntegrationTest, testInstance = org.axonframework.commandhandling.model.GenericJpaRepositoryIntegrationTest@6028b018, testMethod = testUpdateAnAggregate@GenericJpaRepositoryIntegrationTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@2e47ec5e testClass = GenericJpaRepositoryIntegrationTest, locations = '{}', classes = '{class org.axonframework.commandhandling.model.GenericJpaRepositoryIntegrationTest$TestContext}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{classpath:hsqldb.database.properties}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@3b2bd545]; rollback [true]
2018-10-09 11:20:57,578 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@9bd7c1 testClass = GenericJpaRepositoryIntegrationTest, testInstance = org.axonframework.commandhandling.model.GenericJpaRepositoryIntegrationTest@6028b018, testMethod = testUpdateAnAggregate@GenericJpaRepositoryIntegrationTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@2e47ec5e testClass = GenericJpaRepositoryIntegrationTest, locations = '{}', classes = '{class org.axonframework.commandhandling.model.GenericJpaRepositoryIntegrationTest$TestContext}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{classpath:hsqldb.database.properties}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-09 11:20:57,580 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@9bd7c1 testClass = GenericJpaRepositoryIntegrationTest, testInstance = org.axonframework.commandhandling.model.GenericJpaRepositoryIntegrationTest@5531484a, testMethod = testStoreAndLoadNewAggregate@GenericJpaRepositoryIntegrationTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@2e47ec5e testClass = GenericJpaRepositoryIntegrationTest, locations = '{}', classes = '{class org.axonframework.commandhandling.model.GenericJpaRepositoryIntegrationTest$TestContext}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{classpath:hsqldb.database.properties}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@3b2bd545]; rollback [true]
2018-10-09 11:20:57,582 [main] INFO  ueryTranslatorFactoryInitiator  - HHH000397: Using ASTQueryTranslatorFactory
2018-10-09 11:20:57,586 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@9bd7c1 testClass = GenericJpaRepositoryIntegrationTest, testInstance = org.axonframework.commandhandling.model.GenericJpaRepositoryIntegrationTest@5531484a, testMethod = testStoreAndLoadNewAggregate@GenericJpaRepositoryIntegrationTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@2e47ec5e testClass = GenericJpaRepositoryIntegrationTest, locations = '{}', classes = '{class org.axonframework.commandhandling.model.GenericJpaRepositoryIntegrationTest$TestContext}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{classpath:hsqldb.database.properties}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-09 11:20:57,588 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@9bd7c1 testClass = GenericJpaRepositoryIntegrationTest, testInstance = org.axonframework.commandhandling.model.GenericJpaRepositoryIntegrationTest@6241ef96, testMethod = testDeleteAnAggregate@GenericJpaRepositoryIntegrationTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@2e47ec5e testClass = GenericJpaRepositoryIntegrationTest, locations = '{}', classes = '{class org.axonframework.commandhandling.model.GenericJpaRepositoryIntegrationTest$TestContext}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{classpath:hsqldb.database.properties}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@3b2bd545]; rollback [true]
2018-10-09 11:20:57,596 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@9bd7c1 testClass = GenericJpaRepositoryIntegrationTest, testInstance = org.axonframework.commandhandling.model.GenericJpaRepositoryIntegrationTest@6241ef96, testMethod = testDeleteAnAggregate@GenericJpaRepositoryIntegrationTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@2e47ec5e testClass = GenericJpaRepositoryIntegrationTest, locations = '{}', classes = '{class org.axonframework.commandhandling.model.GenericJpaRepositoryIntegrationTest$TestContext}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{classpath:hsqldb.database.properties}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.367 sec - in org.axonframework.commandhandling.model.GenericJpaRepositoryIntegrationTest
Running org.axonframework.commandhandling.model.LockingRepositoryTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.096 sec - in org.axonframework.commandhandling.model.LockingRepositoryTest
Running org.axonframework.commandhandling.model.AnnotatedAggregateTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.005 sec - in org.axonframework.commandhandling.model.AnnotatedAggregateTest
Running org.axonframework.commandhandling.model.AbstractRepositoryTest
Tests run: 9, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.054 sec - in org.axonframework.commandhandling.model.AbstractRepositoryTest
Running org.axonframework.commandhandling.model.EventSourcingRepositoryTest
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.012 sec - in org.axonframework.commandhandling.model.EventSourcingRepositoryTest
Running org.axonframework.commandhandling.model.GenericJpaRepositoryTest
Tests run: 11, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.086 sec - in org.axonframework.commandhandling.model.GenericJpaRepositoryTest
Running org.axonframework.commandhandling.model.AggregateScopeDescriptorSerializationTest
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.011 sec - in org.axonframework.commandhandling.model.AggregateScopeDescriptorSerializationTest
Running org.axonframework.commandhandling.AnnotationCommandTargetResolverTest
Tests run: 10, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.006 sec - in org.axonframework.commandhandling.AnnotationCommandTargetResolverTest
Running org.axonframework.commandhandling.CurrentUnitOfWorkParameterResolverFactoryTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.081 sec - in org.axonframework.commandhandling.CurrentUnitOfWorkParameterResolverFactoryTest
Running org.axonframework.commandhandling.CommandHandlingTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.005 sec - in org.axonframework.commandhandling.CommandHandlingTest
Running org.axonframework.commandhandling.distributed.commandfilter.CommandFilterTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.007 sec - in org.axonframework.commandhandling.distributed.commandfilter.CommandFilterTest
Running org.axonframework.commandhandling.distributed.AnnotationRoutingStrategyTest
Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.006 sec - in org.axonframework.commandhandling.distributed.AnnotationRoutingStrategyTest
Running org.axonframework.commandhandling.distributed.DistributedCommandBusTest
Tests run: 7, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.123 sec - in org.axonframework.commandhandling.distributed.DistributedCommandBusTest
Running org.axonframework.commandhandling.distributed.ConsistentHashTest
Tests run: 7, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.027 sec - in org.axonframework.commandhandling.distributed.ConsistentHashTest
Running org.axonframework.commandhandling.distributed.CommandCallbackRepositoryTest
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 sec - in org.axonframework.commandhandling.distributed.CommandCallbackRepositoryTest
Running org.axonframework.commandhandling.SimpleCommandBusTest
Tests run: 10, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.013 sec - in org.axonframework.commandhandling.SimpleCommandBusTest
Running org.axonframework.commandhandling.CommandHandlerInterceptorTest
Tests run: 8, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.137 sec - in org.axonframework.commandhandling.CommandHandlerInterceptorTest
Running org.axonframework.commandhandling.gateway.DefaultCommandGatewayTest
2018-10-09 11:20:58,339 [main] WARN  DefaultCommandGateway           - Command 'java.lang.String' resulted in java.lang.RuntimeException(java.lang.RuntimeException)
Tests run: 10, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.053 sec - in org.axonframework.commandhandling.gateway.DefaultCommandGatewayTest
Running org.axonframework.commandhandling.gateway.CommandGatewayFactoryTest
Tests run: 30, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.09 sec - in org.axonframework.commandhandling.gateway.CommandGatewayFactoryTest
Running org.axonframework.commandhandling.conflictresolution.ConflictResolutionIntegrationTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.014 sec - in org.axonframework.commandhandling.conflictresolution.ConflictResolutionIntegrationTest
Running org.axonframework.commandhandling.conflictresolution.DefaultConflictResolverTest
2018-10-09 11:20:58,463 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
Tests run: 7, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.007 sec - in org.axonframework.commandhandling.conflictresolution.DefaultConflictResolverTest
Running org.axonframework.commandhandling.conflictresolution.ConflictResolutionTest
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.01 sec - in org.axonframework.commandhandling.conflictresolution.ConflictResolutionTest
Running org.axonframework.commandhandling.conflictresolution.ConflictsTest
Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.commandhandling.conflictresolution.ConflictsTest
Running org.axonframework.commandhandling.AsynchronousCommandBusTest
2018-10-09 11:20:58,497 [main] INFO  LoggingCallback                 - Command executed successfully: java.lang.Object
Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.023 sec - in org.axonframework.commandhandling.AsynchronousCommandBusTest
Running org.axonframework.commandhandling.AggregateAnnotationCommandHandlerTest
2018-10-09 11:20:58,589 [main] INFO  LoggingCallback                 - Command executed successfully: org.axonframework.commandhandling.AggregateAnnotationCommandHandlerTest$CreateCommand
2018-10-09 11:20:58,644 [main] INFO  LoggingCallback                 - Command executed successfully: org.axonframework.commandhandling.AggregateAnnotationCommandHandlerTest$CreateFactoryMethodCommand
Tests run: 22, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.252 sec - in org.axonframework.commandhandling.AggregateAnnotationCommandHandlerTest
Running org.axonframework.commandhandling.GenericCommandMessageTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.commandhandling.GenericCommandMessageTest
Running org.axonframework.commandhandling.AnnotationCommandHandlerAdapterTest
Tests run: 6, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.102 sec - in org.axonframework.commandhandling.AnnotationCommandHandlerAdapterTest
Running org.axonframework.commandhandling.SpawningNewAggregateTest
2018-10-09 11:20:58,883 [main] INFO  LoggingCallback                 - Command executed successfully: org.axonframework.commandhandling.SpawningNewAggregateTest$CreateAggregate1Command
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.029 sec - in org.axonframework.commandhandling.SpawningNewAggregateTest
Running org.axonframework.eventhandling.async.SequentialPerAggregatePolicyTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.eventhandling.async.SequentialPerAggregatePolicyTest
Running org.axonframework.eventhandling.async.FullConcurrencyPolicyTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.eventhandling.async.FullConcurrencyPolicyTest
Running org.axonframework.eventhandling.async.AsynchronousEventProcessorConcurrencyTest
2018-10-09 11:20:59,464 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:00,465 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:01,465 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:02,466 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 4.15 sec - in org.axonframework.eventhandling.async.AsynchronousEventProcessorConcurrencyTest
Running org.axonframework.eventhandling.async.SequentialPolicyTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.eventhandling.async.SequentialPolicyTest
Running org.axonframework.eventhandling.async.AsynchronousEventProcessingStrategyTest
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.011 sec - in org.axonframework.eventhandling.async.AsynchronousEventProcessingStrategyTest
Running org.axonframework.eventhandling.saga.AnnotatedSagaTest
Tests run: 7, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.019 sec - in org.axonframework.eventhandling.saga.AnnotatedSagaTest
Running org.axonframework.eventhandling.saga.metamodel.AnnotationSagaMetaModelFactoryTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.002 sec - in org.axonframework.eventhandling.saga.metamodel.AnnotationSagaMetaModelFactoryTest
Running org.axonframework.eventhandling.saga.repository.jpa.JpaSagaStoreTest
2018-10-09 11:21:03,087 [main] INFO  DefaultTestContextBootstrapper  - Loaded default TestExecutionListener class names from location [META-INF/spring.factories]: [org.springframework.test.context.web.ServletTestExecutionListener, org.springframework.test.context.support.DirtiesContextBeforeModesTestExecutionListener, org.springframework.test.context.support.DependencyInjectionTestExecutionListener, org.springframework.test.context.support.DirtiesContextTestExecutionListener, org.springframework.test.context.transaction.TransactionalTestExecutionListener, org.springframework.test.context.jdbc.SqlScriptsTestExecutionListener]
2018-10-09 11:21:03,088 [main] INFO  DefaultTestContextBootstrapper  - Using TestExecutionListeners: [org.springframework.test.context.support.DirtiesContextBeforeModesTestExecutionListener@7fa72332, org.springframework.test.context.support.DependencyInjectionTestExecutionListener@5a4736b8, org.springframework.test.context.support.DirtiesContextTestExecutionListener@70eb3b36, org.springframework.test.context.transaction.TransactionalTestExecutionListener@6b102ccf, org.springframework.test.context.jdbc.SqlScriptsTestExecutionListener@2de83c2c]
2018-10-09 11:21:03,089 [main] INFO  XmlBeanDefinitionReader         - Loading XML bean definitions from class path resource [META-INF/spring/saga-repository-test.xml]
2018-10-09 11:21:03,113 [main] INFO  XmlBeanDefinitionReader         - Loading XML bean definitions from class path resource [META-INF/spring/db-context.xml]
2018-10-09 11:21:03,135 [main] INFO  GenericApplicationContext       - Refreshing org.springframework.context.support.GenericApplicationContext@4e792ddf: startup date [Tue Oct 09 11:21:03 CEST 2018]; root of context hierarchy
2018-10-09 11:21:03,146 [main] INFO  redAnnotationBeanPostProcessor  - JSR-330 'javax.inject.Inject' annotation found and supported for autowiring
2018-10-09 11:21:03,175 [main] INFO  DriverManagerDataSource         - Loaded JDBC driver: org.hsqldb.jdbcDriver
2018-10-09 11:21:03,187 [main] INFO  tainerEntityManagerFactoryBean  - Building JPA container EntityManagerFactory for persistence unit 'eventStore'
2018-10-09 11:21:03,188 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-09 11:21:03,247 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-09 11:21:03,370 [main] WARN  EntityManagerFactoryRegistry    - HHH000436: Entity manager factory name (eventStore) is already registered.  If entity manager will be clustered or passivated, specify a unique value for property 'hibernate.ejb.entitymanager_factory_name'
2018-10-09 11:21:03,370 [main] INFO  tainerEntityManagerFactoryBean  - Initialized JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-09 11:21:03,419 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@75e6907c testClass = JpaSagaStoreTest, testInstance = org.axonframework.eventhandling.saga.repository.jpa.JpaSagaStoreTest@10b87c58, testMethod = testEndSaga@JpaSagaStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@7203a784 testClass = JpaSagaStoreTest, locations = '{classpath:/META-INF/spring/saga-repository-test.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@7050e135]; rollback [true]
2018-10-09 11:21:03,427 [main] INFO  ueryTranslatorFactoryInitiator  - HHH000397: Using ASTQueryTranslatorFactory
2018-10-09 11:21:03,469 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:03,486 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@75e6907c testClass = JpaSagaStoreTest, testInstance = org.axonframework.eventhandling.saga.repository.jpa.JpaSagaStoreTest@10b87c58, testMethod = testEndSaga@JpaSagaStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@7203a784 testClass = JpaSagaStoreTest, locations = '{classpath:/META-INF/spring/saga-repository-test.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-09 11:21:03,486 [main] INFO  GenericApplicationContext       - Closing org.springframework.context.support.GenericApplicationContext@4e792ddf: startup date [Tue Oct 09 11:21:03 CEST 2018]; root of context hierarchy
2018-10-09 11:21:03,486 [main] INFO  tainerEntityManagerFactoryBean  - Closing JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-09 11:21:03,487 [main] INFO  XmlBeanDefinitionReader         - Loading XML bean definitions from class path resource [META-INF/spring/saga-repository-test.xml]
2018-10-09 11:21:03,507 [main] INFO  XmlBeanDefinitionReader         - Loading XML bean definitions from class path resource [META-INF/spring/db-context.xml]
2018-10-09 11:21:03,526 [main] INFO  GenericApplicationContext       - Refreshing org.springframework.context.support.GenericApplicationContext@b6aa7e9: startup date [Tue Oct 09 11:21:03 CEST 2018]; root of context hierarchy
2018-10-09 11:21:03,538 [main] INFO  redAnnotationBeanPostProcessor  - JSR-330 'javax.inject.Inject' annotation found and supported for autowiring
2018-10-09 11:21:03,572 [main] INFO  DriverManagerDataSource         - Loaded JDBC driver: org.hsqldb.jdbcDriver
2018-10-09 11:21:03,580 [main] INFO  tainerEntityManagerFactoryBean  - Building JPA container EntityManagerFactory for persistence unit 'eventStore'
2018-10-09 11:21:03,581 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-09 11:21:03,627 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-09 11:21:03,728 [main] WARN  EntityManagerFactoryRegistry    - HHH000436: Entity manager factory name (eventStore) is already registered.  If entity manager will be clustered or passivated, specify a unique value for property 'hibernate.ejb.entitymanager_factory_name'
2018-10-09 11:21:03,728 [main] INFO  tainerEntityManagerFactoryBean  - Initialized JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-09 11:21:03,757 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@75e6907c testClass = JpaSagaStoreTest, testInstance = org.axonframework.eventhandling.saga.repository.jpa.JpaSagaStoreTest@4b238e69, testMethod = testAddingAnInactiveSagaDoesntStoreIt@JpaSagaStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@7203a784 testClass = JpaSagaStoreTest, locations = '{classpath:/META-INF/spring/saga-repository-test.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@301f5aaf]; rollback [true]
2018-10-09 11:21:03,759 [main] INFO  ueryTranslatorFactoryInitiator  - HHH000397: Using ASTQueryTranslatorFactory
2018-10-09 11:21:03,779 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@75e6907c testClass = JpaSagaStoreTest, testInstance = org.axonframework.eventhandling.saga.repository.jpa.JpaSagaStoreTest@4b238e69, testMethod = testAddingAnInactiveSagaDoesntStoreIt@JpaSagaStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@7203a784 testClass = JpaSagaStoreTest, locations = '{classpath:/META-INF/spring/saga-repository-test.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-09 11:21:03,779 [main] INFO  GenericApplicationContext       - Closing org.springframework.context.support.GenericApplicationContext@b6aa7e9: startup date [Tue Oct 09 11:21:03 CEST 2018]; root of context hierarchy
2018-10-09 11:21:03,779 [main] INFO  tainerEntityManagerFactoryBean  - Closing JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-09 11:21:03,780 [main] INFO  XmlBeanDefinitionReader         - Loading XML bean definitions from class path resource [META-INF/spring/saga-repository-test.xml]
2018-10-09 11:21:03,794 [main] INFO  XmlBeanDefinitionReader         - Loading XML bean definitions from class path resource [META-INF/spring/db-context.xml]
2018-10-09 11:21:03,808 [main] INFO  GenericApplicationContext       - Refreshing org.springframework.context.support.GenericApplicationContext@199c7a22: startup date [Tue Oct 09 11:21:03 CEST 2018]; root of context hierarchy
2018-10-09 11:21:03,816 [main] INFO  redAnnotationBeanPostProcessor  - JSR-330 'javax.inject.Inject' annotation found and supported for autowiring
2018-10-09 11:21:03,844 [main] INFO  DriverManagerDataSource         - Loaded JDBC driver: org.hsqldb.jdbcDriver
2018-10-09 11:21:03,857 [main] INFO  tainerEntityManagerFactoryBean  - Building JPA container EntityManagerFactory for persistence unit 'eventStore'
2018-10-09 11:21:03,857 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-09 11:21:03,908 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-09 11:21:04,019 [main] WARN  EntityManagerFactoryRegistry    - HHH000436: Entity manager factory name (eventStore) is already registered.  If entity manager will be clustered or passivated, specify a unique value for property 'hibernate.ejb.entitymanager_factory_name'
2018-10-09 11:21:04,019 [main] INFO  tainerEntityManagerFactoryBean  - Initialized JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-09 11:21:04,047 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@75e6907c testClass = JpaSagaStoreTest, testInstance = org.axonframework.eventhandling.saga.repository.jpa.JpaSagaStoreTest@6f889214, testMethod = testLoadSaga_AssociationValueRemoved@JpaSagaStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@7203a784 testClass = JpaSagaStoreTest, locations = '{classpath:/META-INF/spring/saga-repository-test.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@30511454]; rollback [true]
2018-10-09 11:21:04,051 [main] INFO  ueryTranslatorFactoryInitiator  - HHH000397: Using ASTQueryTranslatorFactory
2018-10-09 11:21:04,114 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@75e6907c testClass = JpaSagaStoreTest, testInstance = org.axonframework.eventhandling.saga.repository.jpa.JpaSagaStoreTest@6f889214, testMethod = testLoadSaga_AssociationValueRemoved@JpaSagaStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@7203a784 testClass = JpaSagaStoreTest, locations = '{classpath:/META-INF/spring/saga-repository-test.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-09 11:21:04,114 [main] INFO  GenericApplicationContext       - Closing org.springframework.context.support.GenericApplicationContext@199c7a22: startup date [Tue Oct 09 11:21:03 CEST 2018]; root of context hierarchy
2018-10-09 11:21:04,115 [main] INFO  tainerEntityManagerFactoryBean  - Closing JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-09 11:21:04,116 [main] INFO  XmlBeanDefinitionReader         - Loading XML bean definitions from class path resource [META-INF/spring/saga-repository-test.xml]
2018-10-09 11:21:04,154 [main] INFO  XmlBeanDefinitionReader         - Loading XML bean definitions from class path resource [META-INF/spring/db-context.xml]
2018-10-09 11:21:04,180 [main] INFO  GenericApplicationContext       - Refreshing org.springframework.context.support.GenericApplicationContext@5a6e1f51: startup date [Tue Oct 09 11:21:04 CEST 2018]; root of context hierarchy
2018-10-09 11:21:04,195 [main] INFO  redAnnotationBeanPostProcessor  - JSR-330 'javax.inject.Inject' annotation found and supported for autowiring
2018-10-09 11:21:04,271 [main] INFO  DriverManagerDataSource         - Loaded JDBC driver: org.hsqldb.jdbcDriver
2018-10-09 11:21:04,287 [main] INFO  tainerEntityManagerFactoryBean  - Building JPA container EntityManagerFactory for persistence unit 'eventStore'
2018-10-09 11:21:04,287 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-09 11:21:04,373 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-09 11:21:04,473 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:04,531 [main] WARN  EntityManagerFactoryRegistry    - HHH000436: Entity manager factory name (eventStore) is already registered.  If entity manager will be clustered or passivated, specify a unique value for property 'hibernate.ejb.entitymanager_factory_name'
2018-10-09 11:21:04,532 [main] INFO  tainerEntityManagerFactoryBean  - Initialized JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-09 11:21:04,588 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@75e6907c testClass = JpaSagaStoreTest, testInstance = org.axonframework.eventhandling.saga.repository.jpa.JpaSagaStoreTest@c6ca1, testMethod = testStoreSagaWithCustomEntity@JpaSagaStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@7203a784 testClass = JpaSagaStoreTest, locations = '{classpath:/META-INF/spring/saga-repository-test.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@543211ac]; rollback [true]
2018-10-09 11:21:04,598 [main] INFO  ueryTranslatorFactoryInitiator  - HHH000397: Using ASTQueryTranslatorFactory
2018-10-09 11:21:04,647 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@75e6907c testClass = JpaSagaStoreTest, testInstance = org.axonframework.eventhandling.saga.repository.jpa.JpaSagaStoreTest@c6ca1, testMethod = testStoreSagaWithCustomEntity@JpaSagaStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@7203a784 testClass = JpaSagaStoreTest, locations = '{classpath:/META-INF/spring/saga-repository-test.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-09 11:21:04,648 [main] INFO  GenericApplicationContext       - Closing org.springframework.context.support.GenericApplicationContext@5a6e1f51: startup date [Tue Oct 09 11:21:04 CEST 2018]; root of context hierarchy
2018-10-09 11:21:04,648 [main] INFO  tainerEntityManagerFactoryBean  - Closing JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-09 11:21:04,649 [main] INFO  XmlBeanDefinitionReader         - Loading XML bean definitions from class path resource [META-INF/spring/saga-repository-test.xml]
2018-10-09 11:21:04,663 [main] INFO  XmlBeanDefinitionReader         - Loading XML bean definitions from class path resource [META-INF/spring/db-context.xml]
2018-10-09 11:21:04,676 [main] INFO  GenericApplicationContext       - Refreshing org.springframework.context.support.GenericApplicationContext@4d52119c: startup date [Tue Oct 09 11:21:04 CEST 2018]; root of context hierarchy
2018-10-09 11:21:04,689 [main] INFO  redAnnotationBeanPostProcessor  - JSR-330 'javax.inject.Inject' annotation found and supported for autowiring
2018-10-09 11:21:04,728 [main] INFO  DriverManagerDataSource         - Loaded JDBC driver: org.hsqldb.jdbcDriver
2018-10-09 11:21:04,739 [main] INFO  tainerEntityManagerFactoryBean  - Building JPA container EntityManagerFactory for persistence unit 'eventStore'
2018-10-09 11:21:04,739 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-09 11:21:04,806 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-09 11:21:04,946 [main] WARN  EntityManagerFactoryRegistry    - HHH000436: Entity manager factory name (eventStore) is already registered.  If entity manager will be clustered or passivated, specify a unique value for property 'hibernate.ejb.entitymanager_factory_name'
2018-10-09 11:21:04,947 [main] INFO  tainerEntityManagerFactoryBean  - Initialized JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-09 11:21:04,990 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@75e6907c testClass = JpaSagaStoreTest, testInstance = org.axonframework.eventhandling.saga.repository.jpa.JpaSagaStoreTest@4f25fe6e, testMethod = testAddAndLoadSaga_ByAssociationValue@JpaSagaStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@7203a784 testClass = JpaSagaStoreTest, locations = '{classpath:/META-INF/spring/saga-repository-test.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@34ec4134]; rollback [true]
2018-10-09 11:21:04,994 [main] INFO  ueryTranslatorFactoryInitiator  - HHH000397: Using ASTQueryTranslatorFactory
2018-10-09 11:21:05,027 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@75e6907c testClass = JpaSagaStoreTest, testInstance = org.axonframework.eventhandling.saga.repository.jpa.JpaSagaStoreTest@4f25fe6e, testMethod = testAddAndLoadSaga_ByAssociationValue@JpaSagaStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@7203a784 testClass = JpaSagaStoreTest, locations = '{classpath:/META-INF/spring/saga-repository-test.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-09 11:21:05,028 [main] INFO  GenericApplicationContext       - Closing org.springframework.context.support.GenericApplicationContext@4d52119c: startup date [Tue Oct 09 11:21:04 CEST 2018]; root of context hierarchy
2018-10-09 11:21:05,028 [main] INFO  tainerEntityManagerFactoryBean  - Closing JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-09 11:21:05,029 [main] INFO  XmlBeanDefinitionReader         - Loading XML bean definitions from class path resource [META-INF/spring/saga-repository-test.xml]
2018-10-09 11:21:05,044 [main] INFO  XmlBeanDefinitionReader         - Loading XML bean definitions from class path resource [META-INF/spring/db-context.xml]
2018-10-09 11:21:05,061 [main] INFO  GenericApplicationContext       - Refreshing org.springframework.context.support.GenericApplicationContext@5af08862: startup date [Tue Oct 09 11:21:05 CEST 2018]; root of context hierarchy
2018-10-09 11:21:05,072 [main] INFO  redAnnotationBeanPostProcessor  - JSR-330 'javax.inject.Inject' annotation found and supported for autowiring
2018-10-09 11:21:05,106 [main] INFO  DriverManagerDataSource         - Loaded JDBC driver: org.hsqldb.jdbcDriver
2018-10-09 11:21:05,114 [main] INFO  tainerEntityManagerFactoryBean  - Building JPA container EntityManagerFactory for persistence unit 'eventStore'
2018-10-09 11:21:05,114 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-09 11:21:05,159 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-09 11:21:05,289 [main] WARN  EntityManagerFactoryRegistry    - HHH000436: Entity manager factory name (eventStore) is already registered.  If entity manager will be clustered or passivated, specify a unique value for property 'hibernate.ejb.entitymanager_factory_name'
2018-10-09 11:21:05,289 [main] INFO  tainerEntityManagerFactoryBean  - Initialized JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-09 11:21:05,333 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@75e6907c testClass = JpaSagaStoreTest, testInstance = org.axonframework.eventhandling.saga.repository.jpa.JpaSagaStoreTest@654d7914, testMethod = testAddAndLoadSaga_ByIdentifier@JpaSagaStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@7203a784 testClass = JpaSagaStoreTest, locations = '{classpath:/META-INF/spring/saga-repository-test.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@4e51a9f3]; rollback [true]
2018-10-09 11:21:05,336 [main] INFO  ueryTranslatorFactoryInitiator  - HHH000397: Using ASTQueryTranslatorFactory
2018-10-09 11:21:05,358 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@75e6907c testClass = JpaSagaStoreTest, testInstance = org.axonframework.eventhandling.saga.repository.jpa.JpaSagaStoreTest@654d7914, testMethod = testAddAndLoadSaga_ByIdentifier@JpaSagaStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@7203a784 testClass = JpaSagaStoreTest, locations = '{classpath:/META-INF/spring/saga-repository-test.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-09 11:21:05,358 [main] INFO  GenericApplicationContext       - Closing org.springframework.context.support.GenericApplicationContext@5af08862: startup date [Tue Oct 09 11:21:05 CEST 2018]; root of context hierarchy
2018-10-09 11:21:05,358 [main] INFO  tainerEntityManagerFactoryBean  - Closing JPA EntityManagerFactory for persistence unit 'eventStore'
Tests run: 6, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 2.274 sec - in org.axonframework.eventhandling.saga.repository.jpa.JpaSagaStoreTest
Running org.axonframework.eventhandling.saga.repository.jdbc.JdbcSagaStoreTest
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.097 sec - in org.axonframework.eventhandling.saga.repository.jdbc.JdbcSagaStoreTest
Running org.axonframework.eventhandling.saga.repository.CachingSagaStoreTest
2018-10-09 11:21:05,477 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.156 sec - in org.axonframework.eventhandling.saga.repository.CachingSagaStoreTest
Running org.axonframework.eventhandling.saga.repository.LockingSagaRepositoryTest
Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.044 sec - in org.axonframework.eventhandling.saga.repository.LockingSagaRepositoryTest
Running org.axonframework.eventhandling.saga.repository.AnnotatedSagaRepositoryTest
Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.005 sec - in org.axonframework.eventhandling.saga.repository.AnnotatedSagaRepositoryTest
Running org.axonframework.eventhandling.saga.repository.AssociationValueMapTest
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.064 sec - in org.axonframework.eventhandling.saga.repository.AssociationValueMapTest
Running org.axonframework.eventhandling.saga.AnnotatedSagaManagerTest
Tests run: 11, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.065 sec - in org.axonframework.eventhandling.saga.AnnotatedSagaManagerTest
Running org.axonframework.eventhandling.saga.SimpleResourceInjectorTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.003 sec - in org.axonframework.eventhandling.saga.SimpleResourceInjectorTest
Running org.axonframework.eventhandling.saga.AssociationValuesImplTest
Tests run: 8, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 sec - in org.axonframework.eventhandling.saga.AssociationValuesImplTest
Running org.axonframework.eventhandling.saga.SagaManagerTest
Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.007 sec - in org.axonframework.eventhandling.saga.SagaManagerTest
Running org.axonframework.eventhandling.SegmentTest
2018-10-09 11:21:06,480 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:07,481 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
Tests run: 11, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 2.458 sec - in org.axonframework.eventhandling.SegmentTest
Running org.axonframework.eventhandling.TrackingEventProcessorTest_MultiThreaded
2018-10-09 11:21:08,482 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:08,515 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-09 11:21:08,525 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Dispatching new tracking segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/1]}
2018-10-09 11:21:08,525 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[1/1]}
2018-10-09 11:21:08,525 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=2} for segment: Segment[1/1]
2018-10-09 11:21:08,526 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=1} for segment: Segment[0/1]
2018-10-09 11:21:08,527 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-09 11:21:09,482 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:09,530 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Dispatching new tracking segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-09 11:21:09,530 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=0} for segment: Segment[0/0]
2018-10-09 11:21:09,533 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-09 11:21:10,483 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:10,535 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Dispatching new tracking segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/1]}
2018-10-09 11:21:10,535 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[1/1]}
2018-10-09 11:21:10,535 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=-1} for segment: Segment[1/1]
2018-10-09 11:21:10,536 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=-1} for segment: Segment[0/1]
2018-10-09 11:21:10,541 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-09 11:21:11,484 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:11,546 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Dispatching new tracking segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/1]}
2018-10-09 11:21:11,546 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[1/1]}
2018-10-09 11:21:11,546 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=-1} for segment: Segment[1/1]
2018-10-09 11:21:11,546 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=-1} for segment: Segment[0/1]
2018-10-09 11:21:11,550 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-09 11:21:12,484 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:12,553 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/1]}
2018-10-09 11:21:12,553 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=1} for segment: Segment[0/1]
2018-10-09 11:21:12,753 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-09 11:21:13,485 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:13,556 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Dispatching new tracking segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/3]}
2018-10-09 11:21:13,556 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[1/1]}
2018-10-09 11:21:13,556 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=-1} for segment: Segment[1/1]
2018-10-09 11:21:13,556 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=-1} for segment: Segment[0/3]
2018-10-09 11:21:13,561 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-09 11:21:13,563 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Dispatching new tracking segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/3]}
2018-10-09 11:21:13,563 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[1/1]}
2018-10-09 11:21:13,563 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=2} for segment: Segment[1/1]
2018-10-09 11:21:13,564 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=1} for segment: Segment[0/3]
2018-10-09 11:21:14,486 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:14,564 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - No Worker Launcher active. Using current thread to assign segments.
2018-10-09 11:21:14,564 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[2/3]}
2018-10-09 11:21:14,565 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=2} for segment: Segment[2/3]
2018-10-09 11:21:14,565 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-09 11:21:15,486 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:15,567 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Dispatching new tracking segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/3]}
2018-10-09 11:21:15,567 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[1/3]}
2018-10-09 11:21:15,567 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[1/3]
2018-10-09 11:21:15,567 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[0/3]
2018-10-09 11:21:15,766 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-09 11:21:16,487 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:16,570 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-09 11:21:16,570 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=-1} for segment: Segment[0/0]
2018-10-09 11:21:16,573 [EventProcessor[test]-0] WARN  TrackingEventProcessor          - Error occurred. Starting retry mode.
org.axonframework.common.MockException: Mock
2018-10-09 11:21:16,573 [EventProcessor[test]-0] WARN  TrackingEventProcessor          - Releasing claim on token and preparing for retry in 1s
2018-10-09 11:21:17,488 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:17,575 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=-1} for segment: Segment[0/0]
2018-10-09 11:21:17,577 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-09 11:21:18,488 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:18,580 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Dispatching new tracking segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/1]}
2018-10-09 11:21:18,580 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[1/1]}
2018-10-09 11:21:18,580 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=-1} for segment: Segment[1/1]
2018-10-09 11:21:18,580 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=-1} for segment: Segment[0/1]
2018-10-09 11:21:18,586 [Time-limited test] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-09 11:21:19,489 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:19,590 [EventProcessor[test]-2] INFO  TrackingEventProcessor          - Dispatching new tracking segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/1]}
2018-10-09 11:21:19,591 [EventProcessor[test]-2] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[1/1]}
2018-10-09 11:21:19,591 [EventProcessor[test]-2] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=1} for segment: Segment[1/1]
2018-10-09 11:21:19,591 [EventProcessor[test]-3] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=1} for segment: Segment[0/1]
2018-10-09 11:21:19,595 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-09 11:21:20,490 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:20,596 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Dispatching new tracking segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/1]}
2018-10-09 11:21:20,597 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[1/1]}
2018-10-09 11:21:20,597 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[1/1]
2018-10-09 11:21:20,597 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[0/1]
2018-10-09 11:21:20,598 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-09 11:21:21,490 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:21,602 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Dispatching new tracking segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/7]}
2018-10-09 11:21:21,603 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Dispatching new tracking segment worker: TrackingSegmentWorker{processor=test, segment=Segment[1/7]}
2018-10-09 11:21:21,603 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[0/7]
2018-10-09 11:21:21,604 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Dispatching new tracking segment worker: TrackingSegmentWorker{processor=test, segment=Segment[2/3]}
2018-10-09 11:21:21,604 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Dispatching new tracking segment worker: TrackingSegmentWorker{processor=test, segment=Segment[3/3]}
2018-10-09 11:21:21,604 [EventProcessor[test]-2] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[1/7]
2018-10-09 11:21:21,605 [EventProcessor[test]-3] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[2/3]
2018-10-09 11:21:21,605 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Dispatching new tracking segment worker: TrackingSegmentWorker{processor=test, segment=Segment[4/7]}
2018-10-09 11:21:21,606 [EventProcessor[test]-4] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[3/3]
2018-10-09 11:21:21,606 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[5/7]}
2018-10-09 11:21:21,606 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[5/7]
2018-10-09 11:21:21,606 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-09 11:21:22,491 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:22,609 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Dispatching new tracking segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/1]}
2018-10-09 11:21:22,610 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[1/1]}
2018-10-09 11:21:22,610 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=-1} for segment: Segment[1/1]
2018-10-09 11:21:22,610 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=-1} for segment: Segment[0/1]
2018-10-09 11:21:22,615 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-09 11:21:23,492 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:23,619 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Dispatching new tracking segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/1]}
2018-10-09 11:21:23,619 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[1/1]}
2018-10-09 11:21:23,619 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=2} for segment: Segment[1/1]
2018-10-09 11:21:23,619 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=1} for segment: Segment[0/1]
2018-10-09 11:21:23,823 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-09 11:21:24,493 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
Tests run: 15, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 16.553 sec - in org.axonframework.eventhandling.TrackingEventProcessorTest_MultiThreaded
Running org.axonframework.eventhandling.scheduling.quartz.DirectEventJobDataBinderTest
Tests run: 6, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.079 sec - in org.axonframework.eventhandling.scheduling.quartz.DirectEventJobDataBinderTest
Running org.axonframework.eventhandling.scheduling.quartz.QuartzEventSchedulerTest
2018-10-09 11:21:24,933 [main] INFO  StdSchedulerFactory             - Using default implementation for ThreadExecutor
2018-10-09 11:21:24,935 [main] INFO  SimpleThreadPool                - Job execution threads will use class loader of thread: main
2018-10-09 11:21:24,947 [main] INFO  SchedulerSignalerImpl           - Initialized Scheduler Signaller of type: class org.quartz.core.SchedulerSignalerImpl
2018-10-09 11:21:24,948 [main] INFO  QuartzScheduler                 - Quartz Scheduler v.2.2.1 created.
2018-10-09 11:21:24,949 [main] INFO  RAMJobStore                     - RAMJobStore initialized.
2018-10-09 11:21:24,949 [main] INFO  QuartzScheduler                 - Scheduler meta-data: Quartz Scheduler (v2.2.1) 'DefaultQuartzScheduler' with instanceId 'NON_CLUSTERED'
  Scheduler class: 'org.quartz.core.QuartzScheduler' - running locally.
  NOT STARTED.
  Currently in standby mode.
  Number of jobs executed: 0
  Using thread pool 'org.quartz.simpl.SimpleThreadPool' - with 10 threads.
  Using job-store 'org.quartz.simpl.RAMJobStore' - which does not support persistence. and is not clustered.

2018-10-09 11:21:24,949 [main] INFO  StdSchedulerFactory             - Quartz scheduler 'DefaultQuartzScheduler' initialized from default resource file in Quartz package: 'quartz.properties'
2018-10-09 11:21:24,949 [main] INFO  StdSchedulerFactory             - Quartz scheduler version: 2.2.1
2018-10-09 11:21:24,950 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
2018-10-09 11:21:25,005 [DefaultQuartzScheduler_Worker-1] INFO  FireEventJob                    - Job successfully executed. Scheduled Event [Object] has been published.
2018-10-09 11:21:25,007 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED shutting down.
2018-10-09 11:21:25,007 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED paused.
2018-10-09 11:21:25,444 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED shutdown complete.
2018-10-09 11:21:25,447 [main] INFO  StdSchedulerFactory             - Using default implementation for ThreadExecutor
2018-10-09 11:21:25,447 [main] INFO  SimpleThreadPool                - Job execution threads will use class loader of thread: main
2018-10-09 11:21:25,449 [main] INFO  SchedulerSignalerImpl           - Initialized Scheduler Signaller of type: class org.quartz.core.SchedulerSignalerImpl
2018-10-09 11:21:25,449 [main] INFO  QuartzScheduler                 - Quartz Scheduler v.2.2.1 created.
2018-10-09 11:21:25,449 [main] INFO  RAMJobStore                     - RAMJobStore initialized.
2018-10-09 11:21:25,449 [main] INFO  QuartzScheduler                 - Scheduler meta-data: Quartz Scheduler (v2.2.1) 'DefaultQuartzScheduler' with instanceId 'NON_CLUSTERED'
  Scheduler class: 'org.quartz.core.QuartzScheduler' - running locally.
  NOT STARTED.
  Currently in standby mode.
  Number of jobs executed: 0
  Using thread pool 'org.quartz.simpl.SimpleThreadPool' - with 10 threads.
  Using job-store 'org.quartz.simpl.RAMJobStore' - which does not support persistence. and is not clustered.

2018-10-09 11:21:25,449 [main] INFO  StdSchedulerFactory             - Quartz scheduler 'DefaultQuartzScheduler' initialized from default resource file in Quartz package: 'quartz.properties'
2018-10-09 11:21:25,449 [main] INFO  StdSchedulerFactory             - Quartz scheduler version: 2.2.1
2018-10-09 11:21:25,449 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
2018-10-09 11:21:25,494 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:25,499 [DefaultQuartzScheduler_Worker-1] ERROR FireEventJob                    - Exception occurred while publishing scheduled event [java.lang.Object]
org.axonframework.common.MockException: Mock
2018-10-09 11:21:25,503 [DefaultQuartzScheduler_Worker-1] INFO  JobRunShell                     - Job TestGroup.event-ad36f1cd-a233-4e6e-b792-83acdbdd4bd1 threw a JobExecutionException: 
org.quartz.JobExecutionException: org.axonframework.common.MockException: Mock [See nested exception: org.axonframework.common.MockException: Mock]
	at org.axonframework.eventhandling.scheduling.quartz.FireEventJob.execute(FireEventJob.java:87)
	at org.quartz.core.JobRunShell.run(JobRunShell.java:202)
	at org.quartz.simpl.SimpleThreadPool$WorkerThread.run(SimpleThreadPool.java:573)
Caused by: org.axonframework.common.MockException: Mock
2018-10-09 11:21:25,503 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED shutting down.
2018-10-09 11:21:25,505 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED paused.
2018-10-09 11:21:26,005 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED shutdown complete.
2018-10-09 11:21:26,009 [main] INFO  StdSchedulerFactory             - Using default implementation for ThreadExecutor
2018-10-09 11:21:26,009 [main] INFO  SimpleThreadPool                - Job execution threads will use class loader of thread: main
2018-10-09 11:21:26,010 [main] INFO  SchedulerSignalerImpl           - Initialized Scheduler Signaller of type: class org.quartz.core.SchedulerSignalerImpl
2018-10-09 11:21:26,011 [main] INFO  QuartzScheduler                 - Quartz Scheduler v.2.2.1 created.
2018-10-09 11:21:26,011 [main] INFO  RAMJobStore                     - RAMJobStore initialized.
2018-10-09 11:21:26,011 [main] INFO  QuartzScheduler                 - Scheduler meta-data: Quartz Scheduler (v2.2.1) 'DefaultQuartzScheduler' with instanceId 'NON_CLUSTERED'
  Scheduler class: 'org.quartz.core.QuartzScheduler' - running locally.
  NOT STARTED.
  Currently in standby mode.
  Number of jobs executed: 0
  Using thread pool 'org.quartz.simpl.SimpleThreadPool' - with 10 threads.
  Using job-store 'org.quartz.simpl.RAMJobStore' - which does not support persistence. and is not clustered.

2018-10-09 11:21:26,011 [main] INFO  StdSchedulerFactory             - Quartz scheduler 'DefaultQuartzScheduler' initialized from default resource file in Quartz package: 'quartz.properties'
2018-10-09 11:21:26,011 [main] INFO  StdSchedulerFactory             - Quartz scheduler version: 2.2.1
2018-10-09 11:21:26,011 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
2018-10-09 11:21:26,057 [DefaultQuartzScheduler_Worker-1] INFO  FireEventJob                    - Job successfully executed. Scheduled Event [Object] has been published.
2018-10-09 11:21:26,062 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED shutting down.
2018-10-09 11:21:26,062 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED paused.
2018-10-09 11:21:26,494 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:26,561 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED shutdown complete.
2018-10-09 11:21:26,565 [main] INFO  StdSchedulerFactory             - Using default implementation for ThreadExecutor
2018-10-09 11:21:26,565 [main] INFO  SimpleThreadPool                - Job execution threads will use class loader of thread: main
2018-10-09 11:21:26,566 [main] INFO  SchedulerSignalerImpl           - Initialized Scheduler Signaller of type: class org.quartz.core.SchedulerSignalerImpl
2018-10-09 11:21:26,566 [main] INFO  QuartzScheduler                 - Quartz Scheduler v.2.2.1 created.
2018-10-09 11:21:26,566 [main] INFO  RAMJobStore                     - RAMJobStore initialized.
2018-10-09 11:21:26,566 [main] INFO  QuartzScheduler                 - Scheduler meta-data: Quartz Scheduler (v2.2.1) 'DefaultQuartzScheduler' with instanceId 'NON_CLUSTERED'
  Scheduler class: 'org.quartz.core.QuartzScheduler' - running locally.
  NOT STARTED.
  Currently in standby mode.
  Number of jobs executed: 0
  Using thread pool 'org.quartz.simpl.SimpleThreadPool' - with 10 threads.
  Using job-store 'org.quartz.simpl.RAMJobStore' - which does not support persistence. and is not clustered.

2018-10-09 11:21:26,567 [main] INFO  StdSchedulerFactory             - Quartz scheduler 'DefaultQuartzScheduler' initialized from default resource file in Quartz package: 'quartz.properties'
2018-10-09 11:21:26,567 [main] INFO  StdSchedulerFactory             - Quartz scheduler version: 2.2.1
2018-10-09 11:21:26,567 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
2018-10-09 11:21:26,573 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED shutting down.
2018-10-09 11:21:26,573 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED paused.
2018-10-09 11:21:27,071 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED shutdown complete.
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 2.167 sec - in org.axonframework.eventhandling.scheduling.quartz.QuartzEventSchedulerTest
Running org.axonframework.eventhandling.scheduling.ScheduleTokenJacksonSerializationTest
Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.007 sec - in org.axonframework.eventhandling.scheduling.ScheduleTokenJacksonSerializationTest
Running org.axonframework.eventhandling.scheduling.java.SimpleEventSchedulerTest
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.158 sec - in org.axonframework.eventhandling.scheduling.java.SimpleEventSchedulerTest
Running org.axonframework.eventhandling.replay.ReplayAwareMessageHandlerWrapperTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.003 sec - in org.axonframework.eventhandling.replay.ReplayAwareMessageHandlerWrapperTest
Running org.axonframework.eventhandling.replay.ReplayParameterResolverFactoryTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 sec - in org.axonframework.eventhandling.replay.ReplayParameterResolverFactoryTest
Running org.axonframework.eventhandling.tokenstore.jdbc.JdbcTokenStoreTest
2018-10-09 11:21:27,250 [main] INFO  AbstractContextLoader           - Could not detect default resource locations for test class [org.axonframework.eventhandling.tokenstore.jdbc.JdbcTokenStoreTest]: no resource found for suffixes {-context.xml}.
2018-10-09 11:21:27,252 [main] INFO  ctDelegatingSmartContextLoader  - AnnotationConfigContextLoader detected default configuration classes for context configuration [ContextConfigurationAttributes@3a37d3b6 declaringClass = 'org.axonframework.eventhandling.tokenstore.jdbc.JdbcTokenStoreTest', classes = '{class org.axonframework.eventhandling.tokenstore.jdbc.JdbcTokenStoreTest$Context}', locations = '{}', inheritLocations = true, initializers = '{}', inheritInitializers = true, name = [null], contextLoaderClass = 'org.springframework.test.context.ContextLoader'].
2018-10-09 11:21:27,252 [main] INFO  DefaultTestContextBootstrapper  - Loaded default TestExecutionListener class names from location [META-INF/spring.factories]: [org.springframework.test.context.web.ServletTestExecutionListener, org.springframework.test.context.support.DirtiesContextBeforeModesTestExecutionListener, org.springframework.test.context.support.DependencyInjectionTestExecutionListener, org.springframework.test.context.support.DirtiesContextTestExecutionListener, org.springframework.test.context.transaction.TransactionalTestExecutionListener, org.springframework.test.context.jdbc.SqlScriptsTestExecutionListener]
2018-10-09 11:21:27,253 [main] INFO  DefaultTestContextBootstrapper  - Using TestExecutionListeners: [org.springframework.test.context.support.DirtiesContextBeforeModesTestExecutionListener@2a69158a, org.springframework.test.context.support.DependencyInjectionTestExecutionListener@1b5a471d, org.springframework.test.context.support.DirtiesContextTestExecutionListener@1ff49da3, org.springframework.test.context.transaction.TransactionalTestExecutionListener@68fbb22, org.springframework.test.context.jdbc.SqlScriptsTestExecutionListener@64a82b3c]
2018-10-09 11:21:27,254 [main] INFO  GenericApplicationContext       - Refreshing org.springframework.context.support.GenericApplicationContext@16a1738d: startup date [Tue Oct 09 11:21:27 CEST 2018]; root of context hierarchy
2018-10-09 11:21:27,262 [main] INFO  redAnnotationBeanPostProcessor  - JSR-330 'javax.inject.Inject' annotation found and supported for autowiring
2018-10-09 11:21:27,393 [main] WARN  JdbcTokenStore                  - Releasing claim of token stealing/0 failed. It was owned by another node.
2018-10-09 11:21:27,410 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@48d74bb4 testClass = JdbcTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jdbc.JdbcTokenStoreTest@467c9ad9, testMethod = testInitializeTokensWhileAlreadyPresent@JdbcTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1b1d9369 testClass = JdbcTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jdbc.JdbcTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.jdbc.datasource.DataSourceTransactionManager@7787cbcd]; rollback [true]
2018-10-09 11:21:27,416 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@48d74bb4 testClass = JdbcTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jdbc.JdbcTokenStoreTest@467c9ad9, testMethod = testInitializeTokensWhileAlreadyPresent@JdbcTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1b1d9369 testClass = JdbcTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jdbc.JdbcTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-09 11:21:27,421 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@48d74bb4 testClass = JdbcTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jdbc.JdbcTokenStoreTest@6eeee66f, testMethod = testInitializeTokens@JdbcTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1b1d9369 testClass = JdbcTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jdbc.JdbcTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.jdbc.datasource.DataSourceTransactionManager@7787cbcd]; rollback [true]
2018-10-09 11:21:27,426 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@48d74bb4 testClass = JdbcTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jdbc.JdbcTokenStoreTest@6eeee66f, testMethod = testInitializeTokens@JdbcTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1b1d9369 testClass = JdbcTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jdbc.JdbcTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-09 11:21:27,428 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@48d74bb4 testClass = JdbcTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jdbc.JdbcTokenStoreTest@2fa5ce67, testMethod = testQuerySegments@JdbcTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1b1d9369 testClass = JdbcTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jdbc.JdbcTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.jdbc.datasource.DataSourceTransactionManager@7787cbcd]; rollback [true]
2018-10-09 11:21:27,437 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@48d74bb4 testClass = JdbcTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jdbc.JdbcTokenStoreTest@2fa5ce67, testMethod = testQuerySegments@JdbcTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1b1d9369 testClass = JdbcTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jdbc.JdbcTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-09 11:21:27,453 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@48d74bb4 testClass = JdbcTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jdbc.JdbcTokenStoreTest@5c56cb6d, testMethod = testInitializeTokensAtGivenPosition@JdbcTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1b1d9369 testClass = JdbcTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jdbc.JdbcTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.jdbc.datasource.DataSourceTransactionManager@7787cbcd]; rollback [true]
2018-10-09 11:21:27,464 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@48d74bb4 testClass = JdbcTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jdbc.JdbcTokenStoreTest@5c56cb6d, testMethod = testInitializeTokensAtGivenPosition@JdbcTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@1b1d9369 testClass = JdbcTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jdbc.JdbcTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
Tests run: 11, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.226 sec - in org.axonframework.eventhandling.tokenstore.jdbc.JdbcTokenStoreTest
Running org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest
2018-10-09 11:21:27,481 [main] INFO  AbstractContextLoader           - Could not detect default resource locations for test class [org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest]: no resource found for suffixes {-context.xml}.
2018-10-09 11:21:27,482 [main] INFO  ctDelegatingSmartContextLoader  - AnnotationConfigContextLoader detected default configuration classes for context configuration [ContextConfigurationAttributes@259fabf7 declaringClass = 'org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest', classes = '{class org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest$Context}', locations = '{}', inheritLocations = true, initializers = '{}', inheritInitializers = true, name = [null], contextLoaderClass = 'org.springframework.test.context.ContextLoader'].
2018-10-09 11:21:27,482 [main] INFO  DefaultTestContextBootstrapper  - Loaded default TestExecutionListener class names from location [META-INF/spring.factories]: [org.springframework.test.context.web.ServletTestExecutionListener, org.springframework.test.context.support.DirtiesContextBeforeModesTestExecutionListener, org.springframework.test.context.support.DependencyInjectionTestExecutionListener, org.springframework.test.context.support.DirtiesContextTestExecutionListener, org.springframework.test.context.transaction.TransactionalTestExecutionListener, org.springframework.test.context.jdbc.SqlScriptsTestExecutionListener]
2018-10-09 11:21:27,483 [main] INFO  DefaultTestContextBootstrapper  - Using TestExecutionListeners: [org.springframework.test.context.support.DirtiesContextBeforeModesTestExecutionListener@68db2d5c, org.springframework.test.context.support.DependencyInjectionTestExecutionListener@29863c20, org.springframework.test.context.support.DirtiesContextTestExecutionListener@25d18a01, org.springframework.test.context.transaction.TransactionalTestExecutionListener@7dc95d5f, org.springframework.test.context.jdbc.SqlScriptsTestExecutionListener@4cc93e77]
2018-10-09 11:21:27,484 [main] INFO  GenericApplicationContext       - Refreshing org.springframework.context.support.GenericApplicationContext@7d1e75f7: startup date [Tue Oct 09 11:21:27 CEST 2018]; root of context hierarchy
2018-10-09 11:21:27,495 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:27,499 [main] INFO  redAnnotationBeanPostProcessor  - JSR-330 'javax.inject.Inject' annotation found and supported for autowiring
2018-10-09 11:21:27,524 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-09 11:21:27,556 [main] INFO  tainerEntityManagerFactoryBean  - Building JPA container EntityManagerFactory for persistence unit 'default'
2018-10-09 11:21:27,556 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: default
	...]
2018-10-09 11:21:27,655 [main] WARN  connections                     - HHH10001002: Using Hibernate built-in connection pool (not for production use!)
2018-10-09 11:21:27,655 [main] INFO  connections                     - HHH10001005: using driver [null] at URL [jdbc:hsqldb:mem:testdb]
2018-10-09 11:21:27,655 [main] INFO  connections                     - HHH10001001: Connection properties: {}
2018-10-09 11:21:27,655 [main] INFO  connections                     - HHH10001003: Autocommit mode: false
2018-10-09 11:21:27,655 [main] INFO  rManagerConnectionProviderImpl  - HHH000115: Hibernate connection pool size: 20 (min=1)
Hibernate: drop table TokenEntry if exists
Hibernate: create table TokenEntry (processorName varchar(255) not null, segment integer not null, owner varchar(255), timestamp varchar(255) not null, token blob(10000), tokenType varchar(255), primary key (processorName, segment))
2018-10-09 11:21:27,689 [main] INFO  SchemaCreatorImpl               - HHH000476: Executing import script 'org.hibernate.tool.schema.internal.exec.ScriptSourceInputNonExistentImpl@6ade4ac6'
2018-10-09 11:21:27,693 [main] INFO  tainerEntityManagerFactoryBean  - Initialized JPA EntityManagerFactory for persistence unit 'default'
2018-10-09 11:21:27,749 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@16b6e5e testClass = JpaTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest@43900101, testMethod = testStealToken@JpaTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@57c09e37 testClass = JpaTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@1364560f]; rollback [true]
Hibernate: select tokenentry0_.processorName as processo1_0_0_, tokenentry0_.segment as segment2_0_0_, tokenentry0_.owner as owner3_0_0_, tokenentry0_.timestamp as timestam4_0_0_, tokenentry0_.token as token5_0_0_, tokenentry0_.tokenType as tokenTyp6_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? and tokenentry0_.segment=? for update
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: select processorName from TokenEntry where processorName =? and segment =? for update
2018-10-09 11:21:27,754 [main] INFO  ueryTranslatorFactoryInitiator  - HHH000397: Using ASTQueryTranslatorFactory
Hibernate: update TokenEntry set owner=?, timestamp=?, token=?, tokenType=? where processorName=? and segment=?
Hibernate: update TokenEntry set owner=null where owner=? and processorName=? and segment=?
2018-10-09 11:21:27,758 [main] WARN  JpaTokenStore                   - Releasing claim of token stealing/0 failed. It was not owned by local
Hibernate: select processorName from TokenEntry where processorName =? and segment =? for update
2018-10-09 11:21:27,760 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@16b6e5e testClass = JpaTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest@43900101, testMethod = testStealToken@JpaTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@57c09e37 testClass = JpaTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
Hibernate: select tokenentry0_.processorName as processo1_0_0_, tokenentry0_.segment as segment2_0_0_, tokenentry0_.owner as owner3_0_0_, tokenentry0_.timestamp as timestam4_0_0_, tokenentry0_.token as token5_0_0_, tokenentry0_.tokenType as tokenTyp6_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? and tokenentry0_.segment=? for update
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: select processorName from TokenEntry where processorName =? and segment =? for update
Hibernate: update TokenEntry set owner=?, timestamp=?, token=?, tokenType=? where processorName=? and segment=?
Hibernate: select tokenentry0_.processorName as processo1_0_0_, tokenentry0_.segment as segment2_0_0_, tokenentry0_.owner as owner3_0_0_, tokenentry0_.timestamp as timestam4_0_0_, tokenentry0_.token as token5_0_0_, tokenentry0_.tokenType as tokenTyp6_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? and tokenentry0_.segment=? for update
Hibernate: update TokenEntry set owner=?, timestamp=?, token=?, tokenType=? where processorName=? and segment=?
Hibernate: select tokenentry0_.processorName as processo1_0_0_, tokenentry0_.segment as segment2_0_0_, tokenentry0_.owner as owner3_0_0_, tokenentry0_.timestamp as timestam4_0_0_, tokenentry0_.token as token5_0_0_, tokenentry0_.tokenType as tokenTyp6_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? and tokenentry0_.segment=? for update
Hibernate: update TokenEntry set owner=?, timestamp=?, token=?, tokenType=? where processorName=? and segment=?
2018-10-09 11:21:27,783 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@16b6e5e testClass = JpaTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest@404fb8c2, testMethod = testInitializeTokensWhileAlreadyPresent@JpaTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@57c09e37 testClass = JpaTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@1364560f]; rollback [true]
Hibernate: select tokenentry0_.processorName as processo1_0_0_, tokenentry0_.segment as segment2_0_0_, tokenentry0_.owner as owner3_0_0_, tokenentry0_.timestamp as timestam4_0_0_, tokenentry0_.token as token5_0_0_, tokenentry0_.tokenType as tokenTyp6_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? and tokenentry0_.segment=? for update
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: select tokenentry0_.segment as col_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? order by tokenentry0_.segment ASC
2018-10-09 11:21:27,788 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@16b6e5e testClass = JpaTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest@404fb8c2, testMethod = testInitializeTokensWhileAlreadyPresent@JpaTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@57c09e37 testClass = JpaTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-09 11:21:27,789 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@16b6e5e testClass = JpaTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest@149afc70, testMethod = testStealingFromOtherThreadFailsWithRowLock@JpaTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@57c09e37 testClass = JpaTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@1364560f]; rollback [true]
Hibernate: select tokenentry0_.processorName as processo1_0_0_, tokenentry0_.segment as segment2_0_0_, tokenentry0_.owner as owner3_0_0_, tokenentry0_.timestamp as timestam4_0_0_, tokenentry0_.token as token5_0_0_, tokenentry0_.tokenType as tokenTyp6_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? and tokenentry0_.segment=? for update
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: select tokenentry0_.processorName as processo1_0_0_, tokenentry0_.segment as segment2_0_0_, tokenentry0_.owner as owner3_0_0_, tokenentry0_.timestamp as timestam4_0_0_, tokenentry0_.token as token5_0_0_, tokenentry0_.tokenType as tokenTyp6_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? and tokenentry0_.segment=? for update
2018-10-09 11:21:28,053 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@16b6e5e testClass = JpaTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest@149afc70, testMethod = testStealingFromOtherThreadFailsWithRowLock@JpaTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@57c09e37 testClass = JpaTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
2018-10-09 11:21:28,062 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@16b6e5e testClass = JpaTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest@5287c159, testMethod = testInitializeTokens@JpaTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@57c09e37 testClass = JpaTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@1364560f]; rollback [true]
Hibernate: select tokenentry0_.segment as col_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? order by tokenentry0_.segment ASC
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: select tokenentry0_.segment as col_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? order by tokenentry0_.segment ASC
2018-10-09 11:21:28,071 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@16b6e5e testClass = JpaTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest@5287c159, testMethod = testInitializeTokens@JpaTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@57c09e37 testClass = JpaTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-09 11:21:28,078 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@16b6e5e testClass = JpaTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest@23d9a633, testMethod = testQuerySegments@JpaTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@57c09e37 testClass = JpaTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@1364560f]; rollback [true]
Hibernate: select tokenentry0_.processorName as processo1_0_0_, tokenentry0_.segment as segment2_0_0_, tokenentry0_.owner as owner3_0_0_, tokenentry0_.timestamp as timestam4_0_0_, tokenentry0_.token as token5_0_0_, tokenentry0_.tokenType as tokenTyp6_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? and tokenentry0_.segment=? for update
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: select tokenentry0_.processorName as processo1_0_0_, tokenentry0_.segment as segment2_0_0_, tokenentry0_.owner as owner3_0_0_, tokenentry0_.timestamp as timestam4_0_0_, tokenentry0_.token as token5_0_0_, tokenentry0_.tokenType as tokenTyp6_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? and tokenentry0_.segment=? for update
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: select tokenentry0_.processorName as processo1_0_0_, tokenentry0_.segment as segment2_0_0_, tokenentry0_.owner as owner3_0_0_, tokenentry0_.timestamp as timestam4_0_0_, tokenentry0_.token as token5_0_0_, tokenentry0_.tokenType as tokenTyp6_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? and tokenentry0_.segment=? for update
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: update TokenEntry set owner=?, timestamp=?, token=?, tokenType=? where processorName=? and segment=?
Hibernate: select tokenentry0_.processorName as processo1_0_0_, tokenentry0_.segment as segment2_0_0_, tokenentry0_.owner as owner3_0_0_, tokenentry0_.timestamp as timestam4_0_0_, tokenentry0_.token as token5_0_0_, tokenentry0_.tokenType as tokenTyp6_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? and tokenentry0_.segment=? for update
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: update TokenEntry set owner=?, timestamp=?, token=?, tokenType=? where processorName=? and segment=?
Hibernate: update TokenEntry set owner=?, timestamp=?, token=?, tokenType=? where processorName=? and segment=?
Hibernate: select tokenentry0_.segment as col_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? order by tokenentry0_.segment ASC
Hibernate: select tokenentry0_.segment as col_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? order by tokenentry0_.segment ASC
Hibernate: select tokenentry0_.segment as col_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? order by tokenentry0_.segment ASC
2018-10-09 11:21:28,101 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@16b6e5e testClass = JpaTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest@23d9a633, testMethod = testQuerySegments@JpaTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@57c09e37 testClass = JpaTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-09 11:21:28,103 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@16b6e5e testClass = JpaTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest@59fd35ad, testMethod = testClaimTokenConcurrently@JpaTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@57c09e37 testClass = JpaTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@1364560f]; rollback [true]
Hibernate: select tokenentry0_.processorName as processo1_0_0_, tokenentry0_.segment as segment2_0_0_, tokenentry0_.owner as owner3_0_0_, tokenentry0_.timestamp as timestam4_0_0_, tokenentry0_.token as token5_0_0_, tokenentry0_.tokenType as tokenTyp6_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? and tokenentry0_.segment=? for update
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: select processorName from TokenEntry where processorName =? and segment =? for update
2018-10-09 11:21:28,106 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@16b6e5e testClass = JpaTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest@59fd35ad, testMethod = testClaimTokenConcurrently@JpaTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@57c09e37 testClass = JpaTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-09 11:21:28,107 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@16b6e5e testClass = JpaTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest@27cef2f7, testMethod = testExtendingLostClaimFails@JpaTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@57c09e37 testClass = JpaTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@1364560f]; rollback [true]
Hibernate: select tokenentry0_.processorName as processo1_0_0_, tokenentry0_.segment as segment2_0_0_, tokenentry0_.owner as owner3_0_0_, tokenentry0_.timestamp as timestam4_0_0_, tokenentry0_.token as token5_0_0_, tokenentry0_.tokenType as tokenTyp6_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? and tokenentry0_.segment=? for update
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: update TokenEntry set timestamp=? where processorName=? and segment=? and owner=?
2018-10-09 11:21:28,114 [main] WARN  SqlExceptionHelper              - SQL Warning Code: -1100, SQLState: 02000
2018-10-09 11:21:28,114 [main] WARN  SqlExceptionHelper              - no data
2018-10-09 11:21:28,115 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@16b6e5e testClass = JpaTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest@27cef2f7, testMethod = testExtendingLostClaimFails@JpaTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@57c09e37 testClass = JpaTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-09 11:21:28,117 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@16b6e5e testClass = JpaTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest@5fe45792, testMethod = testUpdateNullToken@JpaTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@57c09e37 testClass = JpaTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@1364560f]; rollback [true]
Hibernate: select tokenentry0_.processorName as processo1_0_0_, tokenentry0_.segment as segment2_0_0_, tokenentry0_.owner as owner3_0_0_, tokenentry0_.timestamp as timestam4_0_0_, tokenentry0_.token as token5_0_0_, tokenentry0_.tokenType as tokenTyp6_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? and tokenentry0_.segment=? for update
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: update TokenEntry set owner=?, timestamp=?, token=?, tokenType=? where processorName=? and segment=?
Hibernate: select tokenentry0_.processorName as processo1_0_, tokenentry0_.segment as segment2_0_, tokenentry0_.owner as owner3_0_, tokenentry0_.timestamp as timestam4_0_, tokenentry0_.token as token5_0_, tokenentry0_.tokenType as tokenTyp6_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=?
2018-10-09 11:21:28,128 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@16b6e5e testClass = JpaTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest@5fe45792, testMethod = testUpdateNullToken@JpaTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@57c09e37 testClass = JpaTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-09 11:21:28,129 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@16b6e5e testClass = JpaTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest@221e3b5f, testMethod = testInitializeTokensAtGivenPosition@JpaTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@57c09e37 testClass = JpaTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@1364560f]; rollback [true]
Hibernate: select tokenentry0_.segment as col_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? order by tokenentry0_.segment ASC
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: select tokenentry0_.segment as col_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? order by tokenentry0_.segment ASC
Hibernate: select processorName from TokenEntry where processorName =? and segment =? for update
Hibernate: select processorName from TokenEntry where processorName =? and segment =? for update
Hibernate: select processorName from TokenEntry where processorName =? and segment =? for update
Hibernate: select processorName from TokenEntry where processorName =? and segment =? for update
Hibernate: select processorName from TokenEntry where processorName =? and segment =? for update
Hibernate: select processorName from TokenEntry where processorName =? and segment =? for update
Hibernate: select processorName from TokenEntry where processorName =? and segment =? for update
2018-10-09 11:21:28,146 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@16b6e5e testClass = JpaTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest@221e3b5f, testMethod = testInitializeTokensAtGivenPosition@JpaTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@57c09e37 testClass = JpaTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-09 11:21:28,148 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@16b6e5e testClass = JpaTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest@77c894d5, testMethod = testClaimAndUpdateToken@JpaTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@57c09e37 testClass = JpaTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@1364560f]; rollback [true]
Hibernate: select tokenentry0_.processorName as processo1_0_0_, tokenentry0_.segment as segment2_0_0_, tokenentry0_.owner as owner3_0_0_, tokenentry0_.timestamp as timestam4_0_0_, tokenentry0_.token as token5_0_0_, tokenentry0_.tokenType as tokenTyp6_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? and tokenentry0_.segment=? for update
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: select processorName from TokenEntry where processorName =? and segment =? for update
Hibernate: update TokenEntry set owner=?, timestamp=?, token=?, tokenType=? where processorName=? and segment=?
Hibernate: select tokenentry0_.processorName as processo1_0_, tokenentry0_.segment as segment2_0_, tokenentry0_.owner as owner3_0_, tokenentry0_.timestamp as timestam4_0_, tokenentry0_.token as token5_0_, tokenentry0_.tokenType as tokenTyp6_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=?
Hibernate: update TokenEntry set owner=null where owner=? and processorName=? and segment=?
Hibernate: select tokenentry0_.processorName as processo1_0_0_, tokenentry0_.segment as segment2_0_0_, tokenentry0_.owner as owner3_0_0_, tokenentry0_.timestamp as timestam4_0_0_, tokenentry0_.token as token5_0_0_, tokenentry0_.tokenType as tokenTyp6_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? and tokenentry0_.segment=?
2018-10-09 11:21:28,156 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@16b6e5e testClass = JpaTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest@77c894d5, testMethod = testClaimAndUpdateToken@JpaTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@57c09e37 testClass = JpaTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
Tests run: 11, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.685 sec - in org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest
Running org.axonframework.eventhandling.tokenstore.inmemory.InMemoryTokenStoreTest
Tests run: 6, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 sec - in org.axonframework.eventhandling.tokenstore.inmemory.InMemoryTokenStoreTest
Running org.axonframework.eventhandling.ConcludesBatchParameterResolverFactoryTest
Tests run: 6, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.006 sec - in org.axonframework.eventhandling.ConcludesBatchParameterResolverFactoryTest
Running org.axonframework.eventhandling.AbstractEventBusTest
Tests run: 8, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.156 sec - in org.axonframework.eventhandling.AbstractEventBusTest
Running org.axonframework.eventhandling.AnnotatedParameterResolverFactoryTest
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.003 sec - in org.axonframework.eventhandling.AnnotatedParameterResolverFactoryTest
Running org.axonframework.eventhandling.AbstractEventProcessorTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.002 sec - in org.axonframework.eventhandling.AbstractEventProcessorTest
Running org.axonframework.eventhandling.SubscribingEventProcessorTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.eventhandling.SubscribingEventProcessorTest
Running org.axonframework.eventhandling.DirectEventProcessingStrategyTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.eventhandling.DirectEventProcessingStrategyTest
Running org.axonframework.eventhandling.MultiEventHandlerInvokerTest
Tests run: 9, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.026 sec - in org.axonframework.eventhandling.MultiEventHandlerInvokerTest
Running org.axonframework.eventhandling.AnnotationEventMessageHandlerAdapterTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.003 sec - in org.axonframework.eventhandling.AnnotationEventMessageHandlerAdapterTest
Running org.axonframework.eventhandling.ReplayTokenTest
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.007 sec - in org.axonframework.eventhandling.ReplayTokenTest
Running org.axonframework.eventhandling.TimestampParameterResolverFactoryTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.eventhandling.TimestampParameterResolverFactoryTest
Running org.axonframework.eventhandling.GenericEventMessageTest
Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.002 sec - in org.axonframework.eventhandling.GenericEventMessageTest
Running org.axonframework.eventhandling.SimpleEventBusTest
2018-10-09 11:21:28,378 [main] INFO  AbstractEventBus                - EventProcessor [Mock for Consumer, hashCode: 282827877] not added. It was already subscribed
2018-10-09 11:21:28,379 [main] INFO  AbstractEventBus                - EventListener Mock for Consumer, hashCode: 1867037662 not removed. It was already unsubscribed
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.eventhandling.SimpleEventBusTest
Running org.axonframework.eventhandling.SimpleEventHandlerInvokerTest
Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 sec - in org.axonframework.eventhandling.SimpleEventHandlerInvokerTest
Running org.axonframework.eventhandling.TrackingEventProcessorTest
2018-10-09 11:21:28,404 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-09 11:21:28,404 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-09 11:21:28,411 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-09 11:21:28,411 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=-1} for segment: Segment[0/0]
2018-10-09 11:21:28,415 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-09 11:21:28,420 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-09 11:21:28,427 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Fetched token: ReplayToken{currentToken=IndexTrackingToken{globalIndex=1}, tokenAtReset=IndexTrackingToken{globalIndex=3}} for segment: Segment[0/0]
2018-10-09 11:21:28,439 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-09 11:21:28,498 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:29,448 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - An error occurred while attempting to claim a token for segment: 0. Will retry later...
java.lang.RuntimeException: Faking a recoverable issue
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.lambda$run$1(TrackingEventProcessor.java:750)
	at org.axonframework.eventhandling.TrackingEventProcessorTest.lambda$setUp$1(TrackingEventProcessorTest.java:127)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.run(TrackingEventProcessor.java:749)
	at org.axonframework.eventhandling.TrackingEventProcessor$CountingRunnable.run(TrackingEventProcessor.java:613)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:29,449 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-09 11:21:29,449 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[0/0]
2018-10-09 11:21:29,498 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:29,645 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-09 11:21:29,648 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-09 11:21:29,648 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=-1} for segment: Segment[0/0]
2018-10-09 11:21:29,653 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-09 11:21:29,665 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-09 11:21:29,666 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Fetched token: ReplayToken{currentToken=IndexTrackingToken{globalIndex=-1}, tokenAtReset=IndexTrackingToken{globalIndex=3}} for segment: Segment[0/0]
2018-10-09 11:21:29,668 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-09 11:21:30,499 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:30,672 [EventProcessor[test]-0] WARN  TrackingEventProcessor          - Fetch Segments for Processor 'test' failed: Faking issue during fetchSegments. Preparing for retry in 1s
2018-10-09 11:21:30,673 [EventProcessor[test]-0] WARN  TrackingEventProcessor          - Fetch Segments for Processor 'test' failed: Could not initialize segments. Some segments were already present.. Preparing for retry in 1s
2018-10-09 11:21:30,673 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-09 11:21:30,673 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[0/0]
2018-10-09 11:21:31,500 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:32,500 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:33,170 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-09 11:21:33,501 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:33,678 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-09 11:21:33,678 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[0/0]
2018-10-09 11:21:33,880 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-09 11:21:34,502 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:34,883 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-09 11:21:34,884 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[0/0]
2018-10-09 11:21:35,085 [EventProcessor[test]-0] WARN  TrackingEventProcessor          - Error occurred. Starting retry mode.
org.axonframework.common.MockException: Mock
2018-10-09 11:21:35,085 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-09 11:21:35,085 [EventProcessor[test]-0] WARN  TrackingEventProcessor          - Releasing claim on token and preparing for retry in 1s
2018-10-09 11:21:35,089 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-09 11:21:35,090 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[0/0]
2018-10-09 11:21:35,091 [EventProcessor[test]-0] WARN  TrackingEventProcessor          - Error occurred. Starting retry mode.
org.axonframework.common.MockException: Mock
2018-10-09 11:21:35,091 [EventProcessor[test]-0] WARN  TrackingEventProcessor          - Releasing claim on token and preparing for retry in 1s
2018-10-09 11:21:35,289 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-09 11:21:35,294 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-09 11:21:35,294 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=0} for segment: Segment[0/0]
2018-10-09 11:21:35,494 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-09 11:21:35,503 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:36,300 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-09 11:21:36,300 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[0/0]
2018-10-09 11:21:36,502 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-09 11:21:36,504 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:37,504 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:37,505 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-09 11:21:37,505 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[0/0]
2018-10-09 11:21:37,705 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-09 11:21:38,505 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:38,709 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-09 11:21:38,713 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-09 11:21:38,713 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=-1} for segment: Segment[0/0]
2018-10-09 11:21:38,714 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-09 11:21:38,720 [EventProcessor[test]-0] ERROR TrackingEventProcessor          - An unrecoverable error has occurred wile attempting to claim a token for segment: 0. Shutting down processor [test].
org.axonframework.serialization.SerializationException: Faking a serialization issue
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.lambda$run$1(TrackingEventProcessor.java:750)
	at org.axonframework.eventhandling.TrackingEventProcessorTest.lambda$setUp$1(TrackingEventProcessorTest.java:127)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.run(TrackingEventProcessor.java:749)
	at org.axonframework.eventhandling.TrackingEventProcessor$CountingRunnable.run(TrackingEventProcessor.java:613)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:38,723 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-09 11:21:38,724 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[0/0]
2018-10-09 11:21:38,924 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-09 11:21:39,506 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:39,939 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-09 11:21:39,939 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[0/0]
2018-10-09 11:21:39,940 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-09 11:21:39,942 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-09 11:21:39,942 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Fetched token: ReplayToken{currentToken=null, tokenAtReset=GapAwareTrackingToken{index=5, gaps=[3, 4]}} for segment: Segment[0/0]
2018-10-09 11:21:39,944 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-09 11:21:39,946 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-09 11:21:39,946 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=-1} for segment: Segment[0/0]
2018-10-09 11:21:39,949 [EventProcessor[test]-0] WARN  TrackingEventProcessor          - Error occurred. Starting retry mode.
org.axonframework.common.MockException: Mock
2018-10-09 11:21:39,949 [EventProcessor[test]-0] WARN  TrackingEventProcessor          - Releasing claim on token and preparing for retry in 1s
2018-10-09 11:21:40,506 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:40,950 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=-1} for segment: Segment[0/0]
2018-10-09 11:21:40,953 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-09 11:21:41,507 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:41,955 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-09 11:21:41,956 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - No Worker Launcher active. Using current thread to assign segments.
2018-10-09 11:21:42,508 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:43,508 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:45,263 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:46,283 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:48,216 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:49,217 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:50,217 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:51,218 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:51,956 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-09 11:21:51,956 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-09 11:21:51,960 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-09 11:21:51,961 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[0/0]
2018-10-09 11:21:52,162 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-09 11:21:52,219 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:53,165 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-09 11:21:53,166 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=1} for segment: Segment[0/0]
2018-10-09 11:21:53,172 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-09 11:21:53,219 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:54,172 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-09 11:21:54,172 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Fetched token: ReplayToken{currentToken=IndexTrackingToken{globalIndex=1}, tokenAtReset=IndexTrackingToken{globalIndex=3}} for segment: Segment[0/0]
2018-10-09 11:21:54,175 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-09 11:21:54,220 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:55,180 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-09 11:21:55,180 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[0/0]
2018-10-09 11:21:55,221 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:55,380 [Time-limited test] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-09 11:21:55,386 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-09 11:21:55,387 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=1} for segment: Segment[0/0]
2018-10-09 11:21:56,222 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:56,383 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-09 11:21:57,222 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:57,385 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-09 11:21:57,385 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - No Worker Launcher active. Using current thread to assign segments.
2018-10-09 11:21:57,386 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
Tests run: 24, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 29.003 sec - in org.axonframework.eventhandling.TrackingEventProcessorTest
Running org.axonframework.messaging.unitofwork.BatchingUnitOfWorkTest
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.009 sec - in org.axonframework.messaging.unitofwork.BatchingUnitOfWorkTest
Running org.axonframework.messaging.unitofwork.CurrentUnitOfWorkTest
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 sec - in org.axonframework.messaging.unitofwork.CurrentUnitOfWorkTest
Running org.axonframework.messaging.unitofwork.RollbackConfigurationTypeTest
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 sec - in org.axonframework.messaging.unitofwork.RollbackConfigurationTypeTest
Running org.axonframework.messaging.unitofwork.AbstractUnitOfWorkTest
Tests run: 7, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.114 sec - in org.axonframework.messaging.unitofwork.AbstractUnitOfWorkTest
Running org.axonframework.messaging.unitofwork.ExecutionResultTest
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.messaging.unitofwork.ExecutionResultTest
Running org.axonframework.messaging.unitofwork.UnitOfWorkNestingTest
Tests run: 6, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.011 sec - in org.axonframework.messaging.unitofwork.UnitOfWorkNestingTest
Running org.axonframework.messaging.annotation.MessageIdentifierParameterResolverFactoryTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.004 sec - in org.axonframework.messaging.annotation.MessageIdentifierParameterResolverFactoryTest
Running org.axonframework.messaging.annotation.SimpleResourceParameterResolverFactoryTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.messaging.annotation.SimpleResourceParameterResolverFactoryTest
Running org.axonframework.messaging.annotation.MultiParameterResolverFactoryTest
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.018 sec - in org.axonframework.messaging.annotation.MultiParameterResolverFactoryTest
Running org.axonframework.messaging.annotation.HandlerComparatorTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.messaging.annotation.HandlerComparatorTest
Running org.axonframework.messaging.HeadersTests
Tests run: 11, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.041 sec - in org.axonframework.messaging.HeadersTests
Running org.axonframework.messaging.DefaultInterceptorChainTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.007 sec - in org.axonframework.messaging.DefaultInterceptorChainTest
Running org.axonframework.messaging.interceptors.BeanValidationInterceptorTest
Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.179 sec - in org.axonframework.messaging.interceptors.BeanValidationInterceptorTest
Running org.axonframework.messaging.interceptors.TransactionManagingInterceptorTest
Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.messaging.interceptors.TransactionManagingInterceptorTest
Running org.axonframework.messaging.interceptors.LoggingInterceptorTest
Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.119 sec - in org.axonframework.messaging.interceptors.LoggingInterceptorTest
Running org.axonframework.messaging.interceptors.CorrelationDataInterceptorTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.017 sec - in org.axonframework.messaging.interceptors.CorrelationDataInterceptorTest
Running org.axonframework.messaging.correlation.MetaDataValueTest
Tests run: 18, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.027 sec - in org.axonframework.messaging.correlation.MetaDataValueTest
Running org.axonframework.messaging.correlation.SimpleCorrelationDataProviderTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.messaging.correlation.SimpleCorrelationDataProviderTest
Running org.axonframework.messaging.responsetypes.MultipleInstancesResponseTypeTest
2018-10-09 11:21:58,019 [main] INFO  MultipleInstancesResponseType   - The given response is an Iterable without any contents, hence we cannot verify if the contained type is assignable to the expected type.
Tests run: 46, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.066 sec - in org.axonframework.messaging.responsetypes.MultipleInstancesResponseTypeTest
Running org.axonframework.messaging.responsetypes.ResponseTypesJacksonSerializationTest
Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.021 sec - in org.axonframework.messaging.responsetypes.ResponseTypesJacksonSerializationTest
Running org.axonframework.messaging.responsetypes.InstanceResponseTypeTest
Tests run: 36, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.012 sec - in org.axonframework.messaging.responsetypes.InstanceResponseTypeTest
Running org.axonframework.messaging.MetaDataTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.messaging.MetaDataTest
Running org.axonframework.messaging.GenericMessageTest
Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.003 sec - in org.axonframework.messaging.GenericMessageTest
Running org.axonframework.queryhandling.SubscriptionQueryTest
2018-10-09 11:21:58,214 [main] ERROR SimpleQueryBus                  - An error happened while trying to report an initial result. Query: GenericQueryMessage{payload={axonFrameworkCR}, metadata={}, messageIdentifier='69d291e1-bd75-4397-a126-2a25f9c316aa', queryName='failingQuery', expectedResponseType='org.axonframework.messaging.responsetypes.InstanceResponseType@7b07ef24'}
java.util.concurrent.CompletionException: java.lang.RuntimeException: oops
	at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:292)
	at java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:308)
	at java.util.concurrent.CompletableFuture.uniAccept(CompletableFuture.java:647)
	at java.util.concurrent.CompletableFuture.uniAcceptStage(CompletableFuture.java:669)
	at java.util.concurrent.CompletableFuture.thenAccept(CompletableFuture.java:1997)
	at org.axonframework.queryhandling.SimpleQueryBus.lambda$subscriptionQuery$5(SimpleQueryBus.java:206)
	at org.axonframework.queryhandling.MonoWrapper.lambda$create$0(MonoWrapper.java:62)
	at reactor.core.publisher.MonoCreate.subscribe(MonoCreate.java:53)
	at reactor.core.publisher.Mono.subscribe(Mono.java:3080)
	at reactor.core.publisher.Mono.subscribeWith(Mono.java:3188)
	at reactor.core.publisher.Mono.subscribe(Mono.java:3074)
	at reactor.core.publisher.Mono.subscribe(Mono.java:3041)
	at reactor.core.publisher.Mono.subscribe(Mono.java:3013)
	at org.axonframework.queryhandling.SubscriptionQueryResult.handle(SubscriptionQueryResult.java:59)
	at org.axonframework.queryhandling.SubscriptionQueryTest.testSubscriptionQueryResultHandleWhenThereIsAnErrorOnUpdate(SubscriptionQueryTest.java:736)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:363)
	at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:367)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeWithRerun(JUnit4Provider.java:274)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:238)
	at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:161)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:290)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:242)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:121)
Caused by: java.lang.RuntimeException: oops
	at org.axonframework.queryhandling.SubscriptionQueryTest$ChatQueryHandler.<init>(SubscriptionQueryTest.java:750)
	at org.axonframework.queryhandling.SubscriptionQueryTest$ChatQueryHandler.<init>(SubscriptionQueryTest.java:747)
	at org.axonframework.queryhandling.SubscriptionQueryTest.<init>(SubscriptionQueryTest.java:54)
	at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
	at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)
	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
	at java.lang.reflect.Constructor.newInstance(Constructor.java:423)
	at org.junit.runners.BlockJUnit4ClassRunner.createTest(BlockJUnit4ClassRunner.java:217)
	at org.junit.runners.BlockJUnit4ClassRunner$1.runReflectiveCall(BlockJUnit4ClassRunner.java:266)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.BlockJUnit4ClassRunner.methodBlock(BlockJUnit4ClassRunner.java:263)
	... 15 more
2018-10-09 11:21:58,224 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:21:58,302 [main] INFO  SimpleQueryUpdateEmitter        - An error occurred while trying to emit an update to a query 'chatMessages'. The subscription will be cancelled. Exception summary: reactor.core.Exceptions$ErrorCallbackNotImplemented: java.lang.IllegalStateException: oops
2018-10-09 11:21:58,381 [main] ERROR SimpleQueryUpdateEmitter        - An error happened while trying to inform update handler about the error. Query: GenericQueryMessage{payload={axonFrameworkCR}, metadata={}, messageIdentifier='37b9377f-0da9-422d-84be-78245fbeb5a2', queryName='chatMessages', expectedResponseType='org.axonframework.messaging.responsetypes.MultipleInstancesResponseType@5ea854da'}
2018-10-09 11:21:58,390 [main] ERROR SimpleQueryUpdateEmitter        - An error happened while trying to inform update handler about the error. Query: GenericQueryMessage{payload={axonFrameworkCR}, metadata={}, messageIdentifier='0d69ed2e-37ed-4c89-8013-7ec8ef79e75d', queryName='chatMessages', expectedResponseType='org.axonframework.messaging.responsetypes.MultipleInstancesResponseType@25370a99'}
2018-10-09 11:21:58,926 [main] ERROR SimpleQueryBus                  - An error happened while trying to report an initial result. Query: GenericQueryMessage{payload={axonFrameworkCR}, metadata={}, messageIdentifier='a2d1618c-6603-4c78-938f-c2f6dbd2feac', queryName='failingQuery', expectedResponseType='org.axonframework.messaging.responsetypes.InstanceResponseType@1abde659'}
java.util.concurrent.CompletionException: java.lang.RuntimeException: oops
	at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:292)
	at java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:308)
	at java.util.concurrent.CompletableFuture.uniAccept(CompletableFuture.java:647)
	at java.util.concurrent.CompletableFuture.uniAcceptStage(CompletableFuture.java:669)
	at java.util.concurrent.CompletableFuture.thenAccept(CompletableFuture.java:1997)
	at org.axonframework.queryhandling.SimpleQueryBus.lambda$subscriptionQuery$5(SimpleQueryBus.java:206)
	at org.axonframework.queryhandling.MonoWrapper.lambda$create$0(MonoWrapper.java:62)
	at reactor.core.publisher.MonoCreate.subscribe(MonoCreate.java:53)
	at reactor.core.publisher.Mono.subscribe(Mono.java:3080)
	at reactor.test.DefaultStepVerifierBuilder$DefaultStepVerifier.verify(DefaultStepVerifierBuilder.java:728)
	at reactor.test.DefaultStepVerifierBuilder$DefaultStepVerifier.verify(DefaultStepVerifierBuilder.java:700)
	at org.axonframework.queryhandling.SubscriptionQueryTest.testSubscribingQueryHandlerFailing(SubscriptionQueryTest.java:377)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:363)
	at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:367)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeWithRerun(JUnit4Provider.java:274)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:238)
	at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:161)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:290)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:242)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:121)
Caused by: java.lang.RuntimeException: oops
	at org.axonframework.queryhandling.SubscriptionQueryTest$ChatQueryHandler.<init>(SubscriptionQueryTest.java:750)
	at org.axonframework.queryhandling.SubscriptionQueryTest$ChatQueryHandler.<init>(SubscriptionQueryTest.java:747)
	at org.axonframework.queryhandling.SubscriptionQueryTest.<init>(SubscriptionQueryTest.java:54)
	at sun.reflect.GeneratedConstructorAccessor149.newInstance(Unknown Source)
	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
	at java.lang.reflect.Constructor.newInstance(Constructor.java:423)
	at org.junit.runners.BlockJUnit4ClassRunner.createTest(BlockJUnit4ClassRunner.java:217)
	at org.junit.runners.BlockJUnit4ClassRunner$1.runReflectiveCall(BlockJUnit4ClassRunner.java:266)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.BlockJUnit4ClassRunner.methodBlock(BlockJUnit4ClassRunner.java:263)
	... 15 more
2018-10-09 11:21:58,929 [main] ERROR SimpleQueryBus                  - An error happened while trying to report an initial result. Query: GenericQueryMessage{payload={axonFrameworkCR}, metadata={}, messageIdentifier='992dcb2f-0b7d-4311-9a37-fe2461ffa2c2', queryName='failingQuery', expectedResponseType='org.axonframework.messaging.responsetypes.InstanceResponseType@499c0aed'}
java.util.concurrent.CompletionException: java.lang.RuntimeException: oops
	at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:292)
	at java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:308)
	at java.util.concurrent.CompletableFuture.uniAccept(CompletableFuture.java:647)
	at java.util.concurrent.CompletableFuture.uniAcceptStage(CompletableFuture.java:669)
	at java.util.concurrent.CompletableFuture.thenAccept(CompletableFuture.java:1997)
	at org.axonframework.queryhandling.SimpleQueryBus.lambda$subscriptionQuery$5(SimpleQueryBus.java:206)
	at org.axonframework.queryhandling.MonoWrapper.lambda$create$0(MonoWrapper.java:62)
	at reactor.core.publisher.MonoCreate.subscribe(MonoCreate.java:53)
	at reactor.core.publisher.Mono.subscribe(Mono.java:3080)
	at reactor.core.publisher.Mono.subscribeWith(Mono.java:3188)
	at reactor.core.publisher.Mono.subscribe(Mono.java:3074)
	at reactor.core.publisher.Mono.subscribe(Mono.java:3041)
	at reactor.core.publisher.Mono.subscribe(Mono.java:3013)
	at org.axonframework.queryhandling.SubscriptionQueryResult.handle(SubscriptionQueryResult.java:59)
	at org.axonframework.queryhandling.SubscriptionQueryTest.testSubscriptionQueryResultHandleWhenThereIsAnErrorOnInitialResult(SubscriptionQueryTest.java:713)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:363)
	at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:367)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeWithRerun(JUnit4Provider.java:274)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:238)
	at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:161)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:290)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:242)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:121)
Caused by: java.lang.RuntimeException: oops
	at org.axonframework.queryhandling.SubscriptionQueryTest$ChatQueryHandler.<init>(SubscriptionQueryTest.java:750)
	at org.axonframework.queryhandling.SubscriptionQueryTest$ChatQueryHandler.<init>(SubscriptionQueryTest.java:747)
	at org.axonframework.queryhandling.SubscriptionQueryTest.<init>(SubscriptionQueryTest.java:54)
	at sun.reflect.GeneratedConstructorAccessor149.newInstance(Unknown Source)
	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
	at java.lang.reflect.Constructor.newInstance(Constructor.java:423)
	at org.junit.runners.BlockJUnit4ClassRunner.createTest(BlockJUnit4ClassRunner.java:217)
	at org.junit.runners.BlockJUnit4ClassRunner$1.runReflectiveCall(BlockJUnit4ClassRunner.java:266)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.BlockJUnit4ClassRunner.methodBlock(BlockJUnit4ClassRunner.java:263)
	... 15 more
2018-10-09 11:21:59,225 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:22:00,226 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
Tests run: 23, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 2.882 sec - in org.axonframework.queryhandling.SubscriptionQueryTest
Running org.axonframework.queryhandling.FutureAsResponseTypeToQueryHandlersTest
2018-10-09 11:22:01,227 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:22:02,227 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:22:03,228 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
Tests run: 6, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 3.017 sec - in org.axonframework.queryhandling.FutureAsResponseTypeToQueryHandlersTest
Running org.axonframework.queryhandling.QueryEventHandlingTest
2018-10-09 11:22:04,025 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'org.axonframework.queryhandling'. Awaiting termination...
2018-10-09 11:22:04,025 [EventProcessor[org.axonframework.queryhandling]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=org.axonframework.queryhandling, segment=Segment[0/0]}
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.013 sec - in org.axonframework.queryhandling.QueryEventHandlingTest
Running org.axonframework.queryhandling.SimpleQueryBusTest
Tests run: 24, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.054 sec - in org.axonframework.queryhandling.SimpleQueryBusTest
Running org.axonframework.queryhandling.DefaultQueryGatewayTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.023 sec - in org.axonframework.queryhandling.DefaultQueryGatewayTest
Running org.axonframework.queryhandling.annotation.AnnotationQueryHandlerAdapterTest
Tests run: 6, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.013 sec - in org.axonframework.queryhandling.annotation.AnnotationQueryHandlerAdapterTest
Running org.axonframework.deadline.quartz.DeadlineJobDataBinderTest
Tests run: 9, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.035 sec - in org.axonframework.deadline.quartz.DeadlineJobDataBinderTest
Running org.axonframework.deadline.quartz.QuartzDeadlineManagerTest
2018-10-09 11:22:04,167 [main] INFO  StdSchedulerFactory             - Using default implementation for ThreadExecutor
2018-10-09 11:22:04,167 [main] INFO  SimpleThreadPool                - Job execution threads will use class loader of thread: main
2018-10-09 11:22:04,169 [main] INFO  SchedulerSignalerImpl           - Initialized Scheduler Signaller of type: class org.quartz.core.SchedulerSignalerImpl
2018-10-09 11:22:04,170 [main] INFO  QuartzScheduler                 - Quartz Scheduler v.2.2.1 created.
2018-10-09 11:22:04,170 [main] INFO  RAMJobStore                     - RAMJobStore initialized.
2018-10-09 11:22:04,170 [main] INFO  QuartzScheduler                 - Scheduler meta-data: Quartz Scheduler (v2.2.1) 'DefaultQuartzScheduler' with instanceId 'NON_CLUSTERED'
  Scheduler class: 'org.quartz.core.QuartzScheduler' - running locally.
  NOT STARTED.
  Currently in standby mode.
  Number of jobs executed: 0
  Using thread pool 'org.quartz.simpl.SimpleThreadPool' - with 10 threads.
  Using job-store 'org.quartz.simpl.RAMJobStore' - which does not support persistence. and is not clustered.

2018-10-09 11:22:04,170 [main] INFO  StdSchedulerFactory             - Quartz scheduler 'DefaultQuartzScheduler' initialized from default resource file in Quartz package: 'quartz.properties'
2018-10-09 11:22:04,170 [main] INFO  StdSchedulerFactory             - Quartz scheduler version: 2.2.1
2018-10-09 11:22:04,177 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
2018-10-09 11:22:04,229 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:22:04,341 [DefaultQuartzScheduler_Worker-1] INFO  DeadlineJob                     - Job successfully executed. Deadline message [Void] processed.
2018-10-09 11:22:04,350 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
2018-10-09 11:22:04,497 [DefaultQuartzScheduler_Worker-2] INFO  DeadlineJob                     - Job successfully executed. Deadline message [DeadlinePayload] processed.
2018-10-09 11:22:04,505 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
2018-10-09 11:22:04,648 [DefaultQuartzScheduler_Worker-3] INFO  DeadlineJob                     - Job successfully executed. Deadline message [DeadlinePayload] processed.
2018-10-09 11:22:04,663 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
2018-10-09 11:22:04,787 [DefaultQuartzScheduler_Worker-4] INFO  DeadlineJob                     - Job successfully executed. Deadline message [DeadlinePayload] processed.
2018-10-09 11:22:04,795 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
2018-10-09 11:22:04,960 [DefaultQuartzScheduler_Worker-5] INFO  DeadlineJob                     - Job successfully executed. Deadline message [DeadlinePayload] processed.
2018-10-09 11:22:04,966 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
2018-10-09 11:22:04,978 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
2018-10-09 11:22:05,091 [DefaultQuartzScheduler_Worker-6] INFO  DeadlineJob                     - Job successfully executed. Deadline message [EntityDeadlinePayload] processed.
2018-10-09 11:22:05,111 [DefaultQuartzScheduler_Worker-7] INFO  DeadlineJob                     - Job successfully executed. Deadline message [DeadlinePayload] processed.
2018-10-09 11:22:05,121 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
2018-10-09 11:22:05,230 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
2018-10-09 11:22:05,247 [DefaultQuartzScheduler_Worker-8] INFO  DeadlineJob                     - Job successfully executed. Deadline message [String] processed.
2018-10-09 11:22:05,258 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
2018-10-09 11:22:05,376 [DefaultQuartzScheduler_Worker-9] INFO  DeadlineJob                     - Job successfully executed. Deadline message [Void] processed.
2018-10-09 11:22:05,388 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
2018-10-09 11:22:05,505 [DefaultQuartzScheduler_Worker-10] INFO  DeadlineJob                     - Job successfully executed. Deadline message [String] processed.
2018-10-09 11:22:05,511 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
2018-10-09 11:22:05,521 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
2018-10-09 11:22:05,637 [DefaultQuartzScheduler_Worker-1] INFO  DeadlineJob                     - Job successfully executed. Deadline message [DeadlinePayload] processed.
2018-10-09 11:22:05,642 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
2018-10-09 11:22:05,758 [DefaultQuartzScheduler_Worker-2] INFO  DeadlineJob                     - Job successfully executed. Deadline message [DeadlinePayload] processed.
Tests run: 13, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 1.596 sec - in org.axonframework.deadline.quartz.QuartzDeadlineManagerTest
Running org.axonframework.deadline.SimpleDeadlineManagerTest
2018-10-09 11:22:06,231 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy48.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy52.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:241)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:231)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:271)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:237)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:216)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:166)
	at java.lang.Thread.run(Thread.java:745)
Tests run: 13, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 1.319 sec - in org.axonframework.deadline.SimpleDeadlineManagerTest
Running org.axonframework.monitoring.MultiMessageMonitorTest
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.004 sec - in org.axonframework.monitoring.MultiMessageMonitorTest
2018-10-09 11:22:07,087 [Thread-76] INFO  GenericApplicationContext       - Closing org.springframework.context.support.GenericApplicationContext@7d1e75f7: startup date [Tue Oct 09 11:21:27 CEST 2018]; root of context hierarchy
2018-10-09 11:22:07,087 [Thread-39] INFO  GenericApplicationContext       - Closing org.springframework.context.support.GenericApplicationContext@37d6a6b6: startup date [Tue Oct 09 11:20:57 CEST 2018]; root of context hierarchy
2018-10-09 11:22:07,090 [Thread-75] INFO  GenericApplicationContext       - Closing org.springframework.context.support.GenericApplicationContext@16a1738d: startup date [Tue Oct 09 11:21:27 CEST 2018]; root of context hierarchy
2018-10-09 11:22:07,091 [Thread-7] INFO  GenericApplicationContext       - Closing org.springframework.context.support.GenericApplicationContext@24d7657b: startup date [Tue Oct 09 11:20:16 CEST 2018]; root of context hierarchy
2018-10-09 11:22:07,137 [Thread-7] INFO  tainerEntityManagerFactoryBean  - Closing JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-09 11:22:07,137 [Thread-39] INFO  tainerEntityManagerFactoryBean  - Closing JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-09 11:22:07,140 [Thread-76] INFO  tainerEntityManagerFactoryBean  - Closing JPA EntityManagerFactory for persistence unit 'default'
2018-10-09 11:22:07,161 [Thread-76] INFO  pperImpl$DelayedDropActionImpl  - HHH000477: Starting delayed drop of schema as part of SessionFactory shut-down'
Hibernate: drop table TokenEntry if exists
2018-10-09 11:22:07,187 [Thread-76] INFO  connections                     - HHH10001008: Cleaning up connection pool [jdbc:hsqldb:mem:testdb]

Results :

Tests run: 1141, Failures: 0, Errors: 0, Skipped: 1

[INFO]                                                                         
[INFO] ------------------------------------------------------------------------
[INFO] Building Axon Framework Distributed CommandBus JGroups 4.0-SNAPSHOT
[INFO] ------------------------------------------------------------------------
[INFO] 
[INFO] --- maven-resources-plugin:3.0.2:resources (default-resources) @ axon-distributed-commandbus-jgroups ---
[INFO] Using 'UTF-8' encoding to copy filtered resources.
[INFO] skip non existing resourceDirectory /root/workspace/AxonFramework/AxonFramework/439035107/distributed-commandbus-jgroups/src/main/resources
[INFO] 
[INFO] --- maven-compiler-plugin:3.5.1:compile (default-compile) @ axon-distributed-commandbus-jgroups ---
[INFO] Nothing to compile - all classes are up to date
[INFO] 
[INFO] --- maven-resources-plugin:3.0.2:testResources (default-testResources) @ axon-distributed-commandbus-jgroups ---
[INFO] Using 'UTF-8' encoding to copy filtered resources.
[INFO] Copying 4 resources
[INFO] 
[INFO] --- maven-compiler-plugin:3.5.1:testCompile (default-testCompile) @ axon-distributed-commandbus-jgroups ---
[INFO] Nothing to compile - all classes are up to date
[INFO] 
[INFO] --- maven-surefire-plugin:2.19.1:test (default-test) @ axon-distributed-commandbus-jgroups ---

-------------------------------------------------------
 T E S T S
-------------------------------------------------------
Running org.axonframework.jgroups.commandhandling.JgroupsConnectorTest_Gossip
Tests run: 2, Failures: 0, Errors: 2, Skipped: 0, Time elapsed: 0.202 sec <<< FAILURE! - in org.axonframework.jgroups.commandhandling.JgroupsConnectorTest_Gossip
testConnectorRecoversWhenGossipRouterReconnects(org.axonframework.jgroups.commandhandling.JgroupsConnectorTest_Gossip)  Time elapsed: 0.072 sec  <<< ERROR!
java.lang.ExceptionInInitializerError
	at org.axonframework.jgroups.commandhandling.JgroupsConnectorTest_Gossip.createChannel(JgroupsConnectorTest_Gossip.java:64)
	at org.axonframework.jgroups.commandhandling.JgroupsConnectorTest_Gossip.setUp(JgroupsConnectorTest_Gossip.java:69)
Caused by: java.lang.NullPointerException
	at org.axonframework.jgroups.commandhandling.JgroupsConnectorTest_Gossip.createChannel(JgroupsConnectorTest_Gossip.java:64)
	at org.axonframework.jgroups.commandhandling.JgroupsConnectorTest_Gossip.setUp(JgroupsConnectorTest_Gossip.java:69)

testDistributedCommandBusInvokesCallbackOnSerializationFailure(org.axonframework.jgroups.commandhandling.JgroupsConnectorTest_Gossip)  Time elapsed: 0.003 sec  <<< ERROR!
java.lang.NoClassDefFoundError: Could not initialize class org.jgroups.conf.XmlConfigurator
	at org.axonframework.jgroups.commandhandling.JgroupsConnectorTest_Gossip.createChannel(JgroupsConnectorTest_Gossip.java:64)
	at org.axonframework.jgroups.commandhandling.JgroupsConnectorTest_Gossip.setUp(JgroupsConnectorTest_Gossip.java:69)

Running org.axonframework.jgroups.commandhandling.JGroupsConnectorTest
Tests run: 11, Failures: 0, Errors: 11, Skipped: 0, Time elapsed: 0.105 sec <<< FAILURE! - in org.axonframework.jgroups.commandhandling.JGroupsConnectorTest
testRingsProperlySynchronized_ChannelAlreadyConnectedToOtherCluster(org.axonframework.jgroups.commandhandling.JGroupsConnectorTest)  Time elapsed: 0.085 sec  <<< ERROR!
java.lang.NoClassDefFoundError: Could not initialize class org.jgroups.conf.XmlConfigurator
	at org.axonframework.jgroups.commandhandling.JGroupsConnectorTest.createChannel(JGroupsConnectorTest.java:483)
	at org.axonframework.jgroups.commandhandling.JGroupsConnectorTest.setUp(JGroupsConnectorTest.java:72)

testUpdatesToMemberShipProcessedInOrder(org.axonframework.jgroups.commandhandling.JGroupsConnectorTest)  Time elapsed: 0.001 sec  <<< ERROR!
java.lang.NoClassDefFoundError: Could not initialize class org.jgroups.conf.XmlConfigurator
	at org.axonframework.jgroups.commandhandling.JGroupsConnectorTest.createChannel(JGroupsConnectorTest.java:483)
	at org.axonframework.jgroups.commandhandling.JGroupsConnectorTest.setUp(JGroupsConnectorTest.java:72)

testUnserializableResponseConvertedToNull(org.axonframework.jgroups.commandhandling.JGroupsConnectorTest)  Time elapsed: 0.001 sec  <<< ERROR!
java.lang.NoClassDefFoundError: Could not initialize class org.jgroups.conf.XmlConfigurator
	at org.axonframework.jgroups.commandhandling.JGroupsConnectorTest.createChannel(JGroupsConnectorTest.java:483)
	at org.axonframework.jgroups.commandhandling.JGroupsConnectorTest.setUp(JGroupsConnectorTest.java:72)

testDisconnectClosesJChannelConnection(org.axonframework.jgroups.commandhandling.JGroupsConnectorTest)  Time elapsed: 0.002 sec  <<< ERROR!
java.lang.NoClassDefFoundError: Could not initialize class org.jgroups.conf.XmlConfigurator
	at org.axonframework.jgroups.commandhandling.JGroupsConnectorTest.createChannel(JGroupsConnectorTest.java:483)
	at org.axonframework.jgroups.commandhandling.JGroupsConnectorTest.setUp(JGroupsConnectorTest.java:72)

testConnectAndDispatchMessagesWaitingOnCallback(org.axonframework.jgroups.commandhandling.JGroupsConnectorTest)  Time elapsed: 0.001 sec  <<< ERROR!
java.lang.NoClassDefFoundError: Could not initialize class org.jgroups.conf.XmlConfigurator
	at org.axonframework.jgroups.commandhandling.JGroupsConnectorTest.createChannel(JGroupsConnectorTest.java:483)
	at org.axonframework.jgroups.commandhandling.JGroupsConnectorTest.setUp(JGroupsConnectorTest.java:72)

testRingsProperlySynchronized_ChannelAlreadyConnected(org.axonframework.jgroups.commandhandling.JGroupsConnectorTest)  Time elapsed: 0.002 sec  <<< ERROR!
java.lang.NoClassDefFoundError: Could not initialize class org.jgroups.conf.XmlConfigurator
	at org.axonframework.jgroups.commandhandling.JGroupsConnectorTest.createChannel(JGroupsConnectorTest.java:483)
	at org.axonframework.jgroups.commandhandling.JGroupsConnectorTest.setUp(JGroupsConnectorTest.java:72)

testJoinMessageReceivedForDisconnectedHost(org.axonframework.jgroups.commandhandling.JGroupsConnectorTest)  Time elapsed: 0.001 sec  <<< ERROR!
java.lang.NoClassDefFoundError: Could not initialize class org.jgroups.conf.XmlConfigurator
	at org.axonframework.jgroups.commandhandling.JGroupsConnectorTest.createChannel(JGroupsConnectorTest.java:483)
	at org.axonframework.jgroups.commandhandling.JGroupsConnectorTest.setUp(JGroupsConnectorTest.java:72)

testConnectAndDispatchMessages_Balanced(org.axonframework.jgroups.commandhandling.JGroupsConnectorTest)  Time elapsed: 0.001 sec  <<< ERROR!
java.lang.NoClassDefFoundError: Could not initialize class org.jgroups.conf.XmlConfigurator
	at org.axonframework.jgroups.commandhandling.JGroupsConnectorTest.createChannel(JGroupsConnectorTest.java:483)
	at org.axonframework.jgroups.commandhandling.JGroupsConnectorTest.setUp(JGroupsConnectorTest.java:72)

testSetupOfReplyingCallback(org.axonframework.jgroups.commandhandling.JGroupsConnectorTest)  Time elapsed: 0.001 sec  <<< ERROR!
java.lang.NoClassDefFoundError: Could not initialize class org.jgroups.conf.XmlConfigurator
	at org.axonframework.jgroups.commandhandling.JGroupsConnectorTest.createChannel(JGroupsConnectorTest.java:483)
	at org.axonframework.jgroups.commandhandling.JGroupsConnectorTest.setUp(JGroupsConnectorTest.java:72)

testConnectAndDispatchMessages_SingleCandidate(org.axonframework.jgroups.commandhandling.JGroupsConnectorTest)  Time elapsed: 0.001 sec  <<< ERROR!
java.lang.NoClassDefFoundError: Could not initialize class org.jgroups.conf.XmlConfigurator
	at org.axonframework.jgroups.commandhandling.JGroupsConnectorTest.createChannel(JGroupsConnectorTest.java:483)
	at org.axonframework.jgroups.commandhandling.JGroupsConnectorTest.setUp(JGroupsConnectorTest.java:72)

testConnectAndDispatchMessages_CustomCommandName(org.axonframework.jgroups.commandhandling.JGroupsConnectorTest)  Time elapsed: 0.002 sec  <<< ERROR!
java.lang.NoClassDefFoundError: Could not initialize class org.jgroups.conf.XmlConfigurator
	at org.axonframework.jgroups.commandhandling.JGroupsConnectorTest.createChannel(JGroupsConnectorTest.java:483)
	at org.axonframework.jgroups.commandhandling.JGroupsConnectorTest.setUp(JGroupsConnectorTest.java:72)


Results :

Tests in error: 
  JGroupsConnectorTest.setUp:72->createChannel:483 » NoClassDefFound Could not i...
  JGroupsConnectorTest.setUp:72->createChannel:483 » NoClassDefFound Could not i...
  JGroupsConnectorTest.setUp:72->createChannel:483 » NoClassDefFound Could not i...
  JGroupsConnectorTest.setUp:72->createChannel:483 » NoClassDefFound Could not i...
  JGroupsConnectorTest.setUp:72->createChannel:483 » NoClassDefFound Could not i...
  JGroupsConnectorTest.setUp:72->createChannel:483 » NoClassDefFound Could not i...
  JGroupsConnectorTest.setUp:72->createChannel:483 » NoClassDefFound Could not i...
  JGroupsConnectorTest.setUp:72->createChannel:483 » NoClassDefFound Could not i...
  JGroupsConnectorTest.setUp:72->createChannel:483 » NoClassDefFound Could not i...
  JGroupsConnectorTest.setUp:72->createChannel:483 » NoClassDefFound Could not i...
  JGroupsConnectorTest.setUp:72->createChannel:483 » NoClassDefFound Could not i...
  JgroupsConnectorTest_Gossip.setUp:69->createChannel:64 » ExceptionInInitializer
  JgroupsConnectorTest_Gossip.setUp:69->createChannel:64 » NoClassDefFound Could...

Tests run: 13, Failures: 0, Errors: 13, Skipped: 0

[INFO] ------------------------------------------------------------------------
[INFO] Reactor Summary:
[INFO] 
[INFO] Axon Framework ..................................... SUCCESS [  0.004 s]
[INFO] Axon Framework core ................................ SUCCESS [02:24 min]
[INFO] Axon Framework Distributed CommandBus JGroups ...... FAILURE [  2.323 s]
[INFO] Axon Framework Spring Support ...................... SKIPPED
[INFO] Axon AMQP .......................................... SKIPPED
[INFO] Axon Kafka ......................................... SKIPPED
[INFO] Axon Framework Distributed CommandBus Spring Cloud . SKIPPED
[INFO] Axon Metrics ....................................... SKIPPED
[INFO] axon-server-connector .............................. SKIPPED
[INFO] Axon Framework Spring Boot Support ................. SKIPPED
[INFO] Axon Framework Test Fixtures ....................... SKIPPED
[INFO] Axon MongoDB Components ............................ SKIPPED
[INFO] Axon Integration tests ............................. SKIPPED
[INFO] Spring Boot Starter module for Axon Framework ...... SKIPPED
[INFO] Spring Boot Starter module for Axon with JGroups Distributed Command Bus SKIPPED
[INFO] Axon Legacy Components ............................. SKIPPED
[INFO] ------------------------------------------------------------------------
[INFO] BUILD FAILURE
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 02:28 min
[INFO] Finished at: 2018-10-09T11:22:10+02:00
[INFO] Final Memory: 52M/733M
[INFO] ------------------------------------------------------------------------
[ERROR] Failed to execute goal org.apache.maven.plugins:maven-surefire-plugin:2.19.1:test (default-test) on project axon-distributed-commandbus-jgroups: There are test failures.
[ERROR] 
[ERROR] Please refer to /root/workspace/AxonFramework/AxonFramework/439035107/distributed-commandbus-jgroups/target/surefire-reports for the individual test results.
[ERROR] -> [Help 1]
[ERROR] 
[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.
[ERROR] Re-run Maven using the -X switch to enable full debug logging.
[ERROR] 
[ERROR] For more information about the errors and possible solutions, please read the following articles:
[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoFailureException
[ERROR] 
[ERROR] After correcting the problems, you can resume the build with the command
[ERROR]   mvn <goals> -rf :axon-distributed-commandbus-jgroups
