[INFO] Scanning for projects...
[WARNING] 
[WARNING] Some problems were encountered while building the effective model for org.axonframework:axon-integrationtests:jar:3.4-SNAPSHOT
[WARNING] 'dependencies.dependency.systemPath' for com.oracle:ojdbc7:jar should not point at files within the project directory, ${project.basedir}/src/test/binary/ojdbc7.jar will be unresolvable by dependent projects @ org.axonframework:axon-integrationtests:[unknown-version], /root/workspace/AxonFramework/AxonFramework/437597521/integrationtests/pom.xml, line 142, column 25
[WARNING] 
[WARNING] It is highly recommended to fix these problems because they threaten the stability of your build.
[WARNING] 
[WARNING] For this reason, future Maven versions might no longer support building such malformed projects.
[WARNING] 
[INFO] ------------------------------------------------------------------------
[INFO] Reactor Build Order:
[INFO] 
[INFO] Axon Framework
[INFO] Axon Framework core
[INFO] Axon Framework Distributed CommandBus JGroups
[INFO] Axon Framework Spring Support
[INFO] Axon AMQP
[INFO] Axon Kafka
[INFO] Axon Framework Distributed CommandBus Spring Cloud
[INFO] Axon Metrics
[INFO] Axon Framework Spring Boot Support
[INFO] Axon Framework Test Fixtures
[INFO] Axon MongoDB Components
[INFO] Axon Integration tests
[INFO] Spring Boot Starter module for Axon Framework
[INFO] Spring Boot Starter module for Axon with JGroups Distributed Command Bus
[INFO] Axon Legacy Components
[INFO]                                                                         
[INFO] ------------------------------------------------------------------------
[INFO] Building Axon Framework 3.4-SNAPSHOT
[INFO] ------------------------------------------------------------------------
[INFO]                                                                         
[INFO] ------------------------------------------------------------------------
[INFO] Building Axon Framework core 3.4-SNAPSHOT
[INFO] ------------------------------------------------------------------------
[INFO] 
[INFO] --- maven-enforcer-plugin:1.4.1:enforce (enforce-banned-dependencies) @ axon-core ---
[INFO] Skipping Rule Enforcement.
[INFO] 
[INFO] --- maven-resources-plugin:3.0.2:resources (default-resources) @ axon-core ---
[INFO] Using 'UTF-8' encoding to copy filtered resources.
[INFO] Copying 7 resources
[INFO] 
[INFO] --- maven-compiler-plugin:3.5.1:compile (default-compile) @ axon-core ---
[INFO] Changes detected - recompiling the module!
[INFO] Compiling 575 source files to /root/workspace/AxonFramework/AxonFramework/437597521/core/target/classes
[INFO] /root/workspace/AxonFramework/AxonFramework/437597521/core/src/main/java/org/axonframework/commandhandling/model/LockingRepository.java: Some input files use or override a deprecated API.
[INFO] /root/workspace/AxonFramework/AxonFramework/437597521/core/src/main/java/org/axonframework/commandhandling/model/LockingRepository.java: Recompile with -Xlint:deprecation for details.
[INFO] /root/workspace/AxonFramework/AxonFramework/437597521/core/src/main/java/org/axonframework/messaging/unitofwork/MessageProcessingContext.java: Some input files use unchecked or unsafe operations.
[INFO] /root/workspace/AxonFramework/AxonFramework/437597521/core/src/main/java/org/axonframework/messaging/unitofwork/MessageProcessingContext.java: Recompile with -Xlint:unchecked for details.
[INFO] 
[INFO] --- maven-bundle-plugin:3.3.0:manifest (default) @ axon-core ---
[INFO] 
[INFO] --- maven-resources-plugin:3.0.2:testResources (default-testResources) @ axon-core ---
[INFO] Using 'UTF-8' encoding to copy filtered resources.
[INFO] Copying 11 resources
[INFO] 
[INFO] --- maven-compiler-plugin:3.5.1:testCompile (default-testCompile) @ axon-core ---
[INFO] Nothing to compile - all classes are up to date
[INFO] 
[INFO] --- maven-surefire-plugin:2.19.1:test (default-test) @ axon-core ---
[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/surefire-junit4/2.19.1/surefire-junit4-2.19.1.pom
[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/surefire-junit4/2.19.1/surefire-junit4-2.19.1.pom (4 KB at 5.7 KB/sec)
[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/surefire-providers/2.19.1/surefire-providers-2.19.1.pom
[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/surefire-providers/2.19.1/surefire-providers-2.19.1.pom (3 KB at 65.9 KB/sec)
[INFO] Downloading: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/surefire-junit4/2.19.1/surefire-junit4-2.19.1.jar
[INFO] Downloaded: https://repo.maven.apache.org/maven2/org/apache/maven/surefire/surefire-junit4/2.19.1/surefire-junit4-2.19.1.jar (74 KB at 818.3 KB/sec)

-------------------------------------------------------
 T E S T S
-------------------------------------------------------
Running org.axonframework.messaging.DefaultInterceptorChainTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 1.345 sec - in org.axonframework.messaging.DefaultInterceptorChainTest
Running org.axonframework.messaging.interceptors.CorrelationDataInterceptorTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.25 sec - in org.axonframework.messaging.interceptors.CorrelationDataInterceptorTest
Running org.axonframework.messaging.interceptors.LoggingInterceptorTest
Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.332 sec - in org.axonframework.messaging.interceptors.LoggingInterceptorTest
Running org.axonframework.messaging.interceptors.TransactionManagingInterceptorTest
Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.223 sec - in org.axonframework.messaging.interceptors.TransactionManagingInterceptorTest
Running org.axonframework.messaging.interceptors.BeanValidationInterceptorTest
2018-10-05 14:40:47,983 [main] INFO  Version                         - HV000001: Hibernate Validator 5.2.4.Final
Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.421 sec - in org.axonframework.messaging.interceptors.BeanValidationInterceptorTest
Running org.axonframework.messaging.unitofwork.BatchingUnitOfWorkTest
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.042 sec - in org.axonframework.messaging.unitofwork.BatchingUnitOfWorkTest
Running org.axonframework.messaging.unitofwork.ExecutionResultTest
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.messaging.unitofwork.ExecutionResultTest
Running org.axonframework.messaging.unitofwork.RollbackConfigurationTypeTest
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.messaging.unitofwork.RollbackConfigurationTypeTest
Running org.axonframework.messaging.unitofwork.UnitOfWorkNestingTest
Tests run: 6, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.05 sec - in org.axonframework.messaging.unitofwork.UnitOfWorkNestingTest
Running org.axonframework.messaging.unitofwork.AbstractUnitOfWorkTest
Tests run: 7, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.274 sec - in org.axonframework.messaging.unitofwork.AbstractUnitOfWorkTest
Running org.axonframework.messaging.unitofwork.CurrentUnitOfWorkTest
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.004 sec - in org.axonframework.messaging.unitofwork.CurrentUnitOfWorkTest
Running org.axonframework.messaging.HeadersTests
Tests run: 11, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.391 sec - in org.axonframework.messaging.HeadersTests
Running org.axonframework.messaging.annotation.MessageIdentifierParameterResolverFactoryTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.007 sec - in org.axonframework.messaging.annotation.MessageIdentifierParameterResolverFactoryTest
Running org.axonframework.messaging.annotation.HandlerComparatorTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.202 sec - in org.axonframework.messaging.annotation.HandlerComparatorTest
Running org.axonframework.messaging.annotation.SimpleResourceParameterResolverFactoryTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.messaging.annotation.SimpleResourceParameterResolverFactoryTest
Running org.axonframework.messaging.annotation.MultiParameterResolverFactoryTest
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.091 sec - in org.axonframework.messaging.annotation.MultiParameterResolverFactoryTest
Running org.axonframework.messaging.correlation.SimpleCorrelationDataProviderTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.004 sec - in org.axonframework.messaging.correlation.SimpleCorrelationDataProviderTest
Running org.axonframework.messaging.correlation.MetaDataValueTest
Tests run: 18, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.103 sec - in org.axonframework.messaging.correlation.MetaDataValueTest
Running org.axonframework.messaging.GenericMessageTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.023 sec - in org.axonframework.messaging.GenericMessageTest
Running org.axonframework.messaging.MetaDataTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 sec - in org.axonframework.messaging.MetaDataTest
Running org.axonframework.serialization.upcasting.event.AbstractSingleEventUpcasterTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.248 sec - in org.axonframework.serialization.upcasting.event.AbstractSingleEventUpcasterTest
Running org.axonframework.serialization.upcasting.event.AbstractContextAwareEventMultiUpcasterTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.351 sec - in org.axonframework.serialization.upcasting.event.AbstractContextAwareEventMultiUpcasterTest
Running org.axonframework.serialization.upcasting.event.AbstractEventMultiUpcasterTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.027 sec - in org.axonframework.serialization.upcasting.event.AbstractEventMultiUpcasterTest
Running org.axonframework.serialization.upcasting.event.EventUpcasterChainTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.032 sec - in org.axonframework.serialization.upcasting.event.EventUpcasterChainTest
Running org.axonframework.serialization.upcasting.event.AbstractContextAwareSingleEventUpcasterTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.012 sec - in org.axonframework.serialization.upcasting.event.AbstractContextAwareSingleEventUpcasterTest
Running org.axonframework.serialization.upcasting.GenericUpcasterChainTest
Tests run: 6, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.009 sec - in org.axonframework.serialization.upcasting.GenericUpcasterChainTest
Running org.axonframework.serialization.MavenArtifactRevisionResolverTest
Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 sec - in org.axonframework.serialization.MavenArtifactRevisionResolverTest
Running org.axonframework.serialization.converters.StringToByteArrayConverterTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.serialization.converters.StringToByteArrayConverterTest
Running org.axonframework.serialization.converters.InputStreamToByteArrayConverterTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.serialization.converters.InputStreamToByteArrayConverterTest
Running org.axonframework.serialization.converters.ByteArrayToStringConverterTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.serialization.converters.ByteArrayToStringConverterTest
Running org.axonframework.serialization.json.ByteArrayToJsonNodeConverterTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.serialization.json.ByteArrayToJsonNodeConverterTest
Running org.axonframework.serialization.json.MetaDataDeserializerTest
Tests run: 20, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.191 sec - in org.axonframework.serialization.json.MetaDataDeserializerTest
Running org.axonframework.serialization.json.JsonNodeToByteArrayConverterTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.serialization.json.JsonNodeToByteArrayConverterTest
Running org.axonframework.serialization.json.JacksonSerializerTest
Tests run: 10, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 1.411 sec - in org.axonframework.serialization.json.JacksonSerializerTest
Running org.axonframework.serialization.JavaSerializerTest
Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.009 sec - in org.axonframework.serialization.JavaSerializerTest
Running org.axonframework.serialization.xml.Dom4JToByteArrayConverterTest
Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.005 sec - in org.axonframework.serialization.xml.Dom4JToByteArrayConverterTest
Running org.axonframework.serialization.xml.InputStreamToDom4jConverterTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.serialization.xml.InputStreamToDom4jConverterTest
Running org.axonframework.serialization.xml.XomToStringConverterTest
Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.008 sec - in org.axonframework.serialization.xml.XomToStringConverterTest
Running org.axonframework.serialization.xml.XStreamSerializerTest
Tests run: 12, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.22 sec - in org.axonframework.serialization.xml.XStreamSerializerTest
Running org.axonframework.serialization.xml.InputStreamToXomConverterTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.serialization.xml.InputStreamToXomConverterTest
Running org.axonframework.serialization.MessageSerializerTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.011 sec - in org.axonframework.serialization.MessageSerializerTest
Running org.axonframework.serialization.SerialVersionUIDRevisionResolverTest
Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 sec - in org.axonframework.serialization.SerialVersionUIDRevisionResolverTest
Running org.axonframework.serialization.SerializedMessageTest
Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.045 sec - in org.axonframework.serialization.SerializedMessageTest
Running org.axonframework.serialization.AnnotationRevisionResolverTest
Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 sec - in org.axonframework.serialization.AnnotationRevisionResolverTest
Running org.axonframework.serialization.LazyDeserializingObjectTest
Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.012 sec - in org.axonframework.serialization.LazyDeserializingObjectTest
Running org.axonframework.serialization.ChainedConverterTest
Tests run: 6, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.022 sec - in org.axonframework.serialization.ChainedConverterTest
Running org.axonframework.serialization.SerializedMetaDataValueTest
Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.serialization.SerializedMetaDataValueTest
Running org.axonframework.serialization.SerializationAwareTest
Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.015 sec - in org.axonframework.serialization.SerializationAwareTest
Running org.axonframework.serialization.FixedValueRevisionResolverTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.serialization.FixedValueRevisionResolverTest
Running org.axonframework.eventsourcing.eventstore.jdbc.MysqlJdbcEventStorageEngineTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 1, Time elapsed: 0.195 sec - in org.axonframework.eventsourcing.eventstore.jdbc.MysqlJdbcEventStorageEngineTest
Running org.axonframework.eventsourcing.eventstore.jdbc.JdbcEventStorageEngineTest
Tests run: 27, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 1.724 sec - in org.axonframework.eventsourcing.eventstore.jdbc.JdbcEventStorageEngineTest
Running org.axonframework.eventsourcing.eventstore.TrackingTokenSerializationTest
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.057 sec - in org.axonframework.eventsourcing.eventstore.TrackingTokenSerializationTest
Running org.axonframework.eventsourcing.eventstore.jpa.SQLStateResolverTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.015 sec - in org.axonframework.eventsourcing.eventstore.jpa.SQLStateResolverTest
Running org.axonframework.eventsourcing.eventstore.jpa.SQLErrorCodesResolverTest
Tests run: 12, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.383 sec - in org.axonframework.eventsourcing.eventstore.jpa.SQLErrorCodesResolverTest
Running org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest
2018-10-05 14:40:54,770 [main] INFO  DefaultTestContextBootstrapper  - Loaded default TestExecutionListener class names from location [META-INF/spring.factories]: [org.springframework.test.context.web.ServletTestExecutionListener, org.springframework.test.context.support.DirtiesContextBeforeModesTestExecutionListener, org.springframework.test.context.support.DependencyInjectionTestExecutionListener, org.springframework.test.context.support.DirtiesContextTestExecutionListener, org.springframework.test.context.transaction.TransactionalTestExecutionListener, org.springframework.test.context.jdbc.SqlScriptsTestExecutionListener]
2018-10-05 14:40:54,878 [main] INFO  DefaultTestContextBootstrapper  - Using TestExecutionListeners: [org.springframework.test.context.support.DirtiesContextBeforeModesTestExecutionListener@4276ad40, org.springframework.test.context.support.DependencyInjectionTestExecutionListener@6e5f5478, org.springframework.test.context.support.DirtiesContextTestExecutionListener@5fb07347, org.springframework.test.context.transaction.TransactionalTestExecutionListener@3ef2b8e5, org.springframework.test.context.jdbc.SqlScriptsTestExecutionListener@49190ed6]
2018-10-05 14:40:54,933 [main] INFO  XmlBeanDefinitionReader         - Loading XML bean definitions from class path resource [META-INF/spring/db-context.xml]
2018-10-05 14:40:55,235 [main] INFO  GenericApplicationContext       - Refreshing org.springframework.context.support.GenericApplicationContext@43deba42: startup date [Fri Oct 05 14:40:55 CEST 2018]; root of context hierarchy
2018-10-05 14:40:55,391 [main] INFO  redAnnotationBeanPostProcessor  - JSR-330 'javax.inject.Inject' annotation found and supported for autowiring
2018-10-05 14:40:55,534 [main] INFO  DriverManagerDataSource         - Loaded JDBC driver: org.hsqldb.jdbcDriver
2018-10-05 14:40:55,653 [main] INFO  tainerEntityManagerFactoryBean  - Building JPA container EntityManagerFactory for persistence unit 'eventStore'
2018-10-05 14:40:55,682 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-05 14:40:55,759 [main] INFO  Version                         - HHH000412: Hibernate Core {5.1.0.Final}
2018-10-05 14:40:55,760 [main] INFO  Environment                     - HHH000206: hibernate.properties not found
2018-10-05 14:40:55,761 [main] INFO  Environment                     - HHH000021: Bytecode provider name : javassist
2018-10-05 14:40:55,804 [main] INFO  Version                         - HCANN000001: Hibernate Commons Annotations {5.0.1.Final}
2018-10-05 14:40:56,092 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-05 14:40:57,177 [main] INFO  ractorJdbcDatabaseMetaDataImpl  - HHH000262: Table not found: AssociationValueEntry
2018-10-05 14:40:57,179 [main] INFO  ractorJdbcDatabaseMetaDataImpl  - HHH000262: Table not found: AssociationValueEntry
2018-10-05 14:40:57,184 [main] INFO  ractorJdbcDatabaseMetaDataImpl  - HHH000262: Table not found: CustomDomainEventEntry
2018-10-05 14:40:57,185 [main] INFO  ractorJdbcDatabaseMetaDataImpl  - HHH000262: Table not found: CustomDomainEventEntry
2018-10-05 14:40:57,190 [main] INFO  ractorJdbcDatabaseMetaDataImpl  - HHH000262: Table not found: CustomSagaEntry
2018-10-05 14:40:57,192 [main] INFO  ractorJdbcDatabaseMetaDataImpl  - HHH000262: Table not found: CustomSagaEntry
2018-10-05 14:40:57,196 [main] INFO  ractorJdbcDatabaseMetaDataImpl  - HHH000262: Table not found: CustomSnapshotEventEntry
2018-10-05 14:40:57,197 [main] INFO  ractorJdbcDatabaseMetaDataImpl  - HHH000262: Table not found: CustomSnapshotEventEntry
2018-10-05 14:40:57,202 [main] INFO  ractorJdbcDatabaseMetaDataImpl  - HHH000262: Table not found: DomainEventEntry
2018-10-05 14:40:57,203 [main] INFO  ractorJdbcDatabaseMetaDataImpl  - HHH000262: Table not found: DomainEventEntry
2018-10-05 14:40:57,209 [main] INFO  ractorJdbcDatabaseMetaDataImpl  - HHH000262: Table not found: JpaAggregate
2018-10-05 14:40:57,211 [main] INFO  ractorJdbcDatabaseMetaDataImpl  - HHH000262: Table not found: JpaAggregate
2018-10-05 14:40:57,213 [main] INFO  ractorJdbcDatabaseMetaDataImpl  - HHH000262: Table not found: SagaEntry
2018-10-05 14:40:57,213 [main] INFO  ractorJdbcDatabaseMetaDataImpl  - HHH000262: Table not found: SagaEntry
2018-10-05 14:40:57,215 [main] INFO  ractorJdbcDatabaseMetaDataImpl  - HHH000262: Table not found: SnapshotEventEntry
2018-10-05 14:40:57,216 [main] INFO  ractorJdbcDatabaseMetaDataImpl  - HHH000262: Table not found: SnapshotEventEntry
2018-10-05 14:40:57,218 [main] INFO  ractorJdbcDatabaseMetaDataImpl  - HHH000262: Table not found: StubAggregate
2018-10-05 14:40:57,219 [main] INFO  ractorJdbcDatabaseMetaDataImpl  - HHH000262: Table not found: StubAggregate
2018-10-05 14:40:57,380 [main] INFO  tainerEntityManagerFactoryBean  - Initialized JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-05 14:40:57,770 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@16120270, testMethod = testStoreTwoExactSameSnapshots@JpaEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@7d563c13]; rollback [true]
2018-10-05 14:40:57,799 [main] INFO  ueryTranslatorFactoryInitiator  - HHH000397: Using ASTQueryTranslatorFactory
2018-10-05 14:40:58,025 [main] WARN  SqlExceptionHelper              - SQL Warning Code: -1100, SQLState: 02000
2018-10-05 14:40:58,025 [main] WARN  SqlExceptionHelper              - no data
2018-10-05 14:40:58,026 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@16120270, testMethod = testStoreTwoExactSameSnapshots@JpaEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-05 14:40:58,033 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@e2ee348, testMethod = testEventsWithUnknownPayloadTypeAreSkipped@JpaEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@7d563c13]; rollback [true]
2018-10-05 14:40:58,111 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@e2ee348, testMethod = testEventsWithUnknownPayloadTypeAreSkipped@JpaEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-05 14:40:58,117 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@4fe3f9ef, testMethod = testStoreEventsWithCustomEntity@JpaEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@7d563c13]; rollback [true]
2018-10-05 14:40:58,192 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@4fe3f9ef, testMethod = testStoreEventsWithCustomEntity@JpaEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-05 14:40:58,194 [main] INFO  GenericApplicationContext       - Closing org.springframework.context.support.GenericApplicationContext@43deba42: startup date [Fri Oct 05 14:40:55 CEST 2018]; root of context hierarchy
2018-10-05 14:40:58,199 [main] INFO  tainerEntityManagerFactoryBean  - Closing JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-05 14:40:58,204 [main] INFO  XmlBeanDefinitionReader         - Loading XML bean definitions from class path resource [META-INF/spring/db-context.xml]
2018-10-05 14:40:58,279 [main] INFO  GenericApplicationContext       - Refreshing org.springframework.context.support.GenericApplicationContext@67372d20: startup date [Fri Oct 05 14:40:58 CEST 2018]; root of context hierarchy
2018-10-05 14:40:58,302 [main] INFO  redAnnotationBeanPostProcessor  - JSR-330 'javax.inject.Inject' annotation found and supported for autowiring
2018-10-05 14:40:58,364 [main] INFO  DriverManagerDataSource         - Loaded JDBC driver: org.hsqldb.jdbcDriver
2018-10-05 14:40:58,379 [main] INFO  tainerEntityManagerFactoryBean  - Building JPA container EntityManagerFactory for persistence unit 'eventStore'
2018-10-05 14:40:58,379 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-05 14:40:58,455 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-05 14:40:58,739 [main] INFO  tainerEntityManagerFactoryBean  - Initialized JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-05 14:40:58,857 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@590336ed, testMethod = testStoreAndLoadEventsFromDatastore@JpaEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@2f8b48c3]; rollback [true]
2018-10-05 14:40:58,862 [main] INFO  ueryTranslatorFactoryInitiator  - HHH000397: Using ASTQueryTranslatorFactory
2018-10-05 14:40:58,893 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@590336ed, testMethod = testStoreAndLoadEventsFromDatastore@JpaEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-05 14:40:58,900 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@2d5435d4, testMethod = testLoadLastSequenceNumber@JpaEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@2f8b48c3]; rollback [true]
2018-10-05 14:40:58,919 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@2d5435d4, testMethod = testLoadLastSequenceNumber@JpaEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-05 14:40:58,925 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@5fd5d6d1, testMethod = testOldGapsAreRemovedFromProvidedTrackingToken@JpaEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@2f8b48c3]; rollback [true]
2018-10-05 14:40:58,989 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@5fd5d6d1, testMethod = testOldGapsAreRemovedFromProvidedTrackingToken@JpaEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-05 14:40:58,990 [main] INFO  GenericApplicationContext       - Closing org.springframework.context.support.GenericApplicationContext@67372d20: startup date [Fri Oct 05 14:40:58 CEST 2018]; root of context hierarchy
2018-10-05 14:40:58,991 [main] INFO  tainerEntityManagerFactoryBean  - Closing JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-05 14:40:58,992 [main] INFO  XmlBeanDefinitionReader         - Loading XML bean definitions from class path resource [META-INF/spring/db-context.xml]
2018-10-05 14:40:59,049 [main] INFO  GenericApplicationContext       - Refreshing org.springframework.context.support.GenericApplicationContext@481c1e92: startup date [Fri Oct 05 14:40:59 CEST 2018]; root of context hierarchy
2018-10-05 14:40:59,063 [main] INFO  redAnnotationBeanPostProcessor  - JSR-330 'javax.inject.Inject' annotation found and supported for autowiring
2018-10-05 14:40:59,103 [main] INFO  DriverManagerDataSource         - Loaded JDBC driver: org.hsqldb.jdbcDriver
2018-10-05 14:40:59,119 [main] INFO  tainerEntityManagerFactoryBean  - Building JPA container EntityManagerFactory for persistence unit 'eventStore'
2018-10-05 14:40:59,119 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-05 14:40:59,194 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:40:59,208 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-05 14:40:59,602 [main] INFO  tainerEntityManagerFactoryBean  - Initialized JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-05 14:40:59,664 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@129348e8, testMethod = testGapsForVeryOldEventsAreNotIncluded@JpaEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@66428512]; rollback [true]
2018-10-05 14:40:59,668 [main] INFO  ueryTranslatorFactoryInitiator  - HHH000397: Using ASTQueryTranslatorFactory
2018-10-05 14:40:59,692 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@129348e8, testMethod = testGapsForVeryOldEventsAreNotIncluded@JpaEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-05 14:40:59,696 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@42fdf45e, testMethod = testUnknownSerializedTypeCausesException@JpaEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@66428512]; rollback [true]
2018-10-05 14:40:59,713 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@42fdf45e, testMethod = testUnknownSerializedTypeCausesException@JpaEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-05 14:40:59,717 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@96448ee, testMethod = testLoad_LargeAmountOfEvents@BatchingEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@66428512]; rollback [true]
2018-10-05 14:41:00,198 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:00,303 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@96448ee, testMethod = testLoad_LargeAmountOfEvents@BatchingEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-05 14:41:00,310 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@18f794e, testMethod = testStoreDuplicateEventWithoutExceptionResolver@AbstractEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@66428512]; rollback [true]
2018-10-05 14:41:00,324 [main] WARN  SqlExceptionHelper              - SQL Error: -104, SQLState: 23505
2018-10-05 14:41:00,324 [main] ERROR SqlExceptionHelper              - integrity constraint violation: unique constraint or index violation; UKDG43IA27YPO1JOVW2X64VBWV8 table: DOMAINEVENTENTRY
2018-10-05 14:41:00,325 [main] INFO  AbstractBatchImpl               - HHH000010: On release of batch it still contained JDBC statements
2018-10-05 14:41:00,328 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@18f794e, testMethod = testStoreDuplicateEventWithoutExceptionResolver@AbstractEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-05 14:41:00,330 [main] INFO  GenericApplicationContext       - Closing org.springframework.context.support.GenericApplicationContext@481c1e92: startup date [Fri Oct 05 14:40:59 CEST 2018]; root of context hierarchy
2018-10-05 14:41:00,330 [main] INFO  tainerEntityManagerFactoryBean  - Closing JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-05 14:41:00,332 [main] INFO  XmlBeanDefinitionReader         - Loading XML bean definitions from class path resource [META-INF/spring/db-context.xml]
2018-10-05 14:41:00,376 [main] INFO  GenericApplicationContext       - Refreshing org.springframework.context.support.GenericApplicationContext@30bfdcc5: startup date [Fri Oct 05 14:41:00 CEST 2018]; root of context hierarchy
2018-10-05 14:41:00,391 [main] INFO  redAnnotationBeanPostProcessor  - JSR-330 'javax.inject.Inject' annotation found and supported for autowiring
2018-10-05 14:41:00,463 [main] INFO  DriverManagerDataSource         - Loaded JDBC driver: org.hsqldb.jdbcDriver
2018-10-05 14:41:00,478 [main] INFO  tainerEntityManagerFactoryBean  - Building JPA container EntityManagerFactory for persistence unit 'eventStore'
2018-10-05 14:41:00,479 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-05 14:41:00,559 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-05 14:41:00,792 [main] INFO  tainerEntityManagerFactoryBean  - Initialized JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-05 14:41:00,847 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@62536882, testMethod = testStoreDuplicateEventWithExceptionTranslator@AbstractEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@3453f79c]; rollback [true]
2018-10-05 14:41:00,851 [main] INFO  ueryTranslatorFactoryInitiator  - HHH000397: Using ASTQueryTranslatorFactory
2018-10-05 14:41:00,858 [main] WARN  SqlExceptionHelper              - SQL Error: -104, SQLState: 23505
2018-10-05 14:41:00,858 [main] ERROR SqlExceptionHelper              - integrity constraint violation: unique constraint or index violation; UKDG43IA27YPO1JOVW2X64VBWV8 table: DOMAINEVENTENTRY
2018-10-05 14:41:00,858 [main] INFO  AbstractBatchImpl               - HHH000010: On release of batch it still contained JDBC statements
2018-10-05 14:41:00,859 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@62536882, testMethod = testStoreDuplicateEventWithExceptionTranslator@AbstractEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-05 14:41:00,860 [main] INFO  GenericApplicationContext       - Closing org.springframework.context.support.GenericApplicationContext@30bfdcc5: startup date [Fri Oct 05 14:41:00 CEST 2018]; root of context hierarchy
2018-10-05 14:41:00,860 [main] INFO  tainerEntityManagerFactoryBean  - Closing JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-05 14:41:00,861 [main] INFO  XmlBeanDefinitionReader         - Loading XML bean definitions from class path resource [META-INF/spring/db-context.xml]
2018-10-05 14:41:00,894 [main] INFO  GenericApplicationContext       - Refreshing org.springframework.context.support.GenericApplicationContext@363ee411: startup date [Fri Oct 05 14:41:00 CEST 2018]; root of context hierarchy
2018-10-05 14:41:00,907 [main] INFO  redAnnotationBeanPostProcessor  - JSR-330 'javax.inject.Inject' annotation found and supported for autowiring
2018-10-05 14:41:00,945 [main] INFO  DriverManagerDataSource         - Loaded JDBC driver: org.hsqldb.jdbcDriver
2018-10-05 14:41:00,958 [main] INFO  tainerEntityManagerFactoryBean  - Building JPA container EntityManagerFactory for persistence unit 'eventStore'
2018-10-05 14:41:00,958 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-05 14:41:01,038 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-05 14:41:01,200 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:01,412 [main] INFO  tainerEntityManagerFactoryBean  - Initialized JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-05 14:41:01,489 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@66e44f9f, testMethod = testStoreAndLoadEventsWithUpcaster@AbstractEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@25cef4b3]; rollback [true]
2018-10-05 14:41:01,499 [main] INFO  ueryTranslatorFactoryInitiator  - HHH000397: Using ASTQueryTranslatorFactory
2018-10-05 14:41:01,588 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@66e44f9f, testMethod = testStoreAndLoadEventsWithUpcaster@AbstractEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-05 14:41:01,590 [main] INFO  GenericApplicationContext       - Closing org.springframework.context.support.GenericApplicationContext@363ee411: startup date [Fri Oct 05 14:41:00 CEST 2018]; root of context hierarchy
2018-10-05 14:41:01,591 [main] INFO  tainerEntityManagerFactoryBean  - Closing JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-05 14:41:01,593 [main] INFO  XmlBeanDefinitionReader         - Loading XML bean definitions from class path resource [META-INF/spring/db-context.xml]
2018-10-05 14:41:01,683 [main] INFO  GenericApplicationContext       - Refreshing org.springframework.context.support.GenericApplicationContext@13e6ab86: startup date [Fri Oct 05 14:41:01 CEST 2018]; root of context hierarchy
2018-10-05 14:41:01,712 [main] INFO  redAnnotationBeanPostProcessor  - JSR-330 'javax.inject.Inject' annotation found and supported for autowiring
2018-10-05 14:41:01,772 [main] INFO  DriverManagerDataSource         - Loaded JDBC driver: org.hsqldb.jdbcDriver
2018-10-05 14:41:01,788 [main] INFO  tainerEntityManagerFactoryBean  - Building JPA container EntityManagerFactory for persistence unit 'eventStore'
2018-10-05 14:41:01,788 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-05 14:41:01,859 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-05 14:41:02,101 [main] INFO  tainerEntityManagerFactoryBean  - Initialized JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-05 14:41:02,162 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@38e100ab, testMethod = testUniqueKeyConstraintOnEventIdentifier@AbstractEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@5fa0943d]; rollback [true]
2018-10-05 14:41:02,167 [main] INFO  ueryTranslatorFactoryInitiator  - HHH000397: Using ASTQueryTranslatorFactory
2018-10-05 14:41:02,203 [main] WARN  SqlExceptionHelper              - SQL Error: -104, SQLState: 23505
2018-10-05 14:41:02,205 [main] ERROR SqlExceptionHelper              - integrity constraint violation: unique constraint or index violation; UK_K5LT6D2792AMNLOO7Q91NJP0V table: DOMAINEVENTENTRY
2018-10-05 14:41:02,205 [main] INFO  AbstractBatchImpl               - HHH000010: On release of batch it still contained JDBC statements
2018-10-05 14:41:02,206 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@38e100ab, testMethod = testUniqueKeyConstraintOnEventIdentifier@AbstractEventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-05 14:41:02,208 [main] INFO  GenericApplicationContext       - Closing org.springframework.context.support.GenericApplicationContext@13e6ab86: startup date [Fri Oct 05 14:41:01 CEST 2018]; root of context hierarchy
2018-10-05 14:41:02,208 [main] INFO  tainerEntityManagerFactoryBean  - Closing JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-05 14:41:02,209 [main] INFO  XmlBeanDefinitionReader         - Loading XML bean definitions from class path resource [META-INF/spring/db-context.xml]
2018-10-05 14:41:02,210 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:02,248 [main] INFO  GenericApplicationContext       - Refreshing org.springframework.context.support.GenericApplicationContext@50ad5625: startup date [Fri Oct 05 14:41:02 CEST 2018]; root of context hierarchy
2018-10-05 14:41:02,261 [main] INFO  redAnnotationBeanPostProcessor  - JSR-330 'javax.inject.Inject' annotation found and supported for autowiring
2018-10-05 14:41:02,320 [main] INFO  DriverManagerDataSource         - Loaded JDBC driver: org.hsqldb.jdbcDriver
2018-10-05 14:41:02,344 [main] INFO  tainerEntityManagerFactoryBean  - Building JPA container EntityManagerFactory for persistence unit 'eventStore'
2018-10-05 14:41:02,349 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-05 14:41:02,462 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-05 14:41:02,779 [main] INFO  tainerEntityManagerFactoryBean  - Initialized JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-05 14:41:02,829 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@21bf1b1f, testMethod = testCreateTokenAtExactTime@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@3f213e97]; rollback [true]
2018-10-05 14:41:02,843 [main] INFO  ueryTranslatorFactoryInitiator  - HHH000397: Using ASTQueryTranslatorFactory
2018-10-05 14:41:02,901 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@21bf1b1f, testMethod = testCreateTokenAtExactTime@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-05 14:41:02,911 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@19e03398, testMethod = testCreateHeadToken@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@3f213e97]; rollback [true]
2018-10-05 14:41:02,937 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@19e03398, testMethod = testCreateHeadToken@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-05 14:41:02,944 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@55e75ce0, testMethod = testCreateTailToken@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@3f213e97]; rollback [true]
2018-10-05 14:41:02,974 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@55e75ce0, testMethod = testCreateTailToken@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-05 14:41:02,990 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@7f9b46ed, testMethod = testLoadNonExistent@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@3f213e97]; rollback [true]
2018-10-05 14:41:03,027 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@7f9b46ed, testMethod = testLoadNonExistent@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-05 14:41:03,036 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@26247027, testMethod = testCreateTokenAt@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@3f213e97]; rollback [true]
2018-10-05 14:41:03,075 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@26247027, testMethod = testCreateTokenAt@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-05 14:41:03,086 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@362fbd98, testMethod = testLoadPartialStreamOfTrackedEvents@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@3f213e97]; rollback [true]
2018-10-05 14:41:03,199 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@362fbd98, testMethod = testLoadPartialStreamOfTrackedEvents@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-05 14:41:03,204 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@4e301795, testMethod = testStoreAndLoadEvents@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@3f213e97]; rollback [true]
2018-10-05 14:41:03,212 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:03,232 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@4e301795, testMethod = testStoreAndLoadEvents@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-05 14:41:03,243 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@308498a8, testMethod = testCreateTokenWithUnorderedEvents@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@3f213e97]; rollback [true]
2018-10-05 14:41:03,283 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@308498a8, testMethod = testCreateTokenWithUnorderedEvents@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-05 14:41:03,292 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@75f579d2, testMethod = testReturnedEventMessageBehavior@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@3f213e97]; rollback [true]
2018-10-05 14:41:03,316 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@75f579d2, testMethod = testReturnedEventMessageBehavior@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-05 14:41:03,327 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@759862a2, testMethod = testReadPartialStream@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@3f213e97]; rollback [true]
2018-10-05 14:41:03,353 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@759862a2, testMethod = testReadPartialStream@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-05 14:41:03,358 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@22495f2f, testMethod = testLoadTrackedEvents@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@3f213e97]; rollback [true]
2018-10-05 14:41:03,438 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@22495f2f, testMethod = testLoadTrackedEvents@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-05 14:41:03,445 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@4f78adf, testMethod = testStoreAndLoadEventsArray@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@3f213e97]; rollback [true]
2018-10-05 14:41:03,459 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@4f78adf, testMethod = testStoreAndLoadEventsArray@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-05 14:41:03,464 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@7f680a9a, testMethod = testStoreAndLoadApplicationEvent@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@3f213e97]; rollback [true]
2018-10-05 14:41:03,510 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@7f680a9a, testMethod = testStoreAndLoadApplicationEvent@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-05 14:41:03,514 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@727b3b0, testMethod = testStoreAndLoadSnapshot@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@3f213e97]; rollback [true]
2018-10-05 14:41:03,537 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@483fe83a testClass = JpaEventStorageEngineTest, testInstance = org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest@727b3b0, testMethod = testStoreAndLoadSnapshot@EventStorageEngineTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@74babce8 testClass = JpaEventStorageEngineTest, locations = '{classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
Tests run: 27, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 8.852 sec - in org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngineTest
Running org.axonframework.eventsourcing.eventstore.jpa.DomainEventEntryTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.003 sec - in org.axonframework.eventsourcing.eventstore.jpa.DomainEventEntryTest
Running org.axonframework.eventsourcing.eventstore.EmbeddedEventStoreTest
2018-10-05 14:41:03,954 [main] WARN  AbstractEventStore              - Error reading snapshot for aggregate [aggregate]. Reconstructing from entire event stream.
org.axonframework.common.MockException: Mock
2018-10-05 14:41:04,225 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:04,874 [EmbeddedEventStore-1] WARN  EmbeddedEventStore              - An event processor fell behind the tail end of the event store cache. This usually indicates a badly performing event processor.
Tests run: 16, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 1.423 sec - in org.axonframework.eventsourcing.eventstore.EmbeddedEventStoreTest
Running org.axonframework.eventsourcing.eventstore.EqualRevisionPredicateTest
Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.021 sec - in org.axonframework.eventsourcing.eventstore.EqualRevisionPredicateTest
Running org.axonframework.eventsourcing.eventstore.FilteringDomainEventStreamTest
Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.002 sec - in org.axonframework.eventsourcing.eventstore.FilteringDomainEventStreamTest
Running org.axonframework.eventsourcing.eventstore.TrackingTokenParameterResolverFactoryTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 sec - in org.axonframework.eventsourcing.eventstore.TrackingTokenParameterResolverFactoryTest
Running org.axonframework.eventsourcing.eventstore.SequenceEventStorageEngineTest
Tests run: 11, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.04 sec - in org.axonframework.eventsourcing.eventstore.SequenceEventStorageEngineTest
Running org.axonframework.eventsourcing.eventstore.GlobalSequenceTrackingTokenTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.eventsourcing.eventstore.GlobalSequenceTrackingTokenTest
Running org.axonframework.eventsourcing.eventstore.ConcatenatingDomainEventStreamTest
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 sec - in org.axonframework.eventsourcing.eventstore.ConcatenatingDomainEventStreamTest
Running org.axonframework.eventsourcing.eventstore.inmemory.InMemoryEventStorageEngineTest
Tests run: 14, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.018 sec - in org.axonframework.eventsourcing.eventstore.inmemory.InMemoryEventStorageEngineTest
Running org.axonframework.eventsourcing.eventstore.GapAwareTrackingTokenTest
2018-10-05 14:41:05,231 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
Tests run: 12, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 1.065 sec - in org.axonframework.eventsourcing.eventstore.GapAwareTrackingTokenTest
Running org.axonframework.eventsourcing.eventstore.EventUtilsTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.009 sec - in org.axonframework.eventsourcing.eventstore.EventUtilsTest
Running org.axonframework.eventsourcing.GenericAggregateFactoryTest
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.004 sec - in org.axonframework.eventsourcing.GenericAggregateFactoryTest
Running org.axonframework.eventsourcing.AggregateSnapshotterTest
2018-10-05 14:41:06,232 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.109 sec - in org.axonframework.eventsourcing.AggregateSnapshotterTest
Running org.axonframework.eventsourcing.FilteringEventStorageEngineTest
Tests run: 6, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.006 sec - in org.axonframework.eventsourcing.FilteringEventStorageEngineTest
Running org.axonframework.eventsourcing.GenericDomainEventMessageTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.004 sec - in org.axonframework.eventsourcing.GenericDomainEventMessageTest
Running org.axonframework.eventsourcing.CachingRepositoryWithNestedUnitOfWorkTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.332 sec - in org.axonframework.eventsourcing.CachingRepositoryWithNestedUnitOfWorkTest
Running org.axonframework.eventsourcing.NoSnapshotTriggerDefinitionTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 sec - in org.axonframework.eventsourcing.NoSnapshotTriggerDefinitionTest
Running org.axonframework.eventsourcing.CachingEventSourcingRepositoryTest
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.12 sec - in org.axonframework.eventsourcing.CachingEventSourcingRepositoryTest
Running org.axonframework.eventsourcing.NestedUnitOfWorkTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.105 sec - in org.axonframework.eventsourcing.NestedUnitOfWorkTest
Running org.axonframework.eventsourcing.EventSourcingRepositoryTest
Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.05 sec - in org.axonframework.eventsourcing.EventSourcingRepositoryTest
Running org.axonframework.eventsourcing.EventCountSnapshotTriggerDefinitionTest
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.02 sec - in org.axonframework.eventsourcing.EventCountSnapshotTriggerDefinitionTest
Running org.axonframework.eventsourcing.DomainEventStreamTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.eventsourcing.DomainEventStreamTest
Running org.axonframework.eventsourcing.EventSourcingRepositoryIntegrationTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.073 sec - in org.axonframework.eventsourcing.EventSourcingRepositoryIntegrationTest
Running org.axonframework.eventsourcing.AbstractSnapshotterTest
Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.112 sec - in org.axonframework.eventsourcing.AbstractSnapshotterTest
Running org.axonframework.eventhandling.SimpleEventHandlerInvokerTest
Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.023 sec - in org.axonframework.eventhandling.SimpleEventHandlerInvokerTest
Running org.axonframework.eventhandling.saga.repository.jpa.JpaSagaStoreTest
2018-10-05 14:41:07,141 [main] INFO  DefaultTestContextBootstrapper  - Loaded default TestExecutionListener class names from location [META-INF/spring.factories]: [org.springframework.test.context.web.ServletTestExecutionListener, org.springframework.test.context.support.DirtiesContextBeforeModesTestExecutionListener, org.springframework.test.context.support.DependencyInjectionTestExecutionListener, org.springframework.test.context.support.DirtiesContextTestExecutionListener, org.springframework.test.context.transaction.TransactionalTestExecutionListener, org.springframework.test.context.jdbc.SqlScriptsTestExecutionListener]
2018-10-05 14:41:07,142 [main] INFO  DefaultTestContextBootstrapper  - Using TestExecutionListeners: [org.springframework.test.context.support.DirtiesContextBeforeModesTestExecutionListener@4e67f0a0, org.springframework.test.context.support.DependencyInjectionTestExecutionListener@656c356c, org.springframework.test.context.support.DirtiesContextTestExecutionListener@3146c61d, org.springframework.test.context.transaction.TransactionalTestExecutionListener@6321e29b, org.springframework.test.context.jdbc.SqlScriptsTestExecutionListener@12b2fcaf]
2018-10-05 14:41:07,144 [main] INFO  XmlBeanDefinitionReader         - Loading XML bean definitions from class path resource [META-INF/spring/saga-repository-test.xml]
2018-10-05 14:41:07,173 [main] INFO  XmlBeanDefinitionReader         - Loading XML bean definitions from class path resource [META-INF/spring/db-context.xml]
2018-10-05 14:41:07,213 [main] INFO  GenericApplicationContext       - Refreshing org.springframework.context.support.GenericApplicationContext@16716cc0: startup date [Fri Oct 05 14:41:07 CEST 2018]; root of context hierarchy
2018-10-05 14:41:07,233 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:07,239 [main] INFO  redAnnotationBeanPostProcessor  - JSR-330 'javax.inject.Inject' annotation found and supported for autowiring
2018-10-05 14:41:07,282 [main] INFO  DriverManagerDataSource         - Loaded JDBC driver: org.hsqldb.jdbcDriver
2018-10-05 14:41:07,294 [main] INFO  tainerEntityManagerFactoryBean  - Building JPA container EntityManagerFactory for persistence unit 'eventStore'
2018-10-05 14:41:07,294 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-05 14:41:07,373 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-05 14:41:07,642 [main] WARN  EntityManagerFactoryRegistry    - HHH000436: Entity manager factory name (eventStore) is already registered.  If entity manager will be clustered or passivated, specify a unique value for property 'hibernate.ejb.entitymanager_factory_name'
2018-10-05 14:41:07,643 [main] INFO  tainerEntityManagerFactoryBean  - Initialized JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-05 14:41:07,704 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@6e1ac80e testClass = JpaSagaStoreTest, testInstance = org.axonframework.eventhandling.saga.repository.jpa.JpaSagaStoreTest@4170ee0f, testMethod = testEndSaga@JpaSagaStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@4b95fdf2 testClass = JpaSagaStoreTest, locations = '{classpath:/META-INF/spring/saga-repository-test.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@2de22e7]; rollback [true]
2018-10-05 14:41:07,712 [main] INFO  ueryTranslatorFactoryInitiator  - HHH000397: Using ASTQueryTranslatorFactory
2018-10-05 14:41:07,779 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@6e1ac80e testClass = JpaSagaStoreTest, testInstance = org.axonframework.eventhandling.saga.repository.jpa.JpaSagaStoreTest@4170ee0f, testMethod = testEndSaga@JpaSagaStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@4b95fdf2 testClass = JpaSagaStoreTest, locations = '{classpath:/META-INF/spring/saga-repository-test.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-05 14:41:07,779 [main] INFO  GenericApplicationContext       - Closing org.springframework.context.support.GenericApplicationContext@16716cc0: startup date [Fri Oct 05 14:41:07 CEST 2018]; root of context hierarchy
2018-10-05 14:41:07,780 [main] INFO  tainerEntityManagerFactoryBean  - Closing JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-05 14:41:07,781 [main] INFO  XmlBeanDefinitionReader         - Loading XML bean definitions from class path resource [META-INF/spring/saga-repository-test.xml]
2018-10-05 14:41:07,802 [main] INFO  XmlBeanDefinitionReader         - Loading XML bean definitions from class path resource [META-INF/spring/db-context.xml]
2018-10-05 14:41:07,830 [main] INFO  GenericApplicationContext       - Refreshing org.springframework.context.support.GenericApplicationContext@62a193e0: startup date [Fri Oct 05 14:41:07 CEST 2018]; root of context hierarchy
2018-10-05 14:41:07,844 [main] INFO  redAnnotationBeanPostProcessor  - JSR-330 'javax.inject.Inject' annotation found and supported for autowiring
2018-10-05 14:41:07,873 [main] INFO  DriverManagerDataSource         - Loaded JDBC driver: org.hsqldb.jdbcDriver
2018-10-05 14:41:07,881 [main] INFO  tainerEntityManagerFactoryBean  - Building JPA container EntityManagerFactory for persistence unit 'eventStore'
2018-10-05 14:41:07,881 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-05 14:41:07,960 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-05 14:41:08,104 [main] WARN  EntityManagerFactoryRegistry    - HHH000436: Entity manager factory name (eventStore) is already registered.  If entity manager will be clustered or passivated, specify a unique value for property 'hibernate.ejb.entitymanager_factory_name'
2018-10-05 14:41:08,104 [main] INFO  tainerEntityManagerFactoryBean  - Initialized JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-05 14:41:08,156 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@6e1ac80e testClass = JpaSagaStoreTest, testInstance = org.axonframework.eventhandling.saga.repository.jpa.JpaSagaStoreTest@522fdf0c, testMethod = testAddingAnInactiveSagaDoesntStoreIt@JpaSagaStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@4b95fdf2 testClass = JpaSagaStoreTest, locations = '{classpath:/META-INF/spring/saga-repository-test.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@26169be3]; rollback [true]
2018-10-05 14:41:08,160 [main] INFO  ueryTranslatorFactoryInitiator  - HHH000397: Using ASTQueryTranslatorFactory
2018-10-05 14:41:08,235 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:08,273 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@6e1ac80e testClass = JpaSagaStoreTest, testInstance = org.axonframework.eventhandling.saga.repository.jpa.JpaSagaStoreTest@522fdf0c, testMethod = testAddingAnInactiveSagaDoesntStoreIt@JpaSagaStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@4b95fdf2 testClass = JpaSagaStoreTest, locations = '{classpath:/META-INF/spring/saga-repository-test.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-05 14:41:08,274 [main] INFO  GenericApplicationContext       - Closing org.springframework.context.support.GenericApplicationContext@62a193e0: startup date [Fri Oct 05 14:41:07 CEST 2018]; root of context hierarchy
2018-10-05 14:41:08,274 [main] INFO  tainerEntityManagerFactoryBean  - Closing JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-05 14:41:08,280 [main] INFO  XmlBeanDefinitionReader         - Loading XML bean definitions from class path resource [META-INF/spring/saga-repository-test.xml]
2018-10-05 14:41:08,311 [main] INFO  XmlBeanDefinitionReader         - Loading XML bean definitions from class path resource [META-INF/spring/db-context.xml]
2018-10-05 14:41:08,344 [main] INFO  GenericApplicationContext       - Refreshing org.springframework.context.support.GenericApplicationContext@67171221: startup date [Fri Oct 05 14:41:08 CEST 2018]; root of context hierarchy
2018-10-05 14:41:08,356 [main] INFO  redAnnotationBeanPostProcessor  - JSR-330 'javax.inject.Inject' annotation found and supported for autowiring
2018-10-05 14:41:08,396 [main] INFO  DriverManagerDataSource         - Loaded JDBC driver: org.hsqldb.jdbcDriver
2018-10-05 14:41:08,406 [main] INFO  tainerEntityManagerFactoryBean  - Building JPA container EntityManagerFactory for persistence unit 'eventStore'
2018-10-05 14:41:08,406 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-05 14:41:08,476 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-05 14:41:08,661 [main] WARN  EntityManagerFactoryRegistry    - HHH000436: Entity manager factory name (eventStore) is already registered.  If entity manager will be clustered or passivated, specify a unique value for property 'hibernate.ejb.entitymanager_factory_name'
2018-10-05 14:41:08,661 [main] INFO  tainerEntityManagerFactoryBean  - Initialized JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-05 14:41:08,702 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@6e1ac80e testClass = JpaSagaStoreTest, testInstance = org.axonframework.eventhandling.saga.repository.jpa.JpaSagaStoreTest@239fdf8f, testMethod = testLoadSaga_AssociationValueRemoved@JpaSagaStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@4b95fdf2 testClass = JpaSagaStoreTest, locations = '{classpath:/META-INF/spring/saga-repository-test.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@504521ae]; rollback [true]
2018-10-05 14:41:08,706 [main] INFO  ueryTranslatorFactoryInitiator  - HHH000397: Using ASTQueryTranslatorFactory
2018-10-05 14:41:08,749 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@6e1ac80e testClass = JpaSagaStoreTest, testInstance = org.axonframework.eventhandling.saga.repository.jpa.JpaSagaStoreTest@239fdf8f, testMethod = testLoadSaga_AssociationValueRemoved@JpaSagaStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@4b95fdf2 testClass = JpaSagaStoreTest, locations = '{classpath:/META-INF/spring/saga-repository-test.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-05 14:41:08,750 [main] INFO  GenericApplicationContext       - Closing org.springframework.context.support.GenericApplicationContext@67171221: startup date [Fri Oct 05 14:41:08 CEST 2018]; root of context hierarchy
2018-10-05 14:41:08,750 [main] INFO  tainerEntityManagerFactoryBean  - Closing JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-05 14:41:08,751 [main] INFO  XmlBeanDefinitionReader         - Loading XML bean definitions from class path resource [META-INF/spring/saga-repository-test.xml]
2018-10-05 14:41:08,769 [main] INFO  XmlBeanDefinitionReader         - Loading XML bean definitions from class path resource [META-INF/spring/db-context.xml]
2018-10-05 14:41:08,789 [main] INFO  GenericApplicationContext       - Refreshing org.springframework.context.support.GenericApplicationContext@b0c4670: startup date [Fri Oct 05 14:41:08 CEST 2018]; root of context hierarchy
2018-10-05 14:41:08,800 [main] INFO  redAnnotationBeanPostProcessor  - JSR-330 'javax.inject.Inject' annotation found and supported for autowiring
2018-10-05 14:41:08,832 [main] INFO  DriverManagerDataSource         - Loaded JDBC driver: org.hsqldb.jdbcDriver
2018-10-05 14:41:08,842 [main] INFO  tainerEntityManagerFactoryBean  - Building JPA container EntityManagerFactory for persistence unit 'eventStore'
2018-10-05 14:41:08,843 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-05 14:41:08,910 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-05 14:41:09,077 [main] WARN  EntityManagerFactoryRegistry    - HHH000436: Entity manager factory name (eventStore) is already registered.  If entity manager will be clustered or passivated, specify a unique value for property 'hibernate.ejb.entitymanager_factory_name'
2018-10-05 14:41:09,077 [main] INFO  tainerEntityManagerFactoryBean  - Initialized JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-05 14:41:09,123 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@6e1ac80e testClass = JpaSagaStoreTest, testInstance = org.axonframework.eventhandling.saga.repository.jpa.JpaSagaStoreTest@6f64c40c, testMethod = testStoreSagaWithCustomEntity@JpaSagaStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@4b95fdf2 testClass = JpaSagaStoreTest, locations = '{classpath:/META-INF/spring/saga-repository-test.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@5fc3333f]; rollback [true]
2018-10-05 14:41:09,126 [main] INFO  ueryTranslatorFactoryInitiator  - HHH000397: Using ASTQueryTranslatorFactory
2018-10-05 14:41:09,171 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@6e1ac80e testClass = JpaSagaStoreTest, testInstance = org.axonframework.eventhandling.saga.repository.jpa.JpaSagaStoreTest@6f64c40c, testMethod = testStoreSagaWithCustomEntity@JpaSagaStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@4b95fdf2 testClass = JpaSagaStoreTest, locations = '{classpath:/META-INF/spring/saga-repository-test.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-05 14:41:09,172 [main] INFO  GenericApplicationContext       - Closing org.springframework.context.support.GenericApplicationContext@b0c4670: startup date [Fri Oct 05 14:41:08 CEST 2018]; root of context hierarchy
2018-10-05 14:41:09,172 [main] INFO  tainerEntityManagerFactoryBean  - Closing JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-05 14:41:09,173 [main] INFO  XmlBeanDefinitionReader         - Loading XML bean definitions from class path resource [META-INF/spring/saga-repository-test.xml]
2018-10-05 14:41:09,191 [main] INFO  XmlBeanDefinitionReader         - Loading XML bean definitions from class path resource [META-INF/spring/db-context.xml]
2018-10-05 14:41:09,210 [main] INFO  GenericApplicationContext       - Refreshing org.springframework.context.support.GenericApplicationContext@377d66f: startup date [Fri Oct 05 14:41:09 CEST 2018]; root of context hierarchy
2018-10-05 14:41:09,220 [main] INFO  redAnnotationBeanPostProcessor  - JSR-330 'javax.inject.Inject' annotation found and supported for autowiring
2018-10-05 14:41:09,248 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:09,257 [main] INFO  DriverManagerDataSource         - Loaded JDBC driver: org.hsqldb.jdbcDriver
2018-10-05 14:41:09,269 [main] INFO  tainerEntityManagerFactoryBean  - Building JPA container EntityManagerFactory for persistence unit 'eventStore'
2018-10-05 14:41:09,269 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-05 14:41:09,355 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-05 14:41:09,541 [main] WARN  EntityManagerFactoryRegistry    - HHH000436: Entity manager factory name (eventStore) is already registered.  If entity manager will be clustered or passivated, specify a unique value for property 'hibernate.ejb.entitymanager_factory_name'
2018-10-05 14:41:09,541 [main] INFO  tainerEntityManagerFactoryBean  - Initialized JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-05 14:41:09,585 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@6e1ac80e testClass = JpaSagaStoreTest, testInstance = org.axonframework.eventhandling.saga.repository.jpa.JpaSagaStoreTest@474c8d42, testMethod = testAddAndLoadSaga_ByAssociationValue@JpaSagaStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@4b95fdf2 testClass = JpaSagaStoreTest, locations = '{classpath:/META-INF/spring/saga-repository-test.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@629e9957]; rollback [true]
2018-10-05 14:41:09,588 [main] INFO  ueryTranslatorFactoryInitiator  - HHH000397: Using ASTQueryTranslatorFactory
2018-10-05 14:41:09,610 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@6e1ac80e testClass = JpaSagaStoreTest, testInstance = org.axonframework.eventhandling.saga.repository.jpa.JpaSagaStoreTest@474c8d42, testMethod = testAddAndLoadSaga_ByAssociationValue@JpaSagaStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@4b95fdf2 testClass = JpaSagaStoreTest, locations = '{classpath:/META-INF/spring/saga-repository-test.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-05 14:41:09,610 [main] INFO  GenericApplicationContext       - Closing org.springframework.context.support.GenericApplicationContext@377d66f: startup date [Fri Oct 05 14:41:09 CEST 2018]; root of context hierarchy
2018-10-05 14:41:09,610 [main] INFO  tainerEntityManagerFactoryBean  - Closing JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-05 14:41:09,611 [main] INFO  XmlBeanDefinitionReader         - Loading XML bean definitions from class path resource [META-INF/spring/saga-repository-test.xml]
2018-10-05 14:41:09,626 [main] INFO  XmlBeanDefinitionReader         - Loading XML bean definitions from class path resource [META-INF/spring/db-context.xml]
2018-10-05 14:41:09,639 [main] INFO  GenericApplicationContext       - Refreshing org.springframework.context.support.GenericApplicationContext@a538180: startup date [Fri Oct 05 14:41:09 CEST 2018]; root of context hierarchy
2018-10-05 14:41:09,647 [main] INFO  redAnnotationBeanPostProcessor  - JSR-330 'javax.inject.Inject' annotation found and supported for autowiring
2018-10-05 14:41:09,676 [main] INFO  DriverManagerDataSource         - Loaded JDBC driver: org.hsqldb.jdbcDriver
2018-10-05 14:41:09,683 [main] INFO  tainerEntityManagerFactoryBean  - Building JPA container EntityManagerFactory for persistence unit 'eventStore'
2018-10-05 14:41:09,683 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-05 14:41:09,746 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-05 14:41:09,910 [main] WARN  EntityManagerFactoryRegistry    - HHH000436: Entity manager factory name (eventStore) is already registered.  If entity manager will be clustered or passivated, specify a unique value for property 'hibernate.ejb.entitymanager_factory_name'
2018-10-05 14:41:09,910 [main] INFO  tainerEntityManagerFactoryBean  - Initialized JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-05 14:41:09,946 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@6e1ac80e testClass = JpaSagaStoreTest, testInstance = org.axonframework.eventhandling.saga.repository.jpa.JpaSagaStoreTest@66113b7c, testMethod = testAddAndLoadSaga_ByIdentifier@JpaSagaStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@4b95fdf2 testClass = JpaSagaStoreTest, locations = '{classpath:/META-INF/spring/saga-repository-test.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@2033fd39]; rollback [true]
2018-10-05 14:41:09,949 [main] INFO  ueryTranslatorFactoryInitiator  - HHH000397: Using ASTQueryTranslatorFactory
2018-10-05 14:41:09,975 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@6e1ac80e testClass = JpaSagaStoreTest, testInstance = org.axonframework.eventhandling.saga.repository.jpa.JpaSagaStoreTest@66113b7c, testMethod = testAddAndLoadSaga_ByIdentifier@JpaSagaStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@4b95fdf2 testClass = JpaSagaStoreTest, locations = '{classpath:/META-INF/spring/saga-repository-test.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-05 14:41:09,976 [main] INFO  GenericApplicationContext       - Closing org.springframework.context.support.GenericApplicationContext@a538180: startup date [Fri Oct 05 14:41:09 CEST 2018]; root of context hierarchy
2018-10-05 14:41:09,976 [main] INFO  tainerEntityManagerFactoryBean  - Closing JPA EntityManagerFactory for persistence unit 'eventStore'
Tests run: 6, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 2.84 sec - in org.axonframework.eventhandling.saga.repository.jpa.JpaSagaStoreTest
Running org.axonframework.eventhandling.saga.repository.jdbc.JdbcSagaStoreTest
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.17 sec - in org.axonframework.eventhandling.saga.repository.jdbc.JdbcSagaStoreTest
Running org.axonframework.eventhandling.saga.repository.AssociationValueMapTest
2018-10-05 14:41:10,249 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.11 sec - in org.axonframework.eventhandling.saga.repository.AssociationValueMapTest
Running org.axonframework.eventhandling.saga.repository.CachingSagaStoreTest
Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.297 sec - in org.axonframework.eventhandling.saga.repository.CachingSagaStoreTest
Running org.axonframework.eventhandling.saga.repository.AnnotatedSagaRepositoryTest
Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.012 sec - in org.axonframework.eventhandling.saga.repository.AnnotatedSagaRepositoryTest
Running org.axonframework.eventhandling.saga.repository.LockingSagaRepositoryTest
Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.066 sec - in org.axonframework.eventhandling.saga.repository.LockingSagaRepositoryTest
Running org.axonframework.eventhandling.saga.AnnotatedSagaTest
Tests run: 7, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.065 sec - in org.axonframework.eventhandling.saga.AnnotatedSagaTest
Running org.axonframework.eventhandling.saga.AnnotatedSagaManagerTest
Tests run: 11, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.182 sec - in org.axonframework.eventhandling.saga.AnnotatedSagaManagerTest
Running org.axonframework.eventhandling.saga.AssociationValuesImplTest
Tests run: 8, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 sec - in org.axonframework.eventhandling.saga.AssociationValuesImplTest
Running org.axonframework.eventhandling.saga.SagaManagerTest
Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.045 sec - in org.axonframework.eventhandling.saga.SagaManagerTest
Running org.axonframework.eventhandling.saga.metamodel.AnnotationSagaMetaModelFactoryTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.003 sec - in org.axonframework.eventhandling.saga.metamodel.AnnotationSagaMetaModelFactoryTest
Running org.axonframework.eventhandling.saga.SimpleResourceInjectorTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.011 sec - in org.axonframework.eventhandling.saga.SimpleResourceInjectorTest
Running org.axonframework.eventhandling.tokenstore.jdbc.JdbcTokenStoreTest
2018-10-05 14:41:10,961 [main] INFO  AbstractContextLoader           - Could not detect default resource locations for test class [org.axonframework.eventhandling.tokenstore.jdbc.JdbcTokenStoreTest]: no resource found for suffixes {-context.xml}.
2018-10-05 14:41:10,964 [main] INFO  ctDelegatingSmartContextLoader  - AnnotationConfigContextLoader detected default configuration classes for context configuration [ContextConfigurationAttributes@3c38f10b declaringClass = 'org.axonframework.eventhandling.tokenstore.jdbc.JdbcTokenStoreTest', classes = '{class org.axonframework.eventhandling.tokenstore.jdbc.JdbcTokenStoreTest$Context}', locations = '{}', inheritLocations = true, initializers = '{}', inheritInitializers = true, name = [null], contextLoaderClass = 'org.springframework.test.context.ContextLoader'].
2018-10-05 14:41:10,966 [main] INFO  DefaultTestContextBootstrapper  - Loaded default TestExecutionListener class names from location [META-INF/spring.factories]: [org.springframework.test.context.web.ServletTestExecutionListener, org.springframework.test.context.support.DirtiesContextBeforeModesTestExecutionListener, org.springframework.test.context.support.DependencyInjectionTestExecutionListener, org.springframework.test.context.support.DirtiesContextTestExecutionListener, org.springframework.test.context.transaction.TransactionalTestExecutionListener, org.springframework.test.context.jdbc.SqlScriptsTestExecutionListener]
2018-10-05 14:41:10,967 [main] INFO  DefaultTestContextBootstrapper  - Using TestExecutionListeners: [org.springframework.test.context.support.DirtiesContextBeforeModesTestExecutionListener@1ab08e83, org.springframework.test.context.support.DependencyInjectionTestExecutionListener@7f6a0c29, org.springframework.test.context.support.DirtiesContextTestExecutionListener@4211a66, org.springframework.test.context.transaction.TransactionalTestExecutionListener@1ccab629, org.springframework.test.context.jdbc.SqlScriptsTestExecutionListener@210e7a5]
2018-10-05 14:41:10,986 [main] INFO  GenericApplicationContext       - Refreshing org.springframework.context.support.GenericApplicationContext@214a7560: startup date [Fri Oct 05 14:41:10 CEST 2018]; root of context hierarchy
2018-10-05 14:41:11,042 [main] INFO  redAnnotationBeanPostProcessor  - JSR-330 'javax.inject.Inject' annotation found and supported for autowiring
2018-10-05 14:41:11,219 [main] WARN  JdbcTokenStore                  - Releasing claim of token stealing/0 failed. It was owned by another node.
2018-10-05 14:41:11,250 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@7df63a2d testClass = JdbcTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jdbc.JdbcTokenStoreTest@2682fe42, testMethod = testInitializeTokensWhileAlreadyPresent@JdbcTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@27f73e68 testClass = JdbcTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jdbc.JdbcTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.jdbc.datasource.DataSourceTransactionManager@3815c525]; rollback [true]
2018-10-05 14:41:11,251 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:11,262 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@7df63a2d testClass = JdbcTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jdbc.JdbcTokenStoreTest@2682fe42, testMethod = testInitializeTokensWhileAlreadyPresent@JdbcTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@27f73e68 testClass = JdbcTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jdbc.JdbcTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-05 14:41:11,268 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@7df63a2d testClass = JdbcTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jdbc.JdbcTokenStoreTest@43a65f56, testMethod = testInitializeTokens@JdbcTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@27f73e68 testClass = JdbcTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jdbc.JdbcTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.jdbc.datasource.DataSourceTransactionManager@3815c525]; rollback [true]
2018-10-05 14:41:11,275 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@7df63a2d testClass = JdbcTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jdbc.JdbcTokenStoreTest@43a65f56, testMethod = testInitializeTokens@JdbcTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@27f73e68 testClass = JdbcTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jdbc.JdbcTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-05 14:41:11,277 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@7df63a2d testClass = JdbcTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jdbc.JdbcTokenStoreTest@bab7179, testMethod = testQuerySegments@JdbcTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@27f73e68 testClass = JdbcTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jdbc.JdbcTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.jdbc.datasource.DataSourceTransactionManager@3815c525]; rollback [true]
2018-10-05 14:41:11,286 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@7df63a2d testClass = JdbcTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jdbc.JdbcTokenStoreTest@bab7179, testMethod = testQuerySegments@JdbcTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@27f73e68 testClass = JdbcTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jdbc.JdbcTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-05 14:41:11,304 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@7df63a2d testClass = JdbcTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jdbc.JdbcTokenStoreTest@2429a26f, testMethod = testInitializeTokensAtGivenPosition@JdbcTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@27f73e68 testClass = JdbcTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jdbc.JdbcTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.jdbc.datasource.DataSourceTransactionManager@3815c525]; rollback [true]
2018-10-05 14:41:11,319 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@7df63a2d testClass = JdbcTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jdbc.JdbcTokenStoreTest@2429a26f, testMethod = testInitializeTokensAtGivenPosition@JdbcTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@27f73e68 testClass = JdbcTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jdbc.JdbcTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
Tests run: 11, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.375 sec - in org.axonframework.eventhandling.tokenstore.jdbc.JdbcTokenStoreTest
Running org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest
2018-10-05 14:41:11,341 [main] INFO  AbstractContextLoader           - Could not detect default resource locations for test class [org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest]: no resource found for suffixes {-context.xml}.
2018-10-05 14:41:11,342 [main] INFO  ctDelegatingSmartContextLoader  - AnnotationConfigContextLoader detected default configuration classes for context configuration [ContextConfigurationAttributes@550afff7 declaringClass = 'org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest', classes = '{class org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest$Context}', locations = '{}', inheritLocations = true, initializers = '{}', inheritInitializers = true, name = [null], contextLoaderClass = 'org.springframework.test.context.ContextLoader'].
2018-10-05 14:41:11,343 [main] INFO  DefaultTestContextBootstrapper  - Loaded default TestExecutionListener class names from location [META-INF/spring.factories]: [org.springframework.test.context.web.ServletTestExecutionListener, org.springframework.test.context.support.DirtiesContextBeforeModesTestExecutionListener, org.springframework.test.context.support.DependencyInjectionTestExecutionListener, org.springframework.test.context.support.DirtiesContextTestExecutionListener, org.springframework.test.context.transaction.TransactionalTestExecutionListener, org.springframework.test.context.jdbc.SqlScriptsTestExecutionListener]
2018-10-05 14:41:11,344 [main] INFO  DefaultTestContextBootstrapper  - Using TestExecutionListeners: [org.springframework.test.context.support.DirtiesContextBeforeModesTestExecutionListener@4805d11b, org.springframework.test.context.support.DependencyInjectionTestExecutionListener@3f6094da, org.springframework.test.context.support.DirtiesContextTestExecutionListener@7d726fa1, org.springframework.test.context.transaction.TransactionalTestExecutionListener@7f05d2bf, org.springframework.test.context.jdbc.SqlScriptsTestExecutionListener@196e494d]
2018-10-05 14:41:11,346 [main] INFO  GenericApplicationContext       - Refreshing org.springframework.context.support.GenericApplicationContext@4cf2b47a: startup date [Fri Oct 05 14:41:11 CEST 2018]; root of context hierarchy
2018-10-05 14:41:11,372 [main] INFO  redAnnotationBeanPostProcessor  - JSR-330 'javax.inject.Inject' annotation found and supported for autowiring
2018-10-05 14:41:11,408 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-05 14:41:11,458 [main] INFO  tainerEntityManagerFactoryBean  - Building JPA container EntityManagerFactory for persistence unit 'default'
2018-10-05 14:41:11,459 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: default
	...]
2018-10-05 14:41:11,556 [main] WARN  connections                     - HHH10001002: Using Hibernate built-in connection pool (not for production use!)
2018-10-05 14:41:11,558 [main] INFO  connections                     - HHH10001005: using driver [null] at URL [jdbc:hsqldb:mem:testdb]
2018-10-05 14:41:11,559 [main] INFO  connections                     - HHH10001001: Connection properties: {}
2018-10-05 14:41:11,559 [main] INFO  connections                     - HHH10001003: Autocommit mode: false
2018-10-05 14:41:11,563 [main] INFO  rManagerConnectionProviderImpl  - HHH000115: Hibernate connection pool size: 20 (min=1)
Hibernate: drop table TokenEntry if exists
Hibernate: create table TokenEntry (processorName varchar(255) not null, segment integer not null, owner varchar(255), timestamp varchar(255) not null, token blob(10000), tokenType varchar(255), primary key (processorName, segment))
2018-10-05 14:41:11,632 [main] INFO  SchemaCreatorImpl               - HHH000476: Executing import script 'org.hibernate.tool.schema.internal.exec.ScriptSourceInputNonExistentImpl@581b9fe6'
2018-10-05 14:41:11,642 [main] INFO  tainerEntityManagerFactoryBean  - Initialized JPA EntityManagerFactory for persistence unit 'default'
2018-10-05 14:41:11,745 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@6d9f78a6 testClass = JpaTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest@46bd6c87, testMethod = testStealToken@JpaTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@150cc1ea testClass = JpaTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@7ce00985]; rollback [true]
Hibernate: select tokenentry0_.processorName as processo1_0_0_, tokenentry0_.segment as segment2_0_0_, tokenentry0_.owner as owner3_0_0_, tokenentry0_.timestamp as timestam4_0_0_, tokenentry0_.token as token5_0_0_, tokenentry0_.tokenType as tokenTyp6_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? and tokenentry0_.segment=? for update
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: select processorName from TokenEntry where processorName =? and segment =? for update
2018-10-05 14:41:11,752 [main] INFO  ueryTranslatorFactoryInitiator  - HHH000397: Using ASTQueryTranslatorFactory
Hibernate: update TokenEntry set owner=?, timestamp=?, token=?, tokenType=? where processorName=? and segment=?
Hibernate: update TokenEntry set owner=null where owner=? and processorName=? and segment=?
2018-10-05 14:41:11,759 [main] WARN  JpaTokenStore                   - Releasing claim of token stealing/0 failed. It was not owned by local
Hibernate: select processorName from TokenEntry where processorName =? and segment =? for update
2018-10-05 14:41:11,763 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@6d9f78a6 testClass = JpaTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest@46bd6c87, testMethod = testStealToken@JpaTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@150cc1ea testClass = JpaTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
Hibernate: select tokenentry0_.processorName as processo1_0_0_, tokenentry0_.segment as segment2_0_0_, tokenentry0_.owner as owner3_0_0_, tokenentry0_.timestamp as timestam4_0_0_, tokenentry0_.token as token5_0_0_, tokenentry0_.tokenType as tokenTyp6_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? and tokenentry0_.segment=? for update
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: select processorName from TokenEntry where processorName =? and segment =? for update
Hibernate: update TokenEntry set owner=?, timestamp=?, token=?, tokenType=? where processorName=? and segment=?
Hibernate: select tokenentry0_.processorName as processo1_0_0_, tokenentry0_.segment as segment2_0_0_, tokenentry0_.owner as owner3_0_0_, tokenentry0_.timestamp as timestam4_0_0_, tokenentry0_.token as token5_0_0_, tokenentry0_.tokenType as tokenTyp6_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? and tokenentry0_.segment=? for update
Hibernate: update TokenEntry set owner=?, timestamp=?, token=?, tokenType=? where processorName=? and segment=?
Hibernate: select tokenentry0_.processorName as processo1_0_0_, tokenentry0_.segment as segment2_0_0_, tokenentry0_.owner as owner3_0_0_, tokenentry0_.timestamp as timestam4_0_0_, tokenentry0_.token as token5_0_0_, tokenentry0_.tokenType as tokenTyp6_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? and tokenentry0_.segment=? for update
Hibernate: update TokenEntry set owner=?, timestamp=?, token=?, tokenType=? where processorName=? and segment=?
2018-10-05 14:41:11,797 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@6d9f78a6 testClass = JpaTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest@3200f6e5, testMethod = testInitializeTokensWhileAlreadyPresent@JpaTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@150cc1ea testClass = JpaTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@7ce00985]; rollback [true]
Hibernate: select tokenentry0_.processorName as processo1_0_0_, tokenentry0_.segment as segment2_0_0_, tokenentry0_.owner as owner3_0_0_, tokenentry0_.timestamp as timestam4_0_0_, tokenentry0_.token as token5_0_0_, tokenentry0_.tokenType as tokenTyp6_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? and tokenentry0_.segment=? for update
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: select tokenentry0_.segment as col_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? order by tokenentry0_.segment ASC
2018-10-05 14:41:11,809 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@6d9f78a6 testClass = JpaTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest@3200f6e5, testMethod = testInitializeTokensWhileAlreadyPresent@JpaTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@150cc1ea testClass = JpaTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-05 14:41:11,812 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@6d9f78a6 testClass = JpaTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest@67ee26af, testMethod = testStealingFromOtherThreadFailsWithRowLock@JpaTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@150cc1ea testClass = JpaTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@7ce00985]; rollback [true]
Hibernate: select tokenentry0_.processorName as processo1_0_0_, tokenentry0_.segment as segment2_0_0_, tokenentry0_.owner as owner3_0_0_, tokenentry0_.timestamp as timestam4_0_0_, tokenentry0_.token as token5_0_0_, tokenentry0_.tokenType as tokenTyp6_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? and tokenentry0_.segment=? for update
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: select tokenentry0_.processorName as processo1_0_0_, tokenentry0_.segment as segment2_0_0_, tokenentry0_.owner as owner3_0_0_, tokenentry0_.timestamp as timestam4_0_0_, tokenentry0_.token as token5_0_0_, tokenentry0_.tokenType as tokenTyp6_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? and tokenentry0_.segment=? for update
2018-10-05 14:41:12,098 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@6d9f78a6 testClass = JpaTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest@67ee26af, testMethod = testStealingFromOtherThreadFailsWithRowLock@JpaTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@150cc1ea testClass = JpaTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-05 14:41:12,101 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@6d9f78a6 testClass = JpaTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest@9e5e75, testMethod = testInitializeTokens@JpaTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@150cc1ea testClass = JpaTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@7ce00985]; rollback [true]
Hibernate: select tokenentry0_.segment as col_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? order by tokenentry0_.segment ASC
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: select tokenentry0_.segment as col_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? order by tokenentry0_.segment ASC
2018-10-05 14:41:12,118 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@6d9f78a6 testClass = JpaTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest@9e5e75, testMethod = testInitializeTokens@JpaTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@150cc1ea testClass = JpaTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-05 14:41:12,132 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@6d9f78a6 testClass = JpaTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest@346b793b, testMethod = testQuerySegments@JpaTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@150cc1ea testClass = JpaTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@7ce00985]; rollback [true]
Hibernate: select tokenentry0_.processorName as processo1_0_0_, tokenentry0_.segment as segment2_0_0_, tokenentry0_.owner as owner3_0_0_, tokenentry0_.timestamp as timestam4_0_0_, tokenentry0_.token as token5_0_0_, tokenentry0_.tokenType as tokenTyp6_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? and tokenentry0_.segment=? for update
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: select tokenentry0_.processorName as processo1_0_0_, tokenentry0_.segment as segment2_0_0_, tokenentry0_.owner as owner3_0_0_, tokenentry0_.timestamp as timestam4_0_0_, tokenentry0_.token as token5_0_0_, tokenentry0_.tokenType as tokenTyp6_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? and tokenentry0_.segment=? for update
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: select tokenentry0_.processorName as processo1_0_0_, tokenentry0_.segment as segment2_0_0_, tokenentry0_.owner as owner3_0_0_, tokenentry0_.timestamp as timestam4_0_0_, tokenentry0_.token as token5_0_0_, tokenentry0_.tokenType as tokenTyp6_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? and tokenentry0_.segment=? for update
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: update TokenEntry set owner=?, timestamp=?, token=?, tokenType=? where processorName=? and segment=?
Hibernate: select tokenentry0_.processorName as processo1_0_0_, tokenentry0_.segment as segment2_0_0_, tokenentry0_.owner as owner3_0_0_, tokenentry0_.timestamp as timestam4_0_0_, tokenentry0_.token as token5_0_0_, tokenentry0_.tokenType as tokenTyp6_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? and tokenentry0_.segment=? for update
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: update TokenEntry set owner=?, timestamp=?, token=?, tokenType=? where processorName=? and segment=?
Hibernate: update TokenEntry set owner=?, timestamp=?, token=?, tokenType=? where processorName=? and segment=?
Hibernate: select tokenentry0_.segment as col_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? order by tokenentry0_.segment ASC
Hibernate: select tokenentry0_.segment as col_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? order by tokenentry0_.segment ASC
Hibernate: select tokenentry0_.segment as col_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? order by tokenentry0_.segment ASC
2018-10-05 14:41:12,176 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@6d9f78a6 testClass = JpaTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest@346b793b, testMethod = testQuerySegments@JpaTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@150cc1ea testClass = JpaTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-05 14:41:12,178 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@6d9f78a6 testClass = JpaTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest@59250335, testMethod = testClaimTokenConcurrently@JpaTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@150cc1ea testClass = JpaTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@7ce00985]; rollback [true]
Hibernate: select tokenentry0_.processorName as processo1_0_0_, tokenentry0_.segment as segment2_0_0_, tokenentry0_.owner as owner3_0_0_, tokenentry0_.timestamp as timestam4_0_0_, tokenentry0_.token as token5_0_0_, tokenentry0_.tokenType as tokenTyp6_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? and tokenentry0_.segment=? for update
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: select processorName from TokenEntry where processorName =? and segment =? for update
2018-10-05 14:41:12,182 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@6d9f78a6 testClass = JpaTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest@59250335, testMethod = testClaimTokenConcurrently@JpaTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@150cc1ea testClass = JpaTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-05 14:41:12,186 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@6d9f78a6 testClass = JpaTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest@6e767943, testMethod = testExtendingLostClaimFails@JpaTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@150cc1ea testClass = JpaTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@7ce00985]; rollback [true]
Hibernate: select tokenentry0_.processorName as processo1_0_0_, tokenentry0_.segment as segment2_0_0_, tokenentry0_.owner as owner3_0_0_, tokenentry0_.timestamp as timestam4_0_0_, tokenentry0_.token as token5_0_0_, tokenentry0_.tokenType as tokenTyp6_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? and tokenentry0_.segment=? for update
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: update TokenEntry set timestamp=? where processorName=? and segment=? and owner=?
2018-10-05 14:41:12,203 [main] WARN  SqlExceptionHelper              - SQL Warning Code: -1100, SQLState: 02000
2018-10-05 14:41:12,203 [main] WARN  SqlExceptionHelper              - no data
2018-10-05 14:41:12,203 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@6d9f78a6 testClass = JpaTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest@6e767943, testMethod = testExtendingLostClaimFails@JpaTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@150cc1ea testClass = JpaTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-05 14:41:12,205 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@6d9f78a6 testClass = JpaTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest@346ea2ed, testMethod = testUpdateNullToken@JpaTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@150cc1ea testClass = JpaTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@7ce00985]; rollback [true]
Hibernate: select tokenentry0_.processorName as processo1_0_0_, tokenentry0_.segment as segment2_0_0_, tokenentry0_.owner as owner3_0_0_, tokenentry0_.timestamp as timestam4_0_0_, tokenentry0_.token as token5_0_0_, tokenentry0_.tokenType as tokenTyp6_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? and tokenentry0_.segment=? for update
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: update TokenEntry set owner=?, timestamp=?, token=?, tokenType=? where processorName=? and segment=?
Hibernate: select tokenentry0_.processorName as processo1_0_, tokenentry0_.segment as segment2_0_, tokenentry0_.owner as owner3_0_, tokenentry0_.timestamp as timestam4_0_, tokenentry0_.token as token5_0_, tokenentry0_.tokenType as tokenTyp6_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=?
2018-10-05 14:41:12,225 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@6d9f78a6 testClass = JpaTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest@346ea2ed, testMethod = testUpdateNullToken@JpaTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@150cc1ea testClass = JpaTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-05 14:41:12,227 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@6d9f78a6 testClass = JpaTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest@5126c400, testMethod = testInitializeTokensAtGivenPosition@JpaTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@150cc1ea testClass = JpaTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@7ce00985]; rollback [true]
Hibernate: select tokenentry0_.segment as col_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? order by tokenentry0_.segment ASC
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: select tokenentry0_.segment as col_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? order by tokenentry0_.segment ASC
Hibernate: select processorName from TokenEntry where processorName =? and segment =? for update
Hibernate: select processorName from TokenEntry where processorName =? and segment =? for update
Hibernate: select processorName from TokenEntry where processorName =? and segment =? for update
Hibernate: select processorName from TokenEntry where processorName =? and segment =? for update
Hibernate: select processorName from TokenEntry where processorName =? and segment =? for update
Hibernate: select processorName from TokenEntry where processorName =? and segment =? for update
Hibernate: select processorName from TokenEntry where processorName =? and segment =? for update
2018-10-05 14:41:12,261 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:12,269 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@6d9f78a6 testClass = JpaTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest@5126c400, testMethod = testInitializeTokensAtGivenPosition@JpaTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@150cc1ea testClass = JpaTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-05 14:41:12,272 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@6d9f78a6 testClass = JpaTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest@5d98216c, testMethod = testClaimAndUpdateToken@JpaTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@150cc1ea testClass = JpaTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@7ce00985]; rollback [true]
Hibernate: select tokenentry0_.processorName as processo1_0_0_, tokenentry0_.segment as segment2_0_0_, tokenentry0_.owner as owner3_0_0_, tokenentry0_.timestamp as timestam4_0_0_, tokenentry0_.token as token5_0_0_, tokenentry0_.tokenType as tokenTyp6_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? and tokenentry0_.segment=? for update
Hibernate: insert into TokenEntry (owner, timestamp, token, tokenType, processorName, segment) values (?, ?, ?, ?, ?, ?)
Hibernate: select processorName from TokenEntry where processorName =? and segment =? for update
Hibernate: update TokenEntry set owner=?, timestamp=?, token=?, tokenType=? where processorName=? and segment=?
Hibernate: select tokenentry0_.processorName as processo1_0_, tokenentry0_.segment as segment2_0_, tokenentry0_.owner as owner3_0_, tokenentry0_.timestamp as timestam4_0_, tokenentry0_.token as token5_0_, tokenentry0_.tokenType as tokenTyp6_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=?
Hibernate: update TokenEntry set owner=null where owner=? and processorName=? and segment=?
Hibernate: select tokenentry0_.processorName as processo1_0_0_, tokenentry0_.segment as segment2_0_0_, tokenentry0_.owner as owner3_0_0_, tokenentry0_.timestamp as timestam4_0_0_, tokenentry0_.token as token5_0_0_, tokenentry0_.tokenType as tokenTyp6_0_0_ from TokenEntry tokenentry0_ where tokenentry0_.processorName=? and tokenentry0_.segment=?
2018-10-05 14:41:12,288 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@6d9f78a6 testClass = JpaTokenStoreTest, testInstance = org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest@5d98216c, testMethod = testClaimAndUpdateToken@JpaTokenStoreTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@150cc1ea testClass = JpaTokenStoreTest, locations = '{}', classes = '{class org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest$Context}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
Tests run: 11, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.955 sec - in org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStoreTest
Running org.axonframework.eventhandling.tokenstore.inmemory.InMemoryTokenStoreTest
Tests run: 6, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.018 sec - in org.axonframework.eventhandling.tokenstore.inmemory.InMemoryTokenStoreTest
Running org.axonframework.eventhandling.async.FullConcurrencyPolicyTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.eventhandling.async.FullConcurrencyPolicyTest
Running org.axonframework.eventhandling.async.SequentialPolicyTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.eventhandling.async.SequentialPolicyTest
Running org.axonframework.eventhandling.async.AsynchronousEventProcessingStrategyTest
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.063 sec - in org.axonframework.eventhandling.async.AsynchronousEventProcessingStrategyTest
Running org.axonframework.eventhandling.async.AsynchronousEventProcessorConcurrencyTest
2018-10-05 14:41:13,271 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:14,273 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:15,273 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:16,276 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 4.793 sec - in org.axonframework.eventhandling.async.AsynchronousEventProcessorConcurrencyTest
Running org.axonframework.eventhandling.async.SequentialPerAggregatePolicyTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.eventhandling.async.SequentialPerAggregatePolicyTest
Running org.axonframework.eventhandling.AbstractEventProcessorTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.002 sec - in org.axonframework.eventhandling.AbstractEventProcessorTest
Running org.axonframework.eventhandling.GenericEventMessageTest
Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.002 sec - in org.axonframework.eventhandling.GenericEventMessageTest
Running org.axonframework.eventhandling.MultiEventHandlerInvokerTest
Tests run: 9, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.035 sec - in org.axonframework.eventhandling.MultiEventHandlerInvokerTest
Running org.axonframework.eventhandling.TrackingEventProcessorTest
2018-10-05 14:41:17,271 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-05 14:41:17,278 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:17,282 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-05 14:41:17,290 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-05 14:41:17,291 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=-1} for segment: Segment[0/0]
2018-10-05 14:41:17,306 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-05 14:41:17,318 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-05 14:41:17,320 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Fetched token: ReplayToken{currentToken=IndexTrackingToken{globalIndex=1}, tokenAtReset=IndexTrackingToken{globalIndex=3}} for segment: Segment[0/0]
2018-10-05 14:41:17,330 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-05 14:41:18,279 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:18,351 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - An error occurred while attempting to claim a token for segment: 0. Will retry later...
java.lang.RuntimeException: Faking a recoverable issue
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.lambda$run$1(TrackingEventProcessor.java:760)
	at org.axonframework.eventhandling.TrackingEventProcessorTest.lambda$setUp$1(TrackingEventProcessorTest.java:127)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.run(TrackingEventProcessor.java:759)
	at org.axonframework.eventhandling.TrackingEventProcessor$CountingRunnable.run(TrackingEventProcessor.java:623)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:18,352 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-05 14:41:18,352 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[0/0]
2018-10-05 14:41:18,539 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-05 14:41:19,282 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:19,543 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-05 14:41:19,543 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=-1} for segment: Segment[0/0]
2018-10-05 14:41:19,545 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-05 14:41:19,549 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-05 14:41:19,549 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Fetched token: ReplayToken{currentToken=IndexTrackingToken{globalIndex=-1}, tokenAtReset=IndexTrackingToken{globalIndex=3}} for segment: Segment[0/0]
2018-10-05 14:41:19,551 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-05 14:41:20,283 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:20,555 [EventProcessor[test]-0] WARN  TrackingEventProcessor          - Fetch Segments for Processor 'test' failed: Faking issue during fetchSegments. Preparing for retry in 1s
2018-10-05 14:41:20,555 [EventProcessor[test]-0] WARN  TrackingEventProcessor          - Fetch Segments for Processor 'test' failed: Could not initialize segments. Some segments were already present.. Preparing for retry in 1s
2018-10-05 14:41:20,556 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-05 14:41:20,556 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[0/0]
2018-10-05 14:41:21,284 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:22,285 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:23,053 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-05 14:41:23,286 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:23,561 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-05 14:41:23,561 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[0/0]
2018-10-05 14:41:23,762 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-05 14:41:24,286 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:24,766 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-05 14:41:24,767 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[0/0]
2018-10-05 14:41:24,968 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-05 14:41:24,968 [EventProcessor[test]-0] WARN  TrackingEventProcessor          - Error occurred. Starting retry mode.
org.axonframework.common.MockException: Mock
2018-10-05 14:41:24,968 [EventProcessor[test]-0] WARN  TrackingEventProcessor          - Releasing claim on token and preparing for retry in 1s
2018-10-05 14:41:24,974 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-05 14:41:24,974 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[0/0]
2018-10-05 14:41:24,975 [EventProcessor[test]-0] WARN  TrackingEventProcessor          - Error occurred. Starting retry mode.
org.axonframework.common.MockException: Mock
2018-10-05 14:41:24,975 [EventProcessor[test]-0] WARN  TrackingEventProcessor          - Releasing claim on token and preparing for retry in 1s
2018-10-05 14:41:25,173 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-05 14:41:25,180 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-05 14:41:25,180 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=0} for segment: Segment[0/0]
2018-10-05 14:41:25,287 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:25,380 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-05 14:41:26,186 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-05 14:41:26,186 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[0/0]
2018-10-05 14:41:26,288 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:26,388 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-05 14:41:27,289 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:27,393 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-05 14:41:27,393 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[0/0]
2018-10-05 14:41:27,594 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-05 14:41:27,598 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-05 14:41:27,602 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-05 14:41:27,603 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=-1} for segment: Segment[0/0]
2018-10-05 14:41:27,606 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-05 14:41:27,611 [EventProcessor[test]-0] ERROR TrackingEventProcessor          - An unrecoverable error has occurred wile attempting to claim a token for segment: 0. Shutting down processor [test].
org.axonframework.serialization.SerializationException: Faking a serialization issue
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.lambda$run$1(TrackingEventProcessor.java:760)
	at org.axonframework.eventhandling.TrackingEventProcessorTest.lambda$setUp$1(TrackingEventProcessorTest.java:127)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.run(TrackingEventProcessor.java:759)
	at org.axonframework.eventhandling.TrackingEventProcessor$CountingRunnable.run(TrackingEventProcessor.java:623)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:27,615 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-05 14:41:27,616 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[0/0]
2018-10-05 14:41:27,816 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-05 14:41:27,840 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-05 14:41:27,841 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[0/0]
2018-10-05 14:41:27,842 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-05 14:41:27,846 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-05 14:41:27,846 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Fetched token: ReplayToken{currentToken=null, tokenAtReset=GapAwareTrackingToken{index=5, gaps=[3, 4]}} for segment: Segment[0/0]
2018-10-05 14:41:27,855 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-05 14:41:27,858 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-05 14:41:27,858 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=-1} for segment: Segment[0/0]
2018-10-05 14:41:27,861 [EventProcessor[test]-0] WARN  TrackingEventProcessor          - Error occurred. Starting retry mode.
org.axonframework.common.MockException: Mock
2018-10-05 14:41:27,861 [EventProcessor[test]-0] WARN  TrackingEventProcessor          - Releasing claim on token and preparing for retry in 1s
2018-10-05 14:41:28,290 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:28,862 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=-1} for segment: Segment[0/0]
2018-10-05 14:41:28,863 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-05 14:41:29,291 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:29,867 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-05 14:41:29,868 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - No Worker Launcher active. Using current thread to assign segments.
2018-10-05 14:41:30,291 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:31,292 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:32,293 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:34,729 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:35,780 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:36,783 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:37,809 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:38,814 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:43,024 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:43,026 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-05 14:41:43,026 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-05 14:41:43,030 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-05 14:41:43,030 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[0/0]
2018-10-05 14:41:43,231 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-05 14:41:44,026 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:44,236 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-05 14:41:44,237 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=1} for segment: Segment[0/0]
2018-10-05 14:41:44,238 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-05 14:41:44,241 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-05 14:41:44,241 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Fetched token: ReplayToken{currentToken=IndexTrackingToken{globalIndex=1}, tokenAtReset=IndexTrackingToken{globalIndex=3}} for segment: Segment[0/0]
2018-10-05 14:41:44,243 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-05 14:41:45,027 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:45,246 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-05 14:41:45,246 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[0/0]
2018-10-05 14:41:45,446 [Time-limited test] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-05 14:41:45,449 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-05 14:41:45,449 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=1} for segment: Segment[0/0]
2018-10-05 14:41:46,028 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:46,450 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-05 14:41:47,028 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:47,453 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-05 14:41:47,453 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - No Worker Launcher active. Using current thread to assign segments.
2018-10-05 14:41:47,453 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
Tests run: 24, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 30.235 sec - in org.axonframework.eventhandling.TrackingEventProcessorTest
Running org.axonframework.eventhandling.SimpleEventBusTest
2018-10-05 14:41:47,458 [main] INFO  AbstractEventBus                - EventProcessor [Mock for Consumer, hashCode: 486750945] not added. It was already subscribed
2018-10-05 14:41:47,458 [main] INFO  AbstractEventBus                - EventListener Mock for Consumer, hashCode: 1575285838 not removed. It was already unsubscribed
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.002 sec - in org.axonframework.eventhandling.SimpleEventBusTest
Running org.axonframework.eventhandling.SegmentTest
2018-10-05 14:41:48,029 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:49,030 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
Tests run: 11, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 2.479 sec - in org.axonframework.eventhandling.SegmentTest
Running org.axonframework.eventhandling.ConcludesBatchParameterResolverFactoryTest
Tests run: 6, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.005 sec - in org.axonframework.eventhandling.ConcludesBatchParameterResolverFactoryTest
Running org.axonframework.eventhandling.AbstractEventBusTest
Tests run: 8, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.079 sec - in org.axonframework.eventhandling.AbstractEventBusTest
Running org.axonframework.eventhandling.ReplayTokenTest
2018-10-05 14:41:50,030 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.014 sec - in org.axonframework.eventhandling.ReplayTokenTest
Running org.axonframework.eventhandling.DirectEventProcessingStrategyTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 sec - in org.axonframework.eventhandling.DirectEventProcessingStrategyTest
Running org.axonframework.eventhandling.replay.ReplayParameterResolverFactoryTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.004 sec - in org.axonframework.eventhandling.replay.ReplayParameterResolverFactoryTest
Running org.axonframework.eventhandling.replay.ReplayAwareMessageHandlerWrapperTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.003 sec - in org.axonframework.eventhandling.replay.ReplayAwareMessageHandlerWrapperTest
Running org.axonframework.eventhandling.SubscribingEventProcessorTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 sec - in org.axonframework.eventhandling.SubscribingEventProcessorTest
Running org.axonframework.eventhandling.AnnotatedParameterResolverFactoryTest
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.002 sec - in org.axonframework.eventhandling.AnnotatedParameterResolverFactoryTest
Running org.axonframework.eventhandling.scheduling.ScheduleTokenJacksonSerializationTest
Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.005 sec - in org.axonframework.eventhandling.scheduling.ScheduleTokenJacksonSerializationTest
Running org.axonframework.eventhandling.scheduling.java.SimpleEventSchedulerTest
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.159 sec - in org.axonframework.eventhandling.scheduling.java.SimpleEventSchedulerTest
Running org.axonframework.eventhandling.scheduling.quartz.DirectEventJobDataBinderTest
Tests run: 6, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.122 sec - in org.axonframework.eventhandling.scheduling.quartz.DirectEventJobDataBinderTest
Running org.axonframework.eventhandling.scheduling.quartz.QuartzEventSchedulerTest
2018-10-05 14:41:50,392 [main] INFO  StdSchedulerFactory             - Using default implementation for ThreadExecutor
2018-10-05 14:41:50,395 [main] INFO  SimpleThreadPool                - Job execution threads will use class loader of thread: main
2018-10-05 14:41:50,414 [main] INFO  SchedulerSignalerImpl           - Initialized Scheduler Signaller of type: class org.quartz.core.SchedulerSignalerImpl
2018-10-05 14:41:50,415 [main] INFO  QuartzScheduler                 - Quartz Scheduler v.2.2.1 created.
2018-10-05 14:41:50,416 [main] INFO  RAMJobStore                     - RAMJobStore initialized.
2018-10-05 14:41:50,418 [main] INFO  QuartzScheduler                 - Scheduler meta-data: Quartz Scheduler (v2.2.1) 'DefaultQuartzScheduler' with instanceId 'NON_CLUSTERED'
  Scheduler class: 'org.quartz.core.QuartzScheduler' - running locally.
  NOT STARTED.
  Currently in standby mode.
  Number of jobs executed: 0
  Using thread pool 'org.quartz.simpl.SimpleThreadPool' - with 10 threads.
  Using job-store 'org.quartz.simpl.RAMJobStore' - which does not support persistence. and is not clustered.

2018-10-05 14:41:50,418 [main] INFO  StdSchedulerFactory             - Quartz scheduler 'DefaultQuartzScheduler' initialized from default resource file in Quartz package: 'quartz.properties'
2018-10-05 14:41:50,418 [main] INFO  StdSchedulerFactory             - Quartz scheduler version: 2.2.1
2018-10-05 14:41:50,418 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
2018-10-05 14:41:50,476 [DefaultQuartzScheduler_Worker-1] INFO  FireEventJob                    - Job successfully executed. Scheduled Event [Object] has been published.
2018-10-05 14:41:50,476 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED shutting down.
2018-10-05 14:41:50,479 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED paused.
2018-10-05 14:41:50,982 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED shutdown complete.
2018-10-05 14:41:50,988 [main] INFO  StdSchedulerFactory             - Using default implementation for ThreadExecutor
2018-10-05 14:41:50,988 [main] INFO  SimpleThreadPool                - Job execution threads will use class loader of thread: main
2018-10-05 14:41:50,991 [main] INFO  SchedulerSignalerImpl           - Initialized Scheduler Signaller of type: class org.quartz.core.SchedulerSignalerImpl
2018-10-05 14:41:50,991 [main] INFO  QuartzScheduler                 - Quartz Scheduler v.2.2.1 created.
2018-10-05 14:41:50,991 [main] INFO  RAMJobStore                     - RAMJobStore initialized.
2018-10-05 14:41:50,991 [main] INFO  QuartzScheduler                 - Scheduler meta-data: Quartz Scheduler (v2.2.1) 'DefaultQuartzScheduler' with instanceId 'NON_CLUSTERED'
  Scheduler class: 'org.quartz.core.QuartzScheduler' - running locally.
  NOT STARTED.
  Currently in standby mode.
  Number of jobs executed: 0
  Using thread pool 'org.quartz.simpl.SimpleThreadPool' - with 10 threads.
  Using job-store 'org.quartz.simpl.RAMJobStore' - which does not support persistence. and is not clustered.

2018-10-05 14:41:50,991 [main] INFO  StdSchedulerFactory             - Quartz scheduler 'DefaultQuartzScheduler' initialized from default resource file in Quartz package: 'quartz.properties'
2018-10-05 14:41:50,991 [main] INFO  StdSchedulerFactory             - Quartz scheduler version: 2.2.1
2018-10-05 14:41:50,991 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
2018-10-05 14:41:51,033 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:51,035 [DefaultQuartzScheduler_Worker-1] ERROR FireEventJob                    - Exception occurred while publishing scheduled event [java.lang.Object]
org.axonframework.common.MockException: Mock
2018-10-05 14:41:51,039 [DefaultQuartzScheduler_Worker-1] INFO  JobRunShell                     - Job TestGroup.event-6b538454-a48b-49d2-bd81-5be60b9b2b56 threw a JobExecutionException: 
org.quartz.JobExecutionException: org.axonframework.common.MockException: Mock [See nested exception: org.axonframework.common.MockException: Mock]
	at org.axonframework.eventhandling.scheduling.quartz.FireEventJob.execute(FireEventJob.java:87)
	at org.quartz.core.JobRunShell.run(JobRunShell.java:202)
	at org.quartz.simpl.SimpleThreadPool$WorkerThread.run(SimpleThreadPool.java:573)
Caused by: org.axonframework.common.MockException: Mock
2018-10-05 14:41:51,041 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED shutting down.
2018-10-05 14:41:51,041 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED paused.
2018-10-05 14:41:51,541 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED shutdown complete.
2018-10-05 14:41:51,546 [main] INFO  StdSchedulerFactory             - Using default implementation for ThreadExecutor
2018-10-05 14:41:51,546 [main] INFO  SimpleThreadPool                - Job execution threads will use class loader of thread: main
2018-10-05 14:41:51,548 [main] INFO  SchedulerSignalerImpl           - Initialized Scheduler Signaller of type: class org.quartz.core.SchedulerSignalerImpl
2018-10-05 14:41:51,548 [main] INFO  QuartzScheduler                 - Quartz Scheduler v.2.2.1 created.
2018-10-05 14:41:51,548 [main] INFO  RAMJobStore                     - RAMJobStore initialized.
2018-10-05 14:41:51,548 [main] INFO  QuartzScheduler                 - Scheduler meta-data: Quartz Scheduler (v2.2.1) 'DefaultQuartzScheduler' with instanceId 'NON_CLUSTERED'
  Scheduler class: 'org.quartz.core.QuartzScheduler' - running locally.
  NOT STARTED.
  Currently in standby mode.
  Number of jobs executed: 0
  Using thread pool 'org.quartz.simpl.SimpleThreadPool' - with 10 threads.
  Using job-store 'org.quartz.simpl.RAMJobStore' - which does not support persistence. and is not clustered.

2018-10-05 14:41:51,548 [main] INFO  StdSchedulerFactory             - Quartz scheduler 'DefaultQuartzScheduler' initialized from default resource file in Quartz package: 'quartz.properties'
2018-10-05 14:41:51,548 [main] INFO  StdSchedulerFactory             - Quartz scheduler version: 2.2.1
2018-10-05 14:41:51,548 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
2018-10-05 14:41:51,588 [DefaultQuartzScheduler_Worker-1] INFO  FireEventJob                    - Job successfully executed. Scheduled Event [Object] has been published.
2018-10-05 14:41:51,592 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED shutting down.
2018-10-05 14:41:51,592 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED paused.
2018-10-05 14:41:52,035 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:52,092 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED shutdown complete.
2018-10-05 14:41:52,096 [main] INFO  StdSchedulerFactory             - Using default implementation for ThreadExecutor
2018-10-05 14:41:52,096 [main] INFO  SimpleThreadPool                - Job execution threads will use class loader of thread: main
2018-10-05 14:41:52,098 [main] INFO  SchedulerSignalerImpl           - Initialized Scheduler Signaller of type: class org.quartz.core.SchedulerSignalerImpl
2018-10-05 14:41:52,098 [main] INFO  QuartzScheduler                 - Quartz Scheduler v.2.2.1 created.
2018-10-05 14:41:52,098 [main] INFO  RAMJobStore                     - RAMJobStore initialized.
2018-10-05 14:41:52,098 [main] INFO  QuartzScheduler                 - Scheduler meta-data: Quartz Scheduler (v2.2.1) 'DefaultQuartzScheduler' with instanceId 'NON_CLUSTERED'
  Scheduler class: 'org.quartz.core.QuartzScheduler' - running locally.
  NOT STARTED.
  Currently in standby mode.
  Number of jobs executed: 0
  Using thread pool 'org.quartz.simpl.SimpleThreadPool' - with 10 threads.
  Using job-store 'org.quartz.simpl.RAMJobStore' - which does not support persistence. and is not clustered.

2018-10-05 14:41:52,098 [main] INFO  StdSchedulerFactory             - Quartz scheduler 'DefaultQuartzScheduler' initialized from default resource file in Quartz package: 'quartz.properties'
2018-10-05 14:41:52,098 [main] INFO  StdSchedulerFactory             - Quartz scheduler version: 2.2.1
2018-10-05 14:41:52,098 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
2018-10-05 14:41:52,102 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED shutting down.
2018-10-05 14:41:52,102 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED paused.
2018-10-05 14:41:52,603 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED shutdown complete.
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 2.256 sec - in org.axonframework.eventhandling.scheduling.quartz.QuartzEventSchedulerTest
Running org.axonframework.eventhandling.TimestampParameterResolverFactoryTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.002 sec - in org.axonframework.eventhandling.TimestampParameterResolverFactoryTest
Running org.axonframework.eventhandling.AnnotationEventListenerAdapterTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.002 sec - in org.axonframework.eventhandling.AnnotationEventListenerAdapterTest
Running org.axonframework.eventhandling.TrackingEventProcessorTest_MultiThreaded
2018-10-05 14:41:52,812 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-05 14:41:52,818 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Dispatching new tracking segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/1]}
2018-10-05 14:41:52,820 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[1/1]}
2018-10-05 14:41:52,820 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=2} for segment: Segment[1/1]
2018-10-05 14:41:52,820 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=1} for segment: Segment[0/1]
2018-10-05 14:41:52,821 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-05 14:41:53,035 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:53,824 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Dispatching new tracking segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-05 14:41:53,826 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=0} for segment: Segment[0/0]
2018-10-05 14:41:53,830 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-05 14:41:54,036 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:54,831 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Dispatching new tracking segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/1]}
2018-10-05 14:41:54,833 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[1/1]}
2018-10-05 14:41:54,833 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=-1} for segment: Segment[1/1]
2018-10-05 14:41:54,833 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=-1} for segment: Segment[0/1]
2018-10-05 14:41:54,838 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-05 14:41:55,037 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:55,841 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Dispatching new tracking segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/1]}
2018-10-05 14:41:55,842 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[1/1]}
2018-10-05 14:41:55,842 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=-1} for segment: Segment[1/1]
2018-10-05 14:41:55,843 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=-1} for segment: Segment[0/1]
2018-10-05 14:41:55,845 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-05 14:41:56,038 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:56,847 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/1]}
2018-10-05 14:41:56,848 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=1} for segment: Segment[0/1]
2018-10-05 14:41:57,038 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:57,047 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-05 14:41:57,851 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Dispatching new tracking segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/3]}
2018-10-05 14:41:57,853 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[1/1]}
2018-10-05 14:41:57,853 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=-1} for segment: Segment[1/1]
2018-10-05 14:41:57,854 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=-1} for segment: Segment[0/3]
2018-10-05 14:41:57,857 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-05 14:41:58,039 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:58,858 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Dispatching new tracking segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/3]}
2018-10-05 14:41:58,860 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[1/1]}
2018-10-05 14:41:58,860 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=2} for segment: Segment[1/1]
2018-10-05 14:41:58,860 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=1} for segment: Segment[0/3]
2018-10-05 14:41:59,040 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:41:59,861 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - No Worker Launcher active. Using current thread to assign segments.
2018-10-05 14:41:59,861 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[2/3]}
2018-10-05 14:41:59,861 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=2} for segment: Segment[2/3]
2018-10-05 14:41:59,862 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-05 14:42:00,040 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:42:00,863 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Dispatching new tracking segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/3]}
2018-10-05 14:42:00,865 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[1/3]}
2018-10-05 14:42:00,865 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[1/3]
2018-10-05 14:42:00,865 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[0/3]
2018-10-05 14:42:01,041 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:42:01,063 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-05 14:42:01,868 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/0]}
2018-10-05 14:42:01,869 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=-1} for segment: Segment[0/0]
2018-10-05 14:42:01,870 [EventProcessor[test]-0] WARN  TrackingEventProcessor          - Error occurred. Starting retry mode.
org.axonframework.common.MockException: Mock
2018-10-05 14:42:01,871 [EventProcessor[test]-0] WARN  TrackingEventProcessor          - Releasing claim on token and preparing for retry in 1s
2018-10-05 14:42:02,042 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:42:02,871 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=-1} for segment: Segment[0/0]
2018-10-05 14:42:02,873 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-05 14:42:03,042 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:42:03,876 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Dispatching new tracking segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/1]}
2018-10-05 14:42:03,878 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[1/1]}
2018-10-05 14:42:03,878 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=-1} for segment: Segment[1/1]
2018-10-05 14:42:03,878 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=-1} for segment: Segment[0/1]
2018-10-05 14:42:03,881 [Time-limited test] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-05 14:42:04,043 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:42:04,885 [EventProcessor[test]-2] INFO  TrackingEventProcessor          - Dispatching new tracking segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/1]}
2018-10-05 14:42:04,885 [EventProcessor[test]-2] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[1/1]}
2018-10-05 14:42:04,885 [EventProcessor[test]-2] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=1} for segment: Segment[1/1]
2018-10-05 14:42:04,886 [EventProcessor[test]-3] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=1} for segment: Segment[0/1]
2018-10-05 14:42:04,890 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-05 14:42:05,044 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:42:05,889 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Dispatching new tracking segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/1]}
2018-10-05 14:42:05,891 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[1/1]}
2018-10-05 14:42:05,891 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[1/1]
2018-10-05 14:42:05,892 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[0/1]
2018-10-05 14:42:05,892 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-05 14:42:06,044 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:42:06,895 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Dispatching new tracking segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/7]}
2018-10-05 14:42:06,897 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Dispatching new tracking segment worker: TrackingSegmentWorker{processor=test, segment=Segment[1/7]}
2018-10-05 14:42:06,897 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Dispatching new tracking segment worker: TrackingSegmentWorker{processor=test, segment=Segment[2/3]}
2018-10-05 14:42:06,897 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[0/7]
2018-10-05 14:42:06,897 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Dispatching new tracking segment worker: TrackingSegmentWorker{processor=test, segment=Segment[3/3]}
2018-10-05 14:42:06,898 [EventProcessor[test]-2] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[1/7]
2018-10-05 14:42:06,898 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Dispatching new tracking segment worker: TrackingSegmentWorker{processor=test, segment=Segment[4/7]}
2018-10-05 14:42:06,898 [EventProcessor[test]-3] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[2/3]
2018-10-05 14:42:06,898 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[5/7]}
2018-10-05 14:42:06,898 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-05 14:42:06,898 [EventProcessor[test]-4] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[3/3]
2018-10-05 14:42:07,045 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:42:07,902 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Dispatching new tracking segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/1]}
2018-10-05 14:42:07,904 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[1/1]}
2018-10-05 14:42:07,904 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=-1} for segment: Segment[1/1]
2018-10-05 14:42:07,904 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=-1} for segment: Segment[0/1]
2018-10-05 14:42:07,908 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-05 14:42:08,046 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:42:08,910 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Dispatching new tracking segment worker: TrackingSegmentWorker{processor=test, segment=Segment[0/1]}
2018-10-05 14:42:08,912 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=test, segment=Segment[1/1]}
2018-10-05 14:42:08,912 [EventProcessor[test]-0] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=2} for segment: Segment[1/1]
2018-10-05 14:42:08,913 [EventProcessor[test]-1] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=1} for segment: Segment[0/1]
2018-10-05 14:42:09,047 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:42:09,113 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'test'. Awaiting termination...
2018-10-05 14:42:10,048 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
Tests run: 15, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 17.505 sec - in org.axonframework.eventhandling.TrackingEventProcessorTest_MultiThreaded
Running org.axonframework.common.property.DirectPropertyAccessStrategyTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 sec - in org.axonframework.common.property.DirectPropertyAccessStrategyTest
Running org.axonframework.common.property.BeanPropertyAccessStrategyTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 sec - in org.axonframework.common.property.BeanPropertyAccessStrategyTest
Running org.axonframework.common.property.UniformPropertyAccessStrategyTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.common.property.UniformPropertyAccessStrategyTest
Running org.axonframework.common.property.PropertyAccessStrategyTest
Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.002 sec - in org.axonframework.common.property.PropertyAccessStrategyTest
Running org.axonframework.common.AxonThreadFactoryTest
Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 sec - in org.axonframework.common.AxonThreadFactoryTest
Running org.axonframework.common.lock.PessimisticLockFactoryTest
Tests run: 10, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.421 sec - in org.axonframework.common.lock.PessimisticLockFactoryTest
Running org.axonframework.common.lock.LockFactoryTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.024 sec - in org.axonframework.common.lock.LockFactoryTest
Running org.axonframework.common.annotation.PriorityAnnotationComparatorTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.012 sec - in org.axonframework.common.annotation.PriorityAnnotationComparatorTest
Running org.axonframework.common.annotation.AnnotationUtilsTest
Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.003 sec - in org.axonframework.common.annotation.AnnotationUtilsTest
Running org.axonframework.common.IdentifierValidatorTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.common.IdentifierValidatorTest
Running org.axonframework.common.AssertTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 sec - in org.axonframework.common.AssertTest
Running org.axonframework.common.CollectionUtilsTest
Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 sec - in org.axonframework.common.CollectionUtilsTest
Running org.axonframework.common.DateTimeUtilsTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.common.DateTimeUtilsTest
Running org.axonframework.common.caching.NoCacheTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.011 sec - in org.axonframework.common.caching.NoCacheTest
Running org.axonframework.common.caching.WeakReferenceCacheTest
Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.259 sec - in org.axonframework.common.caching.WeakReferenceCacheTest
Running org.axonframework.common.ReflectionUtilsTest
Tests run: 11, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.002 sec - in org.axonframework.common.ReflectionUtilsTest
Running org.axonframework.common.jdbc.ConnectionWrapperFactoryTest
Tests run: 8, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.032 sec - in org.axonframework.common.jdbc.ConnectionWrapperFactoryTest
Running org.axonframework.common.jdbc.UnitOfWorkAwareConnectionProviderWrapperTest
Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.019 sec - in org.axonframework.common.jdbc.UnitOfWorkAwareConnectionProviderWrapperTest
Running org.axonframework.common.jdbc.JdbcUtilsTest
2018-10-05 14:42:11,048 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.192 sec - in org.axonframework.common.jdbc.JdbcUtilsTest
Running org.axonframework.queryhandling.responsetypes.InstanceResponseTypeTest
Tests run: 36, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.007 sec - in org.axonframework.queryhandling.responsetypes.InstanceResponseTypeTest
Running org.axonframework.queryhandling.responsetypes.ResponseTypesJacksonSerializationTest
Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.007 sec - in org.axonframework.queryhandling.responsetypes.ResponseTypesJacksonSerializationTest
Running org.axonframework.queryhandling.responsetypes.MultipleInstancesResponseTypeTest
2018-10-05 14:42:11,143 [main] INFO  MultipleInstancesResponseType   - The given response is an Iterable without any contents, hence we cannot verify if the contained type is assignable to the expected type.
Tests run: 46, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.012 sec - in org.axonframework.queryhandling.responsetypes.MultipleInstancesResponseTypeTest
Running org.axonframework.queryhandling.SimpleQueryBusTest
Tests run: 24, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.058 sec - in org.axonframework.queryhandling.SimpleQueryBusTest
Running org.axonframework.queryhandling.DefaultQueryGatewayTest
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.046 sec - in org.axonframework.queryhandling.DefaultQueryGatewayTest
Running org.axonframework.queryhandling.FutureAsResponseTypeToQueryHandlersTest
2018-10-05 14:42:12,049 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:42:13,050 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:42:14,051 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
Tests run: 6, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 3.063 sec - in org.axonframework.queryhandling.FutureAsResponseTypeToQueryHandlersTest
Running org.axonframework.queryhandling.SubscriptionQueryTest
2018-10-05 14:42:14,326 [main] ERROR SimpleQueryBus                  - An error happened while trying to report an initial result. Query: GenericQueryMessage{payload={axonFrameworkCR}, metadata={}, messageIdentifier='f875dc94-2bf6-43d3-aede-3cf8c98b6ad2', queryName='failingQuery', expectedResponseType='org.axonframework.queryhandling.responsetypes.InstanceResponseType@5d642e46'}
java.util.concurrent.CompletionException: java.lang.RuntimeException: oops
	at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:292)
	at java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:308)
	at java.util.concurrent.CompletableFuture.uniAccept(CompletableFuture.java:647)
	at java.util.concurrent.CompletableFuture.uniAcceptStage(CompletableFuture.java:669)
	at java.util.concurrent.CompletableFuture.thenAccept(CompletableFuture.java:1997)
	at org.axonframework.queryhandling.SimpleQueryBus.lambda$subscriptionQuery$7(SimpleQueryBus.java:246)
	at org.axonframework.queryhandling.MonoWrapper.lambda$create$0(MonoWrapper.java:62)
	at reactor.core.publisher.MonoCreate.subscribe(MonoCreate.java:53)
	at reactor.core.publisher.Mono.subscribe(Mono.java:3080)
	at reactor.core.publisher.Mono.subscribeWith(Mono.java:3188)
	at reactor.core.publisher.Mono.subscribe(Mono.java:3074)
	at reactor.core.publisher.Mono.subscribe(Mono.java:3041)
	at reactor.core.publisher.Mono.subscribe(Mono.java:3013)
	at org.axonframework.queryhandling.SubscriptionQueryResult.handle(SubscriptionQueryResult.java:59)
	at org.axonframework.queryhandling.SubscriptionQueryTest.testSubscriptionQueryResultHandleWhenThereIsAnErrorOnUpdate(SubscriptionQueryTest.java:706)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:363)
	at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:367)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeWithRerun(JUnit4Provider.java:274)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:238)
	at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:161)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:290)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:242)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:121)
Caused by: java.lang.RuntimeException: oops
	at org.axonframework.queryhandling.SubscriptionQueryTest$ChatQueryHandler.<init>(SubscriptionQueryTest.java:720)
	at org.axonframework.queryhandling.SubscriptionQueryTest$ChatQueryHandler.<init>(SubscriptionQueryTest.java:717)
	at org.axonframework.queryhandling.SubscriptionQueryTest.<init>(SubscriptionQueryTest.java:50)
	at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
	at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)
	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
	at java.lang.reflect.Constructor.newInstance(Constructor.java:423)
	at org.junit.runners.BlockJUnit4ClassRunner.createTest(BlockJUnit4ClassRunner.java:217)
	at org.junit.runners.BlockJUnit4ClassRunner$1.runReflectiveCall(BlockJUnit4ClassRunner.java:266)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.BlockJUnit4ClassRunner.methodBlock(BlockJUnit4ClassRunner.java:263)
	... 15 more
2018-10-05 14:42:14,348 [main] INFO  SimpleQueryBus                  - An error occurred while trying to emit an update to a query 'chatMessages'. The subscription will be cancelled. Exception summary: reactor.core.Exceptions$ErrorCallbackNotImplemented: java.lang.IllegalStateException: oops
2018-10-05 14:42:14,363 [main] ERROR SimpleQueryBus                  - An error happened while trying to inform update handler about the error. Query: GenericQueryMessage{payload={axonFrameworkCR}, metadata={}, messageIdentifier='49275c04-6d9f-45b9-af08-a3ff261c97c6', queryName='chatMessages', expectedResponseType='org.axonframework.queryhandling.responsetypes.MultipleInstancesResponseType@7a82be85'}
2018-10-05 14:42:14,365 [main] ERROR SimpleQueryBus                  - An error happened while trying to inform update handler about the error. Query: GenericQueryMessage{payload={axonFrameworkCR}, metadata={}, messageIdentifier='9c9930fa-a5fa-49a1-823e-1c4e7f860fd4', queryName='chatMessages', expectedResponseType='org.axonframework.queryhandling.responsetypes.MultipleInstancesResponseType@7225f0fe'}
2018-10-05 14:42:14,886 [main] ERROR SimpleQueryBus                  - An error happened while trying to report an initial result. Query: GenericQueryMessage{payload={axonFrameworkCR}, metadata={}, messageIdentifier='395304bd-9f41-43b4-a554-37021e0ca7dc', queryName='failingQuery', expectedResponseType='org.axonframework.queryhandling.responsetypes.InstanceResponseType@37ca8b4c'}
java.util.concurrent.CompletionException: java.lang.RuntimeException: oops
	at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:292)
	at java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:308)
	at java.util.concurrent.CompletableFuture.uniAccept(CompletableFuture.java:647)
	at java.util.concurrent.CompletableFuture.uniAcceptStage(CompletableFuture.java:669)
	at java.util.concurrent.CompletableFuture.thenAccept(CompletableFuture.java:1997)
	at org.axonframework.queryhandling.SimpleQueryBus.lambda$subscriptionQuery$7(SimpleQueryBus.java:246)
	at org.axonframework.queryhandling.MonoWrapper.lambda$create$0(MonoWrapper.java:62)
	at reactor.core.publisher.MonoCreate.subscribe(MonoCreate.java:53)
	at reactor.core.publisher.Mono.subscribe(Mono.java:3080)
	at reactor.test.DefaultStepVerifierBuilder$DefaultStepVerifier.verify(DefaultStepVerifierBuilder.java:728)
	at reactor.test.DefaultStepVerifierBuilder$DefaultStepVerifier.verify(DefaultStepVerifierBuilder.java:700)
	at org.axonframework.queryhandling.SubscriptionQueryTest.testSubscribingQueryHandlerFailing(SubscriptionQueryTest.java:373)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:363)
	at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:367)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeWithRerun(JUnit4Provider.java:274)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:238)
	at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:161)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:290)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:242)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:121)
Caused by: java.lang.RuntimeException: oops
	at org.axonframework.queryhandling.SubscriptionQueryTest$ChatQueryHandler.<init>(SubscriptionQueryTest.java:720)
	at org.axonframework.queryhandling.SubscriptionQueryTest$ChatQueryHandler.<init>(SubscriptionQueryTest.java:717)
	at org.axonframework.queryhandling.SubscriptionQueryTest.<init>(SubscriptionQueryTest.java:50)
	at sun.reflect.GeneratedConstructorAccessor122.newInstance(Unknown Source)
	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
	at java.lang.reflect.Constructor.newInstance(Constructor.java:423)
	at org.junit.runners.BlockJUnit4ClassRunner.createTest(BlockJUnit4ClassRunner.java:217)
	at org.junit.runners.BlockJUnit4ClassRunner$1.runReflectiveCall(BlockJUnit4ClassRunner.java:266)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.BlockJUnit4ClassRunner.methodBlock(BlockJUnit4ClassRunner.java:263)
	... 15 more
2018-10-05 14:42:14,888 [main] ERROR SimpleQueryBus                  - An error happened while trying to report an initial result. Query: GenericQueryMessage{payload={axonFrameworkCR}, metadata={}, messageIdentifier='137ef6c6-eb0a-4c2e-b593-792773855d03', queryName='failingQuery', expectedResponseType='org.axonframework.queryhandling.responsetypes.InstanceResponseType@153e2f2f'}
java.util.concurrent.CompletionException: java.lang.RuntimeException: oops
	at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:292)
	at java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:308)
	at java.util.concurrent.CompletableFuture.uniAccept(CompletableFuture.java:647)
	at java.util.concurrent.CompletableFuture.uniAcceptStage(CompletableFuture.java:669)
	at java.util.concurrent.CompletableFuture.thenAccept(CompletableFuture.java:1997)
	at org.axonframework.queryhandling.SimpleQueryBus.lambda$subscriptionQuery$7(SimpleQueryBus.java:246)
	at org.axonframework.queryhandling.MonoWrapper.lambda$create$0(MonoWrapper.java:62)
	at reactor.core.publisher.MonoCreate.subscribe(MonoCreate.java:53)
	at reactor.core.publisher.Mono.subscribe(Mono.java:3080)
	at reactor.core.publisher.Mono.subscribeWith(Mono.java:3188)
	at reactor.core.publisher.Mono.subscribe(Mono.java:3074)
	at reactor.core.publisher.Mono.subscribe(Mono.java:3041)
	at reactor.core.publisher.Mono.subscribe(Mono.java:3013)
	at org.axonframework.queryhandling.SubscriptionQueryResult.handle(SubscriptionQueryResult.java:59)
	at org.axonframework.queryhandling.SubscriptionQueryTest.testSubscriptionQueryResultHandleWhenThereIsAnErrorOnInitialResult(SubscriptionQueryTest.java:683)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:363)
	at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:367)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeWithRerun(JUnit4Provider.java:274)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:238)
	at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:161)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:290)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:242)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:121)
Caused by: java.lang.RuntimeException: oops
	at org.axonframework.queryhandling.SubscriptionQueryTest$ChatQueryHandler.<init>(SubscriptionQueryTest.java:720)
	at org.axonframework.queryhandling.SubscriptionQueryTest$ChatQueryHandler.<init>(SubscriptionQueryTest.java:717)
	at org.axonframework.queryhandling.SubscriptionQueryTest.<init>(SubscriptionQueryTest.java:50)
	at sun.reflect.GeneratedConstructorAccessor122.newInstance(Unknown Source)
	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
	at java.lang.reflect.Constructor.newInstance(Constructor.java:423)
	at org.junit.runners.BlockJUnit4ClassRunner.createTest(BlockJUnit4ClassRunner.java:217)
	at org.junit.runners.BlockJUnit4ClassRunner$1.runReflectiveCall(BlockJUnit4ClassRunner.java:266)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.BlockJUnit4ClassRunner.methodBlock(BlockJUnit4ClassRunner.java:263)
	... 15 more
2018-10-05 14:42:15,052 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
Tests run: 22, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 1.577 sec - in org.axonframework.queryhandling.SubscriptionQueryTest
Running org.axonframework.queryhandling.annotation.AnnotationQueryHandlerAdapterTest
Tests run: 6, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.025 sec - in org.axonframework.queryhandling.annotation.AnnotationQueryHandlerAdapterTest
Running org.axonframework.queryhandling.QueryEventHandlingTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.015 sec - in org.axonframework.queryhandling.QueryEventHandlingTest
Running org.axonframework.commandhandling.AsynchronousCommandBusTest
2018-10-05 14:42:15,962 [main] INFO  LoggingCallback                 - Command executed successfully: java.lang.Object
Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.029 sec - in org.axonframework.commandhandling.AsynchronousCommandBusTest
Running org.axonframework.commandhandling.model.inspection.AnnotatedAggregateMetaModelFactoryTest
Tests run: 15, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.034 sec - in org.axonframework.commandhandling.model.inspection.AnnotatedAggregateMetaModelFactoryTest
Running org.axonframework.commandhandling.model.inspection.ModelInspectorTest
Tests run: 14, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.033 sec - in org.axonframework.commandhandling.model.inspection.ModelInspectorTest
Running org.axonframework.commandhandling.model.LockingRepositoryTest
2018-10-05 14:42:16,056 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.085 sec - in org.axonframework.commandhandling.model.LockingRepositoryTest
Running org.axonframework.commandhandling.model.EventSourcingRepositoryTest
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.005 sec - in org.axonframework.commandhandling.model.EventSourcingRepositoryTest
Running org.axonframework.commandhandling.model.JpaRepositoryIntegrationTest
2018-10-05 14:42:16,135 [main] INFO  DefaultTestContextBootstrapper  - Loaded default TestExecutionListener class names from location [META-INF/spring.factories]: [org.springframework.test.context.web.ServletTestExecutionListener, org.springframework.test.context.support.DirtiesContextBeforeModesTestExecutionListener, org.springframework.test.context.support.DependencyInjectionTestExecutionListener, org.springframework.test.context.support.DirtiesContextTestExecutionListener, org.springframework.test.context.transaction.TransactionalTestExecutionListener, org.springframework.test.context.jdbc.SqlScriptsTestExecutionListener]
2018-10-05 14:42:16,136 [main] INFO  DefaultTestContextBootstrapper  - Using TestExecutionListeners: [org.springframework.test.context.support.DirtiesContextBeforeModesTestExecutionListener@7335164e, org.springframework.test.context.support.DependencyInjectionTestExecutionListener@563b9462, org.springframework.test.context.support.DirtiesContextTestExecutionListener@368814bb, org.springframework.test.context.transaction.TransactionalTestExecutionListener@71d85b53, org.springframework.test.context.jdbc.SqlScriptsTestExecutionListener@2a04a440]
2018-10-05 14:42:16,136 [main] INFO  XmlBeanDefinitionReader         - Loading XML bean definitions from class path resource [META-INF/spring/jpa-repository-context.xml]
2018-10-05 14:42:16,145 [main] INFO  XmlBeanDefinitionReader         - Loading XML bean definitions from class path resource [META-INF/spring/db-context.xml]
2018-10-05 14:42:16,156 [main] INFO  GenericApplicationContext       - Refreshing org.springframework.context.support.GenericApplicationContext@2096ade6: startup date [Fri Oct 05 14:42:16 CEST 2018]; root of context hierarchy
2018-10-05 14:42:16,169 [main] INFO  redAnnotationBeanPostProcessor  - JSR-330 'javax.inject.Inject' annotation found and supported for autowiring
2018-10-05 14:42:16,195 [main] INFO  DriverManagerDataSource         - Loaded JDBC driver: org.hsqldb.jdbcDriver
2018-10-05 14:42:16,201 [main] INFO  tainerEntityManagerFactoryBean  - Building JPA container EntityManagerFactory for persistence unit 'eventStore'
2018-10-05 14:42:16,202 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-05 14:42:16,247 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-05 14:42:16,348 [main] WARN  EntityManagerFactoryRegistry    - HHH000436: Entity manager factory name (eventStore) is already registered.  If entity manager will be clustered or passivated, specify a unique value for property 'hibernate.ejb.entitymanager_factory_name'
2018-10-05 14:42:16,348 [main] INFO  tainerEntityManagerFactoryBean  - Initialized JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-05 14:42:16,411 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@6f677c34 testClass = JpaRepositoryIntegrationTest, testInstance = org.axonframework.commandhandling.model.JpaRepositoryIntegrationTest@a54ab55, testMethod = testUpdateAnAggregate@JpaRepositoryIntegrationTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@66d17af8 testClass = JpaRepositoryIntegrationTest, locations = '{classpath:/META-INF/spring/jpa-repository-context.xml, classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@2c6db83a]; rollback [true]
2018-10-05 14:42:16,416 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@6f677c34 testClass = JpaRepositoryIntegrationTest, testInstance = org.axonframework.commandhandling.model.JpaRepositoryIntegrationTest@a54ab55, testMethod = testUpdateAnAggregate@JpaRepositoryIntegrationTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@66d17af8 testClass = JpaRepositoryIntegrationTest, locations = '{classpath:/META-INF/spring/jpa-repository-context.xml, classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-05 14:42:16,418 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@6f677c34 testClass = JpaRepositoryIntegrationTest, testInstance = org.axonframework.commandhandling.model.JpaRepositoryIntegrationTest@69f4143, testMethod = testStoreAndLoadNewAggregate@JpaRepositoryIntegrationTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@66d17af8 testClass = JpaRepositoryIntegrationTest, locations = '{classpath:/META-INF/spring/jpa-repository-context.xml, classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@2c6db83a]; rollback [true]
2018-10-05 14:42:16,420 [main] INFO  ueryTranslatorFactoryInitiator  - HHH000397: Using ASTQueryTranslatorFactory
2018-10-05 14:42:16,423 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@6f677c34 testClass = JpaRepositoryIntegrationTest, testInstance = org.axonframework.commandhandling.model.JpaRepositoryIntegrationTest@69f4143, testMethod = testStoreAndLoadNewAggregate@JpaRepositoryIntegrationTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@66d17af8 testClass = JpaRepositoryIntegrationTest, locations = '{classpath:/META-INF/spring/jpa-repository-context.xml, classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
2018-10-05 14:42:16,425 [main] INFO  TransactionContext              - Began transaction (1) for test context [DefaultTestContext@6f677c34 testClass = JpaRepositoryIntegrationTest, testInstance = org.axonframework.commandhandling.model.JpaRepositoryIntegrationTest@1c17d98c, testMethod = testDeleteAnAggregate@JpaRepositoryIntegrationTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@66d17af8 testClass = JpaRepositoryIntegrationTest, locations = '{classpath:/META-INF/spring/jpa-repository-context.xml, classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]]; transaction manager [org.springframework.orm.jpa.JpaTransactionManager@2c6db83a]; rollback [true]
2018-10-05 14:42:16,431 [main] INFO  TransactionContext              - Rolled back transaction for test context [DefaultTestContext@6f677c34 testClass = JpaRepositoryIntegrationTest, testInstance = org.axonframework.commandhandling.model.JpaRepositoryIntegrationTest@1c17d98c, testMethod = testDeleteAnAggregate@JpaRepositoryIntegrationTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@66d17af8 testClass = JpaRepositoryIntegrationTest, locations = '{classpath:/META-INF/spring/jpa-repository-context.xml, classpath:/META-INF/spring/db-context.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]].
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.298 sec - in org.axonframework.commandhandling.model.JpaRepositoryIntegrationTest
Running org.axonframework.commandhandling.model.AnnotatedAggregateTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.003 sec - in org.axonframework.commandhandling.model.AnnotatedAggregateTest
Running org.axonframework.commandhandling.model.AbstractRepositoryTest
Tests run: 9, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.05 sec - in org.axonframework.commandhandling.model.AbstractRepositoryTest
Running org.axonframework.commandhandling.model.GenericJpaRepositoryTest
Tests run: 11, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.058 sec - in org.axonframework.commandhandling.model.GenericJpaRepositoryTest
Running org.axonframework.commandhandling.model.EntityEventForwardingModelInspectorTest
Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.011 sec - in org.axonframework.commandhandling.model.EntityEventForwardingModelInspectorTest
Running org.axonframework.commandhandling.model.AggregateScopeDescriptorSerializationTest
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.009 sec - in org.axonframework.commandhandling.model.AggregateScopeDescriptorSerializationTest
Running org.axonframework.commandhandling.conflictresolution.ConflictResolutionIntegrationTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.019 sec - in org.axonframework.commandhandling.conflictresolution.ConflictResolutionIntegrationTest
Running org.axonframework.commandhandling.conflictresolution.ConflictResolutionTest
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.009 sec - in org.axonframework.commandhandling.conflictresolution.ConflictResolutionTest
Running org.axonframework.commandhandling.conflictresolution.DefaultConflictResolverTest
Tests run: 7, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.005 sec - in org.axonframework.commandhandling.conflictresolution.DefaultConflictResolverTest
Running org.axonframework.commandhandling.conflictresolution.ConflictsTest
Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.commandhandling.conflictresolution.ConflictsTest
Running org.axonframework.commandhandling.SpawningNewAggregateTest
2018-10-05 14:42:16,649 [main] INFO  LoggingCallback                 - Command executed successfully: org.axonframework.commandhandling.SpawningNewAggregateTest$CreateAggregate1Command
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.048 sec - in org.axonframework.commandhandling.SpawningNewAggregateTest
Running org.axonframework.commandhandling.distributed.ConsistentHashTest
Tests run: 7, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.011 sec - in org.axonframework.commandhandling.distributed.ConsistentHashTest
Running org.axonframework.commandhandling.distributed.commandfilter.CommandFilterTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.003 sec - in org.axonframework.commandhandling.distributed.commandfilter.CommandFilterTest
Running org.axonframework.commandhandling.distributed.AnnotationRoutingStrategyTest
Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.004 sec - in org.axonframework.commandhandling.distributed.AnnotationRoutingStrategyTest
Running org.axonframework.commandhandling.distributed.CommandCallbackRepositoryTest
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 sec - in org.axonframework.commandhandling.distributed.CommandCallbackRepositoryTest
Running org.axonframework.commandhandling.distributed.DistributedCommandBusTest
Tests run: 7, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.034 sec - in org.axonframework.commandhandling.distributed.DistributedCommandBusTest
Running org.axonframework.commandhandling.CommandHandlerInterceptorTest
Tests run: 8, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.09 sec - in org.axonframework.commandhandling.CommandHandlerInterceptorTest
Running org.axonframework.commandhandling.AggregateAnnotationCommandHandlerTest
2018-10-05 14:42:16,861 [main] INFO  LoggingCallback                 - Command executed successfully: org.axonframework.commandhandling.AggregateAnnotationCommandHandlerTest$CreateCommand
2018-10-05 14:42:16,904 [main] INFO  LoggingCallback                 - Command executed successfully: org.axonframework.commandhandling.AggregateAnnotationCommandHandlerTest$CreateFactoryMethodCommand
Tests run: 22, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.184 sec - in org.axonframework.commandhandling.AggregateAnnotationCommandHandlerTest
Running org.axonframework.commandhandling.disruptor.CommandHandlerInvokerTest
Tests run: 10, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.049 sec - in org.axonframework.commandhandling.disruptor.CommandHandlerInvokerTest
Running org.axonframework.commandhandling.disruptor.DisruptorConfigurationTest
Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.002 sec - in org.axonframework.commandhandling.disruptor.DisruptorConfigurationTest
Running org.axonframework.commandhandling.disruptor.DisruptorCommandBusTest
2018-10-05 14:42:17,056 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:42:18,059 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:42:19,060 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:42:19,094 [pool-21-thread-4] INFO  DisruptorCommandBus             - Reset notification for dc904fef-c8df-4923-a1fd-055dce3f7de7 received. The aggregate is removed from the blacklist
2018-10-05 14:42:19,122 [pool-21-thread-4] INFO  DisruptorCommandBus             - Reset notification for dc904fef-c8df-4923-a1fd-055dce3f7de7 received. The aggregate is removed from the blacklist
2018-10-05 14:42:19,161 [pool-21-thread-4] INFO  DisruptorCommandBus             - Reset notification for dc904fef-c8df-4923-a1fd-055dce3f7de7 received. The aggregate is removed from the blacklist
2018-10-05 14:42:19,186 [pool-21-thread-4] INFO  DisruptorCommandBus             - Reset notification for dc904fef-c8df-4923-a1fd-055dce3f7de7 received. The aggregate is removed from the blacklist
2018-10-05 14:42:19,219 [pool-21-thread-4] INFO  DisruptorCommandBus             - Reset notification for dc904fef-c8df-4923-a1fd-055dce3f7de7 received. The aggregate is removed from the blacklist
2018-10-05 14:42:19,291 [pool-21-thread-4] INFO  DisruptorCommandBus             - Reset notification for dc904fef-c8df-4923-a1fd-055dce3f7de7 received. The aggregate is removed from the blacklist
2018-10-05 14:42:19,329 [pool-21-thread-4] INFO  DisruptorCommandBus             - Reset notification for dc904fef-c8df-4923-a1fd-055dce3f7de7 received. The aggregate is removed from the blacklist
2018-10-05 14:42:19,361 [pool-21-thread-4] INFO  DisruptorCommandBus             - Reset notification for dc904fef-c8df-4923-a1fd-055dce3f7de7 received. The aggregate is removed from the blacklist
2018-10-05 14:42:19,394 [pool-21-thread-4] INFO  DisruptorCommandBus             - Reset notification for dc904fef-c8df-4923-a1fd-055dce3f7de7 received. The aggregate is removed from the blacklist
2018-10-05 14:42:19,438 [pool-21-thread-4] INFO  DisruptorCommandBus             - Reset notification for dc904fef-c8df-4923-a1fd-055dce3f7de7 received. The aggregate is removed from the blacklist
2018-10-05 14:42:20,060 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:42:20,745 [DisruptorCommandBus-2] INFO  DisruptorCommandBus             - An error occurred while handling a command [org.axonframework.commandhandling.disruptor.DisruptorCommandBusTest$ErrorCommand].
org.axonframework.common.MockException: This is a failing event. EventStore refuses to store that
2018-10-05 14:42:20,747 [DisruptorCommandBus-1] INFO  DisruptorCommandBus             - Reset notification for 94b0d98f-ec61-41d4-b26e-abff799807a7 received. The aggregate is removed from the blacklist
2018-10-05 14:42:20,747 [DisruptorCommandBus-5] INFO  DisruptorCommandBus             - An error occurred while handling a command [org.axonframework.commandhandling.disruptor.DisruptorCommandBusTest$ErrorCommand].
org.axonframework.common.MockException: This is a failing event. EventStore refuses to store that
2018-10-05 14:42:20,751 [DisruptorCommandBus-1] INFO  DisruptorCommandBus             - Reset notification for a898f263-fef6-43e7-96b4-9d301bf25033 received. The aggregate is removed from the blacklist
2018-10-05 14:42:21,061 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:42:22,062 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:42:23,063 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:42:24,060 [pool-23-thread-4] INFO  DisruptorCommandBus             - Reset notification for 1f9f7d91-018f-4db4-bc3c-6ca0888f6c91 received. The aggregate is removed from the blacklist
2018-10-05 14:42:24,064 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:42:24,073 [pool-23-thread-4] INFO  DisruptorCommandBus             - Reset notification for 1f9f7d91-018f-4db4-bc3c-6ca0888f6c91 received. The aggregate is removed from the blacklist
2018-10-05 14:42:24,088 [pool-23-thread-4] INFO  DisruptorCommandBus             - Reset notification for 1f9f7d91-018f-4db4-bc3c-6ca0888f6c91 received. The aggregate is removed from the blacklist
2018-10-05 14:42:24,095 [pool-23-thread-4] INFO  DisruptorCommandBus             - Reset notification for 1f9f7d91-018f-4db4-bc3c-6ca0888f6c91 received. The aggregate is removed from the blacklist
2018-10-05 14:42:24,115 [pool-23-thread-4] INFO  DisruptorCommandBus             - Reset notification for 1f9f7d91-018f-4db4-bc3c-6ca0888f6c91 received. The aggregate is removed from the blacklist
2018-10-05 14:42:24,131 [pool-23-thread-4] INFO  DisruptorCommandBus             - Reset notification for 1f9f7d91-018f-4db4-bc3c-6ca0888f6c91 received. The aggregate is removed from the blacklist
2018-10-05 14:42:24,140 [pool-23-thread-4] INFO  DisruptorCommandBus             - Reset notification for 1f9f7d91-018f-4db4-bc3c-6ca0888f6c91 received. The aggregate is removed from the blacklist
2018-10-05 14:42:24,159 [pool-23-thread-4] INFO  DisruptorCommandBus             - Reset notification for 1f9f7d91-018f-4db4-bc3c-6ca0888f6c91 received. The aggregate is removed from the blacklist
2018-10-05 14:42:24,172 [pool-23-thread-4] INFO  DisruptorCommandBus             - Reset notification for 1f9f7d91-018f-4db4-bc3c-6ca0888f6c91 received. The aggregate is removed from the blacklist
2018-10-05 14:42:24,181 [pool-23-thread-4] INFO  DisruptorCommandBus             - Reset notification for 1f9f7d91-018f-4db4-bc3c-6ca0888f6c91 received. The aggregate is removed from the blacklist
2018-10-05 14:42:25,065 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:42:26,066 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:42:26,715 [DisruptorCommandBus-2] WARN  DisruptorCommandBus             - Failed sending message [GenericDeadlineMessage{payload={org.axonframework.commandhandling.disruptor.DisruptorCommandBusTest$FailingEvent@7ad20fdb}, metadata={}, messageIdentifier='5a59854f-ddc5-4803-91a8-6d317a80672e', timestamp='2018-10-05T12:42:26.715Z}] to aggregate with id [98006c1f-3ee7-48d0-8a17-25ec02f51ba6]
2018-10-05 14:42:26,720 [DisruptorCommandBus-1] INFO  DisruptorCommandBus             - Reset notification for 98006c1f-3ee7-48d0-8a17-25ec02f51ba6 received. The aggregate is removed from the blacklist
2018-10-05 14:42:27,066 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:42:28,067 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:42:29,068 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:42:30,068 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:42:31,069 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:42:32,070 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:42:33,070 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:42:33,697 [pool-26-thread-4] INFO  DisruptorCommandBus             - Reset notification for b688cac1-d8ee-4f3c-8eff-90bb2c9ab188 received. The aggregate is removed from the blacklist
2018-10-05 14:42:33,817 [pool-26-thread-4] INFO  DisruptorCommandBus             - Reset notification for b688cac1-d8ee-4f3c-8eff-90bb2c9ab188 received. The aggregate is removed from the blacklist
2018-10-05 14:42:33,979 [pool-26-thread-4] INFO  DisruptorCommandBus             - Reset notification for b688cac1-d8ee-4f3c-8eff-90bb2c9ab188 received. The aggregate is removed from the blacklist
2018-10-05 14:42:34,042 [pool-26-thread-4] INFO  DisruptorCommandBus             - Reset notification for b688cac1-d8ee-4f3c-8eff-90bb2c9ab188 received. The aggregate is removed from the blacklist
2018-10-05 14:42:34,071 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:42:34,178 [pool-26-thread-4] INFO  DisruptorCommandBus             - Reset notification for b688cac1-d8ee-4f3c-8eff-90bb2c9ab188 received. The aggregate is removed from the blacklist
2018-10-05 14:42:34,280 [pool-26-thread-4] INFO  DisruptorCommandBus             - Reset notification for b688cac1-d8ee-4f3c-8eff-90bb2c9ab188 received. The aggregate is removed from the blacklist
2018-10-05 14:42:34,374 [pool-26-thread-4] INFO  DisruptorCommandBus             - Reset notification for b688cac1-d8ee-4f3c-8eff-90bb2c9ab188 received. The aggregate is removed from the blacklist
2018-10-05 14:42:34,446 [pool-26-thread-4] INFO  DisruptorCommandBus             - Reset notification for b688cac1-d8ee-4f3c-8eff-90bb2c9ab188 received. The aggregate is removed from the blacklist
2018-10-05 14:42:34,565 [pool-26-thread-4] INFO  DisruptorCommandBus             - Reset notification for b688cac1-d8ee-4f3c-8eff-90bb2c9ab188 received. The aggregate is removed from the blacklist
2018-10-05 14:42:34,680 [pool-26-thread-4] INFO  DisruptorCommandBus             - Reset notification for b688cac1-d8ee-4f3c-8eff-90bb2c9ab188 received. The aggregate is removed from the blacklist
2018-10-05 14:42:35,072 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:42:36,073 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:42:37,073 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
Tests run: 17, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 20.942 sec - in org.axonframework.commandhandling.disruptor.DisruptorCommandBusTest
Running org.axonframework.commandhandling.disruptor.DisruptorCommandBusTest_MultiThreaded
2018-10-05 14:42:38,074 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:42:38,125 [DisruptorCommandBus-3] INFO  DisruptorCommandBus             - Reset notification for deb62d2a-e95e-4f21-8b29-405d69a72687 received. The aggregate is removed from the blacklist
2018-10-05 14:42:38,125 [DisruptorCommandBus-2] INFO  DisruptorCommandBus             - Reset notification for 2caf09fa-1bac-44a2-b56b-565b61d22b5e received. The aggregate is removed from the blacklist
2018-10-05 14:42:38,128 [DisruptorCommandBus-4] INFO  DisruptorCommandBus             - Reset notification for 4410425b-330f-49c6-875e-7d823606b5ee received. The aggregate is removed from the blacklist
2018-10-05 14:42:38,128 [DisruptorCommandBus-4] INFO  DisruptorCommandBus             - Reset notification for 3a0c0076-b4ca-4d9f-a297-e43e3f5887b5 received. The aggregate is removed from the blacklist
2018-10-05 14:42:38,134 [DisruptorCommandBus-3] INFO  DisruptorCommandBus             - Reset notification for 2cfea190-e327-4199-9685-30dabcebcef6 received. The aggregate is removed from the blacklist
2018-10-05 14:42:38,134 [DisruptorCommandBus-2] INFO  DisruptorCommandBus             - Reset notification for 92beff53-51f3-41fc-9a67-35168bd21e41 received. The aggregate is removed from the blacklist
2018-10-05 14:42:38,134 [DisruptorCommandBus-2] INFO  DisruptorCommandBus             - Reset notification for ea2df6d7-e030-4cf1-9f2b-7708a05d91c3 received. The aggregate is removed from the blacklist
2018-10-05 14:42:38,136 [DisruptorCommandBus-4] INFO  DisruptorCommandBus             - Reset notification for 7a6ee0dc-48e8-4f33-9bce-0c002abd2d48 received. The aggregate is removed from the blacklist
2018-10-05 14:42:38,137 [DisruptorCommandBus-2] INFO  DisruptorCommandBus             - Reset notification for 615786ab-3ec1-46a5-8c78-191a80f0caac received. The aggregate is removed from the blacklist
2018-10-05 14:42:38,138 [DisruptorCommandBus-2] INFO  DisruptorCommandBus             - Reset notification for b1689b23-3603-4f16-85db-d36774ab8afb received. The aggregate is removed from the blacklist
2018-10-05 14:42:39,075 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 1.253 sec - in org.axonframework.commandhandling.disruptor.DisruptorCommandBusTest_MultiThreaded
Running org.axonframework.commandhandling.disruptor.DisruptorRepositoryTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.005 sec - in org.axonframework.commandhandling.disruptor.DisruptorRepositoryTest
Running org.axonframework.commandhandling.GenericCommandMessageTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 sec - in org.axonframework.commandhandling.GenericCommandMessageTest
Running org.axonframework.commandhandling.CommandHandlingTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.003 sec - in org.axonframework.commandhandling.CommandHandlingTest
Running org.axonframework.commandhandling.gateway.DefaultCommandGatewayTest
2018-10-05 14:42:39,273 [main] WARN  DefaultCommandGateway           - Command 'java.lang.String' resulted in java.lang.RuntimeException(java.lang.RuntimeException)
Tests run: 10, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.035 sec - in org.axonframework.commandhandling.gateway.DefaultCommandGatewayTest
Running org.axonframework.commandhandling.gateway.CommandGatewayFactoryTest
Tests run: 30, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.083 sec - in org.axonframework.commandhandling.gateway.CommandGatewayFactoryTest
Running org.axonframework.commandhandling.AnnotationCommandHandlerAdapterTest
Tests run: 6, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.036 sec - in org.axonframework.commandhandling.AnnotationCommandHandlerAdapterTest
Running org.axonframework.commandhandling.callbacks.FutureCallbackTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.005 sec - in org.axonframework.commandhandling.callbacks.FutureCallbackTest
Running org.axonframework.commandhandling.callbacks.VoidCallbackTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.commandhandling.callbacks.VoidCallbackTest
Running org.axonframework.commandhandling.CurrentUnitOfWorkParameterResolverFactoryTest
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.067 sec - in org.axonframework.commandhandling.CurrentUnitOfWorkParameterResolverFactoryTest
Running org.axonframework.commandhandling.AnnotationCommandTargetResolverTest
Tests run: 10, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.commandhandling.AnnotationCommandTargetResolverTest
Running org.axonframework.commandhandling.SimpleCommandBusTest
Tests run: 10, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.commandhandling.SimpleCommandBusTest
Running org.axonframework.config.SagaConfigurationTest
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.axonframework.config.SagaConfigurationTest
Running org.axonframework.config.DefaultConfigurerTest
2018-10-05 14:42:39,588 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-05 14:42:39,632 [main] WARN  connections                     - HHH10001002: Using Hibernate built-in connection pool (not for production use!)
2018-10-05 14:42:39,632 [main] INFO  connections                     - HHH10001005: using driver [null] at URL [jdbc:hsqldb:mem:axontest]
2018-10-05 14:42:39,632 [main] INFO  connections                     - HHH10001001: Connection properties: {}
2018-10-05 14:42:39,632 [main] INFO  connections                     - HHH10001003: Autocommit mode: false
2018-10-05 14:42:39,632 [main] INFO  rManagerConnectionProviderImpl  - HHH000115: Hibernate connection pool size: 20 (min=1)
2018-10-05 14:42:39,645 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-05 14:42:39,691 [main] WARN  ExceptionHandlerLoggedImpl      - GenerationTarget encountered exception accepting command : Unable to execute command [drop sequence hibernate_sequence]
org.hibernate.tool.schema.spi.CommandAcceptanceException: Unable to execute command [drop sequence hibernate_sequence]
	at org.hibernate.tool.schema.internal.exec.GenerationTargetToDatabase.accept(GenerationTargetToDatabase.java:63)
	at org.hibernate.tool.schema.internal.SchemaDropperImpl.applySqlString(SchemaDropperImpl.java:370)
	at org.hibernate.tool.schema.internal.SchemaDropperImpl.applySqlStrings(SchemaDropperImpl.java:355)
	at org.hibernate.tool.schema.internal.SchemaDropperImpl.dropFromMetadata(SchemaDropperImpl.java:245)
	at org.hibernate.tool.schema.internal.SchemaDropperImpl.performDrop(SchemaDropperImpl.java:153)
	at org.hibernate.tool.schema.internal.SchemaDropperImpl.doDrop(SchemaDropperImpl.java:125)
	at org.hibernate.tool.schema.internal.SchemaDropperImpl.doDrop(SchemaDropperImpl.java:111)
	at org.hibernate.tool.schema.spi.SchemaManagementToolCoordinator.performDatabaseAction(SchemaManagementToolCoordinator.java:137)
	at org.hibernate.tool.schema.spi.SchemaManagementToolCoordinator.process(SchemaManagementToolCoordinator.java:64)
	at org.hibernate.internal.SessionFactoryImpl.<init>(SessionFactoryImpl.java:458)
	at org.hibernate.boot.internal.SessionFactoryBuilderImpl.build(SessionFactoryBuilderImpl.java:465)
	at org.hibernate.jpa.boot.internal.EntityManagerFactoryBuilderImpl.build(EntityManagerFactoryBuilderImpl.java:881)
	at org.hibernate.jpa.HibernatePersistenceProvider.createEntityManagerFactory(HibernatePersistenceProvider.java:58)
	at javax.persistence.Persistence.createEntityManagerFactory(Persistence.java:55)
	at org.axonframework.config.DefaultConfigurerTest.setUp(DefaultConfigurerTest.java:67)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:24)
	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:363)
	at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:367)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeWithRerun(JUnit4Provider.java:274)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:238)
	at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:161)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:290)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:242)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:121)
Caused by: java.sql.SQLSyntaxErrorException: user lacks privilege or object not found: HIBERNATE_SEQUENCE in statement [drop sequence hibernate_sequence]
	at org.hsqldb.jdbc.JDBCUtil.sqlException(Unknown Source)
	at org.hsqldb.jdbc.JDBCUtil.sqlException(Unknown Source)
	at org.hsqldb.jdbc.JDBCStatement.fetchResult(Unknown Source)
	at org.hsqldb.jdbc.JDBCStatement.execute(Unknown Source)
	at org.hibernate.tool.schema.internal.exec.GenerationTargetToDatabase.accept(GenerationTargetToDatabase.java:51)
	... 39 more
Caused by: org.hsqldb.HsqlException: user lacks privilege or object not found: HIBERNATE_SEQUENCE
	at org.hsqldb.error.Error.error(Unknown Source)
	at org.hsqldb.error.Error.error(Unknown Source)
	at org.hsqldb.StatementSchema.getResult(Unknown Source)
	at org.hsqldb.StatementSchema.execute(Unknown Source)
	at org.hsqldb.Session.executeCompiledStatement(Unknown Source)
	at org.hsqldb.Session.executeDirectStatement(Unknown Source)
	at org.hsqldb.Session.execute(Unknown Source)
	... 42 more
2018-10-05 14:42:39,699 [main] INFO  SchemaCreatorImpl               - HHH000476: Executing import script 'org.hibernate.tool.schema.internal.exec.ScriptSourceInputNonExistentImpl@581b9fe6'
2018-10-05 14:42:39,705 [main] WARN  EntityManagerFactoryRegistry    - HHH000436: Entity manager factory name (eventStore) is already registered.  If entity manager will be clustered or passivated, specify a unique value for property 'hibernate.ejb.entitymanager_factory_name'
2018-10-05 14:42:39,710 [EventProcessor[org.axonframework.config]-0] INFO  TrackingEventProcessor          - Dispatching new tracking segment worker: TrackingSegmentWorker{processor=org.axonframework.config, segment=Segment[0/1]}
2018-10-05 14:42:39,710 [EventProcessor[org.axonframework.config]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=org.axonframework.config, segment=Segment[1/1]}
2018-10-05 14:42:39,710 [EventProcessor[org.axonframework.config]-1] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[0/1]
2018-10-05 14:42:39,710 [EventProcessor[org.axonframework.config]-0] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[1/1]
2018-10-05 14:42:39,711 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'org.axonframework.config'. Awaiting termination...
2018-10-05 14:42:40,075 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:42:40,717 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-05 14:42:40,761 [main] WARN  connections                     - HHH10001002: Using Hibernate built-in connection pool (not for production use!)
2018-10-05 14:42:40,762 [main] INFO  connections                     - HHH10001005: using driver [null] at URL [jdbc:hsqldb:mem:axontest]
2018-10-05 14:42:40,762 [main] INFO  connections                     - HHH10001001: Connection properties: {}
2018-10-05 14:42:40,762 [main] INFO  connections                     - HHH10001003: Autocommit mode: false
2018-10-05 14:42:40,762 [main] INFO  rManagerConnectionProviderImpl  - HHH000115: Hibernate connection pool size: 20 (min=1)
2018-10-05 14:42:40,762 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-05 14:42:40,828 [main] INFO  SchemaCreatorImpl               - HHH000476: Executing import script 'org.hibernate.tool.schema.internal.exec.ScriptSourceInputNonExistentImpl@581b9fe6'
2018-10-05 14:42:40,837 [main] WARN  EntityManagerFactoryRegistry    - HHH000436: Entity manager factory name (eventStore) is already registered.  If entity manager will be clustered or passivated, specify a unique value for property 'hibernate.ejb.entitymanager_factory_name'
2018-10-05 14:42:40,848 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-05 14:42:40,915 [main] WARN  connections                     - HHH10001002: Using Hibernate built-in connection pool (not for production use!)
2018-10-05 14:42:40,915 [main] INFO  connections                     - HHH10001005: using driver [null] at URL [jdbc:hsqldb:mem:axontest]
2018-10-05 14:42:40,915 [main] INFO  connections                     - HHH10001001: Connection properties: {}
2018-10-05 14:42:40,915 [main] INFO  connections                     - HHH10001003: Autocommit mode: false
2018-10-05 14:42:40,915 [main] INFO  rManagerConnectionProviderImpl  - HHH000115: Hibernate connection pool size: 20 (min=1)
2018-10-05 14:42:40,916 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-05 14:42:40,976 [main] INFO  SchemaCreatorImpl               - HHH000476: Executing import script 'org.hibernate.tool.schema.internal.exec.ScriptSourceInputNonExistentImpl@581b9fe6'
2018-10-05 14:42:40,985 [main] WARN  EntityManagerFactoryRegistry    - HHH000436: Entity manager factory name (eventStore) is already registered.  If entity manager will be clustered or passivated, specify a unique value for property 'hibernate.ejb.entitymanager_factory_name'
2018-10-05 14:42:40,999 [main] INFO  ueryTranslatorFactoryInitiator  - HHH000397: Using ASTQueryTranslatorFactory
2018-10-05 14:42:41,020 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-05 14:42:41,065 [main] WARN  connections                     - HHH10001002: Using Hibernate built-in connection pool (not for production use!)
2018-10-05 14:42:41,065 [main] INFO  connections                     - HHH10001005: using driver [null] at URL [jdbc:hsqldb:mem:axontest]
2018-10-05 14:42:41,065 [main] INFO  connections                     - HHH10001001: Connection properties: {}
2018-10-05 14:42:41,065 [main] INFO  connections                     - HHH10001003: Autocommit mode: false
2018-10-05 14:42:41,066 [main] INFO  rManagerConnectionProviderImpl  - HHH000115: Hibernate connection pool size: 20 (min=1)
2018-10-05 14:42:41,066 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-05 14:42:41,076 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:42:41,120 [main] INFO  SchemaCreatorImpl               - HHH000476: Executing import script 'org.hibernate.tool.schema.internal.exec.ScriptSourceInputNonExistentImpl@581b9fe6'
2018-10-05 14:42:41,128 [main] WARN  EntityManagerFactoryRegistry    - HHH000436: Entity manager factory name (eventStore) is already registered.  If entity manager will be clustered or passivated, specify a unique value for property 'hibernate.ejb.entitymanager_factory_name'
2018-10-05 14:42:41,133 [EventProcessor[org.axonframework.config]-0] INFO  TrackingEventProcessor          - Dispatching new tracking segment worker: TrackingSegmentWorker{processor=org.axonframework.config, segment=Segment[0/1]}
2018-10-05 14:42:41,133 [EventProcessor[org.axonframework.config]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=org.axonframework.config, segment=Segment[1/1]}
2018-10-05 14:42:41,133 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'org.axonframework.config'. Awaiting termination...
2018-10-05 14:42:41,139 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-05 14:42:41,185 [main] WARN  connections                     - HHH10001002: Using Hibernate built-in connection pool (not for production use!)
2018-10-05 14:42:41,185 [main] INFO  connections                     - HHH10001005: using driver [null] at URL [jdbc:hsqldb:mem:axontest]
2018-10-05 14:42:41,185 [main] INFO  connections                     - HHH10001001: Connection properties: {}
2018-10-05 14:42:41,185 [main] INFO  connections                     - HHH10001003: Autocommit mode: false
2018-10-05 14:42:41,186 [main] INFO  rManagerConnectionProviderImpl  - HHH000115: Hibernate connection pool size: 20 (min=1)
2018-10-05 14:42:41,186 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-05 14:42:41,245 [main] INFO  SchemaCreatorImpl               - HHH000476: Executing import script 'org.hibernate.tool.schema.internal.exec.ScriptSourceInputNonExistentImpl@581b9fe6'
2018-10-05 14:42:41,254 [main] WARN  EntityManagerFactoryRegistry    - HHH000436: Entity manager factory name (eventStore) is already registered.  If entity manager will be clustered or passivated, specify a unique value for property 'hibernate.ejb.entitymanager_factory_name'
2018-10-05 14:42:41,260 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-05 14:42:41,306 [main] WARN  connections                     - HHH10001002: Using Hibernate built-in connection pool (not for production use!)
2018-10-05 14:42:41,306 [main] INFO  connections                     - HHH10001005: using driver [null] at URL [jdbc:hsqldb:mem:axontest]
2018-10-05 14:42:41,306 [main] INFO  connections                     - HHH10001001: Connection properties: {}
2018-10-05 14:42:41,306 [main] INFO  connections                     - HHH10001003: Autocommit mode: false
2018-10-05 14:42:41,306 [main] INFO  rManagerConnectionProviderImpl  - HHH000115: Hibernate connection pool size: 20 (min=1)
2018-10-05 14:42:41,307 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-05 14:42:41,359 [main] INFO  SchemaCreatorImpl               - HHH000476: Executing import script 'org.hibernate.tool.schema.internal.exec.ScriptSourceInputNonExistentImpl@581b9fe6'
2018-10-05 14:42:41,366 [main] WARN  EntityManagerFactoryRegistry    - HHH000436: Entity manager factory name (eventStore) is already registered.  If entity manager will be clustered or passivated, specify a unique value for property 'hibernate.ejb.entitymanager_factory_name'
2018-10-05 14:42:41,380 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-05 14:42:41,425 [main] WARN  connections                     - HHH10001002: Using Hibernate built-in connection pool (not for production use!)
2018-10-05 14:42:41,425 [main] INFO  connections                     - HHH10001005: using driver [null] at URL [jdbc:hsqldb:mem:axontest]
2018-10-05 14:42:41,425 [main] INFO  connections                     - HHH10001001: Connection properties: {}
2018-10-05 14:42:41,425 [main] INFO  connections                     - HHH10001003: Autocommit mode: false
2018-10-05 14:42:41,425 [main] INFO  rManagerConnectionProviderImpl  - HHH000115: Hibernate connection pool size: 20 (min=1)
2018-10-05 14:42:41,425 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-05 14:42:41,468 [main] INFO  SchemaCreatorImpl               - HHH000476: Executing import script 'org.hibernate.tool.schema.internal.exec.ScriptSourceInputNonExistentImpl@581b9fe6'
2018-10-05 14:42:41,475 [main] WARN  EntityManagerFactoryRegistry    - HHH000436: Entity manager factory name (eventStore) is already registered.  If entity manager will be clustered or passivated, specify a unique value for property 'hibernate.ejb.entitymanager_factory_name'
2018-10-05 14:42:41,485 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-05 14:42:41,529 [main] WARN  connections                     - HHH10001002: Using Hibernate built-in connection pool (not for production use!)
2018-10-05 14:42:41,529 [main] INFO  connections                     - HHH10001005: using driver [null] at URL [jdbc:hsqldb:mem:axontest]
2018-10-05 14:42:41,529 [main] INFO  connections                     - HHH10001001: Connection properties: {}
2018-10-05 14:42:41,529 [main] INFO  connections                     - HHH10001003: Autocommit mode: false
2018-10-05 14:42:41,529 [main] INFO  rManagerConnectionProviderImpl  - HHH000115: Hibernate connection pool size: 20 (min=1)
2018-10-05 14:42:41,530 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-05 14:42:41,581 [main] INFO  SchemaCreatorImpl               - HHH000476: Executing import script 'org.hibernate.tool.schema.internal.exec.ScriptSourceInputNonExistentImpl@581b9fe6'
2018-10-05 14:42:41,590 [main] WARN  EntityManagerFactoryRegistry    - HHH000436: Entity manager factory name (eventStore) is already registered.  If entity manager will be clustered or passivated, specify a unique value for property 'hibernate.ejb.entitymanager_factory_name'
2018-10-05 14:42:41,643 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-05 14:42:41,690 [main] WARN  connections                     - HHH10001002: Using Hibernate built-in connection pool (not for production use!)
2018-10-05 14:42:41,690 [main] INFO  connections                     - HHH10001005: using driver [null] at URL [jdbc:hsqldb:mem:axontest]
2018-10-05 14:42:41,690 [main] INFO  connections                     - HHH10001001: Connection properties: {}
2018-10-05 14:42:41,690 [main] INFO  connections                     - HHH10001003: Autocommit mode: false
2018-10-05 14:42:41,690 [main] INFO  rManagerConnectionProviderImpl  - HHH000115: Hibernate connection pool size: 20 (min=1)
2018-10-05 14:42:41,690 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-05 14:42:41,752 [main] INFO  SchemaCreatorImpl               - HHH000476: Executing import script 'org.hibernate.tool.schema.internal.exec.ScriptSourceInputNonExistentImpl@581b9fe6'
2018-10-05 14:42:41,761 [main] WARN  EntityManagerFactoryRegistry    - HHH000436: Entity manager factory name (eventStore) is already registered.  If entity manager will be clustered or passivated, specify a unique value for property 'hibernate.ejb.entitymanager_factory_name'
2018-10-05 14:42:41,766 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-05 14:42:41,810 [main] WARN  connections                     - HHH10001002: Using Hibernate built-in connection pool (not for production use!)
2018-10-05 14:42:41,810 [main] INFO  connections                     - HHH10001005: using driver [null] at URL [jdbc:hsqldb:mem:axontest]
2018-10-05 14:42:41,810 [main] INFO  connections                     - HHH10001001: Connection properties: {}
2018-10-05 14:42:41,810 [main] INFO  connections                     - HHH10001003: Autocommit mode: false
2018-10-05 14:42:41,810 [main] INFO  rManagerConnectionProviderImpl  - HHH000115: Hibernate connection pool size: 20 (min=1)
2018-10-05 14:42:41,811 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-05 14:42:41,852 [main] INFO  SchemaCreatorImpl               - HHH000476: Executing import script 'org.hibernate.tool.schema.internal.exec.ScriptSourceInputNonExistentImpl@581b9fe6'
2018-10-05 14:42:41,859 [main] WARN  EntityManagerFactoryRegistry    - HHH000436: Entity manager factory name (eventStore) is already registered.  If entity manager will be clustered or passivated, specify a unique value for property 'hibernate.ejb.entitymanager_factory_name'
2018-10-05 14:42:41,865 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-05 14:42:41,908 [main] WARN  connections                     - HHH10001002: Using Hibernate built-in connection pool (not for production use!)
2018-10-05 14:42:41,908 [main] INFO  connections                     - HHH10001005: using driver [null] at URL [jdbc:hsqldb:mem:axontest]
2018-10-05 14:42:41,908 [main] INFO  connections                     - HHH10001001: Connection properties: {}
2018-10-05 14:42:41,908 [main] INFO  connections                     - HHH10001003: Autocommit mode: false
2018-10-05 14:42:41,908 [main] INFO  rManagerConnectionProviderImpl  - HHH000115: Hibernate connection pool size: 20 (min=1)
2018-10-05 14:42:41,909 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-05 14:42:41,949 [main] INFO  SchemaCreatorImpl               - HHH000476: Executing import script 'org.hibernate.tool.schema.internal.exec.ScriptSourceInputNonExistentImpl@581b9fe6'
2018-10-05 14:42:41,955 [main] WARN  EntityManagerFactoryRegistry    - HHH000436: Entity manager factory name (eventStore) is already registered.  If entity manager will be clustered or passivated, specify a unique value for property 'hibernate.ejb.entitymanager_factory_name'
2018-10-05 14:42:41,978 [main] INFO  LogHelper                       - HHH000204: Processing PersistenceUnitInfo [
	name: eventStore
	...]
2018-10-05 14:42:42,021 [main] WARN  connections                     - HHH10001002: Using Hibernate built-in connection pool (not for production use!)
2018-10-05 14:42:42,021 [main] INFO  connections                     - HHH10001005: using driver [null] at URL [jdbc:hsqldb:mem:axontest]
2018-10-05 14:42:42,021 [main] INFO  connections                     - HHH10001001: Connection properties: {}
2018-10-05 14:42:42,021 [main] INFO  connections                     - HHH10001003: Autocommit mode: false
2018-10-05 14:42:42,021 [main] INFO  rManagerConnectionProviderImpl  - HHH000115: Hibernate connection pool size: 20 (min=1)
2018-10-05 14:42:42,021 [main] INFO  Dialect                         - HHH000400: Using dialect: org.hibernate.dialect.HSQLDialect
2018-10-05 14:42:42,063 [main] INFO  SchemaCreatorImpl               - HHH000476: Executing import script 'org.hibernate.tool.schema.internal.exec.ScriptSourceInputNonExistentImpl@581b9fe6'
2018-10-05 14:42:42,073 [main] WARN  EntityManagerFactoryRegistry    - HHH000436: Entity manager factory name (eventStore) is already registered.  If entity manager will be clustered or passivated, specify a unique value for property 'hibernate.ejb.entitymanager_factory_name'
2018-10-05 14:42:42,076 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
Tests run: 12, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 1.713 sec - in org.axonframework.config.DefaultConfigurerTest
Running org.axonframework.config.MessageMonitorFactoryBuilderTest
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 sec - in org.axonframework.config.MessageMonitorFactoryBuilderTest
Running org.axonframework.config.EventHandlingConfigurationTest
2018-10-05 14:42:42,113 [EventProcessor[tracking]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=tracking, segment=Segment[0/0]}
2018-10-05 14:42:42,113 [EventProcessor[tracking]-0] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=-1} for segment: Segment[0/0]
2018-10-05 14:42:42,113 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'tracking'. Awaiting termination...
2018-10-05 14:42:43,077 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:42:43,916 [EventProcessor[concurrent]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=concurrent, segment=Segment[0/0]}
2018-10-05 14:42:43,916 [EventProcessor[concurrent]-0] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[0/0]
2018-10-05 14:42:43,922 [EventProcessor[tracking]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=tracking, segment=Segment[0/0]}
2018-10-05 14:42:43,923 [EventProcessor[tracking]-0] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=-1} for segment: Segment[0/0]
2018-10-05 14:42:43,924 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'tracking'. Awaiting termination...
2018-10-05 14:42:44,078 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:42:44,933 [EventProcessor[tracking]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=tracking, segment=Segment[0/0]}
2018-10-05 14:42:44,933 [EventProcessor[tracking]-0] INFO  TrackingEventProcessor          - Fetched token: null for segment: Segment[0/0]
2018-10-05 14:42:44,937 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'tracking'. Awaiting termination...
2018-10-05 14:42:44,945 [EventProcessor[tracking]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=tracking, segment=Segment[0/0]}
2018-10-05 14:42:44,945 [EventProcessor[tracking]-0] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=-1} for segment: Segment[0/0]
2018-10-05 14:42:44,956 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'tracking'. Awaiting termination...
2018-10-05 14:42:45,078 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:42:45,960 [EventProcessor[tracking]-0] INFO  TrackingEventProcessor          - Using current Thread for last segment worker: TrackingSegmentWorker{processor=tracking, segment=Segment[0/0]}
2018-10-05 14:42:45,960 [EventProcessor[tracking]-0] INFO  TrackingEventProcessor          - Fetched token: IndexTrackingToken{globalIndex=-1} for segment: Segment[0/0]
2018-10-05 14:42:45,968 [main] INFO  TrackingEventProcessor          - Shutdown state set for Processor 'tracking'. Awaiting termination...
2018-10-05 14:42:46,079 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
Tests run: 10, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 4.841 sec - in org.axonframework.config.EventHandlingConfigurationTest
Running org.axonframework.config.ConfigurationScopeAwareProviderTest
2018-10-05 14:42:47,080 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.134 sec - in org.axonframework.config.ConfigurationScopeAwareProviderTest
Running org.axonframework.config.ConfigurationResourceInjectorTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 sec - in org.axonframework.config.ConfigurationResourceInjectorTest
Running org.axonframework.config.SingleEventProcessorAssigningToMultipleInvokersTest
Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.015 sec - in org.axonframework.config.SingleEventProcessorAssigningToMultipleInvokersTest
Running org.axonframework.config.ConfigurationParameterResolverFactoryTest
Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 sec - in org.axonframework.config.ConfigurationParameterResolverFactoryTest
Running org.axonframework.deadline.SimpleDeadlineManagerTest
Tests run: 9, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.839 sec - in org.axonframework.deadline.SimpleDeadlineManagerTest
Running org.axonframework.deadline.quartz.QuartzDeadlineManagerTest
2018-10-05 14:42:47,968 [main] INFO  StdSchedulerFactory             - Using default implementation for ThreadExecutor
2018-10-05 14:42:47,968 [main] INFO  SimpleThreadPool                - Job execution threads will use class loader of thread: main
2018-10-05 14:42:47,969 [main] INFO  SchedulerSignalerImpl           - Initialized Scheduler Signaller of type: class org.quartz.core.SchedulerSignalerImpl
2018-10-05 14:42:47,970 [main] INFO  QuartzScheduler                 - Quartz Scheduler v.2.2.1 created.
2018-10-05 14:42:47,971 [main] INFO  RAMJobStore                     - RAMJobStore initialized.
2018-10-05 14:42:47,971 [main] INFO  QuartzScheduler                 - Scheduler meta-data: Quartz Scheduler (v2.2.1) 'DefaultQuartzScheduler' with instanceId 'NON_CLUSTERED'
  Scheduler class: 'org.quartz.core.QuartzScheduler' - running locally.
  NOT STARTED.
  Currently in standby mode.
  Number of jobs executed: 0
  Using thread pool 'org.quartz.simpl.SimpleThreadPool' - with 10 threads.
  Using job-store 'org.quartz.simpl.RAMJobStore' - which does not support persistence. and is not clustered.

2018-10-05 14:42:47,972 [main] INFO  StdSchedulerFactory             - Quartz scheduler 'DefaultQuartzScheduler' initialized from default resource file in Quartz package: 'quartz.properties'
2018-10-05 14:42:47,972 [main] INFO  StdSchedulerFactory             - Quartz scheduler version: 2.2.1
2018-10-05 14:42:47,977 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
2018-10-05 14:42:48,080 [EmbeddedEventStore-0] ERROR EmbeddedEventStore              - Failed to read events from the underlying event storage
java.lang.IllegalStateException: EntityManagerFactory is closed
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.validateNotClosed(EntityManagerFactoryImpl.java:367)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.internalCreateEntityManager(EntityManagerFactoryImpl.java:316)
	at org.hibernate.jpa.internal.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:286)
	at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.invokeProxyMethod(AbstractEntityManagerFactoryBean.java:476)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:655)
	at com.sun.proxy.$Proxy61.createEntityManager(Unknown Source)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298)
	at com.sun.proxy.$Proxy63.createQuery(Unknown Source)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:234)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:67)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:230)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:154)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:192)
	at java.util.Spliterator.forEachRemaining(Spliterator.java:326)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:265)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:231)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2000(EmbeddedEventStore.java:210)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:160)
	at java.lang.Thread.run(Thread.java:745)
2018-10-05 14:42:48,104 [DefaultQuartzScheduler_Worker-1] INFO  DeadlineJob                     - Job successfully executed. Deadline message [Void] processed.
2018-10-05 14:42:48,109 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
2018-10-05 14:42:48,233 [DefaultQuartzScheduler_Worker-2] INFO  DeadlineJob                     - Job successfully executed. Deadline message [DeadlinePayload] processed.
2018-10-05 14:42:48,240 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
2018-10-05 14:42:48,355 [DefaultQuartzScheduler_Worker-3] INFO  DeadlineJob                     - Job successfully executed. Deadline message [DeadlinePayload] processed.
2018-10-05 14:42:48,360 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
2018-10-05 14:42:48,369 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
2018-10-05 14:42:48,436 [DefaultQuartzScheduler_Worker-4] INFO  DeadlineJob                     - Job successfully executed. Deadline message [EntityDeadlinePayload] processed.
2018-10-05 14:42:48,483 [DefaultQuartzScheduler_Worker-5] INFO  DeadlineJob                     - Job successfully executed. Deadline message [DeadlinePayload] processed.
2018-10-05 14:42:48,487 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
2018-10-05 14:42:48,602 [DefaultQuartzScheduler_Worker-6] INFO  DeadlineJob                     - Job successfully executed. Deadline message [String] processed.
2018-10-05 14:42:48,606 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
2018-10-05 14:42:48,721 [DefaultQuartzScheduler_Worker-7] INFO  DeadlineJob                     - Job successfully executed. Deadline message [Void] processed.
2018-10-05 14:42:48,726 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
2018-10-05 14:42:48,840 [DefaultQuartzScheduler_Worker-8] INFO  DeadlineJob                     - Job successfully executed. Deadline message [String] processed.
2018-10-05 14:42:48,843 [main] INFO  QuartzScheduler                 - Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
Tests run: 9, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.881 sec - in org.axonframework.deadline.quartz.QuartzDeadlineManagerTest
Running org.axonframework.deadline.quartz.DeadlineJobDataBinderTest
Tests run: 9, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.018 sec - in org.axonframework.deadline.quartz.DeadlineJobDataBinderTest
Running org.axonframework.monitoring.MultiMessageMonitorTest
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.003 sec - in org.axonframework.monitoring.MultiMessageMonitorTest
2018-10-05 14:42:48,874 [Thread-42] INFO  GenericApplicationContext       - Closing org.springframework.context.support.GenericApplicationContext@4cf2b47a: startup date [Fri Oct 05 14:41:11 CEST 2018]; root of context hierarchy
2018-10-05 14:42:48,875 [Thread-7] INFO  GenericApplicationContext       - Closing org.springframework.context.support.GenericApplicationContext@50ad5625: startup date [Fri Oct 05 14:41:02 CEST 2018]; root of context hierarchy
2018-10-05 14:42:48,878 [Thread-41] INFO  GenericApplicationContext       - Closing org.springframework.context.support.GenericApplicationContext@214a7560: startup date [Fri Oct 05 14:41:10 CEST 2018]; root of context hierarchy
2018-10-05 14:42:48,879 [Thread-56] INFO  GenericApplicationContext       - Closing org.springframework.context.support.GenericApplicationContext@2096ade6: startup date [Fri Oct 05 14:42:16 CEST 2018]; root of context hierarchy
2018-10-05 14:42:48,887 [Thread-7] INFO  tainerEntityManagerFactoryBean  - Closing JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-05 14:42:48,889 [Thread-56] INFO  tainerEntityManagerFactoryBean  - Closing JPA EntityManagerFactory for persistence unit 'eventStore'
2018-10-05 14:42:48,887 [Thread-42] INFO  tainerEntityManagerFactoryBean  - Closing JPA EntityManagerFactory for persistence unit 'default'
2018-10-05 14:42:48,893 [Thread-42] INFO  pperImpl$DelayedDropActionImpl  - HHH000477: Starting delayed drop of schema as part of SessionFactory shut-down'
Hibernate: drop table TokenEntry if exists
2018-10-05 14:42:48,911 [Thread-42] INFO  connections                     - HHH10001008: Cleaning up connection pool [jdbc:hsqldb:mem:testdb]

Results :

Tests run: 1142, Failures: 0, Errors: 0, Skipped: 1

[INFO]                                                                         
[INFO] ------------------------------------------------------------------------
[INFO] Building Axon Framework Distributed CommandBus JGroups 3.4-SNAPSHOT
[INFO] ------------------------------------------------------------------------
[INFO] 
[INFO] --- maven-resources-plugin:3.0.2:resources (default-resources) @ axon-distributed-commandbus-jgroups ---
[INFO] Using 'UTF-8' encoding to copy filtered resources.
[INFO] skip non existing resourceDirectory /root/workspace/AxonFramework/AxonFramework/437597521/distributed-commandbus-jgroups/src/main/resources
[INFO] 
[INFO] --- maven-compiler-plugin:3.5.1:compile (default-compile) @ axon-distributed-commandbus-jgroups ---
[INFO] Nothing to compile - all classes are up to date
[INFO] 
[INFO] --- maven-resources-plugin:3.0.2:testResources (default-testResources) @ axon-distributed-commandbus-jgroups ---
[INFO] Using 'UTF-8' encoding to copy filtered resources.
[INFO] Copying 4 resources
[INFO] 
[INFO] --- maven-compiler-plugin:3.5.1:testCompile (default-testCompile) @ axon-distributed-commandbus-jgroups ---
[INFO] Nothing to compile - all classes are up to date
[INFO] 
[INFO] --- maven-surefire-plugin:2.19.1:test (default-test) @ axon-distributed-commandbus-jgroups ---

-------------------------------------------------------
 T E S T S
-------------------------------------------------------
Running org.axonframework.jgroups.commandhandling.JgroupsConnectorTest_Gossip
Tests run: 2, Failures: 0, Errors: 2, Skipped: 0, Time elapsed: 0.132 sec <<< FAILURE! - in org.axonframework.jgroups.commandhandling.JgroupsConnectorTest_Gossip
testConnectorRecoversWhenGossipRouterReconnects(org.axonframework.jgroups.commandhandling.JgroupsConnectorTest_Gossip)  Time elapsed: 0.047 sec  <<< ERROR!
java.lang.ExceptionInInitializerError
	at org.axonframework.jgroups.commandhandling.JgroupsConnectorTest_Gossip.createChannel(JgroupsConnectorTest_Gossip.java:159)
	at org.axonframework.jgroups.commandhandling.JgroupsConnectorTest_Gossip.setUp(JgroupsConnectorTest_Gossip.java:67)
Caused by: java.lang.NullPointerException
	at org.axonframework.jgroups.commandhandling.JgroupsConnectorTest_Gossip.createChannel(JgroupsConnectorTest_Gossip.java:159)
	at org.axonframework.jgroups.commandhandling.JgroupsConnectorTest_Gossip.setUp(JgroupsConnectorTest_Gossip.java:67)

testDistributedCommandBusInvokesCallbackOnSerializationFailure(org.axonframework.jgroups.commandhandling.JgroupsConnectorTest_Gossip)  Time elapsed: 0.002 sec  <<< ERROR!
java.lang.NoClassDefFoundError: Could not initialize class org.jgroups.conf.XmlConfigurator
	at org.axonframework.jgroups.commandhandling.JgroupsConnectorTest_Gossip.createChannel(JgroupsConnectorTest_Gossip.java:159)
	at org.axonframework.jgroups.commandhandling.JgroupsConnectorTest_Gossip.setUp(JgroupsConnectorTest_Gossip.java:67)

Running org.axonframework.jgroups.commandhandling.JGroupsConnectorTest
Tests run: 11, Failures: 0, Errors: 11, Skipped: 0, Time elapsed: 0.104 sec <<< FAILURE! - in org.axonframework.jgroups.commandhandling.JGroupsConnectorTest
testRingsProperlySynchronized_ChannelAlreadyConnectedToOtherCluster(org.axonframework.jgroups.commandhandling.JGroupsConnectorTest)  Time elapsed: 0.088 sec  <<< ERROR!
java.lang.NoClassDefFoundError: Could not initialize class org.jgroups.conf.XmlConfigurator
	at org.axonframework.jgroups.commandhandling.JGroupsConnectorTest.createChannel(JGroupsConnectorTest.java:444)
	at org.axonframework.jgroups.commandhandling.JGroupsConnectorTest.setUp(JGroupsConnectorTest.java:71)

testUpdatesToMemberShipProcessedInOrder(org.axonframework.jgroups.commandhandling.JGroupsConnectorTest)  Time elapsed: 0.001 sec  <<< ERROR!
java.lang.NoClassDefFoundError: Could not initialize class org.jgroups.conf.XmlConfigurator
	at org.axonframework.jgroups.commandhandling.JGroupsConnectorTest.createChannel(JGroupsConnectorTest.java:444)
	at org.axonframework.jgroups.commandhandling.JGroupsConnectorTest.setUp(JGroupsConnectorTest.java:71)

testUnserializableResponseConvertedToNull(org.axonframework.jgroups.commandhandling.JGroupsConnectorTest)  Time elapsed: 0.001 sec  <<< ERROR!
java.lang.NoClassDefFoundError: Could not initialize class org.jgroups.conf.XmlConfigurator
	at org.axonframework.jgroups.commandhandling.JGroupsConnectorTest.createChannel(JGroupsConnectorTest.java:444)
	at org.axonframework.jgroups.commandhandling.JGroupsConnectorTest.setUp(JGroupsConnectorTest.java:71)

testDisconnectClosesJChannelConnection(org.axonframework.jgroups.commandhandling.JGroupsConnectorTest)  Time elapsed: 0.001 sec  <<< ERROR!
java.lang.NoClassDefFoundError: Could not initialize class org.jgroups.conf.XmlConfigurator
	at org.axonframework.jgroups.commandhandling.JGroupsConnectorTest.createChannel(JGroupsConnectorTest.java:444)
	at org.axonframework.jgroups.commandhandling.JGroupsConnectorTest.setUp(JGroupsConnectorTest.java:71)

testConnectAndDispatchMessagesWaitingOnCallback(org.axonframework.jgroups.commandhandling.JGroupsConnectorTest)  Time elapsed: 0.002 sec  <<< ERROR!
java.lang.NoClassDefFoundError: Could not initialize class org.jgroups.conf.XmlConfigurator
	at org.axonframework.jgroups.commandhandling.JGroupsConnectorTest.createChannel(JGroupsConnectorTest.java:444)
	at org.axonframework.jgroups.commandhandling.JGroupsConnectorTest.setUp(JGroupsConnectorTest.java:71)

testRingsProperlySynchronized_ChannelAlreadyConnected(org.axonframework.jgroups.commandhandling.JGroupsConnectorTest)  Time elapsed: 0.001 sec  <<< ERROR!
java.lang.NoClassDefFoundError: Could not initialize class org.jgroups.conf.XmlConfigurator
	at org.axonframework.jgroups.commandhandling.JGroupsConnectorTest.createChannel(JGroupsConnectorTest.java:444)
	at org.axonframework.jgroups.commandhandling.JGroupsConnectorTest.setUp(JGroupsConnectorTest.java:71)

testJoinMessageReceivedForDisconnectedHost(org.axonframework.jgroups.commandhandling.JGroupsConnectorTest)  Time elapsed: 0.002 sec  <<< ERROR!
java.lang.NoClassDefFoundError: Could not initialize class org.jgroups.conf.XmlConfigurator
	at org.axonframework.jgroups.commandhandling.JGroupsConnectorTest.createChannel(JGroupsConnectorTest.java:444)
	at org.axonframework.jgroups.commandhandling.JGroupsConnectorTest.setUp(JGroupsConnectorTest.java:71)

testConnectAndDispatchMessages_Balanced(org.axonframework.jgroups.commandhandling.JGroupsConnectorTest)  Time elapsed: 0.001 sec  <<< ERROR!
java.lang.NoClassDefFoundError: Could not initialize class org.jgroups.conf.XmlConfigurator
	at org.axonframework.jgroups.commandhandling.JGroupsConnectorTest.createChannel(JGroupsConnectorTest.java:444)
	at org.axonframework.jgroups.commandhandling.JGroupsConnectorTest.setUp(JGroupsConnectorTest.java:71)

testSetupOfReplyingCallback(org.axonframework.jgroups.commandhandling.JGroupsConnectorTest)  Time elapsed: 0.002 sec  <<< ERROR!
java.lang.NoClassDefFoundError: Could not initialize class org.jgroups.conf.XmlConfigurator
	at org.axonframework.jgroups.commandhandling.JGroupsConnectorTest.createChannel(JGroupsConnectorTest.java:444)
	at org.axonframework.jgroups.commandhandling.JGroupsConnectorTest.setUp(JGroupsConnectorTest.java:71)

testConnectAndDispatchMessages_SingleCandidate(org.axonframework.jgroups.commandhandling.JGroupsConnectorTest)  Time elapsed: 0.001 sec  <<< ERROR!
java.lang.NoClassDefFoundError: Could not initialize class org.jgroups.conf.XmlConfigurator
	at org.axonframework.jgroups.commandhandling.JGroupsConnectorTest.createChannel(JGroupsConnectorTest.java:444)
	at org.axonframework.jgroups.commandhandling.JGroupsConnectorTest.setUp(JGroupsConnectorTest.java:71)

testConnectAndDispatchMessages_CustomCommandName(org.axonframework.jgroups.commandhandling.JGroupsConnectorTest)  Time elapsed: 0.001 sec  <<< ERROR!
java.lang.NoClassDefFoundError: Could not initialize class org.jgroups.conf.XmlConfigurator
	at org.axonframework.jgroups.commandhandling.JGroupsConnectorTest.createChannel(JGroupsConnectorTest.java:444)
	at org.axonframework.jgroups.commandhandling.JGroupsConnectorTest.setUp(JGroupsConnectorTest.java:71)


Results :

Tests in error: 
  JGroupsConnectorTest.setUp:71->createChannel:444  NoClassDefFound Could not i...
  JGroupsConnectorTest.setUp:71->createChannel:444  NoClassDefFound Could not i...
  JGroupsConnectorTest.setUp:71->createChannel:444  NoClassDefFound Could not i...
  JGroupsConnectorTest.setUp:71->createChannel:444  NoClassDefFound Could not i...
  JGroupsConnectorTest.setUp:71->createChannel:444  NoClassDefFound Could not i...
  JGroupsConnectorTest.setUp:71->createChannel:444  NoClassDefFound Could not i...
  JGroupsConnectorTest.setUp:71->createChannel:444  NoClassDefFound Could not i...
  JGroupsConnectorTest.setUp:71->createChannel:444  NoClassDefFound Could not i...
  JGroupsConnectorTest.setUp:71->createChannel:444  NoClassDefFound Could not i...
  JGroupsConnectorTest.setUp:71->createChannel:444  NoClassDefFound Could not i...
  JGroupsConnectorTest.setUp:71->createChannel:444  NoClassDefFound Could not i...
  JgroupsConnectorTest_Gossip.setUp:67->createChannel:159  ExceptionInInitializer
  JgroupsConnectorTest_Gossip.setUp:67->createChannel:159  NoClassDefFound Coul...

Tests run: 13, Failures: 0, Errors: 13, Skipped: 0

[INFO] ------------------------------------------------------------------------
[INFO] Reactor Summary:
[INFO] 
[INFO] Axon Framework ..................................... SUCCESS [  0.005 s]
[INFO] Axon Framework core ................................ SUCCESS [02:25 min]
[INFO] Axon Framework Distributed CommandBus JGroups ...... FAILURE [  1.497 s]
[INFO] Axon Framework Spring Support ...................... SKIPPED
[INFO] Axon AMQP .......................................... SKIPPED
[INFO] Axon Kafka ......................................... SKIPPED
[INFO] Axon Framework Distributed CommandBus Spring Cloud . SKIPPED
[INFO] Axon Metrics ....................................... SKIPPED
[INFO] Axon Framework Spring Boot Support ................. SKIPPED
[INFO] Axon Framework Test Fixtures ....................... SKIPPED
[INFO] Axon MongoDB Components ............................ SKIPPED
[INFO] Axon Integration tests ............................. SKIPPED
[INFO] Spring Boot Starter module for Axon Framework ...... SKIPPED
[INFO] Spring Boot Starter module for Axon with JGroups Distributed Command Bus SKIPPED
[INFO] Axon Legacy Components ............................. SKIPPED
[INFO] ------------------------------------------------------------------------
[INFO] BUILD FAILURE
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 02:29 min
[INFO] Finished at: 2018-10-05T14:42:50+02:00
[INFO] Final Memory: 56M/854M
[INFO] ------------------------------------------------------------------------
[ERROR] Failed to execute goal org.apache.maven.plugins:maven-surefire-plugin:2.19.1:test (default-test) on project axon-distributed-commandbus-jgroups: There are test failures.
[ERROR] 
[ERROR] Please refer to /root/workspace/AxonFramework/AxonFramework/437597521/distributed-commandbus-jgroups/target/surefire-reports for the individual test results.
[ERROR] -> [Help 1]
[ERROR] 
[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.
[ERROR] Re-run Maven using the -X switch to enable full debug logging.
[ERROR] 
[ERROR] For more information about the errors and possible solutions, please read the following articles:
[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoFailureException
[ERROR] 
[ERROR] After correcting the problems, you can resume the build with the command
[ERROR]   mvn <goals> -rf :axon-distributed-commandbus-jgroups
