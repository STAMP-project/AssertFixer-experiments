<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>NxtConfiguration.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">RobotNXT</a> &gt; <a href="index.source.html" class="el_package">de.fhg.iais.roberta.components.nxt</a> &gt; <span class="el_source">NxtConfiguration.java</span></div><h1>NxtConfiguration.java</h1><pre class="source lang-java linenums">package de.fhg.iais.roberta.components.nxt;

import java.util.List;
import java.util.Map;
import java.util.TreeMap;

import de.fhg.iais.roberta.components.Actor;
import de.fhg.iais.roberta.components.ActorType;
import de.fhg.iais.roberta.components.Configuration;
import de.fhg.iais.roberta.components.Sensor;
import de.fhg.iais.roberta.inter.mode.action.IActorPort;
import de.fhg.iais.roberta.inter.mode.sensor.ISensorPort;
import de.fhg.iais.roberta.mode.action.ActorPort;
import de.fhg.iais.roberta.mode.action.MotorSide;
import de.fhg.iais.roberta.mode.sensor.SensorPort;
import de.fhg.iais.roberta.util.Formatter;
import de.fhg.iais.roberta.util.Pair;
import de.fhg.iais.roberta.util.dbc.DbcException;

public class NxtConfiguration extends Configuration {

    public NxtConfiguration(Map&lt;IActorPort, Actor&gt; actors, Map&lt;ISensorPort, Sensor&gt; sensors, double wheelDiameterCM, double trackWidthCM) {
<span class="fc" id="L23">        super(actors, sensors, wheelDiameterCM, trackWidthCM);</span>

<span class="fc" id="L25">    }</span>

    /**
     * This method returns the port on which the left motor is connected. If there is no left motor connected throws and {@link DbcException} exception.
     *
     * @return port on which the left motor is connected
     */
    @Override
    public IActorPort getLeftMotorPort() {
<span class="fc" id="L34">        return getMotorPortOnSide(MotorSide.LEFT);</span>
    }

    @Override
    public Actor getLeftMotor() {
<span class="nc" id="L39">        IActorPort port = getLeftMotorPort();</span>
<span class="nc bnc" id="L40" title="All 2 branches missed.">        if ( port != null ) {</span>
<span class="nc" id="L41">            return getActorOnPort(port);</span>
        }
<span class="nc" id="L43">        return null;</span>
    }

    @Override
    public int getNumberOfLeftMotors() {
<span class="nc" id="L48">        int leftMotors = 0;</span>
<span class="nc bnc" id="L49" title="All 2 branches missed.">        for ( Actor actor : this.actors.values() ) {</span>
<span class="nc bnc" id="L50" title="All 2 branches missed.">            if ( actor.getMotorSide() == MotorSide.LEFT ) {</span>
<span class="nc" id="L51">                leftMotors++;</span>
            }
<span class="nc" id="L53">        }</span>
<span class="nc" id="L54">        return leftMotors;</span>
    }

    /**
     * This method returns the port on which the right motor is connected. If there is no right motor connected throws and {@link DbcException} exception.
     *
     * @return port on which the left motor is connected
     */
    @Override
    public IActorPort getRightMotorPort() {
<span class="fc" id="L64">        return getMotorPortOnSide(MotorSide.RIGHT);</span>
    }

    @Override
    public Actor getRightMotor() {
<span class="nc" id="L69">        IActorPort port = getRightMotorPort();</span>
<span class="nc bnc" id="L70" title="All 2 branches missed.">        if ( port != null ) {</span>
<span class="nc" id="L71">            return getActorOnPort(port);</span>
        }
<span class="nc" id="L73">        return null;</span>
    }

    @Override
    public int getNumberOfRightMotors() {
<span class="nc" id="L78">        int right = 0;</span>
<span class="nc bnc" id="L79" title="All 2 branches missed.">        for ( Actor actor : this.actors.values() ) {</span>
<span class="nc bnc" id="L80" title="All 2 branches missed.">            if ( actor.getMotorSide() == MotorSide.RIGHT ) {</span>
<span class="nc" id="L81">                right++;</span>
            }
<span class="nc" id="L83">        }</span>
<span class="nc" id="L84">        return right;</span>
    }

    /**
     * @return text which defines the brick configuration
     */
    @Override
    public String generateText(String name) {
<span class="fc" id="L92">        StringBuilder sb = new StringBuilder();</span>
<span class="fc" id="L93">        sb.append(&quot;robot nxt &quot;).append(name).append(&quot; {\n&quot;);</span>
<span class="fc" id="L94">        generateWheelData(sb);</span>
<span class="fc" id="L95">        generateSensors(sb);</span>
<span class="fc" id="L96">        generateActors(sb);</span>
<span class="fc" id="L97">        sb.append(&quot;}&quot;);</span>
<span class="fc" id="L98">        return sb.toString();</span>
    }

    private void generateWheelData(StringBuilder sb) {
<span class="pc bpc" id="L102" title="3 of 4 branches missed.">        if ( (this.wheelDiameterCM != 0.0) || (this.trackWidthCM != 0.0) ) { //NOSONAR : 0.0 is safe here, as it is used as 'null' value</span>
<span class="fc" id="L103">            sb.append(&quot;  size {\n&quot;);</span>
<span class="fc" id="L104">            sb.append(&quot;    wheel diameter &quot;).append(Formatter.d2s(this.wheelDiameterCM)).append(&quot; cm;\n&quot;);</span>
<span class="fc" id="L105">            sb.append(&quot;    track width    &quot;).append(Formatter.d2s(this.trackWidthCM)).append(&quot; cm;\n&quot;);</span>
<span class="fc" id="L106">            sb.append(&quot;  }\n&quot;);</span>
        }
<span class="fc" id="L108">    }</span>

    private void generateSensors(StringBuilder sb) {
<span class="pc bpc" id="L111" title="1 of 2 branches missed.">        if ( !this.sensors.isEmpty() ) {</span>
<span class="fc" id="L112">            sb.append(&quot;  sensor port {\n&quot;);</span>
<span class="fc bfc" id="L113" title="All 2 branches covered.">            for ( ISensorPort port : this.sensors.keySet() ) {</span>
<span class="fc" id="L114">                sb.append(&quot;    &quot;).append(port.getOraName()).append(&quot;: &quot;);</span>
<span class="fc" id="L115">                String sensor = this.sensors.get(port).getType().toString();</span>
<span class="fc" id="L116">                sb.append(sensor.toLowerCase()).append(&quot;;\n&quot;);</span>
<span class="fc" id="L117">            }</span>
<span class="fc" id="L118">            sb.append(&quot;  }\n&quot;);</span>
        }
<span class="fc" id="L120">    }</span>

    private void generateActors(StringBuilder sb) {
<span class="pc bpc" id="L123" title="1 of 2 branches missed.">        if ( !this.actors.isEmpty() ) {</span>
<span class="fc" id="L124">            sb.append(&quot;  actor port {\n&quot;);</span>
<span class="fc bfc" id="L125" title="All 2 branches covered.">            for ( IActorPort port : this.actors.keySet() ) {</span>
<span class="fc" id="L126">                sb.append(&quot;    &quot;).append(port.toString()).append(&quot;: &quot;);</span>
<span class="fc" id="L127">                Actor actor = this.actors.get(port);</span>
<span class="fc bfc" id="L128" title="All 2 branches covered.">                if ( actor.getName() == ActorType.LARGE ) {</span>
<span class="fc" id="L129">                    sb.append(&quot;large&quot;);</span>
<span class="pc bpc" id="L130" title="1 of 2 branches missed.">                } else if ( actor.getName() == ActorType.MEDIUM ) {</span>
<span class="fc" id="L131">                    sb.append(&quot;middle&quot;);</span>
                } else {
<span class="nc" id="L133">                    throw new RuntimeException(&quot;Key.E3&quot;);</span>
                }
<span class="fc" id="L135">                sb.append(&quot; motor, &quot;);</span>
<span class="pc bpc" id="L136" title="1 of 2 branches missed.">                if ( actor.isRegulated() ) {</span>
<span class="fc" id="L137">                    sb.append(&quot;regulated&quot;);</span>
                } else {
<span class="nc" id="L139">                    sb.append(&quot;unregulated&quot;);</span>
                }
<span class="fc" id="L141">                sb.append(&quot;, &quot;);</span>
<span class="fc" id="L142">                String rotationDirection = actor.getRotationDirection().toString().toLowerCase();</span>
<span class="pc bpc" id="L143" title="1 of 2 branches missed.">                sb.append(rotationDirection.equals(&quot;foreward&quot;) ? &quot;forward&quot; : rotationDirection); // TODO: remove this hack; rename FOIREWARD tp FORWARD (be careful!)</span>
<span class="fc" id="L144">                MotorSide motorSide = (MotorSide) actor.getMotorSide();</span>
<span class="fc bfc" id="L145" title="All 2 branches covered.">                if ( motorSide != MotorSide.NONE ) {</span>
<span class="fc" id="L146">                    sb.append(&quot;, &quot;).append(motorSide.getText());</span>

                }
<span class="fc" id="L149">                sb.append(&quot;;\n&quot;);</span>
<span class="fc" id="L150">            }</span>
<span class="fc" id="L151">            sb.append(&quot;  }\n&quot;);</span>
        }
<span class="fc" id="L153">    }</span>

    /**
     * This class is a builder of {@link Configuration}
     */
<span class="fc" id="L158">    public static class Builder extends Configuration.Builder&lt;Builder&gt; {</span>
<span class="fc" id="L159">        private final Map&lt;IActorPort, Actor&gt; actorMapping = new TreeMap&lt;&gt;();</span>
<span class="fc" id="L160">        private final Map&lt;ISensorPort, Sensor&gt; sensorMapping = new TreeMap&lt;&gt;();</span>

        private double wheelDiameter;
        private double trackWidth;

        /**
         * Add actor to the {@link Configuration}
         *
         * @param port on which the component is connected
         * @param actor we want to connect
         * @return
         */
        @Override
        public Builder addActor(IActorPort port, Actor actor) {
<span class="fc" id="L174">            this.actorMapping.put(port, actor);</span>
<span class="fc" id="L175">            return this;</span>
        }

        /**
         * Client must provide list of {@link Pair} ({@link ActorPort} and {@link Actor})
         *
         * @param actors we want to connect to the brick configuration
         * @return
         */
        @Override
        public Builder addActors(List&lt;Pair&lt;IActorPort, Actor&gt;&gt; actors) {
<span class="fc bfc" id="L186" title="All 2 branches covered.">            for ( Pair&lt;IActorPort, Actor&gt; pair : actors ) {</span>
<span class="fc" id="L187">                this.actorMapping.put(pair.getFirst(), pair.getSecond());</span>
<span class="fc" id="L188">            }</span>
<span class="fc" id="L189">            return this;</span>
        }

        /**
         * Add sensor to the {@link Configuration}
         *
         * @param port on which the component is connected
         * @param component we want to connect
         * @return
         */

        @Override
        public Builder addSensor(ISensorPort port, Sensor sensor) {
<span class="fc" id="L202">            this.sensorMapping.put(port, sensor);</span>
<span class="fc" id="L203">            return this;</span>
        }

        /**
         * Client must provide list of {@link Pair} ({@link SensorPort} and {@link Sensor})
         *
         * @param sensors we want to connect to the brick configuration
         * @return
         */
        @Override
        public Builder addSensors(List&lt;Pair&lt;ISensorPort, Sensor&gt;&gt; sensors) {
<span class="fc bfc" id="L214" title="All 2 branches covered.">            for ( Pair&lt;ISensorPort, Sensor&gt; pair : sensors ) {</span>
<span class="fc" id="L215">                this.sensorMapping.put(pair.getFirst(), pair.getSecond());</span>
<span class="fc" id="L216">            }</span>
<span class="fc" id="L217">            return this;</span>
        }

        /**
         * Set the wheel diameter
         *
         * @param wheelDiameter in cm
         * @return
         */
        @Override
        public Builder setWheelDiameter(double wheelDiameter) {
<span class="fc" id="L228">            this.wheelDiameter = wheelDiameter;</span>
<span class="fc" id="L229">            return this;</span>
        }

        /**
         * Set the track width
         *
         * @param trackWidth in cm
         * @return
         */
        @Override
        public Builder setTrackWidth(double trackWidth) {
<span class="fc" id="L240">            this.trackWidth = trackWidth;</span>
<span class="fc" id="L241">            return this;</span>
        }

        @Override
        public Configuration build() {
<span class="fc" id="L246">            return new NxtConfiguration(this.actorMapping, this.sensorMapping, this.wheelDiameter, this.trackWidth);</span>
        }

        @Override
        public String toString() {
<span class="nc" id="L251">            return &quot;Builder [actorMapping=&quot;</span>
                + this.actorMapping
                + &quot;, sensorMapping=&quot;
                + this.sensorMapping
                + &quot;, wheelDiameter=&quot;
                + this.wheelDiameter
                + &quot;, trackWidth=&quot;
                + this.trackWidth
                + &quot;]&quot;;
        }

    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>