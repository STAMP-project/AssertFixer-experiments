alter table PROGRAM add CONFIG_NAME varchar(256) default null before CREATED;
alter table PROGRAM add CONFIG_HASH varchar(256) default null before CREATED;
alter table PROGRAM add AUTHOR_ID INTEGER default 0 not null before ROBOT_ID;
alter table PROGRAM add foreign key(AUTHOR_ID) references USER(ID) on delete cascade;

update PROGRAM set AUTHOR_ID = OWNER_ID;
alter table PROGRAM alter column NUMBER_OF_BLOCKS rename to VIEWED;
drop index PROGNAMEOWNERROBOTIDX;
create unique index PROGNAMEOWNERROBOTIDX on PROGRAM(NAME, OWNER_ID, ROBOT_ID, AUTHOR_ID);

alter table CONFIGURATION add CONFIGURATION_HASH varchar(256) default '' not null before CONFIGURATION_TEXT; 

create table USER_PROGRAM_LIKE (
  ID INTEGER not null generated by default as identity (start with 42),
  USER_ID INTEGER not null,
  PROGRAM_ID INTEGER not null,
  CREATED TIMESTAMP not null,
  MARK VARCHAR(16M),
  COMMENT VARCHAR(16M),
 
  foreign key (USER_ID) references USER(ID) on delete cascade,
  foreign key (PROGRAM_ID) references PROGRAM(ID) on delete cascade
);

create table CONFIGURATION_DATA (
  CONFIGURATION_HASH varchar(255) not null,
  CONFIGURATION_TEXT varchar(16M) not null,
  
  primary key (CONFIGURATION_HASH)
);

commit;