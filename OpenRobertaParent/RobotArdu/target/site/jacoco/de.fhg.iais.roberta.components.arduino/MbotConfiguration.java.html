<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>MbotConfiguration.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">RobotArdu</a> &gt; <a href="index.source.html" class="el_package">de.fhg.iais.roberta.components.arduino</a> &gt; <span class="el_source">MbotConfiguration.java</span></div><h1>MbotConfiguration.java</h1><pre class="source lang-java linenums">package de.fhg.iais.roberta.components.arduino;

import java.util.List;
import java.util.Map;
import java.util.TreeMap;

import de.fhg.iais.roberta.components.Actor;
import de.fhg.iais.roberta.components.ActorType;
import de.fhg.iais.roberta.components.Configuration;
import de.fhg.iais.roberta.components.Sensor;
import de.fhg.iais.roberta.inter.mode.action.IActorPort;
import de.fhg.iais.roberta.inter.mode.sensor.ISensorPort;
import de.fhg.iais.roberta.mode.action.MotorSide;
import de.fhg.iais.roberta.util.Pair;
import de.fhg.iais.roberta.util.dbc.DbcException;

public class MbotConfiguration extends Configuration {

    public MbotConfiguration(Map&lt;IActorPort, Actor&gt; actors, Map&lt;ISensorPort, Sensor&gt; sensors, double wheelDiameterCM, double trackWidthCM) {
<span class="fc" id="L20">        super(actors, sensors, wheelDiameterCM, trackWidthCM);</span>

<span class="fc" id="L22">    }</span>

    /**
     * This method returns the port on which the left motor is connected. If there is no left motor connected throws and {@link DbcException} exception.
     *
     * @return port on which the left motor is connected
     */
    @Override
    public IActorPort getLeftMotorPort() {
<span class="fc" id="L31">        return getMotorPortOnSide(MotorSide.LEFT);</span>
    }

    @Override
    public Actor getLeftMotor() {
<span class="nc" id="L36">        IActorPort port = getLeftMotorPort();</span>
<span class="nc bnc" id="L37" title="All 2 branches missed.">        if ( port != null ) {</span>
<span class="nc" id="L38">            return getActorOnPort(port);</span>
        }
<span class="nc" id="L40">        return null;</span>
    }

    /**
     * This method returns the port on which the right motor is connected. If there is no right motor connected throws and {@link DbcException} exception.
     *
     * @return port on which the left motor is connected
     */
    @Override
    public IActorPort getRightMotorPort() {
<span class="fc" id="L50">        return getMotorPortOnSide(MotorSide.RIGHT);</span>
    }

    @Override
    public Actor getRightMotor() {
<span class="nc" id="L55">        IActorPort port = getRightMotorPort();</span>
<span class="nc bnc" id="L56" title="All 2 branches missed.">        if ( port != null ) {</span>
<span class="nc" id="L57">            return getActorOnPort(port);</span>
        }
<span class="nc" id="L59">        return null;</span>

    }

    @Override
    public int getNumberOfRightMotors() {
<span class="nc" id="L65">        int right = 0;</span>
<span class="nc bnc" id="L66" title="All 2 branches missed.">        for ( Actor actor : this.actors.values() ) {</span>
<span class="nc bnc" id="L67" title="All 2 branches missed.">            if ( actor.getMotorSide() == MotorSide.RIGHT ) {</span>
<span class="nc" id="L68">                right++;</span>
            }
<span class="nc" id="L70">        }</span>
<span class="nc" id="L71">        return right;</span>
    }

    @Override
    public int getNumberOfLeftMotors() {
<span class="nc" id="L76">        int leftMotors = 0;</span>
<span class="nc bnc" id="L77" title="All 2 branches missed.">        for ( Actor actor : this.actors.values() ) {</span>
<span class="nc bnc" id="L78" title="All 2 branches missed.">            if ( actor.getMotorSide() == MotorSide.LEFT ) {</span>
<span class="nc" id="L79">                leftMotors++;</span>
            }
<span class="nc" id="L81">        }</span>
<span class="nc" id="L82">        return leftMotors;</span>
    }

    /**
     * @return text which defines the brick configuration
     */
    @Override
    public String generateText(String name) {
<span class="nc" id="L90">        StringBuilder sb = new StringBuilder();</span>
<span class="nc" id="L91">        sb.append(&quot;robot mbot &quot;).append(name).append(&quot; {\n&quot;);</span>
<span class="nc" id="L92">        generateSensors(sb);</span>
<span class="nc" id="L93">        generateActors(sb);</span>
<span class="nc" id="L94">        sb.append(&quot;}&quot;);</span>
<span class="nc" id="L95">        return sb.toString();</span>
    }

    private void generateSensors(StringBuilder sb) {
<span class="nc bnc" id="L99" title="All 2 branches missed.">        if ( !this.sensors.isEmpty() ) {</span>
<span class="nc" id="L100">            sb.append(&quot;  sensor port {\n&quot;);</span>
<span class="nc bnc" id="L101" title="All 2 branches missed.">            for ( ISensorPort port : this.sensors.keySet() ) {</span>
<span class="nc" id="L102">                sb.append(&quot;    &quot;).append(port.getOraName()).append(&quot;: &quot;);</span>
<span class="nc" id="L103">                String sensor = this.sensors.get(port).getType().toString();</span>
<span class="nc" id="L104">                sb.append(sensor.toLowerCase()).append(&quot;;\n&quot;);</span>
<span class="nc" id="L105">            }</span>
<span class="nc" id="L106">            sb.append(&quot;  }\n&quot;);</span>
        }
<span class="nc" id="L108">    }</span>

    private void generateActors(StringBuilder sb) {
<span class="nc bnc" id="L111" title="All 2 branches missed.">        if ( !this.actors.isEmpty() ) {</span>
<span class="nc" id="L112">            sb.append(&quot;  actor port {\n&quot;);</span>
<span class="nc bnc" id="L113" title="All 2 branches missed.">            for ( IActorPort port : this.actors.keySet() ) {</span>
<span class="nc" id="L114">                sb.append(&quot;    &quot;).append(port.toString()).append(&quot;: &quot;);</span>
<span class="nc" id="L115">                Actor actor = this.actors.get(port);</span>
<span class="nc bnc" id="L116" title="All 2 branches missed.">                if ( actor.getName() == ActorType.GEARED_MOTOR ) {</span>
<span class="nc" id="L117">                    sb.append(&quot;geared&quot;);</span>
                }
<span class="nc" id="L119">                sb.append(&quot; motor, &quot;);</span>
<span class="nc bnc" id="L120" title="All 2 branches missed.">                if ( actor.isRegulated() ) {</span>
<span class="nc" id="L121">                    sb.append(&quot;regulated&quot;);</span>
                } else {
<span class="nc" id="L123">                    sb.append(&quot;unregulated&quot;);</span>
                }
<span class="nc" id="L125">                sb.append(&quot;, &quot;);</span>
<span class="nc" id="L126">                String rotationDirection = actor.getRotationDirection().toString().toLowerCase();</span>
<span class="nc bnc" id="L127" title="All 2 branches missed.">                sb.append(rotationDirection.equals(&quot;foreward&quot;) ? &quot;forward&quot; : rotationDirection); // TODO: remove this hack; rename FOIREWARD to FORWARD (be careful!)</span>
<span class="nc" id="L128">                MotorSide motorSide = (MotorSide) actor.getMotorSide();</span>
<span class="nc bnc" id="L129" title="All 2 branches missed.">                if ( motorSide != MotorSide.NONE ) {</span>
<span class="nc" id="L130">                    sb.append(&quot;, &quot;).append(motorSide.getText());</span>

                }
<span class="nc" id="L133">                sb.append(&quot;;\n&quot;);</span>
<span class="nc" id="L134">            }</span>
<span class="nc" id="L135">            sb.append(&quot;  }\n&quot;);</span>
        }
<span class="nc" id="L137">    }</span>

    /**
     * This class is a builder of {@link Configuration}
     */
<span class="fc" id="L142">    public static class Builder extends Configuration.Builder&lt;Builder&gt; {</span>
<span class="fc" id="L143">        private final Map&lt;IActorPort, Actor&gt; actorMapping = new TreeMap&lt;&gt;();</span>
<span class="fc" id="L144">        private final Map&lt;ISensorPort, Sensor&gt; sensorMapping = new TreeMap&lt;&gt;();</span>

        private double wheelDiameter;
        private double trackWidth;

        /**
         * Add actor to the {@link Configuration}
         *
         * @param port on which the component is connected
         * @param actor we want to connect
         * @return
         */
        @Override
        public Builder addActor(IActorPort port, Actor actor) {
<span class="fc" id="L158">            this.actorMapping.put(port, actor);</span>
<span class="fc" id="L159">            return this;</span>
        }

        /**
         * Client must provide list of {@link Pair} ({@link ActorPort} and {@link Actor})
         *
         * @param actors we want to connect to the brick configuration
         * @return
         */
        @Override
        public Builder addActors(List&lt;Pair&lt;IActorPort, Actor&gt;&gt; actors) {
<span class="nc bnc" id="L170" title="All 2 branches missed.">            for ( Pair&lt;IActorPort, Actor&gt; pair : actors ) {</span>
<span class="nc" id="L171">                this.actorMapping.put(pair.getFirst(), pair.getSecond());</span>
<span class="nc" id="L172">            }</span>
<span class="nc" id="L173">            return this;</span>
        }

        /**
         * Add sensor to the {@link Configuration}
         *
         * @param port on which the component is connected
         * @param component we want to connect
         * @return
         */

        @Override
        public Builder addSensor(ISensorPort port, Sensor sensor) {
<span class="nc" id="L186">            this.sensorMapping.put(port, sensor);</span>
<span class="nc" id="L187">            return this;</span>
        }

        /**
         * Client must provide list of {@link Pair} ({@link SensorPort} and {@link Sensor})
         *
         * @param sensors we want to connect to the brick configuration
         * @return
         */
        @Override
        public Builder addSensors(List&lt;Pair&lt;ISensorPort, Sensor&gt;&gt; sensors) {
<span class="nc bnc" id="L198" title="All 2 branches missed.">            for ( Pair&lt;ISensorPort, Sensor&gt; pair : sensors ) {</span>
<span class="nc" id="L199">                this.sensorMapping.put(pair.getFirst(), pair.getSecond());</span>
<span class="nc" id="L200">            }</span>
<span class="nc" id="L201">            return this;</span>
        }

        /**
         * Set the wheel diameter
         *
         * @param wheelDiameter in cm
         * @return
         */
        @Override
        public Builder setWheelDiameter(double wheelDiameter) {
<span class="nc" id="L212">            this.wheelDiameter = wheelDiameter;</span>
<span class="nc" id="L213">            return this;</span>
        }

        /**
         * Set the track width
         *
         * @param trackWidth in cm
         * @return
         */
        @Override
        public Builder setTrackWidth(double trackWidth) {
<span class="nc" id="L224">            this.trackWidth = trackWidth;</span>
<span class="nc" id="L225">            return this;</span>
        }

        @Override
        public Configuration build() {
<span class="fc" id="L230">            return new MbotConfiguration(this.actorMapping, this.sensorMapping, this.wheelDiameter, this.trackWidth);</span>
        }

        @Override
        public String toString() {
<span class="nc" id="L235">            return &quot;Builder [actorMapping=&quot;</span>
                + this.actorMapping
                + &quot;, sensorMapping=&quot;
                + this.sensorMapping
                + &quot;, wheelDiameter=&quot;
                + this.wheelDiameter
                + &quot;, trackWidth=&quot;
                + this.trackWidth
                + &quot;]&quot;;
        }

    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>