<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>BotNrollConfiguration.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">RobotArdu</a> &gt; <a href="index.source.html" class="el_package">de.fhg.iais.roberta.components.arduino</a> &gt; <span class="el_source">BotNrollConfiguration.java</span></div><h1>BotNrollConfiguration.java</h1><pre class="source lang-java linenums">package de.fhg.iais.roberta.components.arduino;

import java.util.List;
import java.util.Map;
import java.util.TreeMap;

import de.fhg.iais.roberta.components.Actor;
import de.fhg.iais.roberta.components.ActorType;
import de.fhg.iais.roberta.components.Configuration;
import de.fhg.iais.roberta.components.Sensor;
import de.fhg.iais.roberta.inter.mode.action.IActorPort;
import de.fhg.iais.roberta.inter.mode.sensor.ISensorPort;
import de.fhg.iais.roberta.mode.action.ActorPort;
import de.fhg.iais.roberta.mode.action.MotorSide;
import de.fhg.iais.roberta.mode.sensor.SensorPort;
import de.fhg.iais.roberta.util.Pair;
import de.fhg.iais.roberta.util.dbc.DbcException;

public class BotNrollConfiguration extends Configuration {

    public BotNrollConfiguration(Map&lt;IActorPort, Actor&gt; actors, Map&lt;ISensorPort, Sensor&gt; sensors, double wheelDiameterCM, double trackWidthCM) {
<span class="fc" id="L22">        super(actors, sensors, wheelDiameterCM, trackWidthCM);</span>

<span class="fc" id="L24">    }</span>

    /**
     * This method returns the port on which the left motor is connected. If there is no left motor connected throws and {@link DbcException} exception.
     *
     * @return port on which the left motor is connected
     */
    @Override
    public IActorPort getLeftMotorPort() {
<span class="fc" id="L33">        return getMotorPortOnSide(MotorSide.LEFT);</span>
    }

    @Override
    public Actor getLeftMotor() {
<span class="fc" id="L38">        IActorPort port = getLeftMotorPort();</span>
<span class="pc bpc" id="L39" title="1 of 2 branches missed.">        if ( port != null ) {</span>
<span class="fc" id="L40">            return getActorOnPort(port);</span>
        }
<span class="nc" id="L42">        return null;</span>
    }

    /**
     * This method returns the port on which the right motor is connected. If there is no right motor connected throws and {@link DbcException} exception.
     *
     * @return port on which the left motor is connected
     */
    @Override
    public IActorPort getRightMotorPort() {
<span class="fc" id="L52">        return getMotorPortOnSide(MotorSide.RIGHT);</span>
    }

    @Override
    public Actor getRightMotor() {
<span class="fc" id="L57">        IActorPort port = getRightMotorPort();</span>
<span class="pc bpc" id="L58" title="1 of 2 branches missed.">        if ( port != null ) {</span>
<span class="fc" id="L59">            return getActorOnPort(port);</span>
        }
<span class="nc" id="L61">        return null;</span>

    }

    @Override
    public int getNumberOfRightMotors() {
<span class="nc" id="L67">        int right = 0;</span>
<span class="nc bnc" id="L68" title="All 2 branches missed.">        for ( Actor actor : this.actors.values() ) {</span>
<span class="nc bnc" id="L69" title="All 2 branches missed.">            if ( actor.getMotorSide() == MotorSide.RIGHT ) {</span>
<span class="nc" id="L70">                right++;</span>
            }
<span class="nc" id="L72">        }</span>
<span class="nc" id="L73">        return right;</span>
    }

    @Override
    public int getNumberOfLeftMotors() {
<span class="nc" id="L78">        int leftMotors = 0;</span>
<span class="nc bnc" id="L79" title="All 2 branches missed.">        for ( Actor actor : this.actors.values() ) {</span>
<span class="nc bnc" id="L80" title="All 2 branches missed.">            if ( actor.getMotorSide() == MotorSide.LEFT ) {</span>
<span class="nc" id="L81">                leftMotors++;</span>
            }
<span class="nc" id="L83">        }</span>
<span class="nc" id="L84">        return leftMotors;</span>
    }

    /**
     * @return text which defines the brick configuration
     */
    @Override
    public String generateText(String name) {
<span class="fc" id="L92">        StringBuilder sb = new StringBuilder();</span>
<span class="fc" id="L93">        sb.append(&quot;robot ardu &quot;).append(name).append(&quot; {\n&quot;);</span>
<span class="fc" id="L94">        generateSensors(sb);</span>
<span class="fc" id="L95">        generateActors(sb);</span>
<span class="fc" id="L96">        sb.append(&quot;}&quot;);</span>
<span class="fc" id="L97">        return sb.toString();</span>
    }

    private void generateSensors(StringBuilder sb) {
<span class="pc bpc" id="L101" title="1 of 2 branches missed.">        if ( !this.sensors.isEmpty() ) {</span>
<span class="fc" id="L102">            sb.append(&quot;  sensor port {\n&quot;);</span>
<span class="fc bfc" id="L103" title="All 2 branches covered.">            for ( ISensorPort port : this.sensors.keySet() ) {</span>
<span class="fc" id="L104">                sb.append(&quot;    &quot;).append(port.getOraName()).append(&quot;: &quot;);</span>
<span class="fc" id="L105">                String sensor = this.sensors.get(port).getType().toString();</span>
<span class="fc" id="L106">                sb.append(sensor.toLowerCase()).append(&quot;;\n&quot;);</span>
<span class="fc" id="L107">            }</span>
<span class="fc" id="L108">            sb.append(&quot;  }\n&quot;);</span>
        }
<span class="fc" id="L110">    }</span>

    private void generateActors(StringBuilder sb) {
<span class="pc bpc" id="L113" title="1 of 2 branches missed.">        if ( !this.actors.isEmpty() ) {</span>
<span class="fc" id="L114">            sb.append(&quot;  actor port {\n&quot;);</span>
<span class="fc bfc" id="L115" title="All 2 branches covered.">            for ( IActorPort port : this.actors.keySet() ) {</span>
<span class="fc" id="L116">                sb.append(&quot;    &quot;).append(port.toString()).append(&quot;: &quot;);</span>
<span class="fc" id="L117">                Actor actor = this.actors.get(port);</span>
<span class="pc bpc" id="L118" title="1 of 2 branches missed.">                if ( actor.getName() == ActorType.LARGE ) {</span>
<span class="nc" id="L119">                    sb.append(&quot;large&quot;);</span>
<span class="pc bpc" id="L120" title="1 of 2 branches missed.">                } else if ( actor.getName() == ActorType.MEDIUM ) {</span>
<span class="nc" id="L121">                    sb.append(&quot;middle&quot;);</span>
<span class="pc bpc" id="L122" title="1 of 2 branches missed.">                } else if ( actor.getName() == ActorType.ARDU ) {</span>
<span class="fc" id="L123">                    sb.append(&quot;ardu&quot;);</span>
                } else {
<span class="nc" id="L125">                    throw new RuntimeException(&quot;Key.E3&quot;);</span>
                }
<span class="fc" id="L127">                sb.append(&quot; motor, &quot;);</span>
<span class="pc bpc" id="L128" title="1 of 2 branches missed.">                if ( actor.isRegulated() ) {</span>
<span class="fc" id="L129">                    sb.append(&quot;regulated&quot;);</span>
                } else {
<span class="nc" id="L131">                    sb.append(&quot;unregulated&quot;);</span>
                }
<span class="fc" id="L133">                sb.append(&quot;, &quot;);</span>
<span class="fc" id="L134">                String rotationDirection = actor.getRotationDirection().toString().toLowerCase();</span>
<span class="pc bpc" id="L135" title="1 of 2 branches missed.">                sb.append(rotationDirection.equals(&quot;foreward&quot;) ? &quot;forward&quot; : rotationDirection); // TODO: remove this hack; rename FOIREWARD tp FORWARD (be careful!)</span>
<span class="fc" id="L136">                MotorSide motorSide = (MotorSide) actor.getMotorSide();</span>
<span class="pc bpc" id="L137" title="1 of 2 branches missed.">                if ( motorSide != MotorSide.NONE ) {</span>
<span class="nc" id="L138">                    sb.append(&quot;, &quot;).append(motorSide.getText());</span>

                }
<span class="fc" id="L141">                sb.append(&quot;;\n&quot;);</span>
<span class="fc" id="L142">            }</span>
<span class="fc" id="L143">            sb.append(&quot;  }\n&quot;);</span>
        }
<span class="fc" id="L145">    }</span>

    /**
     * This class is a builder of {@link Configuration}
     */
<span class="fc" id="L150">    public static class Builder extends Configuration.Builder&lt;Builder&gt; {</span>
<span class="fc" id="L151">        private final Map&lt;IActorPort, Actor&gt; actorMapping = new TreeMap&lt;&gt;();</span>
<span class="fc" id="L152">        private final Map&lt;ISensorPort, Sensor&gt; sensorMapping = new TreeMap&lt;&gt;();</span>

        private double wheelDiameter;
        private double trackWidth;

        /**
         * Add actor to the {@link Configuration}
         *
         * @param port on which the component is connected
         * @param actor we want to connect
         * @return
         */
        @Override
        public Builder addActor(IActorPort port, Actor actor) {
<span class="fc" id="L166">            this.actorMapping.put(port, actor);</span>
<span class="fc" id="L167">            return this;</span>
        }

        /**
         * Client must provide list of {@link Pair} ({@link ActorPort} and {@link Actor})
         *
         * @param actors we want to connect to the brick configuration
         * @return
         */
        @Override
        public Builder addActors(List&lt;Pair&lt;IActorPort, Actor&gt;&gt; actors) {
<span class="fc bfc" id="L178" title="All 2 branches covered.">            for ( Pair&lt;IActorPort, Actor&gt; pair : actors ) {</span>
<span class="fc" id="L179">                this.actorMapping.put(pair.getFirst(), pair.getSecond());</span>
<span class="fc" id="L180">            }</span>
<span class="fc" id="L181">            return this;</span>
        }

        /**
         * Add sensor to the {@link Configuration}
         *
         * @param port on which the component is connected
         * @param component we want to connect
         * @return
         */

        @Override
        public Builder addSensor(ISensorPort port, Sensor sensor) {
<span class="nc" id="L194">            this.sensorMapping.put(port, sensor);</span>
<span class="nc" id="L195">            return this;</span>
        }

        /**
         * Client must provide list of {@link Pair} ({@link SensorPort} and {@link Sensor})
         *
         * @param sensors we want to connect to the brick configuration
         * @return
         */
        @Override
        public Builder addSensors(List&lt;Pair&lt;ISensorPort, Sensor&gt;&gt; sensors) {
<span class="fc bfc" id="L206" title="All 2 branches covered.">            for ( Pair&lt;ISensorPort, Sensor&gt; pair : sensors ) {</span>
<span class="fc" id="L207">                this.sensorMapping.put(pair.getFirst(), pair.getSecond());</span>
<span class="fc" id="L208">            }</span>
<span class="fc" id="L209">            return this;</span>
        }

        /**
         * Set the wheel diameter
         *
         * @param wheelDiameter in cm
         * @return
         */
        @Override
        public Builder setWheelDiameter(double wheelDiameter) {
<span class="nc" id="L220">            this.wheelDiameter = wheelDiameter;</span>
<span class="nc" id="L221">            return this;</span>
        }

        /**
         * Set the track width
         *
         * @param trackWidth in cm
         * @return
         */
        @Override
        public Builder setTrackWidth(double trackWidth) {
<span class="nc" id="L232">            this.trackWidth = trackWidth;</span>
<span class="nc" id="L233">            return this;</span>
        }

        @Override
        public Configuration build() {
<span class="fc" id="L238">            return new BotNrollConfiguration(this.actorMapping, this.sensorMapping, this.wheelDiameter, this.trackWidth);</span>
        }

        @Override
        public String toString() {
<span class="nc" id="L243">            return &quot;Builder [actorMapping=&quot;</span>
                + this.actorMapping
                + &quot;, sensorMapping=&quot;
                + this.sensorMapping
                + &quot;, wheelDiameter=&quot;
                + this.wheelDiameter
                + &quot;, trackWidth=&quot;
                + this.trackWidth
                + &quot;]&quot;;
        }

    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>