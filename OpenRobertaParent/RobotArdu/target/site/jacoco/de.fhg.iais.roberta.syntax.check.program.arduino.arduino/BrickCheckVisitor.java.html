<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>BrickCheckVisitor.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">RobotArdu</a> &gt; <a href="index.source.html" class="el_package">de.fhg.iais.roberta.syntax.check.program.arduino.arduino</a> &gt; <span class="el_source">BrickCheckVisitor.java</span></div><h1>BrickCheckVisitor.java</h1><pre class="source lang-java linenums">package de.fhg.iais.roberta.syntax.check.program.arduino.arduino;

import de.fhg.iais.roberta.components.ActorType;
import de.fhg.iais.roberta.components.Configuration;
import de.fhg.iais.roberta.components.ConfigurationBlock;
import de.fhg.iais.roberta.components.SensorType;
import de.fhg.iais.roberta.components.arduino.ArduinoConfiguration;
import de.fhg.iais.roberta.syntax.action.control.RelayAction;
import de.fhg.iais.roberta.syntax.action.display.ClearDisplayAction;
import de.fhg.iais.roberta.syntax.action.display.ShowTextAction;
import de.fhg.iais.roberta.syntax.action.light.LightAction;
import de.fhg.iais.roberta.syntax.action.light.LightStatusAction;
import de.fhg.iais.roberta.syntax.action.motor.MotorOnAction;
import de.fhg.iais.roberta.syntax.action.sound.PlayNoteAction;
import de.fhg.iais.roberta.syntax.action.sound.ToneAction;
import de.fhg.iais.roberta.syntax.actors.arduino.PinWriteValueAction;
import de.fhg.iais.roberta.syntax.actors.arduino.SerialWriteAction;
import de.fhg.iais.roberta.syntax.actors.arduino.mbot.ExternalLedOffAction;
import de.fhg.iais.roberta.syntax.actors.arduino.mbot.ExternalLedOnAction;
import de.fhg.iais.roberta.syntax.actors.arduino.mbot.LedOffAction;
import de.fhg.iais.roberta.syntax.actors.arduino.mbot.LedOnAction;
import de.fhg.iais.roberta.syntax.check.program.RobotBrickCheckVisitor;
import de.fhg.iais.roberta.syntax.sensor.ExternalSensor;
import de.fhg.iais.roberta.syntax.sensor.generic.BrickSensor;
import de.fhg.iais.roberta.syntax.sensor.generic.DropSensor;
import de.fhg.iais.roberta.syntax.sensor.generic.EncoderSensor;
import de.fhg.iais.roberta.syntax.sensor.generic.HumiditySensor;
import de.fhg.iais.roberta.syntax.sensor.generic.InfraredSensor;
import de.fhg.iais.roberta.syntax.sensor.generic.MoistureSensor;
import de.fhg.iais.roberta.syntax.sensor.generic.MotionSensor;
import de.fhg.iais.roberta.syntax.sensor.generic.PinGetValueSensor;
import de.fhg.iais.roberta.syntax.sensor.generic.PulseSensor;
import de.fhg.iais.roberta.syntax.sensor.generic.RfidSensor;
import de.fhg.iais.roberta.syntax.sensor.generic.TemperatureSensor;
import de.fhg.iais.roberta.syntax.sensor.generic.VoltageSensor;
import de.fhg.iais.roberta.typecheck.NepoInfo;
import de.fhg.iais.roberta.visitors.arduino.ArduinoAstVisitor;

public class BrickCheckVisitor extends RobotBrickCheckVisitor implements ArduinoAstVisitor&lt;Void&gt; {

    public BrickCheckVisitor(Configuration brickConfiguration) {
<span class="nc" id="L42">        super(brickConfiguration);</span>
<span class="nc" id="L43">    }</span>

    @Override
    public Void visitInfraredSensor(InfraredSensor&lt;Void&gt; infraredSensor) {
<span class="nc" id="L47">        checkSensorPort(infraredSensor);</span>
<span class="nc" id="L48">        return null;</span>
    }

    @Override
    public Void visitBrickSensor(BrickSensor&lt;Void&gt; brickSensor) {
<span class="nc" id="L53">        checkSensorPort(brickSensor);</span>
<span class="nc" id="L54">        return null;</span>
    }

    @Override
    public Void visitMoistureSensor(MoistureSensor&lt;Void&gt; moistureSensor) {
<span class="nc" id="L59">        checkSensorPort(moistureSensor);</span>
<span class="nc" id="L60">        return null;</span>
    }

    @Override
    public Void visitMotionSensor(MotionSensor&lt;Void&gt; motionSensor) {
<span class="nc" id="L65">        checkSensorPort(motionSensor);</span>
<span class="nc" id="L66">        return null;</span>
    }

    @Override
    public Void visitPulseSensor(PulseSensor&lt;Void&gt; pulseSensor) {
<span class="nc" id="L71">        checkSensorPort(pulseSensor);</span>
<span class="nc" id="L72">        return null;</span>
    }

    @Override
    public Void visitRfidSensor(RfidSensor&lt;Void&gt; rfidSensor) {
<span class="nc" id="L77">        checkSensorPort(rfidSensor);</span>
<span class="nc" id="L78">        return null;</span>
    }

    @Override
    public Void visitHumiditySensor(HumiditySensor&lt;Void&gt; humiditySensor) {
<span class="nc" id="L83">        checkSensorPort(humiditySensor);</span>
<span class="nc" id="L84">        return null;</span>
    }

    @Override
    public Void visitDropSensor(DropSensor&lt;Void&gt; dropSensor) {
<span class="nc" id="L89">        checkSensorPort(dropSensor);</span>
<span class="nc" id="L90">        return null;</span>
    }

    @Override
    public Void visitVoltageSensor(VoltageSensor&lt;Void&gt; voltageSensor) {
<span class="nc" id="L95">        checkSensorPort(voltageSensor);</span>
<span class="nc" id="L96">        return null;</span>
    }

    @Override
    public Void visitTemperatureSensor(TemperatureSensor&lt;Void&gt; temperatureSensor) {
<span class="nc" id="L101">        checkSensorPort(temperatureSensor);</span>
<span class="nc" id="L102">        return null;</span>
    }

    @Override
    public Void visitEncoderSensor(EncoderSensor&lt;Void&gt; encoderSensor) {
<span class="nc" id="L107">        checkSensorPort(encoderSensor);</span>
<span class="nc" id="L108">        return null;</span>
    }

    @Override
    protected void checkSensorPort(ExternalSensor&lt;Void&gt; sensor) {
<span class="nc" id="L113">        ConfigurationBlock usedConfigurationBlock = ((ArduinoConfiguration) this.brickConfiguration).getConfigurationBlockOnPort(sensor.getPort().toString());</span>
<span class="nc bnc" id="L114" title="All 2 branches missed.">        if ( usedConfigurationBlock == null ) {</span>
<span class="nc" id="L115">            sensor.addInfo(NepoInfo.error(&quot;CONFIGURATION_ERROR_SENSOR_MISSING&quot;));</span>
<span class="nc" id="L116">            this.errorCount++;</span>
        } else {
<span class="nc bnc" id="L118" title="All 10 branches missed.">            switch ( usedConfigurationBlock.getType().toString() ) {</span>
                case &quot;INFRARED_SENSING&quot;:
<span class="nc bnc" id="L120" title="All 2 branches missed.">                    if ( !usedConfigurationBlock.getType().equals(SensorType.INFRARED) ) {</span>
<span class="nc" id="L121">                        sensor.addInfo(NepoInfo.error(&quot;CONFIGURATION_ERROR_SENSOR_WRONG&quot;));</span>
<span class="nc" id="L122">                        this.errorCount++;</span>
                    }
                    break;
                case &quot;GYRO_SENSING&quot;:
<span class="nc bnc" id="L126" title="All 2 branches missed.">                    if ( !usedConfigurationBlock.getType().equals(SensorType.GYRO) ) {</span>
<span class="nc" id="L127">                        sensor.addInfo(NepoInfo.error(&quot;CONFIGURATION_ERROR_SENSOR_WRONG&quot;));</span>
<span class="nc" id="L128">                        this.errorCount++;</span>
                    }
                    break;
                default:
                    break;
            }
        }
<span class="nc" id="L135">    }</span>

    @Override
    public Void visitMotorOnAction(MotorOnAction&lt;Void&gt; motorOnAction) {
<span class="nc bnc" id="L139" title="All 2 branches missed.">        if ( motorOnAction.getInfos().getErrorCount() == 0 ) {</span>
<span class="nc" id="L140">            ConfigurationBlock usedConfigurationBlock =</span>
<span class="nc" id="L141">                ((ArduinoConfiguration) this.brickConfiguration).getConfigurationBlockOnPort(motorOnAction.getPort().toString());</span>
<span class="nc bnc" id="L142" title="All 2 branches missed.">            boolean duration = motorOnAction.getParam().getDuration() != null;</span>
<span class="nc bnc" id="L143" title="All 2 branches missed.">            if ( usedConfigurationBlock == null ) {</span>
<span class="nc" id="L144">                motorOnAction.addInfo(NepoInfo.error(&quot;CONFIGURATION_ERROR_ACTOR_MISSING&quot;));</span>
<span class="nc" id="L145">                this.errorCount++;</span>
<span class="nc bnc" id="L146" title="All 4 branches missed.">            } else if ( usedConfigurationBlock.getType().equals(ActorType.OTHER) &amp;&amp; duration ) {</span>
<span class="nc" id="L147">                motorOnAction.addInfo(NepoInfo.error(&quot;CONFIGURATION_ERROR_OTHER_NOT_SUPPORTED&quot;));</span>
            }
        }
<span class="nc" id="L150">        return null;</span>
    }

    @Override
    public Void visitLightAction(LightAction&lt;Void&gt; lightAction) {
<span class="nc bnc" id="L155" title="All 2 branches missed.">        if ( lightAction.getInfos().getErrorCount() == 0 ) {</span>
<span class="nc" id="L156">            ConfigurationBlock usedConfigurationBlock =</span>
<span class="nc" id="L157">                ((ArduinoConfiguration) this.brickConfiguration).getConfigurationBlockOnPort(lightAction.getPort().toString());</span>
<span class="nc bnc" id="L158" title="All 2 branches missed.">            if ( usedConfigurationBlock == null ) {</span>
<span class="nc" id="L159">                lightAction.addInfo(NepoInfo.error(&quot;CONFIGURATION_ERROR_ACTOR_MISSING&quot;));</span>
<span class="nc" id="L160">                this.errorCount++;</span>
            }
        }
<span class="nc" id="L163">        return null;</span>
    }

    @Override
    public Void visitPlayNoteAction(PlayNoteAction&lt;Void&gt; playNoteAction) {
<span class="nc bnc" id="L168" title="All 2 branches missed.">        if ( playNoteAction.getInfos().getErrorCount() == 0 ) {</span>
<span class="nc" id="L169">            ConfigurationBlock usedConfigurationBlock =</span>
<span class="nc" id="L170">                ((ArduinoConfiguration) this.brickConfiguration).getConfigurationBlockOnPort(playNoteAction.getPort().toString());</span>
<span class="nc bnc" id="L171" title="All 2 branches missed.">            if ( usedConfigurationBlock == null ) {</span>
<span class="nc" id="L172">                playNoteAction.addInfo(NepoInfo.error(&quot;CONFIGURATION_ERROR_ACTOR_MISSING&quot;));</span>
<span class="nc" id="L173">                this.errorCount++;</span>
            }
        }
<span class="nc" id="L176">        return null;</span>
    }

    @Override
    public Void visitLightStatusAction(LightStatusAction&lt;Void&gt; lightStatusAction) {
<span class="nc bnc" id="L181" title="All 2 branches missed.">        if ( lightStatusAction.getInfos().getErrorCount() == 0 ) {</span>
<span class="nc" id="L182">            ConfigurationBlock usedConfigurationBlock =</span>
<span class="nc" id="L183">                ((ArduinoConfiguration) this.brickConfiguration).getConfigurationBlockOnPort(lightStatusAction.getPort().toString());</span>
<span class="nc bnc" id="L184" title="All 2 branches missed.">            if ( usedConfigurationBlock == null ) {</span>
<span class="nc" id="L185">                lightStatusAction.addInfo(NepoInfo.error(&quot;CONFIGURATION_ERROR_ACTOR_MISSING&quot;));</span>
<span class="nc" id="L186">                this.errorCount++;</span>
            }
        }
<span class="nc" id="L189">        return null;</span>
    }

    @Override
    public Void visitToneAction(ToneAction&lt;Void&gt; toneAction) {
<span class="nc bnc" id="L194" title="All 2 branches missed.">        if ( toneAction.getInfos().getErrorCount() == 0 ) {</span>
<span class="nc" id="L195">            ConfigurationBlock usedConfigurationBlock =</span>
<span class="nc" id="L196">                ((ArduinoConfiguration) this.brickConfiguration).getConfigurationBlockOnPort(toneAction.getPort().toString());</span>
<span class="nc bnc" id="L197" title="All 2 branches missed.">            if ( usedConfigurationBlock == null ) {</span>
<span class="nc" id="L198">                toneAction.addInfo(NepoInfo.error(&quot;CONFIGURATION_ERROR_ACTOR_MISSING&quot;));</span>
<span class="nc" id="L199">                this.errorCount++;</span>
            }
        }
<span class="nc" id="L202">        return null;</span>
    }

    @Override
    public Void visitRelayAction(RelayAction&lt;Void&gt; relayAction) {
<span class="nc bnc" id="L207" title="All 2 branches missed.">        if ( relayAction.getInfos().getErrorCount() == 0 ) {</span>
<span class="nc" id="L208">            ConfigurationBlock usedConfigurationBlock =</span>
<span class="nc" id="L209">                ((ArduinoConfiguration) this.brickConfiguration).getConfigurationBlockOnPort(relayAction.getPort().toString());</span>
<span class="nc bnc" id="L210" title="All 2 branches missed.">            if ( usedConfigurationBlock == null ) {</span>
<span class="nc" id="L211">                relayAction.addInfo(NepoInfo.error(&quot;CONFIGURATION_ERROR_ACTOR_MISSING&quot;));</span>
<span class="nc" id="L212">                this.errorCount++;</span>
            }
        }
<span class="nc" id="L215">        return null;</span>
    }

    @Override
    public Void visitShowTextAction(ShowTextAction&lt;Void&gt; showtextAction) {
<span class="nc bnc" id="L220" title="All 2 branches missed.">        if ( showtextAction.getInfos().getErrorCount() == 0 ) {</span>
<span class="nc" id="L221">            ConfigurationBlock usedConfigurationBlock =</span>
<span class="nc" id="L222">                ((ArduinoConfiguration) this.brickConfiguration).getConfigurationBlockOnPort(showtextAction.getPort().toString());</span>
<span class="nc bnc" id="L223" title="All 2 branches missed.">            if ( usedConfigurationBlock == null ) {</span>
<span class="nc" id="L224">                showtextAction.addInfo(NepoInfo.error(&quot;CONFIGURATION_ERROR_ACTOR_MISSING&quot;));</span>
<span class="nc" id="L225">                this.errorCount++;</span>
            }
        }
<span class="nc" id="L228">        return null;</span>
    }

    @Override
    public Void visitClearDisplayAction(ClearDisplayAction&lt;Void&gt; clearDisplayAction) {
<span class="nc bnc" id="L233" title="All 2 branches missed.">        if ( clearDisplayAction.getInfos().getErrorCount() == 0 ) {</span>
<span class="nc" id="L234">            ConfigurationBlock usedConfigurationBlock =</span>
<span class="nc" id="L235">                ((ArduinoConfiguration) this.brickConfiguration).getConfigurationBlockOnPort(clearDisplayAction.getPort().toString());</span>
<span class="nc bnc" id="L236" title="All 2 branches missed.">            if ( usedConfigurationBlock == null ) {</span>
<span class="nc" id="L237">                clearDisplayAction.addInfo(NepoInfo.error(&quot;CONFIGURATION_ERROR_ACTOR_MISSING&quot;));</span>
<span class="nc" id="L238">                this.errorCount++;</span>
            }
        }
<span class="nc" id="L241">        return null;</span>
    }

    @Override
    public Void visitLedOnAction(LedOnAction&lt;Void&gt; ledOnAction) {
<span class="nc" id="L246">        return null;</span>
    }

    @Override
    public Void visitLedOffAction(LedOffAction&lt;Void&gt; ledOffAction) {
<span class="nc" id="L251">        return null;</span>
    }

    @Override
    public Void visitExternalLedOnAction(ExternalLedOnAction&lt;Void&gt; externalLedOnAction) {
<span class="nc" id="L256">        return null;</span>
    }

    @Override
    public Void visitExternalLedOffAction(ExternalLedOffAction&lt;Void&gt; externalLedOffAction) {
<span class="nc" id="L261">        return null;</span>
    }

    @Override
    public Void visitPinGetValueSensor(PinGetValueSensor&lt;Void&gt; pinGetValueSensor) {
<span class="nc" id="L266">        return null;</span>
    }

    @Override
    public Void visitPinWriteValueAction(PinWriteValueAction&lt;Void&gt; pinWriteValueSensor) {
<span class="nc" id="L271">        return null;</span>
    }

    @Override
    public Void visitSerialWriteAction(SerialWriteAction&lt;Void&gt; serialWriteAction) {
<span class="nc" id="L276">        return null;</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>