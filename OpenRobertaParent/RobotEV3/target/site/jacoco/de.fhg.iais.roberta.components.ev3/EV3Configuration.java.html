<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>EV3Configuration.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">RobotEV3</a> &gt; <a href="index.source.html" class="el_package">de.fhg.iais.roberta.components.ev3</a> &gt; <span class="el_source">EV3Configuration.java</span></div><h1>EV3Configuration.java</h1><pre class="source lang-java linenums">package de.fhg.iais.roberta.components.ev3;

import java.util.List;
import java.util.Map;
import java.util.TreeMap;

import de.fhg.iais.roberta.components.Actor;
import de.fhg.iais.roberta.components.ActorType;
import de.fhg.iais.roberta.components.Configuration;
import de.fhg.iais.roberta.components.Sensor;
import de.fhg.iais.roberta.inter.mode.action.IActorPort;
import de.fhg.iais.roberta.inter.mode.sensor.ISensorPort;
import de.fhg.iais.roberta.mode.action.ActorPort;
import de.fhg.iais.roberta.mode.action.MotorSide;
import de.fhg.iais.roberta.mode.sensor.ev3.SensorPort;
import de.fhg.iais.roberta.util.Formatter;
import de.fhg.iais.roberta.util.Pair;
import de.fhg.iais.roberta.util.dbc.DbcException;

public class EV3Configuration extends Configuration {

    public EV3Configuration(Map&lt;IActorPort, Actor&gt; actors, Map&lt;ISensorPort, Sensor&gt; sensors, double wheelDiameterCM, double trackWidthCM) {
<span class="fc" id="L23">        super(actors, sensors, wheelDiameterCM, trackWidthCM);</span>
<span class="fc" id="L24">    }</span>

    /**
     * This method returns the port on which the left motor is connected. If there is no left motor connected throws and {@link DbcException} exception.
     *
     * @return port on which the left motor is connected
     */
    @Override
    public IActorPort getLeftMotorPort() {
<span class="fc" id="L33">        return getMotorPortOnSide(MotorSide.LEFT);</span>
    }

    @Override
    public Actor getLeftMotor() {
<span class="fc" id="L38">        IActorPort port = getLeftMotorPort();</span>
<span class="pc bpc" id="L39" title="1 of 2 branches missed.">        if ( port != null ) {</span>
<span class="fc" id="L40">            return getActorOnPort(port);</span>
        }
<span class="nc" id="L42">        return null;</span>
    }

    @Override
    public int getNumberOfLeftMotors() {
<span class="fc" id="L47">        int leftMotors = 0;</span>
<span class="fc bfc" id="L48" title="All 2 branches covered.">        for ( Actor actor : this.actors.values() ) {</span>
<span class="fc bfc" id="L49" title="All 2 branches covered.">            if ( actor.getMotorSide() == MotorSide.LEFT ) {</span>
<span class="fc" id="L50">                leftMotors++;</span>
            }
<span class="fc" id="L52">        }</span>
<span class="fc" id="L53">        return leftMotors;</span>
    }

    /**
     * This method returns the port on which the right motor is connected. If there is no right motor connected throws and {@link DbcException} exception.
     *
     * @return port on which the left motor is connected
     */
    @Override
    public IActorPort getRightMotorPort() {
<span class="fc" id="L63">        return getMotorPortOnSide(MotorSide.RIGHT);</span>
    }

    @Override
    public Actor getRightMotor() {
<span class="fc" id="L68">        IActorPort port = getRightMotorPort();</span>
<span class="pc bpc" id="L69" title="1 of 2 branches missed.">        if ( port != null ) {</span>
<span class="fc" id="L70">            return getActorOnPort(port);</span>
        }
<span class="nc" id="L72">        return null;</span>
    }

    @Override
    public int getNumberOfRightMotors() {
<span class="fc" id="L77">        int right = 0;</span>
<span class="fc bfc" id="L78" title="All 2 branches covered.">        for ( Actor actor : this.actors.values() ) {</span>
<span class="fc bfc" id="L79" title="All 2 branches covered.">            if ( actor.getMotorSide() == MotorSide.RIGHT ) {</span>
<span class="fc" id="L80">                right++;</span>
            }
<span class="fc" id="L82">        }</span>
<span class="fc" id="L83">        return right;</span>
    }

    /**
     * @return text which defines the brick configuration
     */
    @Override
    public String generateText(String name) {
<span class="nc" id="L91">        StringBuilder sb = new StringBuilder();</span>
<span class="nc" id="L92">        sb.append(&quot;robot ev3 &quot;).append(name).append(&quot; {\n&quot;);</span>
<span class="nc bnc" id="L93" title="All 4 branches missed.">        if ( (this.wheelDiameterCM != 0.0) || (this.trackWidthCM != 0.0) ) { //NOSONAR : 0.0 is safe here, as it is used as 'null' value</span>
<span class="nc" id="L94">            sb.append(&quot;  size {\n&quot;);</span>
<span class="nc" id="L95">            sb.append(&quot;    wheel diameter &quot;).append(Formatter.d2s(this.wheelDiameterCM)).append(&quot; cm;\n&quot;);</span>
<span class="nc" id="L96">            sb.append(&quot;    track width    &quot;).append(Formatter.d2s(this.trackWidthCM)).append(&quot; cm;\n&quot;);</span>
<span class="nc" id="L97">            sb.append(&quot;  }\n&quot;);</span>
        }
<span class="nc bnc" id="L99" title="All 2 branches missed.">        if ( !this.sensors.isEmpty() ) {</span>
<span class="nc" id="L100">            sb.append(&quot;  sensor port {\n&quot;);</span>
<span class="nc bnc" id="L101" title="All 2 branches missed.">            for ( ISensorPort port : this.sensors.keySet() ) {</span>
<span class="nc" id="L102">                sb.append(&quot;    &quot;).append(port.getOraName()).append(&quot;: &quot;);</span>
<span class="nc" id="L103">                String sensor = this.sensors.get(port).getType().toString();</span>
<span class="nc" id="L104">                sb.append(sensor.toLowerCase()).append(&quot;;\n&quot;);</span>
<span class="nc" id="L105">            }</span>
<span class="nc" id="L106">            sb.append(&quot;  }\n&quot;);</span>
        }
<span class="nc bnc" id="L108" title="All 2 branches missed.">        if ( !this.actors.isEmpty() ) {</span>
<span class="nc" id="L109">            sb.append(&quot;  actor port {\n&quot;);</span>
<span class="nc bnc" id="L110" title="All 2 branches missed.">            for ( IActorPort port : this.actors.keySet() ) {</span>
<span class="nc" id="L111">                sb.append(&quot;    &quot;).append(port.toString()).append(&quot;: &quot;);</span>
<span class="nc" id="L112">                Actor actor = this.actors.get(port);</span>
<span class="nc bnc" id="L113" title="All 2 branches missed.">                if ( actor.getName() == ActorType.LARGE ) {</span>
<span class="nc" id="L114">                    sb.append(&quot;large&quot;);</span>
<span class="nc bnc" id="L115" title="All 2 branches missed.">                } else if ( actor.getName() == ActorType.MEDIUM ) {</span>
<span class="nc" id="L116">                    sb.append(&quot;middle&quot;);</span>
                } else {
<span class="nc" id="L118">                    throw new RuntimeException(&quot;Key.E3&quot;);</span>
                }
<span class="nc" id="L120">                sb.append(&quot; motor, &quot;);</span>
<span class="nc bnc" id="L121" title="All 2 branches missed.">                if ( actor.isRegulated() ) {</span>
<span class="nc" id="L122">                    sb.append(&quot;regulated&quot;);</span>
                } else {
<span class="nc" id="L124">                    sb.append(&quot;unregulated&quot;);</span>
                }
<span class="nc" id="L126">                sb.append(&quot;, &quot;);</span>
<span class="nc" id="L127">                String rotationDirection = actor.getRotationDirection().toString().toLowerCase();</span>
<span class="nc bnc" id="L128" title="All 2 branches missed.">                sb.append(rotationDirection.equals(&quot;foreward&quot;) ? &quot;forward&quot; : rotationDirection); // TODO: remove this hack; rename FOIREWARD tp FORWARD (be careful!)</span>
<span class="nc" id="L129">                MotorSide motorSide = (MotorSide) actor.getMotorSide();</span>
<span class="nc bnc" id="L130" title="All 2 branches missed.">                if ( motorSide != MotorSide.NONE ) {</span>
<span class="nc" id="L131">                    sb.append(&quot;, &quot;).append(motorSide.getText());</span>

                }
<span class="nc" id="L134">                sb.append(&quot;;\n&quot;);</span>
<span class="nc" id="L135">            }</span>
<span class="nc" id="L136">            sb.append(&quot;  }\n&quot;);</span>
        }
<span class="nc" id="L138">        sb.append(&quot;}&quot;);</span>
<span class="nc" id="L139">        return sb.toString();</span>
    }

    /**
     * This class is a builder of {@link Configuration}
     */
<span class="fc" id="L145">    public static class Builder extends Configuration.Builder&lt;Builder&gt; {</span>
<span class="fc" id="L146">        private final Map&lt;IActorPort, Actor&gt; actorMapping = new TreeMap&lt;&gt;();</span>
<span class="fc" id="L147">        private final Map&lt;ISensorPort, Sensor&gt; sensorMapping = new TreeMap&lt;&gt;();</span>

        private double wheelDiameter;
        private double trackWidth;

        /**
         * Add actor to the {@link Configuration}
         *
         * @param port on which the component is connected
         * @param actor we want to connect
         * @return
         */
        @Override
        public Builder addActor(IActorPort port, Actor actor) {
<span class="fc" id="L161">            this.actorMapping.put(port, actor);</span>
<span class="fc" id="L162">            return this;</span>
        }

        /**
         * Client must provide list of {@link Pair} ({@link ActorPort} and {@link Actor})
         *
         * @param actors we want to connect to the brick configuration
         * @return
         */
        @Override
        public Builder addActors(List&lt;Pair&lt;IActorPort, Actor&gt;&gt; actors) {
<span class="nc bnc" id="L173" title="All 2 branches missed.">            for ( Pair&lt;IActorPort, Actor&gt; pair : actors ) {</span>
<span class="nc" id="L174">                this.actorMapping.put(pair.getFirst(), pair.getSecond());</span>
<span class="nc" id="L175">            }</span>
<span class="nc" id="L176">            return this;</span>
        }

        /**
         * Add sensor to the {@link Configuration}
         *
         * @param port on which the component is connected
         * @param component we want to connect
         * @return
         */

        @Override
        public Builder addSensor(ISensorPort port, Sensor sensor) {
<span class="fc" id="L189">            this.sensorMapping.put(port, sensor);</span>
<span class="fc" id="L190">            return this;</span>
        }

        /**
         * Client must provide list of {@link Pair} ({@link SensorPort} and {@link Sensor})
         *
         * @param sensors we want to connect to the brick configuration
         * @return
         */
        @Override
        public Builder addSensors(List&lt;Pair&lt;ISensorPort, Sensor&gt;&gt; sensors) {
<span class="nc bnc" id="L201" title="All 2 branches missed.">            for ( Pair&lt;ISensorPort, Sensor&gt; pair : sensors ) {</span>
<span class="nc" id="L202">                this.sensorMapping.put(pair.getFirst(), pair.getSecond());</span>
<span class="nc" id="L203">            }</span>
<span class="nc" id="L204">            return this;</span>
        }

        /**
         * Set the wheel diameter
         *
         * @param wheelDiameter in cm
         * @return
         */
        @Override
        public Builder setWheelDiameter(double wheelDiameter) {
<span class="fc" id="L215">            this.wheelDiameter = wheelDiameter;</span>
<span class="fc" id="L216">            return this;</span>
        }

        /**
         * Set the track width
         *
         * @param trackWidth in cm
         * @return
         */
        @Override
        public Builder setTrackWidth(double trackWidth) {
<span class="fc" id="L227">            this.trackWidth = trackWidth;</span>
<span class="fc" id="L228">            return this;</span>
        }

        @Override
        public Configuration build() {
<span class="fc" id="L233">            return new EV3Configuration(this.actorMapping, this.sensorMapping, this.wheelDiameter, this.trackWidth);</span>
        }

        @Override
        public String toString() {
<span class="nc" id="L238">            return &quot;Builder [actorMapping=&quot;</span>
                + this.actorMapping
                + &quot;, sensorMapping=&quot;
                + this.sensorMapping
                + &quot;, wheelDiameter=&quot;
                + this.wheelDiameter
                + &quot;, trackWidth=&quot;
                + this.trackWidth
                + &quot;]&quot;;
        }

    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>