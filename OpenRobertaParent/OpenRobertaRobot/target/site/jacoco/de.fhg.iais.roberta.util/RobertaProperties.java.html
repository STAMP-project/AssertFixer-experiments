<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>RobertaProperties.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">OpenRobertaRobot</a> &gt; <a href="index.source.html" class="el_package">de.fhg.iais.roberta.util</a> &gt; <span class="el_source">RobertaProperties.java</span></div><h1>RobertaProperties.java</h1><pre class="source lang-java linenums">package de.fhg.iais.roberta.util;

import java.util.Arrays;
import java.util.Collections;
import java.util.List;
import java.util.Properties;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import de.fhg.iais.roberta.util.dbc.Assert;
import de.fhg.iais.roberta.util.dbc.DbcException;

public class RobertaProperties {
<span class="fc" id="L15">    private static final Logger LOG = LoggerFactory.getLogger(RobertaProperties.class);</span>
    public static final String NAME_OF_SIM = &quot;sim&quot;;
    public static final String ROBOT_WHITE_LIST_PROPERTY_KEY = &quot;robot.whitelist&quot;;
    public static final String ROBOT_DEFAULT_PROPERTY_KEY = &quot;robot.default&quot;;
    public static final String PLUGIN_TEMPDIR_PROPERTY_KEY = &quot;plugin.tempdir&quot;;

    private final Properties robertaProperties;
    private final String defaultRobot;
    private final List&lt;String&gt; robotsOnWhiteList;
    private final String tempDir;

    /**
     * store the final set of properties, that control the OpenRoberta system.&lt;br&gt;
     * &lt;br&gt;
     * After the ServerStarter has loaded the properties, merged with optional runtime properties, it calls this method with the (final) set of properties. They
     * are stored in this class. From here they can be retrieved and used elsewhere.&lt;br&gt;
     * &lt;b&gt;But note:&lt;/b&gt; Getting properties from &lt;b&gt;&lt;i&gt;Guice&lt;/i&gt;&lt;/b&gt; is &lt;b&gt;preferred&lt;/b&gt;
     *
     * @param properties
     */
<span class="fc" id="L35">    public RobertaProperties(Properties properties) {</span>
<span class="fc" id="L36">        Assert.notNull(properties);</span>
<span class="fc" id="L37">        this.robertaProperties = properties;</span>

        // process the white list and get the default robot
<span class="fc" id="L40">        String whiteList = getStringProperty(ROBOT_WHITE_LIST_PROPERTY_KEY);</span>
<span class="fc" id="L41">        Assert.notNull(whiteList, &quot;Property \&quot;&quot; + ROBOT_WHITE_LIST_PROPERTY_KEY + &quot;\&quot; not found&quot;);</span>
<span class="fc" id="L42">        String[] whiteListItems = whiteList.split(&quot;\\s*,\\s*&quot;);</span>
<span class="pc bpc" id="L43" title="1 of 2 branches missed.">        Assert.isTrue(whiteListItems.length &gt;= 1, &quot;Property \&quot;&quot; + ROBOT_WHITE_LIST_PROPERTY_KEY + &quot;\&quot; must contain at least one real robot&quot;);</span>
<span class="fc" id="L44">        String defaultRobot = getStringProperty(ROBOT_DEFAULT_PROPERTY_KEY);</span>
<span class="pc bpc" id="L45" title="1 of 2 branches missed.">        if ( defaultRobot != null ) {</span>
<span class="nc" id="L46">            this.defaultRobot = defaultRobot;</span>
<span class="pc bpc" id="L47" title="1 of 2 branches missed.">        } else if ( whiteListItems[0].equals(NAME_OF_SIM) ) {</span>
<span class="nc bnc" id="L48" title="All 2 branches missed.">            Assert.isTrue(</span>
                whiteListItems.length &gt;= 2,
                &quot;Property \&quot;&quot; + ROBOT_WHITE_LIST_PROPERTY_KEY + &quot;\&quot; must contain at least one robot different from \&quot;&quot; + NAME_OF_SIM + &quot;\&quot;&quot;);
<span class="nc" id="L51">            this.defaultRobot = whiteListItems[1];</span>
        } else {
<span class="fc" id="L53">            this.defaultRobot = whiteListItems[0];</span>
        }
<span class="fc" id="L55">        this.robotsOnWhiteList = Collections.unmodifiableList(Arrays.asList(whiteListItems));</span>
<span class="fc" id="L56">        this.robertaProperties.put(ROBOT_DEFAULT_PROPERTY_KEY, this.defaultRobot);</span>

        // made a robust choice about the temporary directory
<span class="fc" id="L59">        String tempTempDir = getStringProperty(PLUGIN_TEMPDIR_PROPERTY_KEY);</span>
<span class="pc bpc" id="L60" title="1 of 2 branches missed.">        if ( tempTempDir == null ) {</span>
<span class="fc" id="L61">            tempTempDir = System.getProperty(&quot;java.io.tmpdir&quot;);</span>
<span class="fc" id="L62">            Assert.notNull(tempTempDir, &quot;could not allocate a temporary directory&quot;);</span>
        }
<span class="pc bpc" id="L64" title="2 of 4 branches missed.">        if ( !(tempTempDir.endsWith(&quot;/&quot;) || tempTempDir.endsWith(&quot;\\&quot;)) ) {</span>
<span class="fc" id="L65">            this.tempDir = tempTempDir + &quot;/&quot;;</span>
        } else {
<span class="nc" id="L67">            this.tempDir = tempTempDir;</span>
        }
<span class="fc" id="L69">        this.robertaProperties.put(PLUGIN_TEMPDIR_PROPERTY_KEY, this.tempDir);</span>
<span class="fc" id="L70">        LOG.info(&quot;As temporary directory &quot; + this.tempDir + &quot; will be used&quot;);</span>
<span class="fc" id="L71">    }</span>

    public Properties getRobertaProperties() {
<span class="nc" id="L74">        Assert.notNull(this.robertaProperties);</span>
<span class="nc" id="L75">        return this.robertaProperties;</span>
    }

    public String getStringProperty(String propertyName) {
<span class="fc" id="L79">        Assert.notNull(this.robertaProperties);</span>
<span class="fc" id="L80">        return this.robertaProperties.getProperty(propertyName);</span>
    }

    public int getIntProperty(String propertyName) {
<span class="nc" id="L84">        Assert.notNull(this.robertaProperties);</span>
<span class="nc" id="L85">        String property = this.robertaProperties.getProperty(propertyName);</span>
<span class="nc" id="L86">        return Integer.parseInt(property);</span>
    }

    public int getIntProperty(String propertyName, int defaultValue) {
<span class="nc" id="L90">        Assert.notNull(this.robertaProperties);</span>
<span class="nc" id="L91">        String property = this.robertaProperties.getProperty(propertyName);</span>
<span class="nc bnc" id="L92" title="All 2 branches missed.">        if ( property == null ) {</span>
<span class="nc" id="L93">            return defaultValue;</span>
        } else {
<span class="nc" id="L95">            return Integer.parseInt(property);</span>
        }
    }

    public boolean getBooleanProperty(String propertyName) {
<span class="nc" id="L100">        Assert.notNull(this.robertaProperties);</span>
<span class="nc" id="L101">        String property = this.robertaProperties.getProperty(propertyName);</span>
<span class="nc" id="L102">        return Boolean.parseBoolean(property);</span>
    }

    public int getRobotNumberFromProperty(String robotName) {
<span class="fc" id="L106">        Assert.notNull(this.robertaProperties);</span>
<span class="pc bpc" id="L107" title="1 of 2 branches missed.">        for ( int i = 1; i &lt; 1000; i++ ) {</span>
<span class="fc" id="L108">            String value = this.robertaProperties.getProperty(&quot;robot.plugin.&quot; + i + &quot;.name&quot;);</span>
<span class="fc bfc" id="L109" title="All 2 branches covered.">            if ( value == null ) {</span>
<span class="fc" id="L110">                throw new DbcException(&quot;Robot with name: &quot; + robotName + &quot; not found!&quot;);</span>
            }
<span class="fc bfc" id="L112" title="All 2 branches covered.">            if ( value.equals(robotName) ) {</span>
<span class="fc" id="L113">                return i;</span>
            }
        }
<span class="nc" id="L116">        throw new DbcException(&quot;Only 999 robots supported!&quot;);</span>
    }

    public List&lt;String&gt; getRobotWhitelist() {
<span class="nc" id="L120">        return this.robotsOnWhiteList;</span>
    }

    public String getDefaultRobot() {
<span class="nc" id="L124">        return this.defaultRobot;</span>
    }

    public String getTempDir() {
<span class="nc" id="L128">        return this.tempDir;</span>
    }

    public String getTempDirFor(String kindOfTempDir) {
<span class="nc" id="L132">        return this.tempDir + kindOfTempDir + &quot;/&quot;;</span>
    }

    public String getTempDirForUserProjects() {
<span class="nc" id="L136">        return getTempDirFor(&quot;userProjects&quot;);</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>